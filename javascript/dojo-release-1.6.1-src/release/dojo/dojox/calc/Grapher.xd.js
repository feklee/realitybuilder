/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realitybuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.calc.Grapher"],["require","dijit._Templated"],["require","dojox.math._base"],["require","dijit.dijit"],["require","dijit.form.DropDownButton"],["require","dijit.TooltipDialog"],["require","dijit.form.TextBox"],["require","dijit.form.Button"],["require","dijit.form.ComboBox"],["require","dijit.form.Select"],["require","dijit.form.CheckBox"],["require","dijit.ColorPalette"],["require","dojox.charting.Chart2D"],["require","dojox.charting.themes.Tufte"],["require","dojo.colors"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.calc.Grapher"]){_4._hasResource["dojox.calc.Grapher"]=true;_4.provide("dojox.calc.Grapher");_4.require("dijit._Templated");_4.require("dojox.math._base");_4.require("dijit.dijit");_4.require("dijit.form.DropDownButton");_4.require("dijit.TooltipDialog");_4.require("dijit.form.TextBox");_4.require("dijit.form.Button");_4.require("dijit.form.ComboBox");_4.require("dijit.form.Select");_4.require("dijit.form.CheckBox");_4.require("dijit.ColorPalette");_4.require("dojox.charting.Chart2D");_4.require("dojox.charting.themes.Tufte");_4.require("dojo.colors");_4.experimental("dojox.calc.Grapher");_4.declare("dojox.calc.Grapher",[_5._Widget,_5._Templated],{templateString:_4.cache("dojox.calc","templates/Grapher.html","<div>\r\n<div dojoAttachPoint=\"chartsParent\" class=\"dojoxCalcChartHolder\"></div>\r\n<span dojoAttachPoint=\"outerDiv\">\r\n<div dojoType=\"dijit.form.DropDownButton\" dojoAttachPoint=\"windowOptions\" class=\"dojoxCalcDropDownForWindowOptions\" title=\"Window Options\">\r\n\t<div>Window Options</div>\r\n\t<div dojoType=\"dijit.TooltipDialog\" dojoAttachPoint=\"windowOptionsInside\" class=\"dojoxCalcTooltipDialogForWindowOptions\" title=\"\">\r\n\t\t<table class=\"dojoxCalcGraphOptionTable\">\r\n\t\t\t<tr>\r\n\t\t\t\t<td>\r\n\t\t\t\t\tWidth:\r\n\t\t\t\t</td>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<input dojoType=\"dijit.form.TextBox\" dojoAttachPoint=\"graphWidth\" class=\"dojoxCalcGraphWidth\" value=\"500\" />\r\n\t\t\t\t</td>\r\n\t\t\t\t<td>\r\n\t\t\t\t\tHeight:\r\n\t\t\t\t</td>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<input dojoType=\"dijit.form.TextBox\" dojoAttachPoint=\"graphHeight\" class=\"dojoxCalcGraphHeight\" value=\"500\" />\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td>\r\n\t\t\t\t\tX >=\r\n\t\t\t\t</td>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<input dojoType=\"dijit.form.TextBox\" dojoAttachPoint=\"graphMinX\" class=\"dojoxCalcGraphMinX\" value=\"-10\" />\r\n\t\t\t\t</td>\r\n\r\n\t\t\t\t<td>\r\n\t\t\t\t\tX <=\r\n\t\t\t\t</td>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<input dojoType=\"dijit.form.TextBox\" dojoAttachPoint=\"graphMaxX\" class=\"dojoxCalcGraphMaxX\" value=\"10\" />\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td>\r\n\t\t\t\t\tY >=\r\n\t\t\t\t</td>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<input dojoType=\"dijit.form.TextBox\" dojoAttachPoint=\"graphMinY\" class=\"dojoxCalcGraphMinY\" value=\"-10\" />\r\n\t\t\t\t</td>\r\n\r\n\t\t\t\t<td>\r\n\t\t\t\t\tY <=\r\n\t\t\t\t</td>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<input dojoType=\"dijit.form.TextBox\" dojoAttachPoint=\"graphMaxY\" class=\"dojoxCalcGraphMaxY\" value=\"10\" />\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t</div>\r\n</div>\r\n\r\n<BR>\r\n\r\n<div class=\"dojoxCalcGrapherFuncOuterDiv\">\r\n\t<table class=\"dojoxCalcGrapherFuncTable\" dojoAttachPoint=\"graphTable\">\r\n\t</table>\r\n</div>\r\n\r\n<div dojoType=\"dijit.form.DropDownButton\" dojoAttachPoint='addFuncButton' class=\"dojoxCalcDropDownAddingFunction\">\r\n\t<div>Add Function</div>\r\n\t<div dojoType=\"dijit.TooltipDialog\" dojoAttachPoint=\"addFuncInside\" class=\"dojoxCalcTooltipDialogAddingFunction\" title=\"\">\r\n\t\t<table class=\"dojoxCalcGrapherModeTable\">\r\n\t\t\t<tr>\r\n\t\t\t\t<td>\r\n\t\t\t\t\tMode:\r\n\t\t\t\t</td>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<select dojoType=\"dijit.form.Select\" dojoAttachPoint=\"funcMode\" class=\"dojoxCalcFunctionModeSelector\">\r\n\t\t\t\t\t\t<option value=\"y=\" selected=\"selected\">y=</option>\r\n\t\t\t\t\t\t<option value=\"x=\">x=</option>\r\n\t\t\t\t\t</select>\r\n\t\t\t\t</td>\r\n\t\t\t\t<td>\r\n\t\t\t</tr>\r\n\t\r\n\t\t\t<tr>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<input dojoType=\"dijit.form.Button\" dojoAttachPoint=\"createFunc\" class=\"dojoxCalcAddFunctionButton\" label=\"Create\" />\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t</div>\r\n</div>\r\n<BR>\r\n<BR>\r\n<table class=\"dijitInline dojoxCalcGrapherLayout\">\r\n\t<tr>\r\n\t\t<td class=\"dojoxCalcGrapherButtonContainer\">\r\n\t\t\t<input dojoType=\"dijit.form.Button\" class=\"dojoxCalcGrapherButton\" dojoAttachPoint='selectAllButton' label=\"Select All\" />\r\n\t\t</td>\r\n\t\t<td class=\"dojoxCalcGrapherButtonContainer\">\r\n\t\t\t<input dojoType=\"dijit.form.Button\" class=\"dojoxCalcGrapherButton\" dojoAttachPoint='deselectAllButton' label=\"Deselect All\" />\r\n\t\t</td>\r\n\t</tr>\r\n\t<tr>\r\n\t\t<td class=\"dojoxCalcGrapherButtonContainer\">\r\n\t\t\t<input dojoType=\"dijit.form.Button\" class=\"dojoxCalcGrapherButton\" dojoAttachPoint='drawButton'label=\"Draw Selected\" />\r\n\t\t</td>\r\n\t\t<td class=\"dojoxCalcGrapherButtonContainer\">\r\n\t\t\t<input dojoType=\"dijit.form.Button\" class=\"dojoxCalcGrapherButton\" dojoAttachPoint='eraseButton' label=\"Erase Selected\" />\r\n\t\t</td>\r\n\t</tr>\r\n\t<tr>\r\n\t\t<td class=\"dojoxCalcGrapherButtonContainer\">\r\n\t\t\t<input dojoType=\"dijit.form.Button\" class=\"dojoxCalcGrapherButton\" dojoAttachPoint='deleteButton' label=\"Delete Selected\" />\r\n\t\t</td>\r\n\t\t<td class=\"dojoxCalcGrapherButtonContainer\">\r\n\t\t\t<input dojoType=\"dijit.form.Button\" class=\"dojoxCalcGrapherButton\" dojoAttachPoint='closeButton' label=\"Close\" />\r\n\t\t</td>\r\n\t</tr>\r\n</table>\r\n</span>\r\n</div>\r\n"),widgetsInTemplate:true,addXYAxes:function(_7){return _7.addAxis("x",{max:parseInt(this.graphMaxX.get("value")),min:parseInt(this.graphMinX.get("value")),majorLabels:true,minorLabels:true,minorTicks:false,microTicks:false,htmlLabels:true,labelFunc:function(_8){return _8;},maxLabelSize:30,fixUpper:"major",fixLower:"major",majorTick:{length:3}}).addAxis("y",{max:parseInt(this.graphMaxY.get("value")),min:parseInt(this.graphMinY.get("value")),labelFunc:function(_9){return _9;},maxLabelSize:50,vertical:true,microTicks:false,minorTicks:true,majorTick:{stroke:"black",length:3}});},selectAll:function(){for(var i=0;i<this.rowCount;i++){this.array[i][this.checkboxIndex].set("checked",true);}},deselectAll:function(){for(var i=0;i<this.rowCount;i++){this.array[i][this.checkboxIndex].set("checked",false);}},drawOne:function(i){},onDraw:function(){console.log("Draw was pressed");},erase:function(i){var _a=0;var _b="Series "+this.array[i][this.funcNumberIndex]+"_"+_a;while(_b in this.array[i][this.chartIndex].runs){this.array[i][this.chartIndex].removeSeries(_b);_a++;_b="Series "+this.array[i][this.funcNumberIndex]+"_"+_a;}this.array[i][this.chartIndex].render();this.setStatus(i,"Hidden");},onErase:function(){for(var i=0;i<this.rowCount;i++){if(this.array[i][this.checkboxIndex].get("checked")){this.erase(i);}}},onDelete:function(){for(var i=0;i<this.rowCount;i++){if(this.array[i][this.checkboxIndex].get("checked")){this.erase(i);for(var k=0;k<this.functionRef;k++){if(this.array[i][k]&&this.array[i][k]["destroy"]){this.array[i][k].destroy();}}this.graphTable.deleteRow(i);this.array.splice(i,1);this.rowCount--;i--;}}},checkboxIndex:0,functionMode:1,expressionIndex:2,colorIndex:3,dropDownIndex:4,tooltipIndex:5,colorBoxFieldsetIndex:6,statusIndex:7,chartIndex:8,funcNumberIndex:9,evaluatedExpression:10,functionRef:11,createFunction:function(){var tr=this.graphTable.insertRow(-1);this.array[tr.rowIndex]=[];var td=tr.insertCell(-1);var d=_4.create("div");td.appendChild(d);var _c=new _5.form.CheckBox({},d);this.array[tr.rowIndex][this.checkboxIndex]=_c;_4.addClass(d,"dojoxCalcCheckBox");td=tr.insertCell(-1);var _d=this.funcMode.get("value");d=_4.doc.createTextNode(_d);td.appendChild(d);this.array[tr.rowIndex][this.functionMode]=_d;td=tr.insertCell(-1);d=_4.create("div");td.appendChild(d);var _e=new _5.form.TextBox({},d);this.array[tr.rowIndex][this.expressionIndex]=_e;_4.addClass(d,"dojoxCalcExpressionBox");var b=_4.create("div");var _f=new _5.ColorPalette({changedColor:this.changedColor},b);_4.addClass(b,"dojoxCalcColorPalette");this.array[tr.rowIndex][this.colorIndex]=_f;var c=_4.create("div");var _10=new _5.TooltipDialog({content:_f},c);this.array[tr.rowIndex][this.tooltipIndex]=_10;_4.addClass(c,"dojoxCalcContainerOfColor");td=tr.insertCell(-1);d=_4.create("div");td.appendChild(d);var _11=_4.create("fieldset");_4.style(_11,{backgroundColor:"black",width:"1em",height:"1em",display:"inline"});this.array[tr.rowIndex][this.colorBoxFieldsetIndex]=_11;var _12=new _5.form.DropDownButton({label:"Color ",dropDown:_10},d);_12.containerNode.appendChild(_11);this.array[tr.rowIndex][this.dropDownIndex]=_12;_4.addClass(d,"dojoxCalcDropDownForColor");td=tr.insertCell(-1);d=_4.create("fieldset");d.innerHTML="Hidden";this.array[tr.rowIndex][this.statusIndex]=d;_4.addClass(d,"dojoxCalcStatusBox");td.appendChild(d);d=_4.create("div");_4.style(d,{position:"absolute",left:"0px",top:"0px"});this.chartsParent.appendChild(d);this.array[tr.rowIndex][this.chartNodeIndex]=d;_4.addClass(d,"dojoxCalcChart");var _13=new _6.charting.Chart2D(d).setTheme(_6.charting.themes.Tufte).addPlot("default",{type:"Lines",shadow:{dx:1,dy:1,width:2,color:[0,0,0,0.3]}});this.addXYAxes(_13);this.array[tr.rowIndex][this.chartIndex]=_13;_f.set("chart",_13);_f.set("colorBox",_11);_f.set("onChange",_4.hitch(_f,"changedColor"));this.array[tr.rowIndex][this.funcNumberIndex]=this.funcNumber++;this.rowCount++;},setStatus:function(i,_14){this.array[i][this.statusIndex].innerHTML=_14;},changedColor:function(){var _15=this.get("chart");var _16=this.get("colorBox");for(var i=0;i<_15.series.length;i++){if(_15.series[i]["stroke"]){if(_15.series[i].stroke["color"]){_15.series[i]["stroke"].color=this.get("value");_15.dirty=true;}}}_15.render();_4.style(_16,{backgroundColor:this.get("value")});},makeDirty:function(){this.dirty=true;},checkDirty1:function(){setTimeout(_4.hitch(this,"checkDirty"),0);},checkDirty:function(){if(this.dirty){for(var i=0;i<this.rowCount;i++){this.array[i][this.chartIndex].removeAxis("x");this.array[i][this.chartIndex].removeAxis("y");this.addXYAxes(this.array[i][this.chartIndex]);}this.onDraw();}this.dirty=false;},postCreate:function(){this.inherited(arguments);this.createFunc.set("onClick",_4.hitch(this,"createFunction"));this.selectAllButton.set("onClick",_4.hitch(this,"selectAll"));this.deselectAllButton.set("onClick",_4.hitch(this,"deselectAll"));this.drawButton.set("onClick",_4.hitch(this,"onDraw"));this.eraseButton.set("onClick",_4.hitch(this,"onErase"));this.deleteButton.set("onClick",_4.hitch(this,"onDelete"));this.dirty=false;this.graphWidth.set("onChange",_4.hitch(this,"makeDirty"));this.graphHeight.set("onChange",_4.hitch(this,"makeDirty"));this.graphMaxX.set("onChange",_4.hitch(this,"makeDirty"));this.graphMinX.set("onChange",_4.hitch(this,"makeDirty"));this.graphMaxY.set("onChange",_4.hitch(this,"makeDirty"));this.graphMinY.set("onChange",_4.hitch(this,"makeDirty"));this.windowOptionsInside.set("onClose",_4.hitch(this,"checkDirty1"));this.funcNumber=0;this.rowCount=0;this.array=[];},startup:function(){this.inherited(arguments);var _17=_5.getEnclosingWidget(this.domNode.parentNode);if(_17&&typeof _17.close=="function"){this.closeButton.set("onClick",_4.hitch(_17,"close"));}else{_4.style(this.closeButton.domNode,"display","none");}this.createFunction();this.array[0][this.checkboxIndex].set("checked",true);this.onDraw();this.erase(0);this.array[0][this.expressionIndex].value="";}});(function(){var _18=1e-15/9,_19=1e+200,_1a=Math.log(2),_1b={graphNumber:0,fOfX:true,color:{stroke:"black"}};_6.calc.Grapher.draw=function(_1c,_1d,_1e){_1e=_4.mixin({},_1b,_1e);_1c.fullGeometry();var x;var y;var _1f;if(_1e.fOfX==true){x="x";y="y";_1f=_6.calc.Grapher.generatePoints(_1d,x,y,_1c.axes.x.scaler.bounds.span,_1c.axes.x.scaler.bounds.lower,_1c.axes.x.scaler.bounds.upper,_1c.axes.y.scaler.bounds.lower,_1c.axes.y.scaler.bounds.upper);}else{x="y";y="x";_1f=_6.calc.Grapher.generatePoints(_1d,x,y,_1c.axes.y.scaler.bounds.span,_1c.axes.y.scaler.bounds.lower,_1c.axes.y.scaler.bounds.upper,_1c.axes.x.scaler.bounds.lower,_1c.axes.x.scaler.bounds.upper);}var i=0;if(_1f.length>0){for(;i<_1f.length;i++){if(_1f[i].length>0){_1c.addSeries("Series "+_1e.graphNumber+"_"+i,_1f[i],_1e.color);}}}var _20="Series "+_1e.graphNumber+"_"+i;while(_20 in _1c.runs){_1c.removeSeries(_20);i++;_20="Series "+_1e.graphNumber+"_"+i;}_1c.render();return _1f;};_6.calc.Grapher.generatePoints=function(_21,x,y,_22,_23,_24,_25,_26){var _27=(1<<Math.ceil(Math.log(_22)/_1a));var dx=(_24-_23)/_27,_28=[],_29=0,_2a,_2b;_28[_29]=[];var i=_23,k,p;for(var _2c=0;_2c<=_27;i+=dx,_2c++){p={};p[x]=i;p[y]=_21({_name:x,_value:i,_graphing:true});if(p[x]==null||p[y]==null){return {};}if(isNaN(p[y])||isNaN(p[x])){continue;}_28[_29].push(p);if(_28[_29].length==3){_2a=_2d(_2e(_28[_29][_28[_29].length-3],_28[_29][_28[_29].length-2]),_2e(_28[_29][_28[_29].length-2],_28[_29][_28[_29].length-1]));continue;}if(_28[_29].length<4){continue;}_2b=_2d(_2e(_28[_29][_28[_29].length-3],_28[_29][_28[_29].length-2]),_2e(_28[_29][_28[_29].length-2],_28[_29][_28[_29].length-1]));if(_2a.inc!=_2b.inc||_2a.pos!=_2b.pos){var a=_2f(_21,_28[_29][_28[_29].length-3],_28[_29][_28[_29].length-1]);p=_28[_29].pop();_28[_29].pop();for(var j=0;j<a[0].length;j++){_28[_29].push(a[0][j]);}for(k=1;k<a.length;k++){_28[++_29]=a.pop();}_28[_29].push(p);_2a=_2b;}}while(_28.length>1){for(k=0;k<_28[1].length;k++){if(_28[0][_28[0].length-1][x]==_28[1][k][x]){continue;}_28[0].push(_28[1][k]);}_28.splice(1,1);}_28=_28[0];var s=0;var _30=[[]];for(k=0;k<_28.length;k++){var x1,y1,b,_31;if(isNaN(_28[k][y])||isNaN(_28[k][x])){while(isNaN(_28[k][y])||isNaN(_28[k][x])){_28.splice(k,1);}_30[++s]=[];k--;}else{if(_28[k][y]>_26||_28[k][y]<_25){if(k>0&&_28[k-1].y!=_25&&_28[k-1].y!=_26){_31=_2e(_28[k-1],_28[k]);if(_31>_19){_31=_19;}else{if(_31<-_19){_31=-_19;}}if(_28[k][y]>_26){y1=_26;}else{y1=_25;}b=_28[k][y]-_31*_28[k][x];x1=(y1-b)/_31;p={};p[x]=x1;p[y]=_21(x1);if(p[y]!=y1){p=_32(_21,_28[k-1],_28[k],y1);}_30[s].push(p);_30[++s]=[];}var _33=k;while(k<_28.length&&(_28[k][y]>_26||_28[k][y]<_25)){k++;}if(k>=_28.length){if(_30[s].length==0){_30.splice(s,1);}break;}if(k>0&&_28[k].y!=_25&&_28[k].y!=_26){_31=_2e(_28[k-1],_28[k]);if(_31>_19){_31=_19;}else{if(_31<-_19){_31=-_19;}}if(_28[k-1][y]>_26){y1=_26;}else{y1=_25;}b=_28[k][y]-_31*_28[k][x];x1=(y1-b)/_31;p={};p[x]=x1;p[y]=_21(x1);if(p[y]!=y1){p=_32(_21,_28[k-1],_28[k],y1);}_30[s].push(p);_30[s].push(_28[k]);}}else{_30[s].push(_28[k]);}}}return _30;function _32(_34,_35,_36,_37){while(_35<=_36){var _38=(_35[x]+_36[x])/2;var mid={};mid[x]=_38;mid[y]=_34(mid[x]);if(_37==mid[y]||mid[x]==_36[x]||mid[x]==_35[x]){return mid;}var _39=true;if(_37<mid[y]){_39=false;}if(mid[y]<_36[y]){if(_39){_35=mid;}else{_36=mid;}}else{if(mid[y]<_35[y]){if(!_39){_35=mid;}else{_36=mid;}}}}return NaN;};function _2f(_3a,_3b,_3c){var _3d=[[],[]],_3e=_3b,_3f=_3c,_40;while(_3e[x]<=_3f[x]){var _41=(_3e[x]+_3f[x])/2;_40={};_40[x]=_41;_40[y]=_3a(_41);var rx=_42(_40[x]);var _43={};_43[x]=rx;_43[y]=_3a(rx);if(Math.abs(_43[y])>=Math.abs(_40[y])){_3d[0].push(_40);_3e=_43;}else{_3d[1].unshift(_40);if(_3f[x]==_40[x]){break;}_3f=_40;}}return _3d;};function _2d(_44,_45){var _46=false,_47=false;if(_44<_45){_46=true;}if(_45>0){_47=true;}return {inc:_46,pos:_47};};function _42(v){var _48;if(v>-1&&v<1){if(v<0){if(v>=-_18){_48=-v;}else{_48=v/Math.ceil(v/_18);}}else{_48=_18;}}else{_48=Math.abs(v)*_18;}return v+_48;};function _2e(p1,p2){return (p2[y]-p1[y])/(p2[x]-p1[x]);};};})();}}};});