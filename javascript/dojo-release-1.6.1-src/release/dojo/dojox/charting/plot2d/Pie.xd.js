/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realityBuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.charting.plot2d.Pie"],["require","dojox.charting.Element"],["require","dojox.charting.axis2d.common"],["require","dojox.charting.plot2d.common"],["require","dojox.charting.plot2d._PlotEvents"],["require","dojox.lang.functional"],["require","dojox.lang.utils"],["require","dojox.gfx"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.charting.plot2d.Pie"]){_4._hasResource["dojox.charting.plot2d.Pie"]=true;_4.provide("dojox.charting.plot2d.Pie");_4.require("dojox.charting.Element");_4.require("dojox.charting.axis2d.common");_4.require("dojox.charting.plot2d.common");_4.require("dojox.charting.plot2d._PlotEvents");_4.require("dojox.lang.functional");_4.require("dojox.lang.utils");_4.require("dojox.gfx");(function(){var df=_6.lang.functional,du=_6.lang.utils,dc=_6.charting.plot2d.common,da=_6.charting.axis2d.common,g=_6.gfx,m=g.matrix,_7=0.2;_4.declare("dojox.charting.plot2d.Pie",[_6.charting.Element,_6.charting.plot2d._PlotEvents],{defaultParams:{labels:true,ticks:false,fixed:true,precision:1,labelOffset:20,labelStyle:"default",htmlLabels:true,radGrad:"native",fanSize:5,startAngle:0},optionalParams:{radius:0,stroke:{},outline:{},shadow:{},fill:{},font:"",fontColor:"",labelWiring:{}},constructor:function(_8,_9){this.opt=_4.clone(this.defaultParams);du.updateWithObject(this.opt,_9);du.updateWithPattern(this.opt,_9,this.optionalParams);this.run=null;this.dyn=[];},clear:function(){this.dirty=true;this.dyn=[];this.run=null;return this;},setAxis:function(_a){return this;},addSeries:function(_b){this.run=_b;return this;},getSeriesStats:function(){return _4.delegate(dc.defaultStats);},initializeScalers:function(){return this;},getRequiredColors:function(){return this.run?this.run.data.length:0;},render:function(_c,_d){if(!this.dirty){return this;}this.resetEvents();this.dirty=false;this._eventSeries={};this.cleanGroup();var s=this.group,t=this.chart.theme;if(!this.run||!this.run.data.length){return this;}var rx=(_c.width-_d.l-_d.r)/2,ry=(_c.height-_d.t-_d.b)/2,r=Math.min(rx,ry),_e="font" in this.opt?this.opt.font:t.axis.font,_f=_e?g.normalizedLength(g.splitFontString(_e).size):0,_10="fontColor" in this.opt?this.opt.fontColor:t.axis.fontColor,_11=m._degToRad(this.opt.startAngle),_12=_11,_13,_14,_15,_16,_17,_18,run=this.run.data,_19=this.events();if(typeof run[0]=="number"){_14=df.map(run,"x ? Math.max(x, 0) : 0");if(df.every(_14,"<= 0")){return this;}_15=df.map(_14,"/this",df.foldl(_14,"+",0));if(this.opt.labels){_16=_4.map(_15,function(x){return x>0?this._getLabel(x*100)+"%":"";},this);}}else{_14=df.map(run,"x ? Math.max(x.y, 0) : 0");if(df.every(_14,"<= 0")){return this;}_15=df.map(_14,"/this",df.foldl(_14,"+",0));if(this.opt.labels){_16=_4.map(_15,function(x,i){if(x<=0){return "";}var v=run[i];return "text" in v?v.text:this._getLabel(x*100)+"%";},this);}}var _1a=df.map(run,function(v,i){if(v===null||typeof v=="number"){return t.next("slice",[this.opt,this.run],true);}return t.next("slice",[this.opt,this.run,v],true);},this);if(this.opt.labels){_17=df.foldl1(df.map(_16,function(_1b,i){var _1c=_1a[i].series.font;return _6.gfx._base._getTextBox(_1b,{font:_1c}).w;},this),"Math.max(a, b)")/2;if(this.opt.labelOffset<0){r=Math.min(rx-2*_17,ry-_f)+this.opt.labelOffset;}_18=r-this.opt.labelOffset;}if("radius" in this.opt){r=this.opt.radius;_18=r-this.opt.labelOffset;}var _1d={cx:_d.l+rx,cy:_d.t+ry,r:r};this.dyn=[];var _1e=new Array(_15.length);_4.some(_15,function(_1f,i){if(_1f<=0){return false;}var v=run[i],_20=_1a[i],_21;if(_1f>=1){_21=this._plotFill(_20.series.fill,_c,_d);_21=this._shapeFill(_21,{x:_1d.cx-_1d.r,y:_1d.cy-_1d.r,width:2*_1d.r,height:2*_1d.r});_21=this._pseudoRadialFill(_21,{x:_1d.cx,y:_1d.cy},_1d.r);var _22=s.createCircle(_1d).setFill(_21).setStroke(_20.series.stroke);this.dyn.push({fill:_21,stroke:_20.series.stroke});if(_19){var o={element:"slice",index:i,run:this.run,shape:_22,x:i,y:typeof v=="number"?v:v.y,cx:_1d.cx,cy:_1d.cy,cr:r};this._connectEvents(o);_1e[i]=o;}return true;}var end=_12+_1f*2*Math.PI;if(i+1==_15.length){end=_11+2*Math.PI;}var _23=end-_12,x1=_1d.cx+r*Math.cos(_12),y1=_1d.cy+r*Math.sin(_12),x2=_1d.cx+r*Math.cos(end),y2=_1d.cy+r*Math.sin(end);var _24=m._degToRad(this.opt.fanSize);if(_20.series.fill&&_20.series.fill.type==="radial"&&this.opt.radGrad==="fan"&&_23>_24){var _25=s.createGroup(),_26=Math.ceil(_23/_24),_27=_23/_26;_21=this._shapeFill(_20.series.fill,{x:_1d.cx-_1d.r,y:_1d.cy-_1d.r,width:2*_1d.r,height:2*_1d.r});for(var j=0;j<_26;++j){var _28=j==0?x1:_1d.cx+r*Math.cos(_12+(j-_7)*_27),_29=j==0?y1:_1d.cy+r*Math.sin(_12+(j-_7)*_27),_2a=j==_26-1?x2:_1d.cx+r*Math.cos(_12+(j+1+_7)*_27),_2b=j==_26-1?y2:_1d.cy+r*Math.sin(_12+(j+1+_7)*_27),fan=_25.createPath({}).moveTo(_1d.cx,_1d.cy).lineTo(_28,_29).arcTo(r,r,0,_27>Math.PI,true,_2a,_2b).lineTo(_1d.cx,_1d.cy).closePath().setFill(this._pseudoRadialFill(_21,{x:_1d.cx,y:_1d.cy},r,_12+(j+0.5)*_27,_12+(j+0.5)*_27));}_25.createPath({}).moveTo(_1d.cx,_1d.cy).lineTo(x1,y1).arcTo(r,r,0,_23>Math.PI,true,x2,y2).lineTo(_1d.cx,_1d.cy).closePath().setStroke(_20.series.stroke);_22=_25;}else{_22=s.createPath({}).moveTo(_1d.cx,_1d.cy).lineTo(x1,y1).arcTo(r,r,0,_23>Math.PI,true,x2,y2).lineTo(_1d.cx,_1d.cy).closePath().setStroke(_20.series.stroke);var _21=_20.series.fill;if(_21&&_21.type==="radial"){_21=this._shapeFill(_21,{x:_1d.cx-_1d.r,y:_1d.cy-_1d.r,width:2*_1d.r,height:2*_1d.r});if(this.opt.radGrad==="linear"){_21=this._pseudoRadialFill(_21,{x:_1d.cx,y:_1d.cy},r,_12,end);}}else{if(_21&&_21.type==="linear"){_21=this._plotFill(_21,_c,_d);_21=this._shapeFill(_21,_22.getBoundingBox());}}_22.setFill(_21);}this.dyn.push({fill:_21,stroke:_20.series.stroke});if(_19){var o={element:"slice",index:i,run:this.run,shape:_22,x:i,y:typeof v=="number"?v:v.y,cx:_1d.cx,cy:_1d.cy,cr:r};this._connectEvents(o);_1e[i]=o;}_12=end;return false;},this);if(this.opt.labels){if(this.opt.labelStyle=="default"){_12=_11;_4.some(_15,function(_2c,i){if(_2c<=0){return false;}var _2d=_1a[i];if(_2c>=1){var v=run[i],_2e=da.createText[this.opt.htmlLabels&&_6.gfx.renderer!="vml"?"html":"gfx"](this.chart,s,_1d.cx,_1d.cy+_f/2,"middle",_16[i],_2d.series.font,_2d.series.fontColor);if(this.opt.htmlLabels){this.htmlElements.push(_2e);}return true;}var end=_12+_2c*2*Math.PI,v=run[i];if(i+1==_15.length){end=_11+2*Math.PI;}var _2f=(_12+end)/2,x=_1d.cx+_18*Math.cos(_2f),y=_1d.cy+_18*Math.sin(_2f)+_f/2;var _2e=da.createText[this.opt.htmlLabels&&_6.gfx.renderer!="vml"?"html":"gfx"](this.chart,s,x,y,"middle",_16[i],_2d.series.font,_2d.series.fontColor);if(this.opt.htmlLabels){this.htmlElements.push(_2e);}_12=end;return false;},this);}else{if(this.opt.labelStyle=="columns"){_12=_11;var _30=[];_4.forEach(_15,function(_31,i){var end=_12+_31*2*Math.PI;if(i+1==_15.length){end=_11+2*Math.PI;}var _32=(_12+end)/2;_30.push({angle:_32,left:Math.cos(_32)<0,theme:_1a[i],index:i,omit:end-_12<0.001});_12=end;});var _33=_6.gfx._base._getTextBox("a",{font:_e}).h;this._getProperLabelRadius(_30,_33,_1d.r*1.1);_4.forEach(_30,function(_34,i){if(!_34.omit){var _35=_1d.cx-_1d.r*2,_36=_1d.cx+_1d.r*2,_37=_6.gfx._base._getTextBox(_16[i],{font:_e}).w,x=_1d.cx+_34.labelR*Math.cos(_34.angle),y=_1d.cy+_34.labelR*Math.sin(_34.angle),_38=(_34.left)?(_35+_37):(_36-_37),_39=(_34.left)?_35:_38;var _3a=s.createPath().moveTo(_1d.cx+_1d.r*Math.cos(_34.angle),_1d.cy+_1d.r*Math.sin(_34.angle));if(Math.abs(_34.labelR*Math.cos(_34.angle))<_1d.r*2-_37){_3a.lineTo(x,y);}_3a.lineTo(_38,y).setStroke(_34.theme.series.labelWiring);var _3b=da.createText[this.opt.htmlLabels&&_6.gfx.renderer!="vml"?"html":"gfx"](this.chart,s,_39,y,"left",_16[i],_34.theme.series.font,_34.theme.series.fontColor);if(this.opt.htmlLabels){this.htmlElements.push(_3b);}}},this);}}}var esi=0;this._eventSeries[this.run.name]=df.map(run,function(v){return v<=0?null:_1e[esi++];});return this;},_getProperLabelRadius:function(_3c,_3d,_3e){var _3f={},_40={},_41=1,_42=1;if(_3c.length==1){_3c[0].labelR=_3e;return;}for(var i=0;i<_3c.length;i++){var _43=Math.abs(Math.sin(_3c[i].angle));if(_3c[i].left){if(_41>_43){_41=_43;_3f=_3c[i];}}else{if(_42>_43){_42=_43;_40=_3c[i];}}}_3f.labelR=_40.labelR=_3e;this._caculateLabelR(_3f,_3c,_3d);this._caculateLabelR(_40,_3c,_3d);},_caculateLabelR:function(_44,_45,_46){var i=_44.index,_47=_45.length,_48=_44.labelR;while(!(_45[i%_47].left^_45[(i+1)%_47].left)){if(!_45[(i+1)%_47].omit){var _49=(Math.sin(_45[i%_47].angle)*_48+((_45[i%_47].left)?(-_46):_46))/Math.sin(_45[(i+1)%_47].angle);_48=(_49<_44.labelR)?_44.labelR:_49;_45[(i+1)%_47].labelR=_48;}i++;}i=_44.index,j=(i==0)?_47-1:i-1;while(!(_45[i].left^_45[j].left)){if(!_45[j].omit){var _49=(Math.sin(_45[i].angle)*_48+((_45[i].left)?_46:(-_46)))/Math.sin(_45[j].angle);_48=(_49<_44.labelR)?_44.labelR:_49;_45[j].labelR=_48;}i--;j--;i=(i<0)?i+_45.length:i;j=(j<0)?j+_45.length:j;}},_getLabel:function(_4a){return dc.getLabel(_4a,this.opt.fixed,this.opt.precision);}});})();}}};});