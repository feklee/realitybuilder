/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realitybuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.RailsStore"],["require","dojox.data.JsonRestStore"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.RailsStore"]){_4._hasResource["dojox.data.RailsStore"]=true;_4.provide("dojox.data.RailsStore");_4.require("dojox.data.JsonRestStore");_4.declare("dojox.data.RailsStore",_6.data.JsonRestStore,{constructor:function(){},preamble:function(_7){if(typeof _7.target=="string"&&!_7.service){var _8=_7.target.replace(/\/$/g,"");var _9=function(id,_a){_a=_a||{};var _b=_8;var _c;var _d;if(_4.isObject(id)){_d="";_c="?"+_4.objectToQuery(id);}else{if(_a.queryStr&&_a.queryStr.indexOf("?")!=-1){_d=_a.queryStr.replace(/\?.*/,"");_c=_a.queryStr.replace(/[^?]*\?/g,"?");}else{if(_4.isString(_a.query)&&_a.query.indexOf("?")!=-1){_d=_a.query.replace(/\?.*/,"");_c=_a.query.replace(/[^?]*\?/g,"?");}else{_d=id?id.toString():"";_c="";}}}if(_d.indexOf("=")!=-1){_c=_d;_d="";}if(_d){_b=_b+"/"+_d+".json"+_c;}else{_b=_b+".json"+_c;}var _e=_6.rpc._sync;_6.rpc._sync=false;return {url:_b,handleAs:"json",contentType:"application/json",sync:_e,headers:{Accept:"application/json,application/javascript",Range:_a&&(_a.start>=0||_a.count>=0)?"items="+(_a.start||"0")+"-"+((_a.count&&(_a.count+(_a.start||0)-1))||""):undefined}};};_7.service=_6.rpc.Rest(this.target,true,null,_9);}},fetch:function(_f){_f=_f||{};function _10(obj){function _11(){if(_f.queryStr==null){_f.queryStr="";}if(_4.isObject(_f.query)){_f.queryStr="?"+_4.objectToQuery(_f.query);}else{if(_4.isString(_f.query)){_f.queryStr=_f.query;}}};function _12(){if(_f.queryStr.indexOf("?")==-1){return "?";}else{return "&";}};if(_f.queryStr==null){_11();}_f.queryStr=_f.queryStr+_12()+_4.objectToQuery(obj);};if(_f.start||_f.count){if((_f.start||0)%_f.count){throw new Error("The start parameter must be a multiple of the count parameter");}_10({page:((_f.start||0)/_f.count)+1,per_page:_f.count});}if(_f.sort){var _13={sortBy:[],sortDir:[]};_4.forEach(_f.sort,function(_14){_13.sortBy.push(_14.attribute);_13.sortDir.push(!!_14.descending?"DESC":"ASC");});_10(_13);delete _f.sort;}return this.inherited(arguments);},_processResults:function(_15,_16){var _17;if((typeof this.rootAttribute=="undefined")&&_15[0]){if(_15[0][this.idAttribute]){this.rootAttribute=false;console.debug("RailsStore: without root_in_json");}else{for(var _18 in _15[0]){if(_15[0][_18][this.idAttribute]){this.rootAttribute=_18;console.debug("RailsStore: with root_in_json, attribute: "+_18);}}}}if(this.rootAttribute){_17=_4.map(_15,function(_19){return _19[this.rootAttribute];},this);}else{_17=_15;}var _1a=_15.length;return {totalCount:_16.fullLength||(_16.request.count==_1a?(_16.request.start||0)+_1a*2:_1a),items:_17};}});}}};});