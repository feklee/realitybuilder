/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realitybuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.drawing.Drawing"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.drawing.Drawing"]){_4._hasResource["dojox.drawing.Drawing"]=true;_4.provide("dojox.drawing.Drawing");(function(){var _7=false;_4.declare("dojox.drawing.Drawing",[],{ready:false,mode:"",width:0,height:0,constructor:function(_8,_9){var _a=_4.attr(_9,"defaults");if(_a){_6.drawing.defaults=_4.getObject(_a);}this.defaults=_6.drawing.defaults;this.id=_9.id;_6.drawing.register(this,"drawing");this.mode=(_8.mode||_4.attr(_9,"mode")||"").toLowerCase();var _b=_4.contentBox(_9);this.width=_b.w;this.height=_b.h;this.util=_6.drawing.util.common;this.util.register(this);this.keys=_6.drawing.manager.keys;this.mouse=new _6.drawing.manager.Mouse({util:this.util,keys:this.keys,id:this.mode=="ui"?"MUI":"mse"});this.mouse.setEventMode(this.mode);this.tools={};this.stencilTypes={};this.stencilTypeMap={};this.srcRefNode=_9;this.domNode=_9;var _c=_4.attr(_9,"plugins");if(_c){this.plugins=eval(_c);}else{this.plugins=[];}this.widgetId=this.id;_4.attr(this.domNode,"widgetId",this.widgetId);if(_5&&_5.registry){_5.registry.add(this);console.log("using dijit");}else{_5.registry={objs:{},add:function(_d){this.objs[_d.id]=_d;}};_5.byId=function(id){return _5.registry.objs[id];};_5.registry.add(this);}var _e=_6.drawing.getRegistered("stencil");for(var nm in _e){this.registerTool(_e[nm].name);}var _f=_6.drawing.getRegistered("tool");for(nm in _f){this.registerTool(_f[nm].name);}var _10=_6.drawing.getRegistered("plugin");for(nm in _10){this.registerTool(_10[nm].name);}this._createCanvas();},_createCanvas:function(){console.info("drawing create canvas...");this.canvas=new _6.drawing.manager.Canvas({srcRefNode:this.domNode,util:this.util,mouse:this.mouse,callback:_4.hitch(this,"onSurfaceReady")});this.initPlugins();},resize:function(box){box&&_4.style(this.domNode,{width:box.w+"px",height:box.h+"px"});if(!this.canvas){this._createCanvas();}else{if(box){this.canvas.resize(box.w,box.h);}}},startup:function(){},getShapeProps:function(_11,_12){var _13=_11.stencilType;var ui=this.mode=="ui"||_12=="ui";return _4.mixin({container:ui&&!_13?this.canvas.overlay.createGroup():this.canvas.surface.createGroup(),util:this.util,keys:this.keys,mouse:this.mouse,drawing:this,drawingType:ui&&!_13?"ui":"stencil",style:this.defaults.copy()},_11||{});},addPlugin:function(_14){this.plugins.push(_14);if(this.canvas.surfaceReady){this.initPlugins();}},initPlugins:function(){if(!this.canvas||!this.canvas.surfaceReady){var c=_4.connect(this,"onSurfaceReady",this,function(){_4.disconnect(c);this.initPlugins();});return;}_4.forEach(this.plugins,function(p,i){var _15=_4.mixin({util:this.util,keys:this.keys,mouse:this.mouse,drawing:this,stencils:this.stencils,anchors:this.anchors,canvas:this.canvas},p.options||{});this.registerTool(p.name,_4.getObject(p.name));try{this.plugins[i]=new this.tools[p.name](_15);}catch(e){console.error("Failed to initilaize plugin:\t"+p.name+". Did you require it?");}},this);this.plugins=[];_7=true;this.mouse.setCanvas();},onSurfaceReady:function(){this.ready=true;this.mouse.init(this.canvas.domNode);this.undo=new _6.drawing.manager.Undo({keys:this.keys});this.anchors=new _6.drawing.manager.Anchors({drawing:this,mouse:this.mouse,undo:this.undo,util:this.util});if(this.mode=="ui"){this.uiStencils=new _6.drawing.manager.StencilUI({canvas:this.canvas,surface:this.canvas.surface,mouse:this.mouse,keys:this.keys});}else{this.stencils=new _6.drawing.manager.Stencil({canvas:this.canvas,surface:this.canvas.surface,mouse:this.mouse,undo:this.undo,keys:this.keys,anchors:this.anchors});this.uiStencils=new _6.drawing.manager.StencilUI({canvas:this.canvas,surface:this.canvas.surface,mouse:this.mouse,keys:this.keys});}if(_6.gfx.renderer=="silverlight"){try{new _6.drawing.plugins.drawing.Silverlight({util:this.util,mouse:this.mouse,stencils:this.stencils,anchors:this.anchors,canvas:this.canvas});}catch(e){throw new Error("Attempted to install the Silverlight plugin, but it was not found.");}}_4.forEach(this.plugins,function(p){p.onSurfaceReady&&p.onSurfaceReady();});},addUI:function(_16,_17){if(!this.ready){var c=_4.connect(this,"onSurfaceReady",this,function(){_4.disconnect(c);this.addUI(_16,_17);});return false;}if(_17&&!_17.data&&!_17.points){_17={data:_17};}if(!this.stencilTypes[_16]){if(_16!="tooltip"){console.warn("Not registered:",_16);}return null;}var s=this.uiStencils.register(new this.stencilTypes[_16](this.getShapeProps(_17,"ui")));return s;},addStencil:function(_18,_19){if(!this.ready){var c=_4.connect(this,"onSurfaceReady",this,function(){_4.disconnect(c);this.addStencil(_18,_19);});return false;}if(_19&&!_19.data&&!_19.points){_19={data:_19};}var s=this.stencils.register(new this.stencilTypes[_18](this.getShapeProps(_19)));this.currentStencil&&this.currentStencil.moveToFront();return s;},removeStencil:function(_1a){this.stencils.unregister(_1a);_1a.destroy();},removeAll:function(){this.stencils.removeAll();},selectAll:function(){this.stencils.selectAll();},toSelected:function(_1b){this.stencils.toSelected.apply(this.stencils,arguments);},exporter:function(){console.log("this.stencils",this.stencils);return this.stencils.exporter();},importer:function(_1c){_4.forEach(_1c,function(m){this.addStencil(m.type,m);},this);},changeDefaults:function(_1d,_1e){if(_1e!=undefined&&_1e){for(var nm in _1d){this.defaults[nm]=_1d[nm];}}else{for(var nm in _1d){for(var n in _1d[nm]){this.defaults[nm][n]=_1d[nm][n];}}}if(this.currentStencil!=undefined&&(!this.currentStencil.created||this.defaults.clickMode)){this.unSetTool();this.setTool(this.currentType);}},onRenderStencil:function(_1f){this.stencils.register(_1f);this.unSetTool();if(!this.defaults.clickMode){this.setTool(this.currentType);}else{this.defaults.clickable=true;}},onDeleteStencil:function(_20){this.stencils.unregister(_20);},registerTool:function(_21){if(this.tools[_21]){return;}var _22=_4.getObject(_21);this.tools[_21]=_22;var _23=this.util.abbr(_21);this.stencilTypes[_23]=_22;this.stencilTypeMap[_23]=_21;},getConstructor:function(_24){return this.stencilTypes[_24];},setTool:function(_25){if(this.mode=="ui"){return;}if(!this.canvas||!this.canvas.surface){var c=_4.connect(this,"onSurfaceReady",this,function(){_4.disconnect(c);this.setTool(_25);});return;}if(this.currentStencil){this.unSetTool();}this.currentType=this.tools[_25]?_25:this.stencilTypeMap[_25];try{this.currentStencil=new this.tools[this.currentType]({container:this.canvas.surface.createGroup(),util:this.util,mouse:this.mouse,keys:this.keys});console.log("new tool is:",this.currentStencil.id,this.currentStencil);if(this.defaults.clickMode){this.defaults.clickable=false;}this.currentStencil.connect(this.currentStencil,"onRender",this,"onRenderStencil");this.currentStencil.connect(this.currentStencil,"destroy",this,"onDeleteStencil");}catch(e){console.error("dojox.drawing.setTool Error:",e);console.error(this.currentType+" is not a constructor: ",this.tools[this.currentType]);}},unSetTool:function(){if(!this.currentStencil.created){this.currentStencil.destroy();}}});})();}}};});