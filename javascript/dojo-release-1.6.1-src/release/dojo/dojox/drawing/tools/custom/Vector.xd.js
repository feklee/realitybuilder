/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realityBuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.drawing.tools.custom.Vector"],["require","dojox.drawing.tools.Arrow"],["require","dojox.drawing.util.positioning"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.drawing.tools.custom.Vector"]){_4._hasResource["dojox.drawing.tools.custom.Vector"]=true;_4.provide("dojox.drawing.tools.custom.Vector");_4.require("dojox.drawing.tools.Arrow");_4.require("dojox.drawing.util.positioning");_6.drawing.tools.custom.Vector=_6.drawing.util.oo.declare(_6.drawing.tools.Arrow,function(_7){this.minimumSize=this.style.arrows.length;this.addShadow({size:3,mult:2});},{draws:true,type:"dojox.drawing.tools.custom.Vector",minimumSize:30,showAngle:true,changeAxis:function(_8){_8=_8!==undefined?_8:this.style.zAxis?0:1;if(_8==0){this.style.zAxis=false;this.data.cosphi=0;}else{this.style.zAxis=true;var p=this.points;var pt=this.zPoint();this.setPoints([{x:p[0].x,y:p[0].y},{x:pt.x,y:pt.y}]);}this.render();},_createZeroVector:function(_9,d,_a){var s=_9=="hit"?this.minimumSize:this.minimumSize/6;var f=_9=="hit"?_a.fill:null;d={cx:this.data.x1,cy:this.data.y1,rx:s,ry:s};this.remove(this[_9]);this[_9]=this.container.createEllipse(d).setStroke(_a).setFill(f);this.util.attr(this[_9],"drawingType","stencil");},_create:function(_b,d,_c){this.remove(this[_b]);this[_b]=this.container.createLine(d).setStroke(_c);this._setNodeAtts(this[_b]);},onDrag:function(_d){if(this.created){return;}var x1=_d.start.x,y1=_d.start.y,x2=_d.x,y2=_d.y;if(this.keys.shift&&!this.style.zAxis){var pt=this.util.snapAngle(_d,45/180);x2=pt.x;y2=pt.y;}if(this.keys.alt){var dx=x2>x1?((x2-x1)/2):((x1-x2)/-2);var dy=y2>y1?((y2-y1)/2):((y1-y2)/-2);x1-=dx;x2-=dx;y1-=dy;y2-=dy;}if(this.style.zAxis){var _e=this.zPoint(_d);x2=_e.x;y2=_e.y;}this.setPoints([{x:x1,y:y1},{x:x2,y:y2}]);this.render();},onTransform:function(_f){if(!this._isBeingModified){this.onTransformBegin();}this.setPoints(this.points);this.render();},anchorConstrain:function(x,y){if(!this.style.zAxis){return null;}var _10=this.style.zAngle*Math.PI/180;var _11=x<0?x>-y:x<-y;var dx=_11?x:-y/Math.tan(_10);var dy=!_11?y:-Math.tan(_10)*x;return {x:dx,y:dy};},zPoint:function(obj){if(obj===undefined){if(!this.points[0]){return null;}var d=this.pointsToData();obj={start:{x:d.x1,y:d.y1},x:d.x2,y:d.y2};}var _12=this.util.length(obj);var _13=this.util.angle(obj);_13<0?_13=360+_13:_13;_13=_13>135&&_13<315?this.style.zAngle:this.util.oppAngle(this.style.zAngle);return this.util.pointOnCircle(obj.start.x,obj.start.y,_12,_13);},pointsToData:function(p){p=p||this.points;var _14=0;var obj={start:{x:p[0].x,y:p[0].y},x:p[1].x,y:p[1].y};if(this.style.zAxis&&(this.util.length(obj)>this.minimumSize)){var _15=this.util.angle(obj);_15<0?_15=360+_15:_15;_14=_15>135&&_15<315?1:-1;}this.data={x1:p[0].x,y1:p[0].y,x2:p[1].x,y2:p[1].y,cosphi:_14};return this.data;},dataToPoints:function(o){o=o||this.data;if(o.radius||o.angle){var _16=0;var pt=this.util.pointOnCircle(o.x,o.y,o.radius,o.angle);if(this.style.zAxis||(o.cosphi&&o.cosphi!=0)){this.style.zAxis=true;_16=o.angle>135&&o.angle<315?1:-1;}this.data=o={x1:o.x,y1:o.y,x2:pt.x,y2:pt.y,cosphi:_16};}this.points=[{x:o.x1,y:o.y1},{x:o.x2,y:o.y2}];return this.points;},render:function(){this.onBeforeRender(this);if(this.getRadius()>=this.minimumSize){this._create("hit",this.data,this.style.currentHit);this._create("shape",this.data,this.style.current);}else{this.data.cosphi=0;this._createZeroVector("hit",this.data,this.style.currentHit);this._createZeroVector("shape",this.data,this.style.current);}},onUp:function(obj){if(this.created||!this._downOnCanvas){return;}this._downOnCanvas=false;if(!this.shape){var d=100;obj.start.x=this.style.zAxis?obj.start.x+d:obj.start.x;obj.y=obj.y+d;this.setPoints([{x:obj.start.x,y:obj.start.y},{x:obj.x,y:obj.y}]);this.render();}if(this.getRadius()<this.minimumSize){var p=this.points;this.setPoints([{x:p[0].x,y:p[0].y},{x:p[0].x,y:p[0].y}]);}else{var p=this.points;var pt=this.style.zAxis?this.zPoint(obj):this.util.snapAngle(obj,this.angleSnap/180);this.setPoints([{x:p[0].x,y:p[0].y},{x:pt.x,y:pt.y}]);}this.renderedOnce=true;this.onRender(this);}});_6.drawing.tools.custom.Vector.setup={name:"dojox.drawing.tools.custom.Vector",tooltip:"Vector Tool",iconClass:"iconVector"};if(_6.drawing.defaults.zAxisEnabled){_6.drawing.tools.custom.Vector.setup.secondary={name:"vectorSecondary",label:"z-axis",funct:function(_17){_17.selected?this.zDeselect(_17):this.zSelect(_17);var _18=this.drawing.stencils.selectedStencils;for(var nm in _18){if(_18[nm].shortType=="vector"&&(_18[nm].style.zAxis!=_6.drawing.defaults.zAxis)){var s=_18[nm];s.changeAxis();if(s.style.zAxis){s.deselect();s.select();}}}},setup:function(){var _19=_6.drawing.defaults.zAxis;this.zSelect=function(_1a){if(!_1a.enabled){return;}_19=true;_6.drawing.defaults.zAxis=true;_1a.select();this.vectorTest();this.zSelected=_1a;};this.zDeselect=function(_1b){if(!_1b.enabled){return;}_19=false;_6.drawing.defaults.zAxis=false;_1b.deselect();this.vectorTest();this.zSelected=null;};this.vectorTest=function(){_4.forEach(this.buttons,function(b){if(b.toolType=="vector"&&b.selected){this.drawing.currentStencil.style.zAxis=_19;}},this);};_4.connect(this,"onRenderStencil",this,function(){if(this.zSelected){this.zDeselect(this.zSelected);}});var c=_4.connect(this.drawing,"onSurfaceReady",this,function(){_4.disconnect(c);_4.connect(this.drawing.stencils,"onSelect",this,function(_1c){if(_1c.shortType=="vector"){if(_1c.style.zAxis){_4.forEach(this.buttons,function(b){if(b.toolType=="vectorSecondary"){this.zSelect(b);}},this);}else{_4.forEach(this.buttons,function(b){if(b.toolType=="vectorSecondary"){this.zDeselect(b);}},this);}}});});},postSetup:function(btn){_4.connect(btn,"enable",function(){_6.drawing.defaults.zAxisEnabled=true;});_4.connect(btn,"disable",function(){_6.drawing.defaults.zAxisEnabled=false;});}};}_6.drawing.register(_6.drawing.tools.custom.Vector.setup,"tool");}}};});