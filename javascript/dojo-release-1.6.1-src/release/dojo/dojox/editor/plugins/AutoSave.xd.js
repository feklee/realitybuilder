/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realityBuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.editor.plugins.AutoSave"],["require","dojo.string"],["require","dojo.date.locale"],["require","dijit.Dialog"],["require","dijit.MenuItem"],["require","dijit.Menu"],["require","dijit.form.Button"],["require","dijit.form.ComboBox"],["require","dijit.form.TextBox"],["require","dijit.TooltipDialog"],["require","dijit._editor._Plugin"],["require","dijit.form.Button"],["require","dojo.i18n"],["require","dojox.editor.plugins.Save"],["requireLocalization","dojox.editor.plugins","AutoSave",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw","ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.editor.plugins.AutoSave"]){_4._hasResource["dojox.editor.plugins.AutoSave"]=true;_4.provide("dojox.editor.plugins.AutoSave");_4.require("dojo.string");_4.require("dojo.date.locale");_4.require("dijit.Dialog");_4.require("dijit.MenuItem");_4.require("dijit.Menu");_4.require("dijit.form.Button");_4.require("dijit.form.ComboBox");_4.require("dijit.form.TextBox");_4.require("dijit.TooltipDialog");_4.require("dijit._editor._Plugin");_4.require("dijit.form.Button");_4.require("dojo.i18n");_4.require("dojox.editor.plugins.Save");_4.experimental("dojox.editor.plugins.AutoSave");_4.declare("dojox.editor.plugins._AutoSaveSettingDialog",[_5._Widget,_5._Templated],{dialogTitle:"",dialogDescription:"",paramName:"",paramLabel:"",btnOk:"",btnCancel:"",widgetsInTemplate:true,templateString:"<span id='${dialogId}' class='dijit dijitReset dijitInline' tabindex='-1'>"+"<div dojoType='dijit.Dialog' title='${dialogTitle}' dojoAttachPoint='dialog' "+"class='dijitEditorAutoSaveSettingDialog'>"+"<div tabindex='-1'>${dialogDescription}</div>"+"<div tabindex='-1' class='dijitEditorAutoSaveSettingInputArea'>${paramName}</div>"+"<div class='dijitEditorAutoSaveSettingInputArea' tabindex='-1'>"+"<input class='textBox' dojoType='dijit.form.TextBox' id='${textBoxId}' required='false' intermediateChanges='true' "+"selectOnClick='true' required='true' dojoAttachPoint='intBox' "+"dojoAttachEvent='onKeyDown: _onKeyDown, onChange: _onChange'/>"+"<label class='dijitLeft dijitInline boxLabel' "+"for='${textBoxId}' tabindex='-1'>${paramLabel}</label>"+"</div>"+"<div class='dijitEditorAutoSaveSettingButtonArea' tabindex='-1'>"+"<button dojoType='dijit.form.Button' dojoAttachEvent='onClick: onOk'>${btnOk}</button>"+"<button dojoType='dijit.form.Button' dojoAttachEvent='onClick: onCancel'>${btnCancel}</button>"+"</div>"+"</div>"+"</span>",postMixInProperties:function(){this.id=_5.getUniqueId(this.declaredClass.replace(/\./g,"_"));this.dialogId=this.id+"_dialog";this.textBoxId=this.id+"_textBox";},show:function(){if(this._value==""){this._value=0;this.intBox.set("value",0);}else{this.intBox.set("value",this._value);}this.dialog.show();_5.selectInputText(this.intBox.focusNode);},hide:function(){this.dialog.hide();},onOk:function(){this.dialog.hide();},onCancel:function(){this.dialog.hide();},_onKeyDown:function(_7){if(_7.keyCode==_4.keys.ENTER){this.onOk();}},_onChange:function(_8){if(this._isValidValue(_8)){this._value=_8;}else{this.intBox.set("value",this._value);}},_setValueAttr:function(_9){if(this._isValidValue(_9)){this._value=_9;}},_getValueAttr:function(){return this._value;},_isValidValue:function(_a){var _b=/^\d{0,3}$/,_c=String(_a);return Boolean(_c.match?_c.match(_b):"");}});_4.declare("dojox.editor.plugins.AutoSave",_6.editor.plugins.Save,{url:"",logResults:true,interval:0,_iconClassPrefix:"dijitEditorIconAutoSave",_MIN:60000,_setIntervalAttr:function(_d){this.interval=_d;},_getIntervalAttr:function(){return this._interval;},setEditor:function(_e){this.editor=_e;this._strings=_4.i18n.getLocalization("dojox.editor.plugins","AutoSave");this._initButton();this._saveSettingDialog=new _6.editor.plugins._AutoSaveSettingDialog({"dialogTitle":this._strings["saveSettingdialogTitle"],"dialogDescription":this._strings["saveSettingdialogDescription"],"paramName":this._strings["saveSettingdialogParamName"],"paramLabel":this._strings["saveSettingdialogParamLabel"],"btnOk":this._strings["saveSettingdialogButtonOk"],"btnCancel":this._strings["saveSettingdialogButtonCancel"]});this.connect(this._saveSettingDialog,"onOk","_onDialogOk");var pd=this._promDialog=new _5.TooltipDialog();pd.startup();pd.set("content","");},_initButton:function(){var _f=new _5.Menu({style:"display: none"}),_10=new _5.MenuItem({iconClass:this._iconClassPrefix+"Default "+this._iconClassPrefix,label:this._strings["saveLabel"]}),_11=this._menuItemAutoSave=new _5.MenuItem({iconClass:this._iconClassPrefix+"Setting "+this._iconClassPrefix,label:this._strings["saveSettingLabelOn"]});_f.addChild(_10);_f.addChild(_11);this.button=new _5.form.ComboButton({label:this._strings["saveLabel"],iconClass:this._iconClassPrefix+"Default "+this._iconClassPrefix,showLabel:false,dropDown:_f});this.connect(this.button,"onClick","_save");this.connect(_10,"onClick","_save");this._menuItemAutoSaveClickHandler=_4.connect(_11,"onClick",this,"_showAutSaveSettingDialog");},_showAutSaveSettingDialog:function(){var _12=this._saveSettingDialog;_12.set("value",this.interval);_12.show();},_onDialogOk:function(){var _13=this.interval=this._saveSettingDialog.get("value")*this._MIN;if(_13>0){this._setSaveInterval(_13);_4.disconnect(this._menuItemAutoSaveClickHandler);this._menuItemAutoSave.set("label",this._strings["saveSettingLabelOff"]);this._menuItemAutoSaveClickHandler=_4.connect(this._menuItemAutoSave,"onClick",this,"_onStopClick");this.button.set("iconClass",this._iconClassPrefix+"Setting "+this._iconClassPrefix);}},_onStopClick:function(){this._clearSaveInterval();_4.disconnect(this._menuItemAutoSaveClickHandler);this._menuItemAutoSave.set("label",this._strings["saveSettingLabelOn"]);this._menuItemAutoSaveClickHandler=_4.connect(this._menuItemAutoSave,"onClick",this,"_showAutSaveSettingDialog");this.button.set("iconClass",this._iconClassPrefix+"Default "+this._iconClassPrefix);},_setSaveInterval:function(_14){if(_14<=0){return;}this._clearSaveInterval();this._intervalHandler=setInterval(_4.hitch(this,function(){if(!this._isWorking&&!this.get("disabled")){this._isWorking=true;this._save();}}),_14);},_clearSaveInterval:function(){if(this._intervalHandler){clearInterval(this._intervalHandler);this._intervalHandler=null;}},onSuccess:function(_15,_16){this.button.set("disabled",false);this._promDialog.set("content",_4.string.substitute(this._strings["saveMessageSuccess"],{"0":_4.date.locale.format(new Date(),{selector:"time"})}));_5.popup.open({popup:this._promDialog,around:this.button.domNode});this._promDialogTimeout=setTimeout(_4.hitch(this,function(){clearTimeout(this._promDialogTimeout);this._promDialogTimeout=null;_5.popup.close(this._promDialog);}),3000);this._isWorking=false;if(this.logResults){console.log(_15);}},onError:function(_17,_18){this.button.set("disabled",false);this._promDialog.set("content",_4.string.substitute(this._strings["saveMessageFail"],{"0":_4.date.locale.format(new Date(),{selector:"time"})}));_5.popup.open({popup:this._promDialog,around:this.button.domNode});this._promDialogTimeout=setTimeout(_4.hitch(this,function(){clearTimeout(this._promDialogTimeout);this._promDialogTimeout=null;_5.popup.close(this._promDialog);}),3000);this._isWorking=false;if(this.logResults){console.log(_17);}},destroy:function(){this.inherited(arguments);this._menuItemAutoSave=null;if(this._promDialogTimeout){clearTimeout(this._promDialogTimeout);this._promDialogTimeout=null;_5.popup.close(this._promDialog);}this._clearSaveInterval();if(this._saveSettingDialog){this._saveSettingDialog.destroyRecursive();this._destroyRecursive=null;}if(this._menuItemAutoSaveClickHandler){_4.disconnect(this._menuItemAutoSaveClickHandler);this._menuItemAutoSaveClickHandler=null;}}});_4.subscribe(_5._scopeName+".Editor.getPlugin",null,function(o){if(o.plugin){return;}var _19=o.args.name.toLowerCase();if(_19=="autosave"){o.plugin=new _6.editor.plugins.AutoSave({url:("url" in o.args)?o.args.url:"",logResults:("logResults" in o.args)?o.args.logResults:true,interval:("interval" in o.args)?o.args.interval:5});}});}}};});