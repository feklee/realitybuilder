/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realityBuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.editor.plugins.InsertAnchor"],["require","dojo.string"],["require","dijit._Widget"],["require","dijit._editor.range"],["require","dijit._Templated"],["require","dijit.TooltipDialog"],["require","dijit.form.ValidationTextBox"],["require","dijit.form.Select"],["require","dijit._editor._Plugin"],["require","dijit.form.Button"],["require","dojox.editor.plugins.ToolbarLineBreak"],["require","dojo.i18n"],["requireLocalization","dojox.editor.plugins","InsertAnchor",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw","ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw"],["requireLocalization","dijit","common",null,"",""]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.editor.plugins.InsertAnchor"]){_4._hasResource["dojox.editor.plugins.InsertAnchor"]=true;_4.provide("dojox.editor.plugins.InsertAnchor");_4.require("dojo.string");_4.require("dijit._Widget");_4.require("dijit._editor.range");_4.require("dijit._Templated");_4.require("dijit.TooltipDialog");_4.require("dijit.form.ValidationTextBox");_4.require("dijit.form.Select");_4.require("dijit._editor._Plugin");_4.require("dijit.form.Button");_4.require("dojox.editor.plugins.ToolbarLineBreak");_4.require("dojo.i18n");_4.declare("dojox.editor.plugins.InsertAnchor",_5._editor._Plugin,{htmlTemplate:"<a name=\"${anchorInput}\" class=\"dijitEditorPluginInsertAnchorStyle\">${textInput}</a>",iconClassPrefix:"dijitAdditionalEditorIcon",_template:["<table><tr><td>","<label for='${id}_anchorInput'>${anchor}</label>","</td><td>","<input dojoType='dijit.form.ValidationTextBox' required='true' "+"id='${id}_anchorInput' name='anchorInput' intermediateChanges='true'>","</td></tr><tr><td>","<label for='${id}_textInput'>${text}</label>","</td><td>","<input dojoType='dijit.form.ValidationTextBox' required='true' id='${id}_textInput' "+"name='textInput' intermediateChanges='true'>","</td></tr>","<tr><td colspan='2'>","<button dojoType='dijit.form.Button' type='submit' id='${id}_setButton'>${set}</button>","<button dojoType='dijit.form.Button' type='button' id='${id}_cancelButton'>${cancel}</button>","</td></tr></table>"].join(""),_initButton:function(){var _7=this;var _8=_4.i18n.getLocalization("dojox.editor.plugins","InsertAnchor",this.lang);var _9=(this.dropDown=new _5.TooltipDialog({title:_8["title"],execute:_4.hitch(this,"setValue"),onOpen:function(){_7._onOpenDialog();_5.TooltipDialog.prototype.onOpen.apply(this,arguments);},onCancel:function(){setTimeout(_4.hitch(_7,"_onCloseDialog"),0);}}));this.button=new _5.form.DropDownButton({label:_8["insertAnchor"],showLabel:false,iconClass:this.iconClassPrefix+" "+this.iconClassPrefix+"InsertAnchor",tabIndex:"-1",dropDown:this.dropDown});_8.id=_5.getUniqueId(this.editor.id);this._uniqueId=_8.id;this.dropDown.set("content",_9.title+"<div style='border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'></div>"+_4.string.substitute(this._template,_8));_9.startup();this._anchorInput=_5.byId(this._uniqueId+"_anchorInput");this._textInput=_5.byId(this._uniqueId+"_textInput");this._setButton=_5.byId(this._uniqueId+"_setButton");this.connect(_5.byId(this._uniqueId+"_cancelButton"),"onClick",function(){this.dropDown.onCancel();});if(this._anchorInput){this.connect(this._anchorInput,"onChange","_checkInput");}if(this._textInput){this.connect(this._anchorInput,"onChange","_checkInput");}this.editor.contentDomPreFilters.push(_4.hitch(this,this._preDomFilter));this.editor.contentDomPostFilters.push(_4.hitch(this,this._postDomFilter));this._setup();},updateState:function(){this.button.set("disabled",this.get("disabled"));},setEditor:function(_a){this.editor=_a;this._initButton();},_checkInput:function(){var _b=true;if(this._anchorInput.isValid()){_b=false;}this._setButton.set("disabled",_b);},_setup:function(){this.editor.onLoadDeferred.addCallback(_4.hitch(this,function(){this.connect(this.editor.editNode,"ondblclick",this._onDblClick);setTimeout(_4.hitch(this,function(){this._applyStyles();}),100);}));},getAnchorStyle:function(){var _c="@media screen {\n"+"\t.dijitEditorPluginInsertAnchorStyle {\n"+"\t\tbackground-image: url({MODURL}/images/anchor.gif);\n"+"\t\tbackground-repeat: no-repeat;\n"+"\t\tbackground-position: top left;\n"+"\t\tborder-width: 1px;\n"+"\t\tborder-style: dashed;\n"+"\t\tborder-color: #D0D0D0;\n"+"\t\tpadding-left: 20px;\n"+"\t}\n"+"}\n";var _d=_4.moduleUrl(_6._scopeName,"editor/plugins/resources").toString();if(!(_d.match(/^https?:\/\//i))&&!(_d.match(/^file:\/\//i))){var _e;if(_d.charAt(0)==="/"){var _f=_4.doc.location.protocol;var _10=_4.doc.location.host;_e=_f+"//"+_10;}else{_e=this._calcBaseUrl(_4.global.location.href);}if(_e[_e.length-1]!=="/"&&_d.charAt(0)!=="/"){_e+="/";}_d=_e+_d;}return _c.replace(/\{MODURL\}/gi,_d);},_applyStyles:function(){if(!this._styled){try{this._styled=true;var doc=this.editor.document;var _11=this.getAnchorStyle();if(!_4.isIE){var _12=doc.createElement("style");_12.appendChild(doc.createTextNode(_11));doc.getElementsByTagName("head")[0].appendChild(_12);}else{var ss=doc.createStyleSheet("");ss.cssText=_11;}}catch(e){}}},_calcBaseUrl:function(_13){var _14=null;if(_13!==null){var _15=_13.indexOf("?");if(_15!=-1){_13=_13.substring(0,_15);}_15=_13.lastIndexOf("/");if(_15>0&&_15<_13.length){_14=_13.substring(0,_15);}else{_14=_13;}}return _14;},_checkValues:function(_16){if(_16){if(_16.anchorInput){_16.anchorInput=_16.anchorInput.replace(/"/g,"&quot;");}if(!_16.textInput){_16.textInput="&nbsp;";}}return _16;},setValue:function(_17){this._onCloseDialog();if(!this.editor.window.getSelection){var sel=_5.range.getSelection(this.editor.window);var _18=sel.getRangeAt(0);var a=_18.endContainer;if(a.nodeType===3){a=a.parentNode;}if(a&&(a.nodeName&&a.nodeName.toLowerCase()!=="a")){a=_4.withGlobal(this.editor.window,"getSelectedElement",_5._editor.selection,["a"]);}if(a&&(a.nodeName&&a.nodeName.toLowerCase()==="a")){if(this.editor.queryCommandEnabled("unlink")){_4.withGlobal(this.editor.window,"selectElementChildren",_5._editor.selection,[a]);this.editor.execCommand("unlink");}}}_17=this._checkValues(_17);this.editor.execCommand("inserthtml",_4.string.substitute(this.htmlTemplate,_17));},_onCloseDialog:function(){this.editor.focus();},_getCurrentValues:function(a){var _19,_1a;if(a&&a.tagName.toLowerCase()==="a"&&_4.attr(a,"name")){_19=_4.attr(a,"name");_1a=a.textContent||a.innerText;_4.withGlobal(this.editor.window,"selectElement",_5._editor.selection,[a,true]);}else{_1a=_4.withGlobal(this.editor.window,_5._editor.selection.getSelectedText);}return {anchorInput:_19||"",textInput:_1a||""};},_onOpenDialog:function(){var a;if(!this.editor.window.getSelection){var sel=_5.range.getSelection(this.editor.window);var _1b=sel.getRangeAt(0);a=_1b.endContainer;if(a.nodeType===3){a=a.parentNode;}if(a&&(a.nodeName&&a.nodeName.toLowerCase()!=="a")){a=_4.withGlobal(this.editor.window,"getSelectedElement",_5._editor.selection,["a"]);}}else{a=_4.withGlobal(this.editor.window,"getAncestorElement",_5._editor.selection,["a"]);}this.dropDown.reset();this._setButton.set("disabled",true);this.dropDown.set("value",this._getCurrentValues(a));},_onDblClick:function(e){if(e&&e.target){var t=e.target;var tg=t.tagName?t.tagName.toLowerCase():"";if(tg==="a"&&_4.attr(t,"name")){this.editor.onDisplayChanged();_4.withGlobal(this.editor.window,"selectElement",_5._editor.selection,[t]);setTimeout(_4.hitch(this,function(){this.button.set("disabled",false);this.button.openDropDown();}),10);}}},_preDomFilter:function(_1c){var ed=this.editor;_4.withGlobal(ed.window,function(){_4.query("a",ed.editNode).forEach(function(a){if(_4.attr(a,"name")&&!_4.attr(a,"href")){if(!_4.hasClass(a,"dijitEditorPluginInsertAnchorStyle")){_4.addClass(a,"dijitEditorPluginInsertAnchorStyle");}}});});},_postDomFilter:function(_1d){var ed=this.editor;_4.withGlobal(ed.window,function(){_4.query("a",_1d).forEach(function(a){if(_4.attr(a,"name")&&!_4.attr(a,"href")){if(_4.hasClass(a,"dijitEditorPluginInsertAnchorStyle")){_4.removeClass(a,"dijitEditorPluginInsertAnchorStyle");}}});});return _1d;}});_4.subscribe(_5._scopeName+".Editor.getPlugin",null,function(o){if(o.plugin){return;}var _1e=o.args.name;if(_1e){_1e=_1e.toLowerCase();}if(_1e==="insertanchor"){o.plugin=new _6.editor.plugins.InsertAnchor();}});}}};});