/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realityBuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.editor.plugins.LocalImage"],["require","dijit._editor.plugins.LinkDialog"],["require","dojox.form.FileUploader"],["require","dojo.i18n"],["requireLocalization","dojox.editor.plugins","LocalImage",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw","ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.editor.plugins.LocalImage"]){_4._hasResource["dojox.editor.plugins.LocalImage"]=true;_4.provide("dojox.editor.plugins.LocalImage");_4.require("dijit._editor.plugins.LinkDialog");_4.require("dojox.form.FileUploader");_4.require("dojo.i18n");_4.declare("dojox.editor.plugins.LocalImage",_5._editor.plugins.ImgLinkDialog,{uploadable:false,uploadUrl:"",baseImageUrl:"",fileMask:"*.jpg;*.jpeg;*.gif;*.png;*.bmp",urlRegExp:"",_fileUploader:null,htmlFieldName:"uploadedfile",_isLocalFile:false,_messages:"",_cssPrefix:"dijitEditorEilDialog",_closable:true,linkDialogTemplate:["<div style='border-bottom: 1px solid black; padding-bottom: 2pt; margin-bottom: 4pt;'></div>","<div class='dijitEditorEilDialogDescription'>${prePopuTextUrl}${prePopuTextBrowse}</div>","<table><tr><td colspan='2'>","<label for='${id}_urlInput' title='${prePopuTextUrl}${prePopuTextBrowse}'>${url}</label>","</td></tr><tr><td class='dijitEditorEilDialogField'>","<input dojoType='dijit.form.ValidationTextBox' class='dijitEditorEilDialogField'"+"regExp='${urlRegExp}' title='${prePopuTextUrl}${prePopuTextBrowse}'  selectOnClick='true' required='true' "+"id='${id}_urlInput' name='urlInput' intermediateChanges='true' invalidMessage='${invalidMessage}' "+"prePopuText='&lt;${prePopuTextUrl}${prePopuTextBrowse}&gt'>","</td><td>","<div id='${id}_browse' style='display:${uploadable}'>${browse}</div>","</td></tr><tr><td colspan='2'>","<label for='${id}_textInput'>${text}</label>","</td></tr><tr><td>","<input dojoType='dijit.form.TextBox' required='false' id='${id}_textInput' "+"name='textInput' intermediateChanges='true' selectOnClick='true' class='dijitEditorEilDialogField'>","</td><td></td></tr><tr><td>","</td><td>","</td></tr><tr><td colspan='2'>","<button dojoType='dijit.form.Button' id='${id}_setButton'>${set}</button>","</td></tr></table>"].join(""),_initButton:function(){var _7=this,_8=this._messages=_4.i18n.getLocalization("dojox.editor.plugins","LocalImage");this.tag="img";var _9=(this.dropDown=new _5.TooltipDialog({title:_8[this.command+"Title"],onOpen:function(){_7._initialFileUploader();_7._onOpenDialog();_5.TooltipDialog.prototype.onOpen.apply(this,arguments);setTimeout(function(){_5.selectInputText(_7._urlInput.textbox);_7._urlInput.isLoadComplete=true;},0);},onClose:function(){_4.disconnect(_7.blurHandler);_7.blurHandler=null;this.onHide();},onCancel:function(){setTimeout(_4.hitch(_7,"_onCloseDialog"),0);}}));var _a=this.getLabel(this.command),_b=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1),_c=_4.mixin({label:_a,showLabel:false,iconClass:_b,dropDown:this.dropDown,tabIndex:"-1"},this.params||{});if(!_4.isIE&&(!_4.isFF||_4.isFF<4)){_c.closeDropDown=function(_d){if(_7._closable){if(this._opened){_5.popup.close(this.dropDown);if(_d){this.focus();}this._opened=false;this.state="";}}setTimeout(function(){_7._closable=true;},10);};}this.button=new _5.form.DropDownButton(_c);var _e=this.fileMask.split(";"),_f="";_4.forEach(_e,function(m){m=m.replace(/\./,"\\.").replace(/\*/g,".*");_f+="|"+m+"|"+m.toUpperCase();});_8.urlRegExp=this.urlRegExp=_f.substring(1);if(!this.uploadable){_8["prePopuTextBrowse"]=".";}_8.id=_5.getUniqueId(this.editor.id);_8.uploadable=this.uploadable?"inline":"none";this._uniqueId=_8.id;this._setContent("<div class='"+this._cssPrefix+"Title'>"+_9.title+"</div>"+_4.string.substitute(this.linkDialogTemplate,_8));_9.startup();var _10=this._urlInput=_5.byId(this._uniqueId+"_urlInput");this._textInput=_5.byId(this._uniqueId+"_textInput");this._setButton=_5.byId(this._uniqueId+"_setButton");if(_10){var pt=_5.form.ValidationTextBox.prototype;_10=_4.mixin(_10,{isLoadComplete:false,isValid:function(_11){if(this.isLoadComplete){return pt.isValid.apply(this,arguments);}else{return this.get("value").length>0;}},reset:function(){this.isLoadComplete=false;pt.reset.apply(this,arguments);}});this.connect(_10,"onKeyDown","_cancelFileUpload");this.connect(_10,"onChange","_checkAndFixInput");}if(this._setButton){this.connect(this._setButton,"onClick","_checkAndSetValue");}this._connectTagEvents();},_initialFileUploader:function(){var fup=null,_12=this,_13=_12._uniqueId,_14=_13+"_browse",_15=_12._urlInput;if(_12.uploadable&&!_12._fileUploader){fup=_12._fileUploader=new _6.form.FileUploader({force:"html",uploadUrl:_12.uploadUrl,htmlFieldName:_12.htmlFieldName,uploadOnChange:false,selectMultipleFiles:false,showProgress:true},_14);fup.reset=function(){_12._isLocalFile=false;fup._resetHTML();};_12.connect(fup,"onClick",function(){_15.validate(false);if(!_4.isIE&&(!_4.isFF||_4.isFF<4)){_12._closable=false;}});_12.connect(fup,"onChange",function(_16){_12._isLocalFile=true;_15.set("value",_16[0].name);_15.focus();});_12.connect(fup,"onComplete",function(_17){var _18=_12.baseImageUrl;_18=_18&&_18.charAt(_18.length-1)=="/"?_18:_18+"/";_15.set("value",_18+_17[0].file);_12._isLocalFile=false;_12._setDialogStatus(true);_12.setValue(_12.dropDown.get("value"));});_12.connect(fup,"onError",function(_19){console.log("Error occurred when uploading image file!");_12._setDialogStatus(true);});}},_checkAndFixInput:function(){this._setButton.set("disabled",!this._isValid());},_isValid:function(){return this._urlInput.isValid();},_cancelFileUpload:function(){this._fileUploader.reset();this._isLocalFile=false;},_checkAndSetValue:function(){if(this._fileUploader&&this._isLocalFile){this._setDialogStatus(false);this._fileUploader.upload();}else{this.setValue(this.dropDown.get("value"));}},_setDialogStatus:function(_1a){this._urlInput.set("disabled",!_1a);this._textInput.set("disabled",!_1a);this._setButton.set("disabled",!_1a);},destroy:function(){this.inherited(arguments);if(this._fileUploader){this._fileUploader.destroy();this._fileUploader=null;}}});_4.subscribe(_5._scopeName+".Editor.getPlugin",null,function(o){if(o.plugin){return;}var _1b=o.args.name.toLowerCase();if(_1b==="localimage"){o.plugin=new _6.editor.plugins.LocalImage({command:"insertImage",uploadable:("uploadable" in o.args)?o.args.uploadable:false,uploadUrl:("uploadable" in o.args&&"uploadUrl" in o.args)?o.args.uploadUrl:"",htmlFieldName:("uploadable" in o.args&&"htmlFieldName" in o.args)?o.args.htmlFieldName:"uploadedfile",baseImageUrl:("uploadable" in o.args&&"baseImageUrl" in o.args)?o.args.baseImageUrl:"",fileMask:("fileMask" in o.args)?o.args.fileMask:"*.jpg;*.jpeg;*.gif;*.png;*.bmp"});}});}}};});