/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realitybuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.editor.plugins.NormalizeStyle"],["require","dijit._editor.html"],["require","dijit._editor._Plugin"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.editor.plugins.NormalizeStyle"]){_4._hasResource["dojox.editor.plugins.NormalizeStyle"]=true;_4.provide("dojox.editor.plugins.NormalizeStyle");_4.require("dijit._editor.html");_4.require("dijit._editor._Plugin");_4.declare("dojox.editor.plugins.NormalizeStyle",_5._editor._Plugin,{mode:"semantic",condenseSpans:true,setEditor:function(_7){this.editor=_7;_7.customUndo=true;if(this.mode==="semantic"){this.editor.contentDomPostFilters.push(_4.hitch(this,this._convertToSemantic));}else{if(this.mode==="css"){this.editor.contentDomPostFilters.push(_4.hitch(this,this._convertToCss));}}if(_4.isIE){this.editor.contentDomPreFilters.push(_4.hitch(this,this._convertToSemantic));this._browserFilter=this._convertToSemantic;}else{if(_4.isWebKit){this.editor.contentDomPreFilters.push(_4.hitch(this,this._convertToCss));this._browserFilter=this._convertToCss;}else{if(_4.isMoz){this.editor.contentDomPreFilters.push(_4.hitch(this,this._convertToSemantic));this._browserFilter=this._convertToSemantic;}else{this.editor.contentDomPreFilters.push(_4.hitch(this,this._convertToSemantic));this._browserFilter=this._convertToSemantic;}}}if(this.editor._inserthtmlImpl){this.editor._oldInsertHtmlImpl=this.editor._inserthtmlImpl;}this.editor._inserthtmlImpl=_4.hitch(this,this._inserthtmlImpl);},_convertToSemantic:function(_8){if(_8){var w=this.editor.window;var _9=this;var _a=function(_b){if(_b.nodeType==1){if(_b.id!=="dijitEditorBody"){var _c=_b.style;var _d=_b.tagName?_b.tagName.toLowerCase():"";var _e;if(_c&&_d!="table"&&_d!="ul"&&_d!="ol"){var fw=_c.fontWeight?_c.fontWeight.toLowerCase():"";var fs=_c.fontStyle?_c.fontStyle.toLowerCase():"";var td=_c.textDecoration?_c.textDecoration.toLowerCase():"";var s=_c.fontSize?_c.fontSize.toLowerCase():"";var bc=_c.backgroundColor?_c.backgroundColor.toLowerCase():"";var c=_c.color?_c.color.toLowerCase():"";var _f=function(_10,_11){if(_10){while(_11.firstChild){_10.appendChild(_11.firstChild);}if(_d=="span"&&!_11.style.cssText){_4.place(_10,_11,"before");_11.parentNode.removeChild(_11);_11=_10;}else{_11.appendChild(_10);}}return _11;};switch(fw){case "bold":case "bolder":case "700":case "800":case "900":_e=_4.withGlobal(w,"create",_4,["b",{}]);_b.style.fontWeight="";break;}_b=_f(_e,_b);_e=null;if(fs=="italic"){_e=_4.withGlobal(w,"create",_4,["i",{}]);_b.style.fontStyle="";}_b=_f(_e,_b);_e=null;if(td){var da=td.split(" ");var _12=0;_4.forEach(da,function(s){switch(s){case "underline":_e=_4.withGlobal(w,"create",_4,["u",{}]);break;case "line-through":_e=_4.withGlobal(w,"create",_4,["strike",{}]);break;}_12++;if(_12==da.length){_b.style.textDecoration="";}_b=_f(_e,_b);_e=null;});}if(s){var _13={"xx-small":1,"x-small":2,"small":3,"medium":4,"large":5,"x-large":6,"xx-large":7,"-webkit-xxx-large":7};if(s.indexOf("pt")>0){s=s.substring(0,s.indexOf("pt"));s=parseInt(s);if(s<5){s="xx-small";}else{if(s<10){s="x-small";}else{if(s<15){s="small";}else{if(s<20){s="medium";}else{if(s<25){s="large";}else{if(s<30){s="x-large";}else{if(s>30){s="xx-large";}}}}}}}}else{if(s.indexOf("px")>0){s=s.substring(0,s.indexOf("px"));s=parseInt(s);if(s<5){s="xx-small";}else{if(s<10){s="x-small";}else{if(s<15){s="small";}else{if(s<20){s="medium";}else{if(s<25){s="large";}else{if(s<30){s="x-large";}else{if(s>30){s="xx-large";}}}}}}}}}var _14=_13[s];if(!_14){_14=3;}_e=_4.withGlobal(w,"create",_4,["font",{size:_14}]);_b.style.fontSize="";}_b=_f(_e,_b);_e=null;if(bc&&_d!=="font"&&_9._isInline(_d)){bc=new _4.Color(bc).toHex();_e=_4.withGlobal(w,"create",_4,["font",{style:{backgroundColor:bc}}]);_b.style.backgroundColor="";}if(c&&_d!=="font"){c=new _4.Color(c).toHex();_e=_4.withGlobal(w,"create",_4,["font",{color:c}]);_b.style.color="";}_b=_f(_e,_b);_e=null;}}if(_b.childNodes){var _15=[];_4.forEach(_b.childNodes,function(n){_15.push(n);});_4.forEach(_15,_a);}}return _b;};return this._normalizeTags(_a(_8));}return _8;},_normalizeTags:function(_16){var w=this.editor.window;var _17=_4.withGlobal(w,function(){return _4.query("em,s,strong",_16);});if(_17&&_17.length){_4.forEach(_17,function(n){if(n){var tag=n.tagName?n.tagName.toLowerCase():"";var _18;switch(tag){case "s":_18="strike";break;case "em":_18="i";break;case "strong":_18="b";break;}if(_18){var _19=_4.withGlobal(w,"create",_4,[_18,null,n,"before"]);while(n.firstChild){_19.appendChild(n.firstChild);}n.parentNode.removeChild(n);}}});}return _16;},_convertToCss:function(_1a){if(_1a){var w=this.editor.window;var _1b=function(_1c){if(_1c.nodeType==1){if(_1c.id!=="dijitEditorBody"){var tag=_1c.tagName?_1c.tagName.toLowerCase():"";if(tag){var _1d;switch(tag){case "b":case "strong":_1d=_4.withGlobal(w,"create",_4,["span",{style:{"fontWeight":"bold"}}]);break;case "i":case "em":_1d=_4.withGlobal(w,"create",_4,["span",{style:{"fontStyle":"italic"}}]);break;case "u":_1d=_4.withGlobal(w,"create",_4,["span",{style:{"textDecoration":"underline"}}]);break;case "strike":case "s":_1d=_4.withGlobal(w,"create",_4,["span",{style:{"textDecoration":"line-through"}}]);break;case "font":var _1e={};if(_4.attr(_1c,"color")){_1e.color=_4.attr(_1c,"color");}if(_4.attr(_1c,"face")){_1e.fontFace=_4.attr(_1c,"face");}if(_1c.style&&_1c.style.backgroundColor){_1e.backgroundColor=_1c.style.backgroundColor;}if(_1c.style&&_1c.style.color){_1e.color=_1c.style.color;}var _1f={1:"xx-small",2:"x-small",3:"small",4:"medium",5:"large",6:"x-large",7:"xx-large"};if(_4.attr(_1c,"size")){_1e.fontSize=_1f[_4.attr(_1c,"size")];}_1d=_4.withGlobal(w,"create",_4,["span",{style:_1e}]);break;}if(_1d){while(_1c.firstChild){_1d.appendChild(_1c.firstChild);}_4.place(_1d,_1c,"before");_1c.parentNode.removeChild(_1c);_1c=_1d;}}}if(_1c.childNodes){var _20=[];_4.forEach(_1c.childNodes,function(n){_20.push(n);});_4.forEach(_20,_1b);}}return _1c;};_1a=_1b(_1a);if(this.condenseSpans){this._condenseSpans(_1a);}}return _1a;},_condenseSpans:function(_21){var _22=function(_23){var _24=function(_25){var m;if(_25){m={};var _26=_25.toLowerCase().split(";");_4.forEach(_26,function(s){if(s){var ss=s.split(":");var key=ss[0]?_4.trim(ss[0]):"";var val=ss[1]?_4.trim(ss[1]):"";if(key&&val){var i;var _27="";for(i=0;i<key.length;i++){var ch=key.charAt(i);if(ch=="-"){i++;ch=key.charAt(i);_27+=ch.toUpperCase();}else{_27+=ch;}}m[_27]=val;}}});}return m;};if(_23&&_23.nodeType==1){var tag=_23.tagName?_23.tagName.toLowerCase():"";if(tag==="span"&&_23.childNodes&&_23.childNodes.length===1){var c=_23.firstChild;while(c&&c.nodeType==1&&c.tagName&&c.tagName.toLowerCase()=="span"){if(!_4.attr(c,"class")&&!_4.attr(c,"id")&&c.style){var s1=_24(_23.style.cssText);var s2=_24(c.style.cssText);if(s1&&s2){var _28={};var i;for(i in s1){if(!s1[i]||!s2[i]||s1[i]==s2[i]){_28[i]=s1[i];delete s2[i];}else{if(s1[i]!=s2[i]){if(i=="textDecoration"){_28[i]=s1[i]+" "+s2[i];delete s2[i];}else{_28=null;}break;}else{_28=null;break;}}}if(_28){for(i in s2){_28[i]=s2[i];}_4.style(_23,_28);while(c.firstChild){_23.appendChild(c.firstChild);}var t=c.nextSibling;c.parentNode.removeChild(c);c=t;}else{c=c.nextSibling;}}else{c=c.nextSibling;}}else{c=c.nextSibling;}}}}if(_23.childNodes&&_23.childNodes.length){_4.forEach(_23.childNodes,_22);}};_22(_21);},_isInline:function(tag){switch(tag){case "a":case "b":case "strong":case "s":case "strike":case "i":case "u":case "em":case "sup":case "sub":case "span":case "font":case "big":case "cite":case "q":case "img":case "small":return true;default:return false;}},_inserthtmlImpl:function(_29){if(_29){var div=this.editor.document.createElement("div");div.innerHTML=_29;div=this._browserFilter(div);_29=_5._editor.getChildrenHtml(div);div.innerHTML="";if(this.editor._oldInsertHtmlImpl){return this.editor._oldInsertHtmlImpl(_29);}else{return this.editor.execCommand("inserthtml",_29);}}return false;}});_4.subscribe(_5._scopeName+".Editor.getPlugin",null,function(o){if(o.plugin){return;}var _2a=o.args.name.toLowerCase();if(_2a==="normalizestyle"){o.plugin=new _6.editor.plugins.NormalizeStyle({mode:("mode" in o.args)?o.args.mode:"semantic",condenseSpans:("condenseSpans" in o.args)?o.args.condenseSpans:true});}});}}};});