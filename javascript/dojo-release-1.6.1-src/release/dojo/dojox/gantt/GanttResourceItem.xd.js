/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realityBuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.gantt.GanttResourceItem"],["require","dojo.date.locale"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.gantt.GanttResourceItem"]){_4._hasResource["dojox.gantt.GanttResourceItem"]=true;_4.provide("dojox.gantt.GanttResourceItem");_4.require("dojo.date.locale");_4.declare("dojox.gantt.GanttResourceItem",null,{constructor:function(_7){this.ganttChart=_7;this.ownerItem=[];this.ownerNameItem=[];this.ownerTaskNodeMapping={};this.ownerTaskNodeMapping_time={};this.resourceInfo={};this.ownerTimeConsume={};},clearAll:function(){this.clearData();this.clearItems();},clearData:function(){this.ownerItem=[];this.ownerNameItem=[];this.ownerTaskNodeMapping={};this.ownerTaskNodeMapping_time={};this.resourceInfo={};this.ownerTimeConsume={};},clearItems:function(){_4.destroy(this.content.firstChild);},buildResource:function(){var _8={};_4.forEach(this.ganttChart.arrProjects,function(_9){_4.forEach(_9.arrTasks,function(_a){_a.buildResourceInfo(_8);},this);},this);return _8;},buildOwnerTimeConsume:function(){var _b={};for(var _c in this.resourceInfo){var _d=this.resourceInfo[_c];var _e={};for(var i=0;i<_d.length;i++){var _f=_d[i];var _10=_f.taskItem.startTime.getTime(),dur=_f.taskItem.duration*24*60*60*1000/this.ganttChart.hsPerDay;_e.min=_e.min?Math.min(_e.min,_10):_10;_e.max=_e.max?Math.max(_e.max,(_10+dur)):(_10+dur);}_e.dur=(_e.max-_e.min)*this.ganttChart.hsPerDay/(24*60*60*1000);_e.min=new Date(_e.min);_e.max=new Date(_e.max);_b[_c]=_e;}return _b;},refresh:function(){this.ownerTimeConsume=this.buildOwnerTimeConsume();this.contentData.firstChild.style.width=Math.max(1200,this.ganttChart.pixelsPerDay*this.ganttChart.totalDays)+"px";for(var _11 in this.resourceInfo){this.refreshOwnerEntry(_11);}},reConstruct:function(){this.clearAll();this.resourceInfo=this.buildResource();this.ownerTimeConsume=this.buildOwnerTimeConsume();this.tableControl=_4.create("table",{cellPadding:"0",cellSpacing:"0",className:"ganttResourceTableControl"});var _12=this.tableControl.insertRow(this.tableControl.rows.length);this.contentHeight=this.content.offsetHeight;this.contentWidth=this.content.offsetWidth;this.content.appendChild(this.tableControl);this.contentData=_4.create("div",{className:"ganttResourceContentDataContainer"});this.contentData.appendChild(this.createPanelOwners());_4.style(this.contentData,"height",(this.contentHeight-this.ganttChart.panelTimeHeight)+"px");var _13=_4.create("td",{vAlign:"top"});this.panelNames=_4.create("div",{className:"ganttResourcePanelNames"});this.panelNames.appendChild(this.createPanelNamesOwners());_13.appendChild(this.panelNames);_12.appendChild(_13);_13=_4.create("td",{vAlign:"top"});var _14=_4.create("div",{className:"ganttResourceDivCell"});_14.appendChild(this.contentData);_13.appendChild(_14);_12.appendChild(_13);_4.style(this.panelNames,{height:(this.contentHeight-this.ganttChart.panelTimeHeight-this.ganttChart.scrollBarWidth)+"px",width:this.ganttChart.maxWidthPanelNames+"px"});this.contentData.style.width=(this.contentWidth-this.ganttChart.maxWidthPanelNames)+"px";this.contentData.firstChild.style.width=this.ganttChart.pixelsPerDay*(this.ganttChart.panelTime.firstChild.firstChild.rows[3].cells.length)+"px";var _15=this;this.contentData.onscroll=function(){if(_15.panelNames){_15.panelNames.scrollTop=this.scrollTop;}};this.contentData.scrollLeft=this.ganttChart.contentData.scrollLeft;for(var _16 in this.resourceInfo){this.createOwnerEntry(_16);}this.postAdjustment();},create:function(){var _17=_4.create("div",{innerHTML:"Resource Chart:",className:"ganttResourceHeader"},this.ganttChart.content,"after");_4.style(_17,"width",this.ganttChart.contentWidth+"px");var _18=_4.create("div",{className:"ganttResourceContent"},_17,"after");_4.style(_18,{width:this.ganttChart.contentWidth+"px",height:(this.ganttChart.resourceChartHeight||(this.ganttChart.contentHeight*0.8))+"px"});this.content=_18||this.content;this.reConstruct();},postAdjustment:function(){this.contentData.firstChild.style.height=(this.ownerItem.length*23)+"px";this.panelNames.firstChild.style.height=(this.ownerItem.length*23)+"px";},refreshOwnerEntry:function(_19){this.refreshOwnerItem(_19);_4.forEach(this.resourceInfo[_19],function(_1a,i){var _1b=this.ownerTaskNodeMapping[_19].tasks[i][0];this.refreshDetailedTaskEntry(_19,_1b,_1a);},this);},createOwnerEntry:function(_1c){var _1d=this.contentData.firstChild;var _1e=this.ownerItem[this.ownerItem.length-1];this.ownerTaskNodeMapping[_1c]={};this.ownerTaskNodeMapping[_1c][_1c]=[];var pos=_4.position(_1d);var _1f=(_1e?parseInt(_1e.style.top):(6-23))+this.ganttChart.heightTaskItem+11;var _20=this.createOwnerItem(_1c,_1f);_1d.appendChild(_20);this.ownerItem.push(_20);this.ownerTaskNodeMapping[_1c][_1c].push(_20);if(this.panelNames){var _21=this.createOwnerNameItem(_1c,_1f);this.panelNames.firstChild.appendChild(_21);this.ownerNameItem.push(_21);this.ownerTaskNodeMapping[_1c][_1c].push(_21);}var _22=this.ownerItem[this.ownerNameItem.length-1];var _23=this.ownerNameItem[this.ownerNameItem.length-1];if(this.panelNames){this.checkWidthTaskNameItem(_23);var _24=this.createTreeImg(_23);this.panelNames.firstChild.appendChild(_24);this.ownerTaskNodeMapping[_1c][_1c].push(_24);}this.ownerTaskNodeMapping[_1c]["taskCount"]=this.resourceInfo[_1c].length;this.ownerTaskNodeMapping[_1c]["isOpen"]=false;this.ownerTaskNodeMapping[_1c]["tasks"]=[];_4.forEach(this.resourceInfo[_1c],function(_25){this.ownerTaskNodeMapping[_1c]["tasks"].push(this.createDetailedTaskEntry(_1c,_23,_25));},this);return this;},createOwnerNameItem:function(_26,_27){var _28=_4.create("div",{id:_26,title:_26,innerHTML:_26,className:"ganttOwnerNameItem"});_4.style(_28,"top",_27+"px");return _28;},refreshOwnerItem:function(_29){var _2a=this.ownerTaskNodeMapping[_29][_29][0];var _2b=this.ownerTimeConsume[_29].min,end=this.ownerTimeConsume[_29].max,dur=this.ownerTimeConsume[_29].dur;var _2c=this.ganttChart.getPosOnDate(_2b);_2a.style.left=_2c+"px";_2a.style.width=dur*this.ganttChart.pixelsPerWorkHour+"px";_4.forEach(this.resourceInfo[_29],function(_2d,i){var _2e=this.ganttChart.getPosOnDate(_2d.taskItem.startTime);_4.style(_2a.childNodes[i],{left:(_2e-_2c)+"px",width:_2d.taskItem.duration*this.ganttChart.pixelsPerWorkHour+"px"});},this);},createOwnerItem:function(_2f,_30){var _31=this.ownerTimeConsume[_2f].min,end=this.ownerTimeConsume[_2f].max,dur=this.ownerTimeConsume[_2f].dur;var _32=this.ganttChart.getPosOnDate(_31);var _33=_4.create("div",{id:_2f,owner:true,className:"ganttOwnerBar"});_4.style(_33,{left:_32+"px",top:_30+"px",width:dur*this.ganttChart.pixelsPerWorkHour+"px",height:this.ganttChart.heightTaskItem+"px"});_4.forEach(this.resourceInfo[_2f],function(_34){var _35=_4.create("div",{id:_2f,className:"ganttOwnerTaskBar"},_33);var _36=this.ganttChart.getPosOnDate(_34.taskItem.startTime);_4.style(_35,{left:(_36-_32)+"px",width:_34.taskItem.duration*this.ganttChart.pixelsPerWorkHour+"px",height:this.ganttChart.heightTaskItem+"px"});},this);return _33;},refreshDetailedTaskEntry:function(_37,_38,_39){this.refreshTaskItem(_38,_39);},createDetailedTaskEntry:function(_3a,_3b,_3c){var _3d=[];var _3e=this.contentData.firstChild;var _3f=parseInt(_3b.style.top);var _40=this.createTaskItem(_3c,_3f);_40.style.display="none";_3e.appendChild(_40);this.ownerItem.push(_40);_3d.push(_40);if(this.panelNames){var _41=this.createTaskNameItem(_3c.taskItem.name,_3f);this.panelNames.firstChild.appendChild(_41);_41.style.display="none";this.ownerNameItem.push(_41);_3d.push(_41);}if(this.panelNames){this.ownerNameItem[this.ownerNameItem.length-1].style.left=_4.style(_3b,"left")+15+"px";var _42=this.createConnectingLinesPN(_3b,this.ownerNameItem[this.ownerNameItem.length-1]);_4.forEach(_42,function(_43){_43.style.display="none";},this);_3d.push({"v":_42[0],"h":_42[1]});this.checkWidthTaskNameItem(this.ownerNameItem[this.ownerNameItem.length-1]);}return _3d;},createTaskNameItem:function(_44,_45){var _46=_4.create("div",{id:_44,className:"ganttTaskNameItem",title:_44,innerHTML:_44});_4.style(_46,"top",_45+"px");return _46;},refreshTaskItem:function(_47,_48){var _49=this.ganttChart.getPosOnDate(_48.taskItem.startTime);_4.style(_47,{left:_49+"px",width:_48.taskItem.duration*this.ganttChart.pixelsPerWorkHour+"px"});},createTaskItem:function(_4a,_4b){var _4c=this.ganttChart.getPosOnDate(_4a.taskItem.startTime);var _4d=_4.create("div",{id:_4a.taskItem.name,className:"ganttTaskBar"});_4.style(_4d,{left:_4c+"px",top:_4b+"px",width:_4a.taskItem.duration*this.ganttChart.pixelsPerWorkHour+"px",height:this.ganttChart.heightTaskItem+"px"});return _4d;},createConnectingLinesPN:function(_4e,_4f){var _50=[];var _51=_4.create("div",{innerHTML:"&nbsp;",className:"ganttResourceLineVerticalLeft"},this.panelNames.firstChild);_51.cNode=_4f;_51.pNode=_4e;var _52=_4.create("div",{noShade:true,color:"#000000",className:"ganttResourceLineHorizontalLeft"},this.panelNames.firstChild);_52.cNode=_4f;_52.pNode=_4e;this.panelNames.firstChild.appendChild(_52);_50.push(_51);_50.push(_52);return _50;},createTreeImg:function(_53){var _54=_4.create("div",{id:_53.id,className:"ganttImageTreeExpand"});_4.attr(_54,"tabIndex",0);var _55=this.ownerTaskNodeMapping[_53.id];_4.forEach(["onclick","onkeydown"],function(e){this.ganttChart._events.push(_4.connect(_54,e,this,function(evt){if(e=="onkeydown"&&evt.keyCode!=_4.keys.ENTER){return;}if(_55.isOpen){_4.removeClass(_54,"ganttImageTreeCollapse");_4.addClass(_54,"ganttImageTreeExpand");_55.isOpen=false;var _56=false;for(var _57 in this.ownerTaskNodeMapping){var _58=this.ownerTaskNodeMapping[_57];if(_56){_4.forEach(_58[_57],function(_59){_4.style(_59,"top",_4.style(_59,"top")-_55.taskCount*23+"px");},this);_4.forEach(_58.tasks,function(_5a){_4.forEach(_5a,function(_5b){var _5c=!_5b.v&&!_5b.h?[_5b]:[_5b.v,_5b.h];_4.forEach(_5c,function(t){_4.style(t,"top",_4.style(t,"top")-_55.taskCount*23+"px");},this);},this);},this);}else{if(_57==_53.id){_56=true;_4.forEach(_58.tasks,function(_5d,i){_4.forEach(_5d,function(_5e){this.styleOwnerItem(_5e,_58[_57][0],"none",0);},this);},this);}}}}else{_4.removeClass(_54,"ganttImageTreeExpand");_4.addClass(_54,"ganttImageTreeCollapse");_55.isOpen=true;var _56=false;for(var _57 in this.ownerTaskNodeMapping){var _58=this.ownerTaskNodeMapping[_57];if(_56){_4.forEach(_58[_57],function(_5f){_4.style(_5f,"top",_4.style(_5f,"top")+_55.taskCount*23+"px");},this);_4.forEach(_58.tasks,function(_60){_4.forEach(_60,function(_61){var _62=!_61.v&&!_61.h?[_61]:[_61.v,_61.h];_4.forEach(_62,function(t){_4.style(t,"top",_4.style(t,"top")+_55.taskCount*23+"px");},this);},this);},this);}else{if(_57==_53.id){_56=true;_4.forEach(_58.tasks,function(_63,i){_4.forEach(_63,function(_64){this.styleOwnerItem(_64,_58[_57][0],"inline",(i+1)*23);},this);},this);}}}}}));},this);_4.addClass(_54,"ganttResourceTreeImage");_4.style(_54,{left:(_4.style(_53,"left")-12)+"px",top:(_4.style(_53,"top")+3)+"px"});return _54;},styleOwnerItem:function(_65,_66,_67,_68){if(_65.v||_65.h){_4.style(_65.v,{height:Math.max(1,(_65.v.cNode.offsetTop-_65.v.pNode.offsetTop))+"px",top:(_65.v.pNode.offsetTop+5)+"px",left:(_65.v.pNode.offsetLeft-9)+"px",display:_67});_4.style(_65.h,{width:Math.max(1,(_65.h.cNode.offsetLeft-_65.h.pNode.offsetLeft+4))+"px",top:(_65.h.cNode.offsetTop+5)+"px",left:(_65.h.pNode.offsetLeft-9)+"px",display:_67});}else{_4.style(_65,{display:_67,top:parseInt(_66.style.top)+_68+"px"});}},checkWidthTaskNameItem:function(_69){if(_69&&_69.offsetWidth+_69.offsetLeft>this.ganttChart.maxWidthPanelNames){var _6a=_69.offsetWidth+_69.offsetLeft-this.ganttChart.maxWidthPanelNames;var _6b=Math.round(_6a/(_69.offsetWidth/_69.firstChild.length));var _6c=_69.id.substring(0,_69.firstChild.length-_6b-3);_6c+="...";_69.innerHTML=_6c;}},createPanelOwners:function(){var _6d=_4.create("div",{className:"ganttOwnerPanel"});_4.style(_6d,{height:(this.contentHeight-this.ganttChart.panelTimeHeight-this.ganttChart.scrollBarWidth)+"px"});return _6d;},createPanelNamesOwners:function(){var _6e=_4.create("div",{innerHTML:"&nbsp;",className:"ganttResourcePanelNamesOwners"});_4.style(_6e,{height:(this.contentHeight-this.ganttChart.panelTimeHeight-this.ganttChart.scrollBarWidth)+"px",width:this.ganttChart.maxWidthPanelNames+"px"});return _6e;}});}}};});