/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realitybuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.gfx.canvas"],["require","dojox.gfx._base"],["require","dojox.gfx.shape"],["require","dojox.gfx.path"],["require","dojox.gfx.arc"],["require","dojox.gfx.decompose"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.gfx.canvas"]){_4._hasResource["dojox.gfx.canvas"]=true;_4.provide("dojox.gfx.canvas");_4.require("dojox.gfx._base");_4.require("dojox.gfx.shape");_4.require("dojox.gfx.path");_4.require("dojox.gfx.arc");_4.require("dojox.gfx.decompose");_4.experimental("dojox.gfx.canvas");(function(){var d=_4,g=_6.gfx,gs=g.shape,ga=g.arc,_7=g.canvas,m=g.matrix,mp=m.multiplyPoint,pi=Math.PI,_8=2*pi,_9=pi/2,_a=null;d.declare("dojox.gfx.canvas.Shape",gs.Shape,{_render:function(_b){_b.save();this._renderTransform(_b);this._renderShape(_b);this._renderFill(_b,true);this._renderStroke(_b,true);_b.restore();},_renderTransform:function(_c){if("canvasTransform" in this){var t=this.canvasTransform;_c.translate(t.dx,t.dy);_c.rotate(t.angle2);_c.scale(t.sx,t.sy);_c.rotate(t.angle1);}},_renderShape:function(_d){},_renderFill:function(_e,_f){if("canvasFill" in this){var fs=this.fillStyle;if("canvasFillImage" in this){var w=fs.width,h=fs.height,iw=this.canvasFillImage.width,ih=this.canvasFillImage.height,sx=w==iw?1:w/iw,sy=h==ih?1:h/ih,s=Math.min(sx,sy),dx=(w-s*iw)/2,dy=(h-s*ih)/2;_a.width=w;_a.height=h;var _10=_a.getContext("2d");_10.clearRect(0,0,w,h);_10.drawImage(this.canvasFillImage,0,0,iw,ih,dx,dy,s*iw,s*ih);this.canvasFill=_e.createPattern(_a,"repeat");delete this.canvasFillImage;}_e.fillStyle=this.canvasFill;if(_f){if(fs.type==="pattern"&&(fs.x!==0||fs.y!==0)){_e.translate(fs.x,fs.y);}_e.fill();}}else{_e.fillStyle="rgba(0,0,0,0.0)";}},_renderStroke:function(ctx,_11){var s=this.strokeStyle;if(s){ctx.strokeStyle=s.color.toString();ctx.lineWidth=s.width;ctx.lineCap=s.cap;if(typeof s.join=="number"){ctx.lineJoin="miter";ctx.miterLimit=s.join;}else{ctx.lineJoin=s.join;}if(_11){ctx.stroke();}}else{if(!_11){ctx.strokeStyle="rgba(0,0,0,0.0)";}}},getEventSource:function(){return null;},connect:function(){},disconnect:function(){}});var _12=function(_13,_14,_15){var old=_13.prototype[_14];_13.prototype[_14]=_15?function(){this.surface.makeDirty();old.apply(this,arguments);_15.call(this);return this;}:function(){this.surface.makeDirty();return old.apply(this,arguments);};};_12(_7.Shape,"setTransform",function(){if(this.matrix){this.canvasTransform=g.decompose(this.matrix);}else{delete this.canvasTransform;}});_12(_7.Shape,"setFill",function(){var fs=this.fillStyle,f;if(fs){if(typeof (fs)=="object"&&"type" in fs){var ctx=this.surface.rawNode.getContext("2d");switch(fs.type){case "linear":case "radial":f=fs.type=="linear"?ctx.createLinearGradient(fs.x1,fs.y1,fs.x2,fs.y2):ctx.createRadialGradient(fs.cx,fs.cy,0,fs.cx,fs.cy,fs.r);d.forEach(fs.colors,function(_16){f.addColorStop(_16.offset,g.normalizeColor(_16.color).toString());});break;case "pattern":if(!_a){_a=document.createElement("canvas");}var img=new Image();this.surface.downloadImage(img,fs.src);this.canvasFillImage=img;}}else{f=fs.toString();}this.canvasFill=f;}else{delete this.canvasFill;}});_12(_7.Shape,"setStroke");_12(_7.Shape,"setShape");_4.declare("dojox.gfx.canvas.Group",_7.Shape,{constructor:function(){gs.Container._init.call(this);},_render:function(ctx){ctx.save();this._renderTransform(ctx);for(var i=0;i<this.children.length;++i){this.children[i]._render(ctx);}ctx.restore();}});_4.declare("dojox.gfx.canvas.Rect",[_7.Shape,gs.Rect],{_renderShape:function(ctx){var s=this.shape,r=Math.min(s.r,s.height/2,s.width/2),xl=s.x,xr=xl+s.width,yt=s.y,yb=yt+s.height,xl2=xl+r,xr2=xr-r,yt2=yt+r,yb2=yb-r;ctx.beginPath();ctx.moveTo(xl2,yt);if(r){ctx.arc(xr2,yt2,r,-_9,0,false);ctx.arc(xr2,yb2,r,0,_9,false);ctx.arc(xl2,yb2,r,_9,pi,false);ctx.arc(xl2,yt2,r,pi,pi+_9,false);}else{ctx.lineTo(xr2,yt);ctx.lineTo(xr,yb2);ctx.lineTo(xl2,yb);ctx.lineTo(xl,yt2);}ctx.closePath();}});var _17=[];(function(){var u=ga.curvePI4;_17.push(u.s,u.c1,u.c2,u.e);for(var a=45;a<360;a+=45){var r=m.rotateg(a);_17.push(mp(r,u.c1),mp(r,u.c2),mp(r,u.e));}})();_4.declare("dojox.gfx.canvas.Ellipse",[_7.Shape,gs.Ellipse],{setShape:function(){this.inherited(arguments);var s=this.shape,t,c1,c2,r=[],M=m.normalize([m.translate(s.cx,s.cy),m.scale(s.rx,s.ry)]);t=mp(M,_17[0]);r.push([t.x,t.y]);for(var i=1;i<_17.length;i+=3){c1=mp(M,_17[i]);c2=mp(M,_17[i+1]);t=mp(M,_17[i+2]);r.push([c1.x,c1.y,c2.x,c2.y,t.x,t.y]);}this.canvasEllipse=r;return this;},_renderShape:function(ctx){var r=this.canvasEllipse;ctx.beginPath();ctx.moveTo.apply(ctx,r[0]);for(var i=1;i<r.length;++i){ctx.bezierCurveTo.apply(ctx,r[i]);}ctx.closePath();}});_4.declare("dojox.gfx.canvas.Circle",[_7.Shape,gs.Circle],{_renderShape:function(ctx){var s=this.shape;ctx.beginPath();ctx.arc(s.cx,s.cy,s.r,0,_8,1);}});_4.declare("dojox.gfx.canvas.Line",[_7.Shape,gs.Line],{_renderShape:function(ctx){var s=this.shape;ctx.beginPath();ctx.moveTo(s.x1,s.y1);ctx.lineTo(s.x2,s.y2);}});_4.declare("dojox.gfx.canvas.Polyline",[_7.Shape,gs.Polyline],{setShape:function(){this.inherited(arguments);var p=this.shape.points,f=p[0],r=[],c,i;if(p.length){if(typeof f=="number"){r.push(f,p[1]);i=2;}else{r.push(f.x,f.y);i=1;}for(;i<p.length;++i){c=p[i];if(typeof c=="number"){r.push(c,p[++i]);}else{r.push(c.x,c.y);}}}this.canvasPolyline=r;return this;},_renderShape:function(ctx){var p=this.canvasPolyline;if(p.length){ctx.beginPath();ctx.moveTo(p[0],p[1]);for(var i=2;i<p.length;i+=2){ctx.lineTo(p[i],p[i+1]);}}}});_4.declare("dojox.gfx.canvas.Image",[_7.Shape,gs.Image],{setShape:function(){this.inherited(arguments);var img=new Image();this.surface.downloadImage(img,this.shape.src);this.canvasImage=img;return this;},_renderShape:function(ctx){var s=this.shape;ctx.drawImage(this.canvasImage,s.x,s.y,s.width,s.height);}});_4.declare("dojox.gfx.canvas.Text",[_7.Shape,gs.Text],{_setFont:function(){if(this.fontStyle){this.canvasFont=g.makeFontString(this.fontStyle);}else{delete this.canvasFont;}},getTextWidth:function(){var s=this.shape,w=0,ctx;if(s.text&&s.text.length>0){ctx=this.surface.rawNode.getContext("2d");ctx.save();this._renderTransform(ctx);this._renderFill(ctx,false);this._renderStroke(ctx,false);if(this.canvasFont){ctx.font=this.canvasFont;}w=ctx.measureText(s.text).width;ctx.restore();}return w;},_render:function(ctx){ctx.save();this._renderTransform(ctx);this._renderFill(ctx,false);this._renderStroke(ctx,false);this._renderShape(ctx);ctx.restore();},_renderShape:function(ctx){var ta,s=this.shape;if(!s.text||s.text.length==0){return;}ta=s.align==="middle"?"center":s.align;ctx.textAlign=ta;if(this.canvasFont){ctx.font=this.canvasFont;}if(this.canvasFill){ctx.fillText(s.text,s.x,s.y);}if(this.strokeStyle){ctx.beginPath();ctx.strokeText(s.text,s.x,s.y);ctx.closePath();}}});_12(_7.Text,"setFont");if(typeof _4.doc.createElement("canvas").getContext("2d").fillText!="function"){_7.Text.extend({getTextWidth:function(){return 0;},_renderShape:function(){}});}var _18={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};_4.declare("dojox.gfx.canvas.Path",[_7.Shape,g.path.Path],{constructor:function(){this.lastControl={};},setShape:function(){this.canvasPath=[];return this.inherited(arguments);},_updateWithSegment:function(_19){var _1a=d.clone(this.last);this[_18[_19.action]](this.canvasPath,_19.action,_19.args);this.last=_1a;this.inherited(arguments);},_renderShape:function(ctx){var r=this.canvasPath;ctx.beginPath();for(var i=0;i<r.length;i+=2){ctx[r[i]].apply(ctx,r[i+1]);}},_moveToA:function(_1b,_1c,_1d){_1b.push("moveTo",[_1d[0],_1d[1]]);for(var i=2;i<_1d.length;i+=2){_1b.push("lineTo",[_1d[i],_1d[i+1]]);}this.last.x=_1d[_1d.length-2];this.last.y=_1d[_1d.length-1];this.lastControl={};},_moveToR:function(_1e,_1f,_20){if("x" in this.last){_1e.push("moveTo",[this.last.x+=_20[0],this.last.y+=_20[1]]);}else{_1e.push("moveTo",[this.last.x=_20[0],this.last.y=_20[1]]);}for(var i=2;i<_20.length;i+=2){_1e.push("lineTo",[this.last.x+=_20[i],this.last.y+=_20[i+1]]);}this.lastControl={};},_lineToA:function(_21,_22,_23){for(var i=0;i<_23.length;i+=2){_21.push("lineTo",[_23[i],_23[i+1]]);}this.last.x=_23[_23.length-2];this.last.y=_23[_23.length-1];this.lastControl={};},_lineToR:function(_24,_25,_26){for(var i=0;i<_26.length;i+=2){_24.push("lineTo",[this.last.x+=_26[i],this.last.y+=_26[i+1]]);}this.lastControl={};},_hLineToA:function(_27,_28,_29){for(var i=0;i<_29.length;++i){_27.push("lineTo",[_29[i],this.last.y]);}this.last.x=_29[_29.length-1];this.lastControl={};},_hLineToR:function(_2a,_2b,_2c){for(var i=0;i<_2c.length;++i){_2a.push("lineTo",[this.last.x+=_2c[i],this.last.y]);}this.lastControl={};},_vLineToA:function(_2d,_2e,_2f){for(var i=0;i<_2f.length;++i){_2d.push("lineTo",[this.last.x,_2f[i]]);}this.last.y=_2f[_2f.length-1];this.lastControl={};},_vLineToR:function(_30,_31,_32){for(var i=0;i<_32.length;++i){_30.push("lineTo",[this.last.x,this.last.y+=_32[i]]);}this.lastControl={};},_curveToA:function(_33,_34,_35){for(var i=0;i<_35.length;i+=6){_33.push("bezierCurveTo",_35.slice(i,i+6));}this.last.x=_35[_35.length-2];this.last.y=_35[_35.length-1];this.lastControl.x=_35[_35.length-4];this.lastControl.y=_35[_35.length-3];this.lastControl.type="C";},_curveToR:function(_36,_37,_38){for(var i=0;i<_38.length;i+=6){_36.push("bezierCurveTo",[this.last.x+_38[i],this.last.y+_38[i+1],this.lastControl.x=this.last.x+_38[i+2],this.lastControl.y=this.last.y+_38[i+3],this.last.x+_38[i+4],this.last.y+_38[i+5]]);this.last.x+=_38[i+4];this.last.y+=_38[i+5];}this.lastControl.type="C";},_smoothCurveToA:function(_39,_3a,_3b){for(var i=0;i<_3b.length;i+=4){var _3c=this.lastControl.type=="C";_39.push("bezierCurveTo",[_3c?2*this.last.x-this.lastControl.x:this.last.x,_3c?2*this.last.y-this.lastControl.y:this.last.y,_3b[i],_3b[i+1],_3b[i+2],_3b[i+3]]);this.lastControl.x=_3b[i];this.lastControl.y=_3b[i+1];this.lastControl.type="C";}this.last.x=_3b[_3b.length-2];this.last.y=_3b[_3b.length-1];},_smoothCurveToR:function(_3d,_3e,_3f){for(var i=0;i<_3f.length;i+=4){var _40=this.lastControl.type=="C";_3d.push("bezierCurveTo",[_40?2*this.last.x-this.lastControl.x:this.last.x,_40?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+_3f[i],this.last.y+_3f[i+1],this.last.x+_3f[i+2],this.last.y+_3f[i+3]]);this.lastControl.x=this.last.x+_3f[i];this.lastControl.y=this.last.y+_3f[i+1];this.lastControl.type="C";this.last.x+=_3f[i+2];this.last.y+=_3f[i+3];}},_qCurveToA:function(_41,_42,_43){for(var i=0;i<_43.length;i+=4){_41.push("quadraticCurveTo",_43.slice(i,i+4));}this.last.x=_43[_43.length-2];this.last.y=_43[_43.length-1];this.lastControl.x=_43[_43.length-4];this.lastControl.y=_43[_43.length-3];this.lastControl.type="Q";},_qCurveToR:function(_44,_45,_46){for(var i=0;i<_46.length;i+=4){_44.push("quadraticCurveTo",[this.lastControl.x=this.last.x+_46[i],this.lastControl.y=this.last.y+_46[i+1],this.last.x+_46[i+2],this.last.y+_46[i+3]]);this.last.x+=_46[i+2];this.last.y+=_46[i+3];}this.lastControl.type="Q";},_qSmoothCurveToA:function(_47,_48,_49){for(var i=0;i<_49.length;i+=2){var _4a=this.lastControl.type=="Q";_47.push("quadraticCurveTo",[this.lastControl.x=_4a?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=_4a?2*this.last.y-this.lastControl.y:this.last.y,_49[i],_49[i+1]]);this.lastControl.type="Q";}this.last.x=_49[_49.length-2];this.last.y=_49[_49.length-1];},_qSmoothCurveToR:function(_4b,_4c,_4d){for(var i=0;i<_4d.length;i+=2){var _4e=this.lastControl.type=="Q";_4b.push("quadraticCurveTo",[this.lastControl.x=_4e?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=_4e?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+_4d[i],this.last.y+_4d[i+1]]);this.lastControl.type="Q";this.last.x+=_4d[i];this.last.y+=_4d[i+1];}},_arcTo:function(_4f,_50,_51){var _52=_50=="a";for(var i=0;i<_51.length;i+=7){var x1=_51[i+5],y1=_51[i+6];if(_52){x1+=this.last.x;y1+=this.last.y;}var _53=ga.arcAsBezier(this.last,_51[i],_51[i+1],_51[i+2],_51[i+3]?1:0,_51[i+4]?1:0,x1,y1);d.forEach(_53,function(p){_4f.push("bezierCurveTo",p);});this.last.x=x1;this.last.y=y1;}this.lastControl={};},_closePath:function(_54,_55,_56){_54.push("closePath",[]);this.lastControl={};}});d.forEach(["moveTo","lineTo","hLineTo","vLineTo","curveTo","smoothCurveTo","qCurveTo","qSmoothCurveTo","arcTo","closePath"],function(_57){_12(_7.Path,_57);});_4.declare("dojox.gfx.canvas.TextPath",[_7.Shape,g.path.TextPath],{_renderShape:function(ctx){var s=this.shape;},_setText:function(){},_setFont:function(){}});_4.declare("dojox.gfx.canvas.Surface",gs.Surface,{constructor:function(){gs.Container._init.call(this);this.pendingImageCount=0;this.makeDirty();},setDimensions:function(_58,_59){this.width=g.normalizedLength(_58);this.height=g.normalizedLength(_59);if(!this.rawNode){return this;}this.rawNode.width=_58;this.rawNode.height=_59;this.makeDirty();return this;},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:null;},_render:function(){if(this.pendingImageCount){return;}var ctx=this.rawNode.getContext("2d");ctx.save();ctx.clearRect(0,0,this.rawNode.width,this.rawNode.height);for(var i=0;i<this.children.length;++i){this.children[i]._render(ctx);}ctx.restore();if("pendingRender" in this){clearTimeout(this.pendingRender);delete this.pendingRender;}},makeDirty:function(){if(!this.pendingImagesCount&&!("pendingRender" in this)){this.pendingRender=setTimeout(d.hitch(this,this._render),0);}},downloadImage:function(img,url){var _5a=d.hitch(this,this.onImageLoad);if(!this.pendingImageCount++&&"pendingRender" in this){clearTimeout(this.pendingRender);delete this.pendingRender;}img.onload=_5a;img.onerror=_5a;img.onabort=_5a;img.src=url;},onImageLoad:function(){if(!--this.pendingImageCount){this._render();}},getEventSource:function(){return null;},connect:function(){},disconnect:function(){}});_7.createSurface=function(_5b,_5c,_5d){if(!_5c&&!_5d){var pos=d.position(_5b);_5c=_5c||pos.w;_5d=_5d||pos.h;}if(typeof _5c=="number"){_5c=_5c+"px";}if(typeof _5d=="number"){_5d=_5d+"px";}var s=new _7.Surface(),p=d.byId(_5b),c=p.ownerDocument.createElement("canvas");c.width=g.normalizedLength(_5c);c.height=g.normalizedLength(_5d);p.appendChild(c);s.rawNode=c;s._parent=p;s.surface=s;return s;};var C=gs.Container,_5e={add:function(_5f){this.surface.makeDirty();return C.add.apply(this,arguments);},remove:function(_60,_61){this.surface.makeDirty();return C.remove.apply(this,arguments);},clear:function(){this.surface.makeDirty();return C.clear.apply(this,arguments);},_moveChildToFront:function(_62){this.surface.makeDirty();return C._moveChildToFront.apply(this,arguments);},_moveChildToBack:function(_63){this.surface.makeDirty();return C._moveChildToBack.apply(this,arguments);}};var _64={createObject:function(_65,_66){var _67=new _65();_67.surface=this.surface;_67.setShape(_66);this.add(_67);return _67;}};d.extend(_7.Group,_5e);d.extend(_7.Group,gs.Creator);d.extend(_7.Group,_64);d.extend(_7.Surface,_5e);d.extend(_7.Surface,gs.Creator);d.extend(_7.Surface,_64);if(g.loadAndSwitch==="canvas"){g.switchTo("canvas");delete g.loadAndSwitch;}})();}}};});