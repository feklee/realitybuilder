/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realitybuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.grid._Scroller"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.grid._Scroller"]){_4._hasResource["dojox.grid._Scroller"]=true;_4.provide("dojox.grid._Scroller");(function(){var _7=function(_8){var i=0,n,p=_8.parentNode;while((n=p.childNodes[i++])){if(n==_8){return i-1;}}return -1;};var _9=function(_a){if(!_a){return;}var _b=function(_c){return _c.domNode&&_4.isDescendant(_c.domNode,_a,true);};var ws=_5.registry.filter(_b);for(var i=0,w;(w=ws[i]);i++){w.destroy();}delete ws;};var _d=function(_e){var _f=_4.byId(_e);return (_f&&_f.tagName?_f.tagName.toLowerCase():"");};var _10=function(_11,_12){var _13=[];var i=0,n;while((n=_11.childNodes[i])){i++;if(_d(n)==_12){_13.push(n);}}return _13;};var _14=function(_15){return _10(_15,"div");};_4.declare("dojox.grid._Scroller",null,{constructor:function(_16){this.setContentNodes(_16);this.pageHeights=[];this.pageNodes=[];this.stack=[];},rowCount:0,defaultRowHeight:32,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,lastVisibleRow:0,averageRowHeight:0,page:0,pageTop:0,init:function(_17,_18,_19){switch(arguments.length){case 3:this.rowsPerPage=_19;case 2:this.keepRows=_18;case 1:this.rowCount=_17;default:break;}this.defaultPageHeight=this.defaultRowHeight*this.rowsPerPage;this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);this.setKeepInfo(this.keepRows);this.invalidate();if(this.scrollboxNode){this.scrollboxNode.scrollTop=0;this.scroll(0);this.scrollboxNode.onscroll=_4.hitch(this,"onscroll");}},_getPageCount:function(_1a,_1b){return _1a?(Math.ceil(_1a/_1b)||1):0;},destroy:function(){this.invalidateNodes();delete this.contentNodes;delete this.contentNode;delete this.scrollboxNode;},setKeepInfo:function(_1c){this.keepRows=_1c;this.keepPages=!this.keepRows?this.keepPages:Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2);},setContentNodes:function(_1d){this.contentNodes=_1d;this.colCount=(this.contentNodes?this.contentNodes.length:0);this.pageNodes=[];for(var i=0;i<this.colCount;i++){this.pageNodes[i]=[];}},getDefaultNodes:function(){return this.pageNodes[0]||[];},invalidate:function(){this._invalidating=true;this.invalidateNodes();this.pageHeights=[];this.height=(this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0);this.resize();this._invalidating=false;},updateRowCount:function(_1e){this.invalidateNodes();this.rowCount=_1e;var _1f=this.pageCount;if(_1f===0){this.height=1;}this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);if(this.pageCount<_1f){for(var i=_1f-1;i>=this.pageCount;i--){this.height-=this.getPageHeight(i);delete this.pageHeights[i];}}else{if(this.pageCount>_1f){this.height+=this.defaultPageHeight*(this.pageCount-_1f-1)+this.calcLastPageHeight();}}this.resize();},pageExists:function(_20){return Boolean(this.getDefaultPageNode(_20));},measurePage:function(_21){if(this.grid.rowHeight){var _22=this.grid.rowHeight+1;return ((_21+1)*this.rowsPerPage>this.rowCount?this.rowCount-_21*this.rowsPerPage:this.rowsPerPage)*_22;}var n=this.getDefaultPageNode(_21);return (n&&n.innerHTML)?n.offsetHeight:undefined;},positionPage:function(_23,_24){for(var i=0;i<this.colCount;i++){this.pageNodes[i][_23].style.top=_24+"px";}},repositionPages:function(_25){var _26=this.getDefaultNodes();var _27=0;for(var i=0;i<this.stack.length;i++){_27=Math.max(this.stack[i],_27);}var n=_26[_25];var y=(n?this.getPageNodePosition(n)+this.getPageHeight(_25):0);for(var p=_25+1;p<=_27;p++){n=_26[p];if(n){if(this.getPageNodePosition(n)==y){return;}this.positionPage(p,y);}y+=this.getPageHeight(p);}},installPage:function(_28){for(var i=0;i<this.colCount;i++){this.contentNodes[i].appendChild(this.pageNodes[i][_28]);}},preparePage:function(_29,_2a){var p=(_2a?this.popPage():null);for(var i=0;i<this.colCount;i++){var _2b=this.pageNodes[i];var _2c=(p===null?this.createPageNode():this.invalidatePageNode(p,_2b));_2c.pageIndex=_29;_2b[_29]=_2c;}},renderPage:function(_2d){var _2e=[];var i,j;for(i=0;i<this.colCount;i++){_2e[i]=this.pageNodes[i][_2d];}for(i=0,j=_2d*this.rowsPerPage;(i<this.rowsPerPage)&&(j<this.rowCount);i++,j++){this.renderRow(j,_2e);}},removePage:function(_2f){for(var i=0,j=_2f*this.rowsPerPage;i<this.rowsPerPage;i++,j++){this.removeRow(j);}},destroyPage:function(_30){for(var i=0;i<this.colCount;i++){var n=this.invalidatePageNode(_30,this.pageNodes[i]);if(n){_4.destroy(n);}}},pacify:function(_31){},pacifying:false,pacifyTicks:200,setPacifying:function(_32){if(this.pacifying!=_32){this.pacifying=_32;this.pacify(this.pacifying);}},startPacify:function(){this.startPacifyTicks=new Date().getTime();},doPacify:function(){var _33=(new Date().getTime()-this.startPacifyTicks)>this.pacifyTicks;this.setPacifying(true);this.startPacify();return _33;},endPacify:function(){this.setPacifying(false);},resize:function(){if(this.scrollboxNode){this.windowHeight=this.scrollboxNode.clientHeight;}for(var i=0;i<this.colCount;i++){_6.grid.util.setStyleHeightPx(this.contentNodes[i],Math.max(1,this.height));}var _34=(!this._invalidating);if(!_34){var ah=this.grid.get("autoHeight");if(typeof ah=="number"&&ah<=Math.min(this.rowsPerPage,this.rowCount)){_34=true;}}if(_34){this.needPage(this.page,this.pageTop);}var _35=(this.page<this.pageCount-1)?this.rowsPerPage:((this.rowCount%this.rowsPerPage)||this.rowsPerPage);var _36=this.getPageHeight(this.page);this.averageRowHeight=(_36>0&&_35>0)?(_36/_35):0;},calcLastPageHeight:function(){if(!this.pageCount){return 0;}var _37=this.pageCount-1;var _38=((this.rowCount%this.rowsPerPage)||(this.rowsPerPage))*this.defaultRowHeight;this.pageHeights[_37]=_38;return _38;},updateContentHeight:function(_39){this.height+=_39;this.resize();},updatePageHeight:function(_3a,_3b,_3c){if(this.pageExists(_3a)){var oh=this.getPageHeight(_3a);var h=(this.measurePage(_3a));if(h===undefined){h=oh;}this.pageHeights[_3a]=h;if(oh!=h){this.updateContentHeight(h-oh);var ah=this.grid.get("autoHeight");if((typeof ah=="number"&&ah>this.rowCount)||(ah===true&&!_3b)){if(!_3c){this.grid.sizeChange();}else{var ns=this.grid.viewsNode.style;ns.height=parseInt(ns.height)+h-oh+"px";this.repositionPages(_3a);}}else{this.repositionPages(_3a);}}return h;}return 0;},rowHeightChanged:function(_3d,_3e){this.updatePageHeight(Math.floor(_3d/this.rowsPerPage),false,_3e);},invalidateNodes:function(){while(this.stack.length){this.destroyPage(this.popPage());}},createPageNode:function(){var p=document.createElement("div");_4.attr(p,"role","presentation");p.style.position="absolute";p.style[_4._isBodyLtr()?"left":"right"]="0";return p;},getPageHeight:function(_3f){var ph=this.pageHeights[_3f];return (ph!==undefined?ph:this.defaultPageHeight);},pushPage:function(_40){return this.stack.push(_40);},popPage:function(){return this.stack.shift();},findPage:function(_41){var i=0,h=0;for(var ph=0;i<this.pageCount;i++,h+=ph){ph=this.getPageHeight(i);if(h+ph>=_41){break;}}this.page=i;this.pageTop=h;},buildPage:function(_42,_43,_44){this.preparePage(_42,_43);this.positionPage(_42,_44);this.installPage(_42);this.renderPage(_42);this.pushPage(_42);},needPage:function(_45,_46){var h=this.getPageHeight(_45),oh=h;if(!this.pageExists(_45)){this.buildPage(_45,(!this.grid._autoHeight&&this.keepPages&&(this.stack.length>=this.keepPages)),_46);h=this.updatePageHeight(_45,true);}else{this.positionPage(_45,_46);}return h;},onscroll:function(){this.scroll(this.scrollboxNode.scrollTop);},scroll:function(_47){this.grid.scrollTop=_47;if(this.colCount){this.startPacify();this.findPage(_47);var h=this.height;var b=this.getScrollBottom(_47);for(var p=this.page,y=this.pageTop;(p<this.pageCount)&&((b<0)||(y<b));p++){y+=this.needPage(p,y);}this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,_47);this.lastVisibleRow=this.getLastVisibleRow(p-1,y,b);if(h!=this.height){this.repositionPages(p-1);}this.endPacify();}},getScrollBottom:function(_48){return (this.windowHeight>=0?_48+this.windowHeight:-1);},processNodeEvent:function(e,_49){var t=e.target;while(t&&(t!=_49)&&t.parentNode&&(t.parentNode.parentNode!=_49)){t=t.parentNode;}if(!t||!t.parentNode||(t.parentNode.parentNode!=_49)){return false;}var _4a=t.parentNode;e.topRowIndex=_4a.pageIndex*this.rowsPerPage;e.rowIndex=e.topRowIndex+_7(t);e.rowTarget=t;return true;},processEvent:function(e){return this.processNodeEvent(e,this.contentNode);},renderRow:function(_4b,_4c){},removeRow:function(_4d){},getDefaultPageNode:function(_4e){return this.getDefaultNodes()[_4e];},positionPageNode:function(_4f,_50){},getPageNodePosition:function(_51){return _51.offsetTop;},invalidatePageNode:function(_52,_53){var p=_53[_52];if(p){delete _53[_52];this.removePage(_52,p);_9(p);p.innerHTML="";}return p;},getPageRow:function(_54){return _54*this.rowsPerPage;},getLastPageRow:function(_55){return Math.min(this.rowCount,this.getPageRow(_55+1))-1;},getFirstVisibleRow:function(_56,_57,_58){if(!this.pageExists(_56)){return 0;}var row=this.getPageRow(_56);var _59=this.getDefaultNodes();var _5a=_14(_59[_56]);for(var i=0,l=_5a.length;i<l&&_57<_58;i++,row++){_57+=_5a[i].offsetHeight;}return (row?row-1:row);},getLastVisibleRow:function(_5b,_5c,_5d){if(!this.pageExists(_5b)){return 0;}var _5e=this.getDefaultNodes();var row=this.getLastPageRow(_5b);var _5f=_14(_5e[_5b]);for(var i=_5f.length-1;i>=0&&_5c>_5d;i--,row--){_5c-=_5f[i].offsetHeight;}return row+1;},findTopRow:function(_60){var _61=this.getDefaultNodes();var _62=_14(_61[this.page]);for(var i=0,l=_62.length,t=this.pageTop,h;i<l;i++){h=_62[i].offsetHeight;t+=h;if(t>=_60){this.offset=h-(t-_60);return i+this.page*this.rowsPerPage;}}return -1;},findScrollTop:function(_63){var _64=Math.floor(_63/this.rowsPerPage);var t=0;var i,l;for(i=0;i<_64;i++){t+=this.getPageHeight(i);}this.pageTop=t;this.page=_64;this.needPage(_64,this.pageTop);var _65=this.getDefaultNodes();var _66=_14(_65[_64]);var r=_63-this.rowsPerPage*_64;for(i=0,l=_66.length;i<l&&i<r;i++){t+=_66[i].offsetHeight;}return t;},dummy:0});})();}}};});