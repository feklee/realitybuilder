/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realityBuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.grid.enhanced.plugins.Cookie"],["require","dojox.grid.enhanced._Plugin"],["require","dojo.cookie"],["require","dojox.grid._RowSelector"],["require","dojox.grid.cells._base"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.grid.enhanced.plugins.Cookie"]){_4._hasResource["dojox.grid.enhanced.plugins.Cookie"]=true;_4.provide("dojox.grid.enhanced.plugins.Cookie");_4.require("dojox.grid.enhanced._Plugin");_4.require("dojo.cookie");_4.require("dojox.grid._RowSelector");_4.require("dojox.grid.cells._base");(function(){var _7=function(_8){return window.location+"/"+_8.id;};var _9=function(_a){var _b=[];if(!_4.isArray(_a)){_a=[_a];}_4.forEach(_a,function(_c){if(_4.isArray(_c)){_c={"cells":_c};}var _d=_c.rows||_c.cells;if(_4.isArray(_d)){if(!_4.isArray(_d[0])){_d=[_d];}_4.forEach(_d,function(_e){if(_4.isArray(_e)){_4.forEach(_e,function(_f){_b.push(_f);});}});}});return _b;};var _10=function(_11,_12){if(_4.isArray(_11)){var _13=_12._setStructureAttr;_12._setStructureAttr=function(_14){if(!_12._colWidthLoaded){_12._colWidthLoaded=true;var _15=_9(_14);for(var i=_15.length-1;i>=0;--i){if(typeof _11[i]=="number"){_15[i].width=_11[i]+"px";}}}_13.call(_12,_14);_12._setStructureAttr=_13;};}};var _16=function(_17){return _4.map(_4.filter(_17.layout.cells,function(_18){return !(_18.isRowSelector||_18 instanceof _6.grid.cells.RowIndex);}),function(_19){return _4[_4.isWebKit?"marginBox":"contentBox"](_19.getHeaderNode()).w;});};var _1a=function(_1b,_1c){if(_1b&&_4.every(_1b,function(_1d){return _4.isArray(_1d)&&_4.every(_1d,function(_1e){return _4.isArray(_1e)&&_1e.length>0;});})){var _1f=_1c._setStructureAttr;var _20=function(def){return ("name" in def||"field" in def||"get" in def);};var _21=function(def){return (def!==null&&_4.isObject(def)&&("cells" in def||"rows" in def||("type" in def&&!_20(def))));};_1c._setStructureAttr=function(_22){if(!_1c._colOrderLoaded){_1c._colOrderLoaded=true;_1c._setStructureAttr=_1f;_22=_4.clone(_22);if(_4.isArray(_22)&&!_4.some(_22,_21)){_22=[{cells:_22}];}else{if(_21(_22)){_22=[_22];}}var _23=_9(_22);_4.forEach(_4.isArray(_22)?_22:[_22],function(_24,_25){var _26=_24;if(_4.isArray(_24)){_24.splice(0,_24.length);}else{delete _24.rows;_26=_24.cells=[];}_4.forEach(_1b[_25],function(_27){_4.forEach(_27,function(_28){var i,_29;for(i=0;i<_23.length;++i){_29=_23[i];if(_4.toJson({"name":_29.name,"field":_29.field})==_4.toJson(_28)){break;}}if(i<_23.length){_26.push(_29);}});});});}_1f.call(_1c,_22);};}};var _2a=function(_2b){var _2c=_4.map(_4.filter(_2b.views.views,function(_2d){return !(_2d instanceof _6.grid._RowSelector);}),function(_2e){return _4.map(_2e.structure.cells,function(_2f){return _4.map(_4.filter(_2f,function(_30){return !(_30.isRowSelector||_30 instanceof _6.grid.cells.RowIndex);}),function(_31){return {"name":_31.name,"field":_31.field};});});});return _2c;};var _32=function(_33,_34){try{if(_4.isObject(_33)){_34.setSortIndex(_33.idx,_33.asc);}}catch(e){}};var _35=function(_36){return {idx:_36.getSortIndex(),asc:_36.getSortAsc()};};if(!_4.isIE){_4.addOnWindowUnload(function(){_4.forEach(_5.findWidgets(_4.body()),function(_37){if(_37 instanceof _6.grid.EnhancedGrid&&!_37._destroyed){_37.destroyRecursive();}});});}_4.declare("dojox.grid.enhanced.plugins.Cookie",_6.grid.enhanced._Plugin,{name:"cookie",_cookieEnabled:true,constructor:function(_38,_39){this.grid=_38;_39=(_39&&_4.isObject(_39))?_39:{};this.cookieProps=_39.cookieProps;this._cookieHandlers=[];this._mixinGrid();this.addCookieHandler({name:"columnWidth",onLoad:_10,onSave:_16});this.addCookieHandler({name:"columnOrder",onLoad:_1a,onSave:_2a});this.addCookieHandler({name:"sortOrder",onLoad:_32,onSave:_35});_4.forEach(this._cookieHandlers,function(_3a){if(_39[_3a.name]===false){_3a.enable=false;}},this);},destroy:function(){this._saveCookie();this._cookieHandlers=null;this.inherited(arguments);},_mixinGrid:function(){var g=this.grid;g.addCookieHandler=_4.hitch(this,"addCookieHandler");g.removeCookie=_4.hitch(this,"removeCookie");g.setCookieEnabled=_4.hitch(this,"setCookieEnabled");g.getCookieEnabled=_4.hitch(this,"getCookieEnabled");},_saveCookie:function(){if(this.getCookieEnabled()){var _3b={},chs=this._cookieHandlers,_3c=this.cookieProps,_3d=_7(this.grid);for(var i=chs.length-1;i>=0;--i){if(chs[i].enabled){_3b[chs[i].name]=chs[i].onSave(this.grid);}}_3c=_4.isObject(this.cookieProps)?this.cookieProps:{};_4.cookie(_3d,_4.toJson(_3b),_3c);}else{this.removeCookie();}},onPreInit:function(){var _3e=this.grid,chs=this._cookieHandlers,_3f=_7(_3e),_40=_4.cookie(_3f);if(_40){_40=_4.fromJson(_40);for(var i=0;i<chs.length;++i){if(chs[i].name in _40&&chs[i].enabled){chs[i].onLoad(_40[chs[i].name],_3e);}}}this._cookie=_40||{};this._cookieStartedup=true;},addCookieHandler:function(_41){if(_41.name){var _42=function(){};_41.onLoad=_41.onLoad||_42;_41.onSave=_41.onSave||_42;if(!("enabled" in _41)){_41.enabled=true;}for(var i=this._cookieHandlers.length-1;i>=0;--i){if(this._cookieHandlers[i].name==_41.name){this._cookieHandlers.splice(i,1);}}this._cookieHandlers.push(_41);if(this._cookieStartedup&&_41.name in this._cookie){_41.onLoad(this._cookie[_41.name],this.grid);}}},removeCookie:function(){var key=_7(this.grid);_4.cookie(key,null,{expires:-1});},setCookieEnabled:function(_43,_44){if(arguments.length==2){var chs=this._cookieHandlers;for(var i=chs.length-1;i>=0;--i){if(chs[i].name===_43){chs[i].enabled=!!_44;}}}else{this._cookieEnabled=!!_43;if(!this._cookieEnabled){this.removeCookie();}}},getCookieEnabled:function(_45){if(_4.isString(_45)){var chs=this._cookieHandlers;for(var i=chs.length-1;i>=0;--i){if(chs[i].name==_45){return chs[i].enabled;}}return false;}return this._cookieEnabled;}});_6.grid.EnhancedGrid.registerPlugin(_6.grid.enhanced.plugins.Cookie,{"preInit":true});})();}}};});