/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realityBuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.grid.enhanced.plugins.Selector"],["require","dojox.grid.enhanced._Plugin"],["require","dojox.grid.enhanced.plugins.AutoScroll"],["require","dojox.grid.cells._base"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.grid.enhanced.plugins.Selector"]){_4._hasResource["dojox.grid.enhanced.plugins.Selector"]=true;_4.provide("dojox.grid.enhanced.plugins.Selector");_4.require("dojox.grid.enhanced._Plugin");_4.require("dojox.grid.enhanced.plugins.AutoScroll");_4.require("dojox.grid.cells._base");(function(){var _7=0,_8=1,_9=2,_a={col:"row",row:"col"},_b=function(_c,_d,_e,_f,_10){if(_c!=="cell"){_d=_d[_c];_e=_e[_c];_f=_f[_c];if(typeof _d!=="number"||typeof _e!=="number"||typeof _f!=="number"){return false;}return _10?((_d>=_e&&_d<_f)||(_d>_f&&_d<=_e)):((_d>=_e&&_d<=_f)||(_d>=_f&&_d<=_e));}else{return _b("col",_d,_e,_f,_10)&&_b("row",_d,_e,_f,_10);}},_11=function(_12,v1,v2){try{if(v1&&v2){switch(_12){case "col":case "row":return v1[_12]==v2[_12]&&typeof v1[_12]=="number"&&!(_a[_12] in v1)&&!(_a[_12] in v2);case "cell":return v1.col==v2.col&&v1.row==v2.row&&typeof v1.col=="number"&&typeof v1.row=="number";}}}catch(e){}return false;},_13=function(evt){try{if(evt&&evt.preventDefault){_4.stopEvent(evt);}}catch(e){}},_14=function(_15,_16,_17){switch(_15){case "col":return {"col":typeof _17=="undefined"?_16:_17,"except":[]};case "row":return {"row":_16,"except":[]};case "cell":return {"row":_16,"col":_17};}return null;};_4.declare("dojox.grid.enhanced.plugins.Selector",_6.grid.enhanced._Plugin,{name:"selector",constructor:function(_18,_19){this.grid=_18;this._config={row:_9,col:_9,cell:_9};this.setupConfig(_19);if(_18.selectionMode==="single"){this._config.row=_8;}this._enabled=true;this._selecting={};this._selected={"col":[],"row":[],"cell":[]};this._startPoint={};this._currentPoint={};this._lastAnchorPoint={};this._lastEndPoint={};this._lastSelectedAnchorPoint={};this._lastSelectedEndPoint={};this._keyboardSelect={};this._lastType=null;this._selectedRowModified={};this._hacks();this._initEvents();this._initAreas();this._mixinGrid();},destroy:function(){this.inherited(arguments);},setupConfig:function(_1a){if(!_1a||!_4.isObject(_1a)){return;}var _1b=["row","col","cell"];for(var _1c in _1a){if(_4.indexOf(_1b,_1c)>=0){if(!_1a[_1c]||_1a[_1c]=="disabled"){this._config[_1c]=_7;}else{if(_1a[_1c]=="single"){this._config[_1c]=_8;}else{this._config[_1c]=_9;}}}}var _1d=["none","single","extended"][this._config.row];this.grid.selection.setMode(_1d);},isSelected:function(_1e,_1f,_20){return this._isSelected(_1e,_14(_1e,_1f,_20));},toggleSelect:function(_21,_22,_23){this._startSelect(_21,_14(_21,_22,_23),this._config[_21]===_9,false,false,!this.isSelected(_21,_22,_23));this._endSelect(_21);},select:function(_24,_25,_26){if(!this.isSelected(_24,_25,_26)){this.toggleSelect(_24,_25,_26);}},deselect:function(_27,_28,_29){if(this.isSelected(_27,_28,_29)){this.toggleSelect(_27,_28,_29);}},selectRange:function(_2a,_2b,end,_2c){this.grid._selectingRange=true;var _2d=_2a=="cell"?_14(_2a,_2b.row,_2b.col):_14(_2a,_2b),_2e=_2a=="cell"?_14(_2a,end.row,end.col):_14(_2a,end);this._startSelect(_2a,_2d,false,false,false,_2c);this._highlight(_2a,_2e,_2c===undefined?true:_2c);this._endSelect(_2a);this.grid._selectingRange=false;},clear:function(_2f){this._clearSelection(_2f||"all");},isSelecting:function(_30){if(typeof _30=="undefined"){return this._selecting.col||this._selecting.row||this._selecting.cell;}return this._selecting[_30];},selectEnabled:function(_31){if(typeof _31!="undefined"&&!this.isSelecting()){this._enabled=!!_31;}return this._enabled;},getSelected:function(_32,_33){switch(_32){case "cell":return _4.map(this._selected[_32],function(_34){return _34;});case "col":case "row":return _4.map(_33?this._selected[_32]:_4.filter(this._selected[_32],function(_35){return _35.except.length===0;}),function(_36){return _33?_36:_36[_32];});}return [];},getSelectedCount:function(_37,_38){switch(_37){case "cell":return this._selected[_37].length;case "col":case "row":return (_38?this._selected[_37]:_4.filter(this._selected[_37],function(_39){return _39.except.length===0;})).length;}return 0;},getSelectedType:function(){var s=this._selected;return ["","cell","row","row|cell","col","col|cell","col|row","col|row|cell"][(!!s.cell.length)|(!!s.row.length<<1)|(!!s.col.length<<2)];},getLastSelectedRange:function(_3a){return this._lastAnchorPoint[_3a]?{"start":this._lastAnchorPoint[_3a],"end":this._lastEndPoint[_3a]}:null;},_hacks:function(){var g=this.grid;var _3b=function(e){if(e.cellNode){g.onMouseUp(e);}g.onMouseUpRow(e);};var _3c=_4.hitch(g,"onMouseUp");var _3d=_4.hitch(g,"onMouseDown");var _3e=function(e){e.cellNode.style.border="solid 1px";};_4.forEach(g.views.views,function(_3f){_3f.content.domouseup=_3b;_3f.header.domouseup=_3c;if(_3f.declaredClass=="dojox.grid._RowSelector"){_3f.domousedown=_3d;_3f.domouseup=_3c;_3f.dofocus=_3e;}});g.selection.clickSelect=function(){};this._oldDeselectAll=g.selection.deselectAll;var _40=this;g.selection.selectRange=function(_41,to){_40.selectRange("row",_41,to,true);if(g.selection.preserver){g.selection.preserver._updateMapping(true,true,false,_41,to);}g.selection.onChanged();};g.selection.deselectRange=function(_42,to){_40.selectRange("row",_42,to,false);if(g.selection.preserver){g.selection.preserver._updateMapping(true,false,false,_42,to);}g.selection.onChanged();};g.selection.deselectAll=function(){g._selectingRange=true;_40._oldDeselectAll.apply(g.selection,arguments);_40._clearSelection("row");g._selectingRange=false;if(g.selection.preserver){g.selection.preserver._updateMapping(true,false,true);}g.selection.onChanged();};var _43=g.views.views[0];if(_43 instanceof _6.grid._RowSelector){_43.doStyleRowNode=function(_44,_45){_4.removeClass(_45,"dojoxGridRow");_4.addClass(_45,"dojoxGridRowbar");_4.addClass(_45,"dojoxGridNonNormalizedCell");_4.toggleClass(_45,"dojoxGridRowbarOver",g.rows.isOver(_44));_4.toggleClass(_45,"dojoxGridRowbarSelected",!!g.selection.isSelected(_44));};}this.connect(g,"updateRow",function(_46){_4.forEach(g.layout.cells,function(_47){if(this.isSelected("cell",_46,_47.index)){this._highlightNode(_47.getNode(_46),true);}},this);});},_mixinGrid:function(){var g=this.grid;g.setupSelectorConfig=_4.hitch(this,this.setupConfig);g.onStartSelect=function(){};g.onEndSelect=function(){};g.onStartDeselect=function(){};g.onEndDeselect=function(){};g.onSelectCleared=function(){};},_initEvents:function(){var g=this.grid,_48=this,dp=_4.partial,_49=function(_4a,e){if(_4a==="row"){_48._isUsingRowSelector=true;}if(_48.selectEnabled()&&_48._config[_4a]&&e.button!=2){if(_48._keyboardSelect.col||_48._keyboardSelect.row||_48._keyboardSelect.cell){_48._endSelect("all");_48._keyboardSelect.col=_48._keyboardSelect.row=_48._keyboardSelect.cell=0;}if(_48._usingKeyboard){_48._usingKeyboard=false;}var _4b=_14(_4a,e.rowIndex,e.cell&&e.cell.index);_48._startSelect(_4a,_4b,e.ctrlKey,e.shiftKey);}},_4c=_4.hitch(this,"_endSelect");this.connect(g,"onHeaderCellMouseDown",dp(_49,"col"));this.connect(g,"onHeaderCellMouseUp",dp(_4c,"col"));this.connect(g,"onRowSelectorMouseDown",dp(_49,"row"));this.connect(g,"onRowSelectorMouseUp",dp(_4c,"row"));this.connect(g,"onCellMouseDown",function(e){if(e.cell&&e.cell.isRowSelector){return;}if(g.singleClickEdit){_48._singleClickEdit=true;g.singleClickEdit=false;}_49(_48._config["cell"]==_7?"row":"cell",e);});this.connect(g,"onCellMouseUp",function(e){if(_48._singleClickEdit){delete _48._singleClickEdit;g.singleClickEdit=true;}_4c("all",e);});this.connect(g,"onCellMouseOver",function(e){if(_48._curType!="row"&&_48._selecting[_48._curType]&&_48._config[_48._curType]==_9){_48._highlight("col",_14("col",e.cell.index),_48._toSelect);if(!_48._keyboardSelect.cell){_48._highlight("cell",_14("cell",e.rowIndex,e.cell.index),_48._toSelect);}}});this.connect(g,"onHeaderCellMouseOver",function(e){if(_48._selecting.col&&_48._config.col==_9){_48._highlight("col",_14("col",e.cell.index),_48._toSelect);}});this.connect(g,"onRowMouseOver",function(e){if(_48._selecting.row&&_48._config.row==_9){_48._highlight("row",_14("row",e.rowIndex),_48._toSelect);}});this.connect(g,"onSelectedById","_onSelectedById");this.connect(g,"_onFetchComplete",function(){if(!g._notRefreshSelection){this._refreshSelected(true);}});this.connect(g.scroller,"buildPage",function(){if(!g._notRefreshSelection){this._refreshSelected(true);}});this.connect(_4.doc,"onmouseup",dp(_4c,"all"));this.connect(g,"onEndAutoScroll",function(_4d,_4e,_4f,_50){var _51=_48._selecting.cell,_52,_53,dir=_4e?1:-1;if(_4d&&(_51||_48._selecting.row)){_52=_51?"cell":"row";_53=_48._currentPoint[_52];_48._highlight(_52,_14(_52,_53.row+dir,_53.col),_48._toSelect);}else{if(!_4d&&(_51||_48._selecting.col)){_52=_51?"cell":"col";_53=_48._currentPoint[_52];_48._highlight(_52,_14(_52,_53.row,_50),_48._toSelect);}}});this.subscribe("dojox/grid/rearrange/move/"+g.id,"_onInternalRearrange");this.subscribe("dojox/grid/rearrange/copy/"+g.id,"_onInternalRearrange");this.subscribe("dojox/grid/rearrange/change/"+g.id,"_onExternalChange");this.subscribe("dojox/grid/rearrange/insert/"+g.id,"_onExternalChange");this.subscribe("dojox/grid/rearrange/remove/"+g.id,"clear");this.connect(g,"onSelected",function(_54){if(this._selectedRowModified&&this._isUsingRowSelector){delete this._selectedRowModified;}else{if(!this.grid._selectingRange){this.select("row",_54);}}});this.connect(g,"onDeselected",function(_55){if(this._selectedRowModified&&this._isUsingRowSelector){delete this._selectedRowModified;}else{if(!this.grid._selectingRange){this.deselect("row",_55);}}});},_onSelectedById:function(id,_56,_57){if(this.grid._noInternalMapping){return;}var _58=[this._lastAnchorPoint.row,this._lastEndPoint.row,this._lastSelectedAnchorPoint.row,this._lastSelectedEndPoint.row];_58=_58.concat(this._selected.row);var _59=false;_4.forEach(_58,function(_5a){if(_5a){if(_5a.id===id){_59=true;_5a.row=_56;}else{if(_5a.row===_56&&_5a.id){_5a.row=-1;}}}});if(!_59&&_57){_4.some(this._selected.row,function(_5b){if(_5b&&!_5b.id&&!_5b.except.length){_5b.id=id;_5b.row=_56;return true;}return false;});}_59=false;_58=[this._lastAnchorPoint.cell,this._lastEndPoint.cell,this._lastSelectedAnchorPoint.cell,this._lastSelectedEndPoint.cell];_58=_58.concat(this._selected.cell);_4.forEach(_58,function(_5c){if(_5c){if(_5c.id===id){_59=true;_5c.row=_56;}else{if(_5c.row===_56&&_5c.id){_5c.row=-1;}}}});},onSetStore:function(){this._clearSelection("all");},_onInternalRearrange:function(_5d,_5e){try{this._refresh("col",false);_4.forEach(this._selected.row,function(_5f){_4.forEach(this.grid.layout.cells,function(_60){this._highlightNode(_60.getNode(_5f.row),false);},this);},this);_4.query(".dojoxGridRowSelectorSelected").forEach(function(_61){_4.removeClass(_61,"dojoxGridRowSelectorSelected");_4.removeClass(_61,"dojoxGridRowSelectorSelectedUp");_4.removeClass(_61,"dojoxGridRowSelectorSelectedDown");});var _62=function(_63){if(_63){delete _63.converted;}},_64=[this._lastAnchorPoint[_5d],this._lastEndPoint[_5d],this._lastSelectedAnchorPoint[_5d],this._lastSelectedEndPoint[_5d]];if(_5d==="cell"){this.selectRange("cell",_5e.to.min,_5e.to.max);var _65=this.grid.layout.cells;_4.forEach(_64,function(_66){if(_66.converted){return;}for(var r=_5e.from.min.row,tr=_5e.to.min.row;r<=_5e.from.max.row;++r,++tr){for(var c=_5e.from.min.col,tc=_5e.to.min.col;c<=_5e.from.max.col;++c,++tc){while(_65[c].hidden){++c;}while(_65[tc].hidden){++tc;}if(_66.row==r&&_66.col==c){_66.row=tr;_66.col=tc;_66.converted=true;return;}}}});}else{_64=this._selected.cell.concat(this._selected[_5d]).concat(_64).concat([this._lastAnchorPoint.cell,this._lastEndPoint.cell,this._lastSelectedAnchorPoint.cell,this._lastSelectedEndPoint.cell]);_4.forEach(_64,function(_67){if(_67&&!_67.converted){var _68=_67[_5d];if(_68 in _5e){_67[_5d]=_5e[_68];}_67.converted=true;}});_4.forEach(this._selected[_a[_5d]],function(_69){for(var i=0,len=_69.except.length;i<len;++i){var _6a=_69.except[i];if(_6a in _5e){_69.except[i]=_5e[_6a];}}});}_4.forEach(_64,_62);this._refreshSelected(true);this._focusPoint(_5d,this._lastEndPoint);}catch(e){console.warn("Selector._onInternalRearrange() error",e);}},_onExternalChange:function(_6b,_6c){var _6d=_6b=="cell"?_6c.min:_6c[0],end=_6b=="cell"?_6c.max:_6c[_6c.length-1];this.selectRange(_6b,_6d,end);},_refresh:function(_6e,_6f){if(!this._keyboardSelect[_6e]){_4.forEach(this._selected[_6e],function(_70){this._highlightSingle(_6e,_6f,_70,undefined,true);},this);}},_refreshSelected:function(){this._refresh("col",true);this._refresh("row",true);this._refresh("cell",true);},_initAreas:function(){var g=this.grid,f=g.focus,_71=this,dk=_4.keys,_72=1,_73=2,_74=function(_75,_76,_77,_78,evt){var ks=_71._keyboardSelect;if(evt.shiftKey&&ks[_75]){if(ks[_75]===_72){if(_75==="cell"){var _79=_71._lastEndPoint[_75];if(f.cell!=g.layout.cells[_79.col+_78]||f.rowIndex!=_79.row+_77){ks[_75]=0;return;}}_71._startSelect(_75,_71._lastAnchorPoint[_75],true,false,true);_71._highlight(_75,_71._lastEndPoint[_75],_71._toSelect);ks[_75]=_73;}var _7a=_76(_75,_77,_78,evt);if(_71._isValid(_75,_7a,g)){_71._highlight(_75,_7a,_71._toSelect);}_13(evt);}},_7b=function(_7c,_7d,evt,_7e){if(_7e&&_71.selectEnabled()&&_71._config[_7c]!=_7){switch(evt.keyCode){case dk.SPACE:_71._startSelect(_7c,_7d(),evt.ctrlKey,evt.shiftKey);_71._endSelect(_7c);break;case dk.SHIFT:if(_71._config[_7c]==_9&&_71._isValid(_7c,_71._lastAnchorPoint[_7c],g)){_71._endSelect(_7c);_71._keyboardSelect[_7c]=_72;_71._usingKeyboard=true;}}}},_7f=function(_80,evt,_81){if(_81&&evt.keyCode==_4.keys.SHIFT&&_71._keyboardSelect[_80]){_71._endSelect(_80);_71._keyboardSelect[_80]=0;}};if(g.views.views[0] instanceof _6.grid._RowSelector){this._lastFocusedRowBarIdx=0;f.addArea({name:"rowHeader",onFocus:function(evt,_82){var _83=g.views.views[0];if(_83 instanceof _6.grid._RowSelector){var _84=_83.getCellNode(_71._lastFocusedRowBarIdx,0);if(_84){_4.toggleClass(_84,f.focusClass,false);}if(evt&&"rowIndex" in evt){if(evt.rowIndex>=0){_71._lastFocusedRowBarIdx=evt.rowIndex;}else{if(!_71._lastFocusedRowBarIdx){_71._lastFocusedRowBarIdx=0;}}}_84=_83.getCellNode(_71._lastFocusedRowBarIdx,0);if(_84){_5.focus(_84);_4.toggleClass(_84,f.focusClass,true);}f.rowIndex=_71._lastFocusedRowBarIdx;_13(evt);return true;}return false;},onBlur:function(evt,_85){var _86=g.views.views[0];if(_86 instanceof _6.grid._RowSelector){var _87=_86.getCellNode(_71._lastFocusedRowBarIdx,0);if(_87){_4.toggleClass(_87,f.focusClass,false);}_13(evt);}return true;},onMove:function(_88,_89,evt){var _8a=g.views.views[0];if(_88&&_8a instanceof _6.grid._RowSelector){var _8b=_71._lastFocusedRowBarIdx+_88;if(_8b>=0&&_8b<g.rowCount){_13(evt);var _8c=_8a.getCellNode(_71._lastFocusedRowBarIdx,0);_4.toggleClass(_8c,f.focusClass,false);var sc=g.scroller;var _8d=sc.getLastPageRow(sc.page);var rc=g.rowCount-1,row=Math.min(rc,_8b);if(_8b>_8d){g.setScrollTop(g.scrollTop+sc.findScrollTop(row)-sc.findScrollTop(_71._lastFocusedRowBarIdx));}_8c=_8a.getCellNode(_8b,0);_5.focus(_8c);_4.toggleClass(_8c,f.focusClass,true);_71._lastFocusedRowBarIdx=_8b;f.cell=_8c;f.cell.view=_8a;f.cell.getNode=function(_8e){return f.cell;};f.rowIndex=_71._lastFocusedRowBarIdx;f.scrollIntoView();f.cell=null;}}}});f.placeArea("rowHeader","before","content");}f.addArea({name:"cellselect",onMove:_4.partial(_74,"cell",function(_8f,_90,_91,evt){var _92=_71._currentPoint[_8f];return _14("cell",_92.row+_90,_92.col+_91);}),onKeyDown:_4.partial(_7b,"cell",function(){return _14("cell",f.rowIndex,f.cell.index);}),onKeyUp:_4.partial(_7f,"cell")});f.placeArea("cellselect","below","content");f.addArea({name:"colselect",onMove:_4.partial(_74,"col",function(_93,_94,_95,evt){var _96=_71._currentPoint[_93];return _14("col",_96.col+_95);}),onKeyDown:_4.partial(_7b,"col",function(){return _14("col",f.getHeaderIndex());}),onKeyUp:_4.partial(_7f,"col")});f.placeArea("colselect","below","header");f.addArea({name:"rowselect",onMove:_4.partial(_74,"row",function(_97,_98,_99,evt){return _14("row",f.rowIndex);}),onKeyDown:_4.partial(_7b,"row",function(){return _14("row",f.rowIndex);}),onKeyUp:_4.partial(_7f,"row")});f.placeArea("rowselect","below","rowHeader");},_clearSelection:function(_9a,_9b){if(_9a=="all"){this._clearSelection("cell",_9b);this._clearSelection("col",_9b);this._clearSelection("row",_9b);return;}this._isUsingRowSelector=true;_4.forEach(this._selected[_9a],function(_9c){if(!_11(_9a,_9b,_9c)){this._highlightSingle(_9a,false,_9c);}},this);this._blurPoint(_9a,this._currentPoint);this._selecting[_9a]=false;this._startPoint[_9a]=this._currentPoint[_9a]=null;this._selected[_9a]=[];if(_9a=="row"&&!this.grid._selectingRange){this._oldDeselectAll.call(this.grid.selection);this.grid.selection._selectedById={};}this.grid.onEndDeselect(_9a,null,null,this._selected);this.grid.onSelectCleared(_9a);},_startSelect:function(_9d,_9e,_9f,_a0,_a1,_a2){if(!this._isValid(_9d,_9e)){return;}var _a3=this._isSelected(_9d,this._lastEndPoint[_9d]),_a4=this._isSelected(_9d,_9e);this._toSelect=_a1?_a4:!_a4;if(!_9f||(!_a4&&this._config[_9d]==_8)){this._clearSelection("all",_9e);this._toSelect=_a2===undefined?true:_a2;}this._selecting[_9d]=true;this._currentPoint[_9d]=null;if(_a0&&this._lastType==_9d&&_a3==this._toSelect){if(_9d==="row"){this._isUsingRowSelector=true;}this._startPoint[_9d]=this._lastEndPoint[_9d];this._highlight(_9d,this._startPoint[_9d]);this._isUsingRowSelector=false;}else{this._startPoint[_9d]=_9e;}this._curType=_9d;this._fireEvent("start",_9d);this._isStartFocus=true;this._isUsingRowSelector=true;this._highlight(_9d,_9e,this._toSelect);this._isStartFocus=false;},_endSelect:function(_a5){if(_a5==="row"){delete this._isUsingRowSelector;}if(_a5=="all"){this._endSelect("col");this._endSelect("row");this._endSelect("cell");}else{if(this._selecting[_a5]){this._addToSelected(_a5);this._lastAnchorPoint[_a5]=this._startPoint[_a5];this._lastEndPoint[_a5]=this._currentPoint[_a5];if(this._toSelect){this._lastSelectedAnchorPoint[_a5]=this._lastAnchorPoint[_a5];this._lastSelectedEndPoint[_a5]=this._lastEndPoint[_a5];}this._startPoint[_a5]=this._currentPoint[_a5]=null;this._selecting[_a5]=false;this._lastType=_a5;this._fireEvent("end",_a5);}}},_fireEvent:function(_a6,_a7){switch(_a6){case "start":this.grid[this._toSelect?"onStartSelect":"onStartDeselect"](_a7,this._startPoint[_a7],this._selected);break;case "end":this.grid[this._toSelect?"onEndSelect":"onEndDeselect"](_a7,this._lastAnchorPoint[_a7],this._lastEndPoint[_a7],this._selected);break;}},_calcToHighlight:function(_a8,_a9,_aa,_ab){if(_ab!==undefined){var _ac;if(this._usingKeyboard&&!_aa){var _ad=this._isInLastRange(this._lastType,_a9);if(_ad){_ac=this._isSelected(_a8,_a9);if(_ab&&_ac){return false;}if(!_ab&&!_ac&&this._isInLastRange(this._lastType,_a9,true)){return true;}}}return _aa?_ab:(_ac||this._isSelected(_a8,_a9));}return _aa;},_highlightNode:function(_ae,_af){if(_ae){var _b0="dojoxGridRowSelected";var _b1="dojoxGridCellSelected";_4.toggleClass(_ae,_b0,_af);_4.toggleClass(_ae,_b1,_af);}},_highlightHeader:function(_b2,_b3){var _b4=this.grid.layout.cells;var _b5=_b4[_b2].getHeaderNode();var _b6="dojoxGridHeaderSelected";_4.toggleClass(_b5,_b6,_b3);},_highlightRowSelector:function(_b7,_b8){var _b9=this.grid.views.views[0];if(_b9 instanceof _6.grid._RowSelector){var _ba=_b9.getRowNode(_b7);if(_ba){var _bb="dojoxGridRowSelectorSelected";_4.toggleClass(_ba,_bb,_b8);}}},_highlightSingle:function(_bc,_bd,_be,_bf,_c0){var _c1=this,_c2,g=_c1.grid,_c3=g.layout.cells;switch(_bc){case "cell":_c2=this._calcToHighlight(_bc,_be,_bd,_bf);var c=_c3[_be.col];if(!c.hidden&&!c.notselectable){this._highlightNode(_be.node||c.getNode(_be.row),_c2);}break;case "col":_c2=this._calcToHighlight(_bc,_be,_bd,_bf);this._highlightHeader(_be.col,_c2);_4.query("td[idx='"+_be.col+"']",g.domNode).forEach(function(_c4){var _c5=_c3[_be.col].view.content.findRowTarget(_c4);if(_c5){var _c6=_c5[_6.grid.util.rowIndexTag];_c1._highlightSingle("cell",_c2,{"row":_c6,"col":_be.col,"node":_c4});}});break;case "row":_c2=this._calcToHighlight(_bc,_be,_bd,_bf);this._highlightRowSelector(_be.row,_c2);_4.forEach(_c3,function(_c7){_c1._highlightSingle("cell",_c2,{"row":_be.row,"col":_c7.index,"node":_c7.getNode(_be.row)});});this._selectedRowModified=true;if(!_c0){g.selection.setSelected(_be.row,_c2);}}},_highlight:function(_c8,_c9,_ca){if(this._selecting[_c8]&&_c9!==null){var _cb=this._startPoint[_c8],_cc=this._currentPoint[_c8],_cd=this,_ce=function(_cf,to,_d0){_cd._forEach(_c8,_cf,to,function(_d1){_cd._highlightSingle(_c8,_d0,_d1,_ca);},true);};switch(_c8){case "col":case "row":if(_cc!==null){if(_b(_c8,_c9,_cb,_cc,true)){_ce(_cc,_c9,false);}else{if(_b(_c8,_cb,_c9,_cc,true)){_ce(_cc,_cb,false);_cc=_cb;}_ce(_c9,_cc,true);}}else{this._highlightSingle(_c8,true,_c9,_ca);}break;case "cell":if(_cc!==null){if(_b("row",_c9,_cb,_cc,true)||_b("col",_c9,_cb,_cc,true)||_b("row",_cb,_c9,_cc,true)||_b("col",_cb,_c9,_cc,true)){_ce(_cb,_cc,false);}}_ce(_cb,_c9,true);}this._currentPoint[_c8]=_c9;this._focusPoint(_c8,this._currentPoint);}},_focusPoint:function(_d2,_d3){if(!this._isStartFocus){var _d4=_d3[_d2],f=this.grid.focus;if(_d2=="col"){f._colHeadFocusIdx=_d4.col;f.focusArea("header");}else{if(_d2=="row"){f.focusArea("rowHeader",{"rowIndex":_d4.row});}else{if(_d2=="cell"){f.setFocusIndex(_d4.row,_d4.col);}}}}},_blurPoint:function(_d5,_d6){var f=this.grid.focus;if(_d5=="col"){f._blurHeader();}else{if(_d5=="cell"){f._blurContent();}}},_addToSelected:function(_d7){var _d8=this._toSelect,_d9=this,_da=[],_db=[],_dc=this._startPoint[_d7],end=this._currentPoint[_d7];if(this._usingKeyboard){this._forEach(_d7,this._lastAnchorPoint[_d7],this._lastEndPoint[_d7],function(_dd){if(!_b(_d7,_dd,_dc,end)){(_d8?_db:_da).push(_dd);}});}this._forEach(_d7,_dc,end,function(_de){var _df=_d9._isSelected(_d7,_de);if(_d8&&!_df){_da.push(_de);}else{if(!_d8){_db.push(_de);}}});this._add(_d7,_da);this._remove(_d7,_db);_4.forEach(this._selected.row,function(_e0){if(_e0.except.length>0){this._selectedRowModified=true;this.grid.selection.setSelected(_e0.row,false);}},this);},_forEach:function(_e1,_e2,end,_e3,_e4){if(!this._isValid(_e1,_e2,true)||!this._isValid(_e1,end,true)){return;}switch(_e1){case "col":case "row":_e2=_e2[_e1];end=end[_e1];var dir=end>_e2?1:-1;if(!_e4){end+=dir;}for(;_e2!=end;_e2+=dir){_e3(_14(_e1,_e2));}break;case "cell":var _e5=end.col>_e2.col?1:-1,_e6=end.row>_e2.row?1:-1;for(var i=_e2.row,p=end.row+_e6;i!=p;i+=_e6){for(var j=_e2.col,q=end.col+_e5;j!=q;j+=_e5){_e3(_14(_e1,i,j));}}}},_makeupForExceptions:function(_e7,_e8){var _e9=[];_4.forEach(this._selected[_e7],function(v1){_4.forEach(_e8,function(v2){if(v1[_e7]==v2[_e7]){var pos=_4.indexOf(v1.except,v2[_a[_e7]]);if(pos>=0){v1.except.splice(pos,1);}_e9.push(v2);}});});return _e9;},_makeupForCells:function(_ea,_eb){var _ec=[];_4.forEach(this._selected.cell,function(v1){_4.some(_eb,function(v2){if(v1[_ea]==v2[_ea]){_ec.push(v1);return true;}return false;});});this._remove("cell",_ec);_4.forEach(this._selected[_a[_ea]],function(v1){_4.forEach(_eb,function(v2){var pos=_4.indexOf(v1.except,v2[_ea]);if(pos>=0){v1.except.splice(pos,1);}});});},_addException:function(_ed,_ee){_4.forEach(this._selected[_ed],function(v1){_4.forEach(_ee,function(v2){v1.except.push(v2[_a[_ed]]);});});},_addCellException:function(_ef,_f0){_4.forEach(this._selected[_ef],function(v1){_4.forEach(_f0,function(v2){if(v1[_ef]==v2[_ef]){v1.except.push(v2[_a[_ef]]);}});});},_add:function(_f1,_f2){var _f3=this.grid.layout.cells;if(_f1=="cell"){var _f4=this._makeupForExceptions("col",_f2);var _f5=this._makeupForExceptions("row",_f2);_f2=_4.filter(_f2,function(_f6){return _4.indexOf(_f4,_f6)<0&&_4.indexOf(_f5,_f6)<0&&!_f3[_f6.col].hidden&&!_f3[_f6.col].notselectable;});}else{if(_f1=="col"){_f2=_4.filter(_f2,function(_f7){return !_f3[_f7.col].hidden&&!_f3[_f7.col].notselectable;});}this._makeupForCells(_f1,_f2);this._selected[_f1]=_4.filter(this._selected[_f1],function(v){return _4.every(_f2,function(_f8){return v[_f1]!==_f8[_f1];});});}if(_f1!="col"&&this.grid._hasIdentity){_4.forEach(_f2,function(_f9){var _fa=this.grid._by_idx[_f9.row];if(_fa){_f9.id=_fa.idty;}},this);}this._selected[_f1]=this._selected[_f1].concat(_f2);},_remove:function(_fb,_fc){var _fd=_4.partial(_11,_fb);this._selected[_fb]=_4.filter(this._selected[_fb],function(v1){return !_4.some(_fc,function(v2){return _fd(v1,v2);});});if(_fb=="cell"){this._addCellException("col",_fc);this._addCellException("row",_fc);}else{this._addException(_a[_fb],_fc);}},_isCellNotInExcept:function(_fe,_ff){var attr=_ff[_fe],_100=_ff[_a[_fe]];return _4.some(this._selected[_fe],function(v){return v[_fe]==attr&&_4.indexOf(v.except,_100)<0;});},_isSelected:function(type,item){if(!item){return false;}var res=_4.some(this._selected[type],function(v){var ret=_11(type,item,v);if(ret&&type!=="cell"){return v.except.length===0;}return ret;});if(!res&&type==="cell"){res=(this._isCellNotInExcept("col",item)||this._isCellNotInExcept("row",item));if(type==="cell"){res=res&&!this.grid.layout.cells[item.col].notselectable;}}return res;},_isInLastRange:function(type,item,_101){var _102=this[_101?"_lastSelectedAnchorPoint":"_lastAnchorPoint"][type],end=this[_101?"_lastSelectedEndPoint":"_lastEndPoint"][type];if(!item||!_102||!end){return false;}return _b(type,item,_102,end);},_isValid:function(type,item,_103){if(!item){return false;}try{var g=this.grid,_104=item[type];switch(type){case "col":return _104>=0&&_104<g.layout.cells.length&&_4.isArray(item.except)&&(_103||!g.layout.cells[_104].notselectable);case "row":return _104>=0&&_104<g.rowCount&&_4.isArray(item.except);case "cell":return item.col>=0&&item.col<g.layout.cells.length&&item.row>=0&&item.row<g.rowCount&&(_103||!g.layout.cells[item.col].notselectable);}}catch(e){}return false;}});_6.grid.EnhancedGrid.registerPlugin(_6.grid.enhanced.plugins.Selector,{"dependency":["autoScroll"]});})();}}};});