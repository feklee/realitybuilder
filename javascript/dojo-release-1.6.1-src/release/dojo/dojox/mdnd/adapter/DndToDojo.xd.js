/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realityBuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.mdnd.adapter.DndToDojo"],["require","dojox.mdnd.PureSource"],["require","dojox.mdnd.LazyManager"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.mdnd.adapter.DndToDojo"]){_4._hasResource["dojox.mdnd.adapter.DndToDojo"]=true;_4.provide("dojox.mdnd.adapter.DndToDojo");_4.require("dojox.mdnd.PureSource");_4.require("dojox.mdnd.LazyManager");_4.declare("dojox.mdnd.adapter.DndToDojo",null,{_dojoList:null,_currentDojoArea:null,_dojoxManager:null,_dragStartHandler:null,_dropHandler:null,_moveHandler:null,_moveUpHandler:null,_draggedNode:null,constructor:function(){this._dojoList=[];this._currentDojoArea=null;this._dojoxManager=_6.mdnd.areaManager();this._dragStartHandler=_4.subscribe("/dojox/mdnd/drag/start",this,function(_7,_8,_9){this._draggedNode=_7;this._moveHandler=_4.connect(_4.doc,"onmousemove",this,"onMouseMove");});this._dropHandler=_4.subscribe("/dojox/mdnd/drop",this,function(_a,_b,_c){if(this._currentDojoArea){_4.publish("/dojox/mdnd/adapter/dndToDojo/cancel",[this._currentDojoArea.node,this._currentDojoArea.type,this._draggedNode,this.accept]);}this._draggedNode=null;this._currentDojoArea=null;_4.disconnect(this._moveHandler);});},_getIndexDojoArea:function(_d){if(_d){for(var i=0,l=this._dojoList.length;i<l;i++){if(this._dojoList[i].node===_d){return i;}}}return -1;},_initCoordinates:function(_e){if(_e){var _f=_4.position(_e,true),_10={};_10.x=_f.x;_10.y=_f.y;_10.x1=_f.x+_f.w;_10.y1=_f.y+_f.h;return _10;}return null;},register:function(_11,_12,_13){if(this._getIndexDojoArea(_11)==-1){var _14=this._initCoordinates(_11),_15={"node":_11,"type":_12,"dojo":(_13)?_13:false,"coords":_14};this._dojoList.push(_15);if(_13&&!this._lazyManager){this._lazyManager=new _6.mdnd.LazyManager();}}},unregisterByNode:function(_16){var _17=this._getIndexDojoArea(_16);if(_17!=-1){this._dojoList.splice(_17,1);}},unregisterByType:function(_18){if(_18){var _19=[];_4.forEach(this._dojoList,function(_1a,i){if(_1a.type!=_18){_19.push(_1a);}});this._dojoList=_19;}},unregister:function(){this._dojoList=[];},refresh:function(){var _1b=this._dojoList;this.unregister();_4.forEach(_1b,function(_1c){_1c.coords=this._initCoordinates(_1c.node);},this);this._dojoList=_1b;},refreshByType:function(_1d){var _1e=this._dojoList;this.unregister();_4.forEach(_1e,function(_1f){if(_1f.type==_1d){_1f.coords=this._initCoordinates(_1f.node);}},this);this._dojoList=_1e;},_getHoverDojoArea:function(_20){this._oldDojoArea=this._currentDojoArea;this._currentDojoArea=null;var x=_20.x;var y=_20.y;var _21=this._dojoList.length;for(var i=0;i<_21;i++){var _22=this._dojoList[i];var _23=_22.coords;if(_23.x<=x&&x<=_23.x1&&_23.y<=y&&y<=_23.y1){this._currentDojoArea=_22;break;}}},onMouseMove:function(e){var _24={"x":e.pageX,"y":e.pageY};this._getHoverDojoArea(_24);if(this._currentDojoArea!=this._oldDojoArea){if(this._currentDojoArea==null){this.onDragExit(e);}else{if(this._oldDojoArea==null){this.onDragEnter(e);}else{this.onDragExit(e);this.onDragEnter(e);}}}},isAccepted:function(_25,_26){return true;},onDragEnter:function(e){if(this._currentDojoArea.dojo){_4.disconnect(this._dojoxManager._dragItem.handlers.pop());_4.disconnect(this._dojoxManager._dragItem.handlers.pop());_4.disconnect(this._dojoxManager._dragItem.item.events.pop());_4.body().removeChild(this._dojoxManager._cover);_4.body().removeChild(this._dojoxManager._cover2);var _27=this._dojoxManager._dragItem.item.node;if(_6.mdnd.adapter._dndFromDojo){_6.mdnd.adapter._dndFromDojo.unsubscribeDnd();}_4.style(_27,{"position":"relative","top":"0","left":"0"});this._lazyManager.startDrag(e,_27);var _28=_4.connect(this._lazyManager.manager,"overSource",this,function(){_4.disconnect(_28);if(this._lazyManager.manager.canDropFlag){this._dojoxManager._dropIndicator.node.style.display="none";}});this.cancelHandler=_4.subscribe("/dnd/cancel",this,function(){var _29=this._dojoxManager._dragItem.item;_29.events=[_4.connect(_29.handle,"onmousedown",_29,"onMouseDown")];_4.body().appendChild(this._dojoxManager._cover);_4.body().appendChild(this._dojoxManager._cover2);this._dojoxManager._cover.appendChild(_29.node);var _2a=this._dojoxManager._areaList[this._dojoxManager._sourceIndexArea];var _2b=this._dojoxManager._sourceDropIndex;var _2c=null;if(_2b!=_2a.items.length&&_2b!=-1){_2c=_2a.items[this._dojoxManager._sourceDropIndex].item.node;}if(this._dojoxManager._dropIndicator.node.style.display=="none"){this._dojoxManager._dropIndicator.node.style.display=="";}this._dojoxManager._dragItem.handlers.push(_4.connect(this._dojoxManager._dragItem.item,"onDrag",this._dojoxManager,"onDrag"));this._dojoxManager._dragItem.handlers.push(_4.connect(this._dojoxManager._dragItem.item,"onDragEnd",this._dojoxManager,"onDrop"));this._draggedNode.style.display="";this._dojoxManager.onDrop(this._draggedNode);_4.unsubscribe(this.cancelHandler);_4.unsubscribe(this.dropHandler);if(_6.mdnd.adapter._dndFromDojo){_6.mdnd.adapter._dndFromDojo.subscribeDnd();}});this.dropHandler=_4.subscribe("/dnd/drop/before",this,function(_2d){_4.unsubscribe(this.cancelHandler);_4.unsubscribe(this.dropHandler);this.onDrop();});}else{this.accept=this.isAccepted(this._dojoxManager._dragItem.item.node,this._currentDojoArea);if(this.accept){_4.disconnect(this._dojoxManager._dragItem.handlers.pop());_4.disconnect(this._dojoxManager._dragItem.handlers.pop());this._dojoxManager._dropIndicator.node.style.display="none";if(!this._moveUpHandler){this._moveUpHandler=_4.connect(_4.doc,"onmouseup",this,"onDrop");}}}_4.publish("/dojox/mdnd/adapter/dndToDojo/over",[this._currentDojoArea.node,this._currentDojoArea.type,this._draggedNode,this.accept]);},onDragExit:function(e){if(this._oldDojoArea.dojo){_4.unsubscribe(this.cancelHandler);_4.unsubscribe(this.dropHandler);var _2e=this._dojoxManager._dragItem.item;this._dojoxManager._dragItem.item.events.push(_4.connect(_2e.node.ownerDocument,"onmousemove",_2e,"onMove"));_4.body().appendChild(this._dojoxManager._cover);_4.body().appendChild(this._dojoxManager._cover2);this._dojoxManager._cover.appendChild(_2e.node);var _2f=_2e.node.style;_2f.position="absolute";_2f.left=(_2e.offsetDrag.l+e.pageX)+"px";_2f.top=(_2e.offsetDrag.t+e.pageX)+"px";_2f.display="";this._lazyManager.cancelDrag();if(_6.mdnd.adapter._dndFromDojo){_6.mdnd.adapter._dndFromDojo.subscribeDnd();}if(this._dojoxManager._dropIndicator.node.style.display=="none"){this._dojoxManager._dropIndicator.node.style.display="";}this._dojoxManager._dragItem.handlers.push(_4.connect(this._dojoxManager._dragItem.item,"onDrag",this._dojoxManager,"onDrag"));this._dojoxManager._dragItem.handlers.push(_4.connect(this._dojoxManager._dragItem.item,"onDragEnd",this._dojoxManager,"onDrop"));this._dojoxManager._dragItem.item.onMove(e);}else{if(this.accept){if(this._moveUpHandler){_4.disconnect(this._moveUpHandler);this._moveUpHandler=null;}if(this._dojoxManager._dropIndicator.node.style.display=="none"){this._dojoxManager._dropIndicator.node.style.display="";}this._dojoxManager._dragItem.handlers.push(_4.connect(this._dojoxManager._dragItem.item,"onDrag",this._dojoxManager,"onDrag"));this._dojoxManager._dragItem.handlers.push(_4.connect(this._dojoxManager._dragItem.item,"onDragEnd",this._dojoxManager,"onDrop"));this._dojoxManager._dragItem.item.onMove(e);}}_4.publish("/dojox/mdnd/adapter/dndToDojo/out",[this._oldDojoArea.node,this._oldDojoArea.type,this._draggedNode,this.accept]);},onDrop:function(e){if(this._currentDojoArea.dojo){if(_6.mdnd.adapter._dndFromDojo){_6.mdnd.adapter._dndFromDojo.subscribeDnd();}}if(this._dojoxManager._dropIndicator.node.style.display=="none"){this._dojoxManager._dropIndicator.node.style.display="";}if(this._dojoxManager._cover.parentNode&&this._dojoxManager._cover.parentNode.nodeType==1){_4.body().removeChild(this._dojoxManager._cover);_4.body().removeChild(this._dojoxManager._cover2);}if(this._draggedNode.parentNode==this._dojoxManager._cover){this._dojoxManager._cover.removeChild(this._draggedNode);}_4.disconnect(this._moveHandler);_4.disconnect(this._moveUpHandler);this._moveHandler=this._moveUpHandler=null;_4.publish("/dojox/mdnd/adapter/dndToDojo/drop",[this._draggedNode,this._currentDojoArea.node,this._currentDojoArea.type]);_4.removeClass(this._draggedNode,"dragNode");var _30=this._draggedNode.style;_30.position="relative";_30.left="0";_30.top="0";_30.width="auto";_4.forEach(this._dojoxManager._dragItem.handlers,_4.disconnect);this._dojoxManager._deleteMoveableItem(this._dojoxManager._dragItem);this._draggedNode=null;this._currentDojoArea=null;this._dojoxManager._resetAfterDrop();}});_6.mdnd.adapter._dndToDojo=null;_6.mdnd.adapter.dndToDojo=function(){if(!_6.mdnd.adapter._dndToDojo){_6.mdnd.adapter._dndToDojo=new _6.mdnd.adapter.DndToDojo();}return _6.mdnd.adapter._dndToDojo;};}}};});