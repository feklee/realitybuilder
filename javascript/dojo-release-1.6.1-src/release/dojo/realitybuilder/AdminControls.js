/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["realitybuilder.AdminControls"]){dojo._hasResource["realitybuilder.AdminControls"]=true;dojo.provide("realitybuilder.AdminControls");dojo.require("dojox.date.posix");dojo.declare("realitybuilder.AdminControls",null,{_construction:null,constructor:function(_1){this._construction=_1;dojo.byId("bottomBar").style.width=_1.camera().sensor().width()+"px";this.updateToggleRealButton();this.updateTogglePendingButton();dojo.connect(dojo.byId("saveSettingsButton"),"onclick",this._construction,this._construction.storeSettingsOnServer);dojo.connect(dojo.byId("previewCameraButton"),"onclick",this,this.updateCamera);dojo.connect(dojo.byId("toggleRealButton"),"onclick",this._construction,this._construction.toggleReal);dojo.connect(dojo.byId("togglePendingButton"),"onclick",this._construction,this._construction.togglePending);dojo.connect(dojo.byId("logoutButton"),"onclick",this,this.logOut);dojo.connect(dojo.byId("setPrerenderedBlockConfigurationButton"),"onclick",this,this.setPrerenderedBlockConfiguration);dojo.connect(dojo.byId("prevPrerenderedBlockConfigurationButton"),"onclick",this,this.prevPrerenderedBlockConfiguration);dojo.connect(dojo.byId("nextPrerenderedBlockConfigurationButton"),"onclick",this,this.nextPrerenderedBlockConfiguration);},logOut:function(){location.href=logoutUrl;},updateToggleRealButton:function(){dojo.byId("toggleRealButton").innerHTML=(this._construction.showReal()?"Hide":"Show")+" Real Blocks";},updateTogglePendingButton:function(){dojo.byId("togglePendingButton").innerHTML=(this._construction.showPending()?"Hide":"Show")+" Pending Blocks";},updateCameraControls:function(_2){var _3=_2.position();dojo.byId("cameraXTextField").value=_3[0];dojo.byId("cameraYTextField").value=_3[1];dojo.byId("cameraZTextField").value=_3[2];dojo.byId("cameraAXTextField").value=_2.aX();dojo.byId("cameraAYTextField").value=_2.aY();dojo.byId("cameraAZTextField").value=_2.aZ();dojo.byId("cameraFlTextField").value=_2.fl();dojo.byId("cameraSensorResolutionTextField").value=_2.sensorResolution();},updatePrerenderModeControls:function(){var _4=this._construction.prerenderMode();if(_4.isEnabled()){dojo.byId("prerenderedBlockConfigurationTextField").value=_4.i();dojo.style("prerenderedBlockConfigurations","display","block");}else{dojo.style("prerenderedBlockConfigurations","display","none");}},setPrerenderedBlockConfiguration:function(){var _5,i;_5=this._construction.prerenderMode();i=parseInt(dojo.byId("prerenderedBlockConfigurationTextField").value,10);_5.loadBlockConfigurationOnServer(i);},prevPrerenderedBlockConfiguration:function(){var _6=this._construction.prerenderMode();_6.loadPrevBlockConfigurationOnServer();},nextPrerenderedBlockConfiguration:function(){var _7=this._construction.prerenderMode();_7.loadNextBlockConfigurationOnServer();},readCameraControls:function(){var _8={"position":[parseFloat(dojo.byId("cameraXTextField").value)||0,parseFloat(dojo.byId("cameraYTextField").value)||0,parseFloat(dojo.byId("cameraZTextField").value)||0],"aX":parseFloat(dojo.byId("cameraAXTextField").value)||0,"aY":parseFloat(dojo.byId("cameraAYTextField").value)||0,"aZ":parseFloat(dojo.byId("cameraAZTextField").value)||0,"fl":parseFloat(dojo.byId("cameraFlTextField").value)||1,"sensorResolution":parseFloat(dojo.byId("cameraSensorResolutionTextField").value)||100};return _8;},updateCamera:function(){this._construction.camera().update(this.readCameraControls());},updateCoordinateDisplays:function(){var _9,a;_9=this._construction.newBlock().positionB();a=this._construction.newBlock().a();dojo.byId("newBlockXB").innerHTML=_9[0].toString();dojo.byId("newBlockYB").innerHTML=_9[1].toString();dojo.byId("newBlockZB").innerHTML=_9[2].toString();dojo.byId("newBlockA").innerHTML=a.toString();},_sortForTable:function(x,y){if(x.state()===y.state()){if(x.timeStamp()>y.timeStamp()){return -1;}else{if(x.timeStamp()<y.timeStamp()){return 1;}else{return 0;}}}else{if(x.state()===1){return -1;}else{if(x.state()===2){return y.state()===1?1:-1;}else{return 1;}}}},_blocksSortedForTable:function(){var _a=dojo.map(this._construction.constructionBlocks().blocks(),function(_b){return _b;});_a.sort(this._sortForTable);return _a;},_applyStateFromStateSelector:function(_c,_d){this._construction.constructionBlocks().setBlockStateOnServer(_d.positionB(),_d.a(),parseInt(_c.value,10));},_stateSelector:function(_e){var _f=document.createElement("select"),_10=["Deleted","Pending","Real"],_11,_12,_13;dojo.attr(_f,"size",1);for(_11=0;_11<3;_11+=1){_12=_10[_11];_13=document.createElement("option");dojo.attr(_13,"value",_11);if(_11===_e.state()){dojo.attr(_13,"selected","");}_13.innerHTML=_12;_f.appendChild(_13);}dojo.connect(_f,"onchange",this,function(_14){this._applyStateFromStateSelector(_f,_e);});return _f;},_appendBlocksTableRow:function(_15,_16){var _17,row,_18,_19,_1a,_1b;_17=_15.positionB();row=document.createElement("tr");_18=new Date(_15.timeStamp()*1000);_19=dojox.date.posix.strftime(_18,"%Y-%m-%d %H:%M:%S");_1a=[_17[0],_17[1],_17[2],_15.a(),_19,this._stateSelector(_15)];dojo.forEach(_1a,function(_1c,i){_1b=document.createElement("td");if(i<5){_1b.innerHTML=_1c;}else{_1b.appendChild(_1c);}if(i<4){dojo.addClass(_1b,"number");}row.appendChild(_1b);});_16.appendChild(row);},updateBlocksTable:function(){var _1d=dojo.query("#blocksTable tbody"),_1e=_1d[0],_1f=this._blocksSortedForTable(),_20=this;dojo.empty(_1e);dojo.forEach(_1f,function(_21){_20._appendBlocksTableRow(_21,_1e);});}});}