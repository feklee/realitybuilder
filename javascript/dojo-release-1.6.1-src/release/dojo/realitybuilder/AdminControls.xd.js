/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realitybuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","realitybuilder.AdminControls"],["require","dojox.date.posix"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["realitybuilder.AdminControls"]){_4._hasResource["realitybuilder.AdminControls"]=true;_4.provide("realitybuilder.AdminControls");_4.require("dojox.date.posix");_4.declare("realitybuilder.AdminControls",null,{_main:null,constructor:function(_7){this._main=_7;_4.byId("bottomBar").style.width=construction.camera().sensor().width()+"px";this.updateToggleRealButton();this.updateTogglePendingButton();_4.connect(_4.byId("saveSettingsButton"),"onclick",this._main,this._main.storeSettingsOnServer);_4.connect(_4.byId("previewCameraButton"),"onclick",this,this.updateCamera);_4.connect(_4.byId("toggleRealButton"),"onclick",this._main,this._main.toggleReal);_4.connect(_4.byId("togglePendingButton"),"onclick",this._main,this._main.togglePending);_4.connect(_4.byId("logoutButton"),"onclick",this,this.logOut);_4.connect(_4.byId("setPrerenderedBlockConfigurationButton"),"onclick",this,this.setPrerenderedBlockConfiguration);_4.connect(_4.byId("prevPrerenderedBlockConfigurationButton"),"onclick",this,this.prevPrerenderedBlockConfiguration);_4.connect(_4.byId("nextPrerenderedBlockConfigurationButton"),"onclick",this,this.nextPrerenderedBlockConfiguration);},logOut:function(){location.href=logoutUrl;},updateToggleRealButton:function(){_4.byId("toggleRealButton").innerHTML=(this._main.showReal()?"Hide":"Show")+" Real Blocks";},updateTogglePendingButton:function(){_4.byId("togglePendingButton").innerHTML=(this._main.showPending()?"Hide":"Show")+" Pending Blocks";},updateCameraControls:function(_8){var _9=_8.position();_4.byId("cameraXTextField").value=_9[0];_4.byId("cameraYTextField").value=_9[1];_4.byId("cameraZTextField").value=_9[2];_4.byId("cameraAXTextField").value=_8.aX();_4.byId("cameraAYTextField").value=_8.aY();_4.byId("cameraAZTextField").value=_8.aZ();_4.byId("cameraFlTextField").value=_8.fl();_4.byId("cameraSensorResolutionTextField").value=_8.sensorResolution();},updatePrerenderModeControls:function(){var _a=this._main.prerenderMode();if(_a.isEnabled()){_4.byId("prerenderedBlockConfigurationTextField").value=_a.i();_4.style("prerenderedBlockConfigurations","display","block");}else{_4.style("prerenderedBlockConfigurations","display","none");}},setPrerenderedBlockConfiguration:function(){var _b,i;_b=this._main.prerenderMode();i=parseInt(_4.byId("prerenderedBlockConfigurationTextField").value,10);_b.loadBlockConfigurationOnServer(i);},prevPrerenderedBlockConfiguration:function(){var _c=this._main.prerenderMode();_c.loadPrevBlockConfigurationOnServer();},nextPrerenderedBlockConfiguration:function(){var _d=this._main.prerenderMode();_d.loadNextBlockConfigurationOnServer();},readCameraControls:function(){var _e={"position":[parseFloat(_4.byId("cameraXTextField").value)||0,parseFloat(_4.byId("cameraYTextField").value)||0,parseFloat(_4.byId("cameraZTextField").value)||0],"aX":parseFloat(_4.byId("cameraAXTextField").value)||0,"aY":parseFloat(_4.byId("cameraAYTextField").value)||0,"aZ":parseFloat(_4.byId("cameraAZTextField").value)||0,"fl":parseFloat(_4.byId("cameraFlTextField").value)||1,"sensorResolution":parseFloat(_4.byId("cameraSensorResolutionTextField").value)||100};return _e;},updateCamera:function(){this._main.camera().update(this.readCameraControls());},updateCoordinateDisplays:function(){var _f,a;_f=this._main.newBlock().positionB();a=this._main.newBlock().a();_4.byId("newBlockXB").innerHTML=_f[0].toString();_4.byId("newBlockYB").innerHTML=_f[1].toString();_4.byId("newBlockZB").innerHTML=_f[2].toString();_4.byId("newBlockA").innerHTML=a.toString();},_sortForTable:function(x,y){if(x.state()===y.state()){if(x.timeStamp()>y.timeStamp()){return -1;}else{if(x.timeStamp()<y.timeStamp()){return 1;}else{return 0;}}}else{if(x.state()===1){return -1;}else{if(x.state()===2){return y.state()===1?1:-1;}else{return 1;}}}},_blocksSortedForTable:function(){var tmp=_4.map(this._main.constructionBlocks().blocks(),function(_10){return _10;});tmp.sort(this._sortForTable);return tmp;},_applyStateFromStateSelector:function(_11,_12){this._main.constructionBlocks().setBlockStateOnServer(_12.positionB(),_12.a(),parseInt(_11.value,10));},_stateSelector:function(_13){var _14=document.createElement("select"),_15=["Deleted","Pending","Real"],_16,_17,_18;_4.attr(_14,"size",1);for(_16=0;_16<3;_16+=1){_17=_15[_16];_18=document.createElement("option");_4.attr(_18,"value",_16);if(_16===_13.state()){_4.attr(_18,"selected","");}_18.innerHTML=_17;_14.appendChild(_18);}_4.connect(_14,"onchange",this,function(_19){this._applyStateFromStateSelector(_14,_13);});return _14;},_appendBlocksTableRow:function(_1a,_1b){var _1c,row,_1d,_1e,_1f,_20;_1c=_1a.positionB();row=document.createElement("tr");_1d=new Date(_1a.timeStamp()*1000);_1e=_6.date.posix.strftime(_1d,"%Y-%m-%d %H:%M:%S");_1f=[_1c[0],_1c[1],_1c[2],_1a.a(),_1e,this._stateSelector(_1a)];_4.forEach(_1f,function(_21,i){_20=document.createElement("td");if(i<5){_20.innerHTML=_21;}else{_20.appendChild(_21);}if(i<4){_4.addClass(_20,"number");}row.appendChild(_20);});_1b.appendChild(row);},updateBlocksTable:function(){var _22=_4.query("#blocksTable tbody"),_23=_22[0],_24=this._blocksSortedForTable(),_25=this;_4.empty(_23);_4.forEach(_24,function(_26){_25._appendBlocksTableRow(_26,_23);});}});}}};});