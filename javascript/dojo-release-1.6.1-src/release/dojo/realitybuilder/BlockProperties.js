/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["realityBuilder.BlockProperties"]){dojo._hasResource["realityBuilder.BlockProperties"]=true;dojo.provide("realityBuilder.BlockProperties");dojo.declare("realityBuilder.BlockProperties",null,{_versionOnServer:"-1",_has2FoldSymmetry:null,_blockPositionSpacingXY:null,_blockPositionSpacingZ:null,_outlineBXY:null,_rotatedOutlinesBXY:null,_collisionOffsetsListBXY:null,_rotatedCollisionOffsetsListsBXY:null,_attachmentOffsetsListB:null,_rotatedAttachmentOffsetsListsB:null,_rotCenterBXY:null,_centroidBXY:null,_backgroundAlpha:null,_congruencyOffsetsB:null,versionOnServer:function(){return this._versionOnServer;},isInitializedWithServerData:function(){return this._versionOnServer!=="-1";},_updateCentroidBXY:function(){var i,_1,_2=0,_3=0,_4=this._outlineBXY.length;for(i=0;i<_4;i+=1){_1=this._outlineBXY[i];_2+=_1[0];_3+=_1[1];}this._centroidBXY=[_2/_4,_3/_4];},_rotateOutlineBXY:function(a){var _5=this;return dojo.map(this._outlineBXY,function(_6){return realityBuilder.util.rotatePointBXY(_6,_5._rotCenterBXY,a);});},_updateRotatedOutlinesBXY:function(){var a;this._rotatedOutlinesBXY=[];for(a=0;a<4;a+=1){this._rotatedOutlinesBXY.push(this._rotateOutlineBXY(a));}},_updateCongruencyOffsetB:function(){var _7,_8,a;_7=realityBuilder.util.multiplyVectorBXY(2,realityBuilder.util.subtractVectorsBXY(this._centroidBXY,this._rotCenterBXY));this._congruencyOffsetsB=[];for(a=0;a<4;a+=1){_8=realityBuilder.util.rotatePointBXY(_7,[0,0],a);this._congruencyOffsetsB.push([_8[0],_8[1],0]);}},congruencyOffsetB:function(a){return this._congruencyOffsetsB[a];},_withCongruencyOffsetsAddedBXY:function(_9,a){var _a=this.congruencyOffsetB(a);return dojo.map(_9,function(_b){return realityBuilder.util.addVectorsBXY(_b,_a);});},has2FoldSymmetry:function(){return this._has2FoldSymmetry;},_completeCollisionOffsetsListBXY:function(){var _c=this._collisionOffsetsListBXY;if(this._has2FoldSymmetry){_c.push(this._withCongruencyOffsetsAddedBXY(_c[0],0));_c.push(this._withCongruencyOffsetsAddedBXY(_c[1],1));}},_rotateCollisionOffsetsBXY:function(_d,a){var _e=realityBuilder.util;return dojo.map(_d,function(_f){return _e.rotatePointBXY(_f,[0,0],a);});},_rotateCollisionOffsetsListBXY:function(a1){var a2,_10,tmp=[];for(a2=0;a2<4;a2+=1){_10=this._collisionOffsetsListBXY[a2];tmp.push(this._rotateCollisionOffsetsBXY(_10,a1));}return tmp;},_updateRotatedCollisionOffsetsListsBXY:function(){var a1,tmp;this._rotatedCollisionOffsetsListsBXY=[];for(a1=0;a1<4;a1+=1){tmp=this._rotateCollisionOffsetsListBXY(a1);this._rotatedCollisionOffsetsListsBXY.push(tmp);}},_withCongruencyOffsetsAddedB:function(_11,a){var _12=this.congruencyOffsetB(a);return dojo.map(_11,function(_13){return realityBuilder.util.addVectorsB(_13,_12);});},_completeAttachmentOffsetsListB:function(){var _14=this._attachmentOffsetsListB;if(this._has2FoldSymmetry){_14.push(this._withCongruencyOffsetsAddedB(_14[0],0));_14.push(this._withCongruencyOffsetsAddedB(_14[1],1));}},_rotateAttachmentOffsetB:function(_15,a){var _16,_17,_18,_19;_19=realityBuilder.util;_16=[_15[0],_15[1]];_17=_19.rotatePointBXY(_16,[0,0],a);return [_17[0],_17[1],_15[2]];},_rotateAttachmentOffsetsB:function(_1a,a){var _1b=this;return dojo.map(_1a,function(_1c){return _1b._rotateAttachmentOffsetB(_1c,a);});},_rotateAttachmentOffsetsListB:function(a1){var a2,_1d,tmp=[];for(a2=0;a2<4;a2+=1){_1d=this._attachmentOffsetsListB[a2];tmp.push(this._rotateAttachmentOffsetsB(_1d,a1));}return tmp;},_updateRotatedAttachmentOffsetsListsB:function(){var a1,tmp;this._rotatedAttachmentOffsetsListsB=[];for(a1=0;a1<4;a1+=1){tmp=this._rotateAttachmentOffsetsListB(a1);this._rotatedAttachmentOffsetsListsB.push(tmp);}},updateWithServerData:function(_1e){if(this._versionOnServer!==_1e.version){this._versionOnServer=_1e.version;this._has2FoldSymmetry=_1e.has2FoldSymmetry;this._positionSpacingXY=_1e.positionSpacingXY;this._positionSpacingZ=_1e.positionSpacingZ;this._outlineBXY=_1e.outlineBXY;this._collisionOffsetsListBXY=_1e.collisionOffsetsListBXY;this._attachmentOffsetsListB=_1e.attachmentOffsetsListB;this._rotCenterBXY=_1e.rotCenterBXY;this._backgroundAlpha=_1e.backgroundAlpha;this._updateCentroidBXY();this._updateCongruencyOffsetB();this._updateRotatedOutlinesBXY();this._completeCollisionOffsetsListBXY();this._updateRotatedCollisionOffsetsListsBXY();this._completeAttachmentOffsetsListB();this._updateRotatedAttachmentOffsetsListsB();dojo.publish("realityBuilder/BlockProperties/changed");}},positionSpacingXY:function(){return this._positionSpacingXY;},positionSpacingZ:function(){return this._positionSpacingZ;},rotatedOutlineBXY:function(a){return this._rotatedOutlinesBXY[a%4];},rotatedCollisionOffsetsBXY:function(_1f,_20){var _21,_22,a1,a2;a1=_1f.a()%4;a2=_20.a()%4;_21=this._rotatedCollisionOffsetsListsBXY[a1];_22=(4+a2-a1)%4;return _21[_22];},rotatedAttachmentOffsetsB:function(_23,_24){var _25,_26,a1,a2;a1=_23.a()%4;a2=_24.a()%4;_25=this._rotatedAttachmentOffsetsListsB[a1];_26=(4+a2-a1)%4;return _25[_26];},backgroundAlpha:function(){return this._backgroundAlpha;}});}