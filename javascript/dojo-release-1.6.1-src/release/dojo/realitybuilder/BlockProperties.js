/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["realityBuilder.BlockProperties"]){dojo._hasResource["realityBuilder.BlockProperties"]=true;dojo.provide("realityBuilder.BlockProperties");dojo.declare("realityBuilder.BlockProperties",null,{_versionOnServer:"-1",_congruencyA:null,_blockPositionSpacingXY:null,_blockPositionSpacingZ:null,_outlineBXY:null,_rotatedOutlinesBXY:null,_collisionOffsetsListBXY:null,_rotatedCollisionOffsetsListsBXY:null,_attachmentOffsetsListB:null,_rotatedAttachmentOffsetsListsB:null,_rotCenterBXY:null,_backgroundAlpha:null,versionOnServer:function(){return this._versionOnServer;},isInitializedWithServerData:function(){return this._versionOnServer!=="-1";},_rotateOutlineBXY:function(a){var _1=this;return dojo.map(this._outlineBXY,function(_2){return realityBuilder.util.rotatePointBXY(_2,_1._rotCenterBXY,a);});},_updateRotatedOutlinesBXY:function(){var a;this._rotatedOutlinesBXY=[];for(a=0;a<4;a+=1){this._rotatedOutlinesBXY.push(this._rotateOutlineBXY(a));}},_congruencyOffsetBXY:function(a){if(a===0){return [1,0];}else{return [0,1];}},_withCongruencyOffsetsAddedBXY:function(_3,a){var _4=this._congruencyOffsetBXY(a);return dojo.map(_3,function(_5){return realityBuilder.util.addVectorsBXY(_5,_4);});},_completeCollisionOffsetsListBXY:function(){var _6=this._collisionOffsetsListBXY;_6.push(this._withCongruencyOffsetsAddedBXY(_6[0],0));_6.push(this._withCongruencyOffsetsAddedBXY(_6[1],1));},_rotateCollisionOffsetsBXY:function(_7,a){var _8=realityBuilder.util;return dojo.map(_7,function(_9){return _8.rotatePointBXY(_9,[0,0],a);});},_rotateCollisionOffsetsListBXY:function(a1){var a2,_a,_b=[];for(a2=0;a2<4;a2+=1){_a=this._collisionOffsetsListBXY[a2];_b.push(this._rotateCollisionOffsetsBXY(_a,a1));}return _b;},_updateRotatedCollisionOffsetsListsBXY:function(){var a1,_c;this._rotatedCollisionOffsetsListsBXY=[];for(a1=0;a1<4;a1+=1){_c=this._rotateCollisionOffsetsListBXY(a1);this._rotatedCollisionOffsetsListsBXY.push(_c);}},_rotateAttachmentOffsetB:function(_d,a){var _e,_f,_10,_11;_11=realityBuilder.util;_e=[_d[0],_d[1]];_f=_11.rotatePointBXY(_e,[0,0],a);return [_f[0],_f[1],_d[2]];},_rotateAttachmentOffsetsB:function(_12,a){var _13=this;return dojo.map(_12,function(_14){return _13._rotateAttachmentOffsetB(_14,a);});},_rotateAttachmentOffsetsListB:function(a1){var a2,_15,tmp=[];for(a2=0;a2<this._congruencyA;a2+=1){_15=this._attachmentOffsetsListB[a2];tmp.push(this._rotateAttachmentOffsetsB(_15,a1));}return tmp;},_updateRotatedAttachmentOffsetsListsB:function(){var a1,tmp;this._rotatedAttachmentOffsetsListsB=[];for(a1=0;a1<this._congruencyA;a1+=1){tmp=this._rotateAttachmentOffsetsListB(a1);this._rotatedAttachmentOffsetsListsB.push(tmp);}},updateWithServerData:function(_16){if(this._versionOnServer!==_16.version){this._versionOnServer=_16.version;this._congruencyA=_16.congruencyA;this._positionSpacingXY=_16.positionSpacingXY;this._positionSpacingZ=_16.positionSpacingZ;this._outlineBXY=_16.outlineBXY;this._collisionOffsetsListBXY=_16.collisionOffsetsListBXY;this._attachmentOffsetsListB=_16.attachmentOffsetsListB;this._rotCenterBXY=_16.rotCenterBXY;this._backgroundAlpha=_16.backgroundAlpha;this._updateRotatedOutlinesBXY();this._completeCollisionOffsetsListBXY();this._updateRotatedCollisionOffsetsListsBXY();this._updateRotatedAttachmentOffsetsListsB();dojo.publish("realityBuilder/BlockProperties/changed");}},positionSpacingXY:function(){return this._positionSpacingXY;},positionSpacingZ:function(){return this._positionSpacingZ;},rotatedOutlineBXY:function(a){return this._rotatedOutlinesBXY[a%4];},rotatedCollisionOffsetsBXY:function(_17,_18){var _19,_1a,a1,a2;a1=_17.a()%4;a2=_18.a()%4;_19=this._rotatedCollisionOffsetsListsBXY[a1];_1a=(4+a2-a1)%4;return _19[_1a];},rotatedAttachmentOffsetsB:function(_1b,_1c){var _1d,_1e,a1,a2;a1=_1b.a()%this._congruencyA;a2=_1c.a()%this._congruencyA;_1d=this._rotatedAttachmentOffsetsListsB[a1];_1e=(this._congruencyA+a2-a1)%this._congruencyA;return _1d[_1e];},backgroundAlpha:function(){return this._backgroundAlpha;}});}