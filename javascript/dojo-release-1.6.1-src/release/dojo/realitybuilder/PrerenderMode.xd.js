/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realityBuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","realityBuilder.PrerenderMode"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["realityBuilder.PrerenderMode"]){_4._hasResource["realityBuilder.PrerenderMode"]=true;_4.provide("realityBuilder.PrerenderMode");_4.declare("realityBuilder.PrerenderMode",null,{_versionOnServer:"-1",_isEnabled:null,_makeRealAfter:null,_blockConfigurations:null,_resetDelay:null,_i:null,_prevI:null,versionOnServer:function(){return this._versionOnServer;},isInitializedWithServerData:function(){return this._versionOnServer!=="-1";},resetDelay:function(){return this._resetDelay;},updateWithServerData:function(_7){if(this._versionOnServer!==_7.version){this._versionOnServer=_7.version;this._isEnabled=_7.isEnabled;this._makeRealAfter=_7.makeRealAfter;this._blockConfigurations=_7.blockConfigurations;this._i=_7.i;this._prevI=_7.prevI;this._resetDelay=_7.resetDelay;this._sortBlockConfigurations(this._blockConfigurations);_4.publish("realityBuilder/PrerenderMode/changed");}},i:function(){return this._i;},prevI:function(){return this._prevI;},isEnabled:function(){return this._isEnabled;},makeRealAfter:function(){return this._makeRealAfter;},_sortBlockConfiguration2:function(_8,_9){var a=_8,b=_9;if(a[0]===b[0]){if(a[1]===b[1]){if(a[2]===b[2]){if(a[3]===b[3]){return 0;}else{return a[3]-b[3];}}else{return a[2]-b[2];}}else{return a[1]-b[1];}}else{return a[0]-b[0];}},_sortBlockConfiguration:function(_a){_a.sort(_4.hitch(this,this._sortBlockConfiguration2));},_sortBlockConfigurations:function(_b){var _c=this;_4.forEach(_b,function(_d){_c._sortBlockConfiguration(_d);});},_positionBAndAsMatch:function(_e,_f){var i;for(i=0;i<4;i+=1){if(_e[i]!==_f[i]){return false;}}return true;},_blockConfigurationsMatch:function(_10,_11){var i;if(_10.length===_11.length){for(i=0;i<_10.length;i+=1){if(!this._positionBAndAsMatch(_10[i],_11[i])){return false;}}return true;}else{return false;}},_simplifiedPositionBAndA:function(_12){var _13,_14,a;_14=_12.positionB();a=_12.a();if(_12.has2FoldSymmetry()&&a>=2){_13=realityBuilder.util.addVectorsB(_14,_12.congruencyOffsetB());_13.push(a%2);}else{_13=_4.clone(_14);_13.push(a);}return _13;},_currentBlockConfiguration:function(_15,_16){var _17=[],_18,_19=this;_4.forEach(_15,function(_1a){_18=_19._simplifiedPositionBAndA(_1a);_17.push(_18);});_18=this._simplifiedPositionBAndA(_16);_17.push(_18);this._sortBlockConfiguration(_17);return _17;},matchingBlockConfigurationI:function(_1b,_1c){var i,_1d,_1e;_1e=this._currentBlockConfiguration(_1b,_1c);for(i=0;i<this._blockConfigurations.length;i+=1){_1d=this._blockConfigurations[i];if(this._blockConfigurationsMatch(_1d,_1e)){return i;}}return false;},_loadBlockConfigurationOnServerSucceeded:function(){_4.publish("realityBuilder/PrerenderMode/"+"loadedBlockConfigurationOnServer");},loadBlockConfigurationOnServer:function(i){realityBuilder.util.jsonpGet({url:realityBuilder.util.rootUrl()+"rpc/load_prerendered_block_configuration",content:{"i":i},load:_4.hitch(this,this._loadBlockConfigurationOnServerSucceeded)});},loadPrevBlockConfigurationOnServer:function(){if(this.i()>0){this.loadBlockConfigurationOnServer(this.i()-1);}},loadNextBlockConfigurationOnServer:function(){if(this.i()<this._blockConfigurations.length-1){this.loadBlockConfigurationOnServer(this.i()+1);}},_scheduleResetOnServer:function(){realityBuilder.util.jsonpGet({url:realityBuilder.util.rootUrl()+"rpc/schedule_reset"});},scheduleReset:function(){this._scheduleResetOnServer();}});}}};});