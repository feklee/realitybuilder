/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realitybuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","realityBuilder.Shadow"],["require","realityBuilder.LayerShadow"],["require","realityBuilder.ShadowObscuringBlocks"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["realityBuilder.Shadow"]){_4._hasResource["realityBuilder.Shadow"]=true;_4.provide("realityBuilder.Shadow");_4.require("realityBuilder.LayerShadow");_4.require("realityBuilder.ShadowObscuringBlocks");_4.declare("realityBuilder.Shadow",null,{_newBlock:null,_camera:null,_blockProperties:null,_constructionBlocks:null,_shadowObscuringBlocks:null,_layerShadow:null,constructor:function(_7,_8,_9,_a){this._newBlock=_7;this._blockProperties=_8;this._camera=_9;this._constructionBlocks=_a;this._shadowObscuringBlocks=new realityBuilder.ShadowObscuringBlocks(_7,_8,_9,_a);this._layerShadow=new realityBuilder.LayerShadow(_7,_8,_9,_a);},_renderLayerShadow:function(_b,_c,_d,_e,_f,_10,_11){this._layerShadow.render(_f,_10);_b.globalAlpha=_11;_b.drawImage(this._layerShadow.canvas(),0,0);_b.globalAlpha=1;},render:function(_12,_13){var _14=this._camera.sensor().shadowCanvas(),_15,_16,_17=this._newBlock,_18=this._camera,_19=this._constructionBlocks,_1a=_19.highestRealBlocksZB();this._shadowObscuringBlocks.update();if(_14.getContext){_15=_14.getContext("2d");realityBuilder.util.clearCanvas(_14);for(_16=-1;_16<=_1a;_16+=1){if(_16<_17.zB()){this._renderLayerShadow(_15,_17,_18,_19,_16,_12,_13);}this._shadowObscuringBlocks.subtract(_15,_16+1);}return;}},clear:function(){var _1b=this._camera.sensor().shadowCanvas();realityBuilder.util.clearCanvas(_1b);}});}}};});