/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is a compiled version of Dojo, built for deployment and not for
	development. To get an editable version, please visit:

		http://dojotoolkit.org

	for documentation and information on getting the source.
*/

if(!dojo._hasResource["dojox.math._base"]){dojo._hasResource["dojox.math._base"]=true;dojo.provide("dojox.math._base");(function(){var m=dojox.math;dojo.mixin(dojox.math,{toRadians:function(n){return (n*Math.PI)/180;},toDegrees:function(n){return (n*180)/Math.PI;},degreesToRadians:function(n){return m.toRadians(n);},radiansToDegrees:function(n){return m.toDegrees(n);},factorial:function(n){if(n===0){return 1;}else{if(n<0||Math.floor(n)!=n){return NaN;}}var _1=1;for(var i=1;i<=n;i++){_1*=i;}return _1;},permutations:function(n,k){if(n==0||k==0){return 1;}return this.factorial(n)/this.factorial(n-k);},combinations:function(n,r){if(n==0||r==0){return 1;}return this.factorial(n)/(this.factorial(n-r)*this.factorial(r));},bernstein:function(t,n,i){return this.combinations(n,i)*Math.pow(t,i)*Math.pow(1-t,n-i);},gaussian:function(){var k=2;do{var i=2*Math.random()-1;var j=2*Math.random()-1;k=i*i+j*j;}while(k>=1);return i*Math.sqrt((-2*Math.log(k))/k);},range:function(a,b,_2){if(arguments.length<2){b=a,a=0;}var _3=[],s=_2||1,i;if(s>0){for(i=a;i<b;i+=s){_3.push(i);}}else{if(s<0){for(i=a;i>b;i+=s){_3.push(i);}}else{throw new Error("dojox.math.range: step must not be zero.");}}return _3;},distance:function(a,b){return Math.sqrt(Math.pow(b[0]-a[0],2)+Math.pow(b[1]-a[1],2));},midpoint:function(a,b){if(a.length!=b.length){console.error("dojox.math.midpoint: Points A and B are not the same dimensionally.",a,b);}var m=[];for(var i=0;i<a.length;i++){m[i]=(a[i]+b[i])/2;}return m;}});})();}if(!dojo._hasResource["dojox.math"]){dojo._hasResource["dojox.math"]=true;dojo.provide("dojox.math");}if(!dojo._hasResource["dojox.math.matrix"]){dojo._hasResource["dojox.math.matrix"]=true;dojo.provide("dojox.math.matrix");dojo.mixin(dojox.math.matrix,{iDF:0,ALMOST_ZERO:1e-10,multiply:function(a,b){var ay=a.length,ax=a[0].length,by=b.length,bx=b[0].length;if(ax!=by){console.warn("Can't multiply matricies of sizes "+ax+","+ay+" and "+bx+","+by);return [[0]];}var c=[];for(var k=0;k<ay;k++){c[k]=[];for(var i=0;i<bx;i++){c[k][i]=0;for(var m=0;m<ax;m++){c[k][i]+=a[k][m]*b[m][i];}}}return c;},product:function(){if(arguments.length==0){console.warn("can't multiply 0 matrices!");return 1;}var m=arguments[0];for(var i=1;i<arguments.length;i++){m=this.multiply(m,arguments[i]);}return m;},sum:function(){if(arguments.length==0){console.warn("can't sum 0 matrices!");return 0;}var m=this.copy(arguments[0]);var _4=m.length;if(_4==0){console.warn("can't deal with matrices of 0 rows!");return 0;}var _5=m[0].length;if(_5==0){console.warn("can't deal with matrices of 0 cols!");return 0;}for(var i=1;i<arguments.length;++i){var _6=arguments[i];if(_6.length!=_4||_6[0].length!=_5){console.warn("can't add matrices of different dimensions: first dimensions were "+_4+"x"+_5+", current dimensions are "+_6.length+"x"+_6[0].length);return 0;}for(var r=0;r<_4;r++){for(var c=0;c<_5;c++){m[r][c]+=_6[r][c];}}}return m;},inverse:function(a){if(a.length==1&&a[0].length==1){return [[1/a[0][0]]];}var _7=a.length,m=this.create(_7,_7),mm=this.adjoint(a),_8=this.determinant(a),dd=0;if(_8==0){console.warn("Determinant Equals 0, Not Invertible.");return [[0]];}else{dd=1/_8;}for(var i=0;i<_7;i++){for(var j=0;j<_7;j++){m[i][j]=dd*mm[i][j];}}return m;},determinant:function(a){if(a.length!=a[0].length){console.warn("Can't calculate the determinant of a non-squre matrix!");return 0;}var _9=a.length,_a=1,b=this.upperTriangle(a);for(var i=0;i<_9;i++){var _b=b[i][i];if(Math.abs(_b)<this.ALMOST_ZERO){return 0;}_a*=_b;}_a*=this.iDF;return _a;},upperTriangle:function(m){m=this.copy(m);var f1=0,_c=0,_d=m.length,v=1;this.iDF=1;for(var _e=0;_e<_d-1;_e++){if(typeof m[_e][_e]!="number"){console.warn("non-numeric entry found in a numeric matrix: m["+_e+"]["+_e+"]="+m[_e][_e]);}v=1;var _f=0;while((m[_e][_e]==0)&&!_f){if(_e+v>=_d){this.iDF=0;_f=1;}else{for(var r=0;r<_d;r++){_c=m[_e][r];m[_e][r]=m[_e+v][r];m[_e+v][r]=_c;}v++;this.iDF*=-1;}}for(var row=_e+1;row<_d;row++){if(typeof m[row][_e]!="number"){console.warn("non-numeric entry found in a numeric matrix: m["+row+"]["+_e+"]="+m[row][_e]);}if(typeof m[_e][row]!="number"){console.warn("non-numeric entry found in a numeric matrix: m["+_e+"]["+row+"]="+m[_e][row]);}if(m[_e][_e]!=0){var f1=(-1)*m[row][_e]/m[_e][_e];for(var i=_e;i<_d;i++){m[row][i]=f1*m[_e][i]+m[row][i];}}}}return m;},create:function(a,b,_10){_10=_10||0;var m=[];for(var i=0;i<b;i++){m[i]=[];for(var j=0;j<a;j++){m[i][j]=_10;}}return m;},ones:function(a,b){return this.create(a,b,1);},zeros:function(a,b){return this.create(a,b);},identity:function(_11,_12){_12=_12||1;var m=[];for(var i=0;i<_11;i++){m[i]=[];for(var j=0;j<_11;j++){m[i][j]=(i==j?_12:0);}}return m;},adjoint:function(a){var tms=a.length;if(tms<=1){console.warn("Can't find the adjoint of a matrix with a dimension less than 2");return [[0]];}if(a.length!=a[0].length){console.warn("Can't find the adjoint of a non-square matrix");return [[0]];}var m=this.create(tms,tms),ap=this.create(tms-1,tms-1);var ii=0,jj=0,ia=0,ja=0,det=0;for(var i=0;i<tms;i++){for(var j=0;j<tms;j++){ia=0;for(ii=0;ii<tms;ii++){if(ii==i){continue;}ja=0;for(jj=0;jj<tms;jj++){if(jj==j){continue;}ap[ia][ja]=a[ii][jj];ja++;}ia++;}det=this.determinant(ap);m[i][j]=Math.pow(-1,(i+j))*det;}}return this.transpose(m);},transpose:function(a){var m=this.create(a.length,a[0].length);for(var i=0;i<a.length;i++){for(var j=0;j<a[i].length;j++){m[j][i]=a[i][j];}}return m;},format:function(a,_13){_13=_13||5;function _14(x,dp){var fac=Math.pow(10,dp);var a=Math.round(x*fac)/fac;var b=a.toString();if(b.charAt(0)!="-"){b=" "+b;}if(b.indexOf(".")>-1){b+=".";}while(b.length<dp+3){b+="0";}return b;};var ya=a.length;var xa=ya>0?a[0].length:0;var _15="";for(var y=0;y<ya;y++){_15+="| ";for(var x=0;x<xa;x++){_15+=_14(a[y][x],_13)+" ";}_15+="|\n";}return _15;},copy:function(a){var ya=a.length,xa=a[0].length,m=this.create(xa,ya);for(var y=0;y<ya;y++){for(var x=0;x<xa;x++){m[y][x]=a[y][x];}}return m;},scale:function(a,_16){a=this.copy(a);var ya=a.length,xa=a[0].length;for(var y=0;y<ya;y++){for(var x=0;x<xa;x++){a[y][x]*=_16;}}return a;}});}if(!dojo._hasResource["dojox.xml.parser"]){dojo._hasResource["dojox.xml.parser"]=true;dojo.provide("dojox.xml.parser");dojox.xml.parser.parse=function(str,_17){var _18=dojo.doc;var doc;_17=_17||"text/xml";if(str&&dojo.trim(str)&&"DOMParser" in dojo.global){var _19=new DOMParser();doc=_19.parseFromString(str,_17);var de=doc.documentElement;var _1a="http://www.mozilla.org/newlayout/xml/parsererror.xml";if(de.nodeName=="parsererror"&&de.namespaceURI==_1a){var _1b=de.getElementsByTagNameNS(_1a,"sourcetext")[0];if(!_1b){_1b=_1b.firstChild.data;}throw new Error("Error parsing text "+nativeDoc.documentElement.firstChild.data+" \n"+_1b);}return doc;}else{if("ActiveXObject" in dojo.global){var ms=function(n){return "MSXML"+n+".DOMDocument";};var dp=["Microsoft.XMLDOM",ms(6),ms(4),ms(3),ms(2)];dojo.some(dp,function(p){try{doc=new ActiveXObject(p);}catch(e){return false;}return true;});if(str&&doc){doc.async=false;doc.loadXML(str);var pe=doc.parseError;if(pe.errorCode!==0){throw new Error("Line: "+pe.line+"\n"+"Col: "+pe.linepos+"\n"+"Reason: "+pe.reason+"\n"+"Error Code: "+pe.errorCode+"\n"+"Source: "+pe.srcText);}}if(doc){return doc;}}else{if(_18.implementation&&_18.implementation.createDocument){if(str&&dojo.trim(str)&&_18.createElement){var tmp=_18.createElement("xml");tmp.innerHTML=str;var _1c=_18.implementation.createDocument("foo","",null);dojo.forEach(tmp.childNodes,function(_1d){_1c.importNode(_1d,true);});return _1c;}else{return _18.implementation.createDocument("","",null);}}}}return null;};dojox.xml.parser.textContent=function(_1e,_1f){if(arguments.length>1){var _20=_1e.ownerDocument||dojo.doc;dojox.xml.parser.replaceChildren(_1e,_20.createTextNode(_1f));return _1f;}else{if(_1e.textContent!==undefined){return _1e.textContent;}var _21="";if(_1e){dojo.forEach(_1e.childNodes,function(_22){switch(_22.nodeType){case 1:case 5:_21+=dojox.xml.parser.textContent(_22);break;case 3:case 2:case 4:_21+=_22.nodeValue;}});}return _21;}};dojox.xml.parser.replaceChildren=function(_23,_24){var _25=[];if(dojo.isIE){dojo.forEach(_23.childNodes,function(_26){_25.push(_26);});}dojox.xml.parser.removeChildren(_23);dojo.forEach(_25,dojo.destroy);if(!dojo.isArray(_24)){_23.appendChild(_24);}else{dojo.forEach(_24,function(_27){_23.appendChild(_27);});}};dojox.xml.parser.removeChildren=function(_28){var _29=_28.childNodes.length;while(_28.hasChildNodes()){_28.removeChild(_28.firstChild);}return _29;};dojox.xml.parser.innerXML=function(_2a){if(_2a.innerXML){return _2a.innerXML;}else{if(_2a.xml){return _2a.xml;}else{if(typeof XMLSerializer!="undefined"){return (new XMLSerializer()).serializeToString(_2a);}}}return null;};}if(!dojo._hasResource["dojo.string"]){dojo._hasResource["dojo.string"]=true;dojo.provide("dojo.string");dojo.string.rep=function(str,num){if(num<=0||!str){return "";}var buf=[];for(;;){if(num&1){buf.push(str);}if(!(num>>=1)){break;}str+=str;}return buf.join("");};dojo.string.pad=function(_2b,_2c,ch,end){if(!ch){ch="0";}var out=String(_2b),pad=dojo.string.rep(ch,Math.ceil((_2c-out.length)/ch.length));return end?out+pad:pad+out;};dojo.string.substitute=function(_2d,map,_2e,_2f){_2f=_2f||dojo.global;_2e=_2e?dojo.hitch(_2f,_2e):function(v){return v;};return _2d.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(_30,key,_31){var _32=dojo.getObject(key,false,map);if(_31){_32=dojo.getObject(_31,false,_2f).call(_2f,_32,key);}return _2e(_32,key).toString();});};dojo.string.trim=String.prototype.trim?dojo.trim:function(str){str=str.replace(/^\s+/,"");for(var i=str.length-1;i>=0;i--){if(/\S/.test(str.charAt(i))){str=str.substring(0,i+1);break;}}return str;};}if(!dojo._hasResource["dojo.date.stamp"]){dojo._hasResource["dojo.date.stamp"]=true;dojo.provide("dojo.date.stamp");dojo.date.stamp.fromISOString=function(_33,_34){if(!dojo.date.stamp._isoRegExp){dojo.date.stamp._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/;}var _35=dojo.date.stamp._isoRegExp.exec(_33),_36=null;if(_35){_35.shift();if(_35[1]){_35[1]--;}if(_35[6]){_35[6]*=1000;}if(_34){_34=new Date(_34);dojo.map(["FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds"],function(_37){return _34["get"+_37]();}).forEach(function(_38,_39){if(_35[_39]===undefined){_35[_39]=_38;}});}_36=new Date(_35[0]||1970,_35[1]||0,_35[2]||1,_35[3]||0,_35[4]||0,_35[5]||0,_35[6]||0);if(_35[0]<100){_36.setFullYear(_35[0]||1970);}var _3a=0,_3b=_35[7]&&_35[7].charAt(0);if(_3b!="Z"){_3a=((_35[8]||0)*60)+(Number(_35[9])||0);if(_3b!="-"){_3a*=-1;}}if(_3b){_3a-=_36.getTimezoneOffset();}if(_3a){_36.setTime(_36.getTime()+_3a*60000);}}return _36;};dojo.date.stamp.toISOString=function(_3c,_3d){var _3e=function(n){return (n<10)?"0"+n:n;};_3d=_3d||{};var _3f=[],_40=_3d.zulu?"getUTC":"get",_41="";if(_3d.selector!="time"){var _42=_3c[_40+"FullYear"]();_41=["0000".substr((_42+"").length)+_42,_3e(_3c[_40+"Month"]()+1),_3e(_3c[_40+"Date"]())].join("-");}_3f.push(_41);if(_3d.selector!="date"){var _43=[_3e(_3c[_40+"Hours"]()),_3e(_3c[_40+"Minutes"]()),_3e(_3c[_40+"Seconds"]())].join(":");var _44=_3c[_40+"Milliseconds"]();if(_3d.milliseconds){_43+="."+(_44<100?"0":"")+_3e(_44);}if(_3d.zulu){_43+="Z";}else{if(_3d.selector!="time"){var _45=_3c.getTimezoneOffset();var _46=Math.abs(_45);_43+=(_45>0?"-":"+")+_3e(Math.floor(_46/60))+":"+_3e(_46%60);}}_3f.push(_43);}return _3f.join("T");};}if(!dojo._hasResource["dojox.atom.io.model"]){dojo._hasResource["dojox.atom.io.model"]=true;dojo.provide("dojox.atom.io.model");dojox.atom.io.model._Constants={"ATOM_URI":"http://www.w3.org/2005/Atom","ATOM_NS":"http://www.w3.org/2005/Atom","PURL_NS":"http://purl.org/atom/app#","APP_NS":"http://www.w3.org/2007/app"};dojox.atom.io.model._actions={"link":function(obj,_47){if(obj.links===null){obj.links=[];}var _48=new dojox.atom.io.model.Link();_48.buildFromDom(_47);obj.links.push(_48);},"author":function(obj,_49){if(obj.authors===null){obj.authors=[];}var _4a=new dojox.atom.io.model.Person("author");_4a.buildFromDom(_49);obj.authors.push(_4a);},"contributor":function(obj,_4b){if(obj.contributors===null){obj.contributors=[];}var _4c=new dojox.atom.io.model.Person("contributor");_4c.buildFromDom(_4b);obj.contributors.push(_4c);},"category":function(obj,_4d){if(obj.categories===null){obj.categories=[];}var cat=new dojox.atom.io.model.Category();cat.buildFromDom(_4d);obj.categories.push(cat);},"icon":function(obj,_4e){obj.icon=dojox.xml.parser.textContent(_4e);},"id":function(obj,_4f){obj.id=dojox.xml.parser.textContent(_4f);},"rights":function(obj,_50){obj.rights=dojox.xml.parser.textContent(_50);},"subtitle":function(obj,_51){var cnt=new dojox.atom.io.model.Content("subtitle");cnt.buildFromDom(_51);obj.subtitle=cnt;},"title":function(obj,_52){var cnt=new dojox.atom.io.model.Content("title");cnt.buildFromDom(_52);obj.title=cnt;},"updated":function(obj,_53){obj.updated=dojox.atom.io.model.util.createDate(_53);},"issued":function(obj,_54){obj.issued=dojox.atom.io.model.util.createDate(_54);},"modified":function(obj,_55){obj.modified=dojox.atom.io.model.util.createDate(_55);},"published":function(obj,_56){obj.published=dojox.atom.io.model.util.createDate(_56);},"entry":function(obj,_57){if(obj.entries===null){obj.entries=[];}var _58=obj.createEntry?obj.createEntry():new dojox.atom.io.model.Entry();_58.buildFromDom(_57);obj.entries.push(_58);},"content":function(obj,_59){var cnt=new dojox.atom.io.model.Content("content");cnt.buildFromDom(_59);obj.content=cnt;},"summary":function(obj,_5a){var _5b=new dojox.atom.io.model.Content("summary");_5b.buildFromDom(_5a);obj.summary=_5b;},"name":function(obj,_5c){obj.name=dojox.xml.parser.textContent(_5c);},"email":function(obj,_5d){obj.email=dojox.xml.parser.textContent(_5d);},"uri":function(obj,_5e){obj.uri=dojox.xml.parser.textContent(_5e);},"generator":function(obj,_5f){obj.generator=new dojox.atom.io.model.Generator();obj.generator.buildFromDom(_5f);}};dojox.atom.io.model.util={createDate:function(_60){var _61=dojox.xml.parser.textContent(_60);if(_61){return dojo.date.stamp.fromISOString(dojo.trim(_61));}return null;},escapeHtml:function(str){return str.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;").replace(/'/gm,"&#39;");},unEscapeHtml:function(str){return str.replace(/&lt;/gm,"<").replace(/&gt;/gm,">").replace(/&quot;/gm,"\"").replace(/&#39;/gm,"'").replace(/&amp;/gm,"&");},getNodename:function(_62){var _63=null;if(_62!==null){_63=_62.localName?_62.localName:_62.nodeName;if(_63!==null){var _64=_63.indexOf(":");if(_64!==-1){_63=_63.substring((_64+1),_63.length);}}}return _63;}};dojo.declare("dojox.atom.io.model.Node",null,{constructor:function(_65,_66,_67,_68,_69){this.name_space=_65;this.name=_66;this.attributes=[];if(_67){this.attributes=_67;}this.content=[];this.rawNodes=[];this.textContent=null;if(_68){this.content.push(_68);}this.shortNs=_69;this._objName="Node";},buildFromDom:function(_6a){this._saveAttributes(_6a);this.name_space=_6a.namespaceURI;this.shortNs=_6a.prefix;this.name=dojox.atom.io.model.util.getNodename(_6a);for(var x=0;x<_6a.childNodes.length;x++){var c=_6a.childNodes[x];if(dojox.atom.io.model.util.getNodename(c)!="#text"){this.rawNodes.push(c);var n=new dojox.atom.io.model.Node();n.buildFromDom(c,true);this.content.push(n);}else{this.content.push(c.nodeValue);}}this.textContent=dojox.xml.parser.textContent(_6a);},_saveAttributes:function(_6b){if(!this.attributes){this.attributes=[];}var _6c=function(_6d){var _6e=_6d.attributes;if(_6e===null){return false;}return (_6e.length!==0);};if(_6c(_6b)&&this._getAttributeNames){var _6f=this._getAttributeNames(_6b);if(_6f&&_6f.length>0){for(var x in _6f){var _70=_6b.getAttribute(_6f[x]);if(_70){this.attributes[_6f[x]]=_70;}}}}},addAttribute:function(_71,_72){this.attributes[_71]=_72;},getAttribute:function(_73){return this.attributes[_73];},_getAttributeNames:function(_74){var _75=[];for(var i=0;i<_74.attributes.length;i++){_75.push(_74.attributes[i].nodeName);}return _75;},toString:function(){var xml=[];var x;var _76=(this.shortNs?this.shortNs+":":"")+this.name;var _77=(this.name=="#cdata-section");if(_77){xml.push("<![CDATA[");xml.push(this.textContent);xml.push("]]>");}else{xml.push("<");xml.push(_76);if(this.name_space){xml.push(" xmlns='"+this.name_space+"'");}if(this.attributes){for(x in this.attributes){xml.push(" "+x+"='"+this.attributes[x]+"'");}}if(this.content){xml.push(">");for(x in this.content){xml.push(this.content[x]);}xml.push("</"+_76+">\n");}else{xml.push("/>\n");}}return xml.join("");},addContent:function(_78){this.content.push(_78);}});dojo.declare("dojox.atom.io.model.AtomItem",dojox.atom.io.model.Node,{constructor:function(_79){this.ATOM_URI=dojox.atom.io.model._Constants.ATOM_URI;this.links=null;this.authors=null;this.categories=null;this.contributors=null;this.icon=this.id=this.logo=this.xmlBase=this.rights=null;this.subtitle=this.title=null;this.updated=this.published=null;this.issued=this.modified=null;this.content=null;this.extensions=null;this.entries=null;this.name_spaces={};this._objName="AtomItem";},_getAttributeNames:function(){return null;},_accepts:{},accept:function(tag){return Boolean(this._accepts[tag]);},_postBuild:function(){},buildFromDom:function(_7a){var i,c,n;for(i=0;i<_7a.attributes.length;i++){c=_7a.attributes.item(i);n=dojox.atom.io.model.util.getNodename(c);if(c.prefix=="xmlns"&&c.prefix!=n){this.addNamespace(c.nodeValue,n);}}c=_7a.childNodes;for(i=0;i<c.length;i++){if(c[i].nodeType==1){var _7b=dojox.atom.io.model.util.getNodename(c[i]);if(!_7b){continue;}if(c[i].namespaceURI!=dojox.atom.io.model._Constants.ATOM_NS&&_7b!="#text"){if(!this.extensions){this.extensions=[];}var _7c=new dojox.atom.io.model.Node();_7c.buildFromDom(c[i]);this.extensions.push(_7c);}if(!this.accept(_7b.toLowerCase())){continue;}var fn=dojox.atom.io.model._actions[_7b];if(fn){fn(this,c[i]);}}}this._saveAttributes(_7a);if(this._postBuild){this._postBuild();}},addNamespace:function(_7d,_7e){if(_7d&&_7e){this.name_spaces[_7e]=_7d;}},addAuthor:function(_7f,_80,uri){if(!this.authors){this.authors=[];}this.authors.push(new dojox.atom.io.model.Person("author",_7f,_80,uri));},addContributor:function(_81,_82,uri){if(!this.contributors){this.contributors=[];}this.contributors.push(new dojox.atom.io.model.Person("contributor",_81,_82,uri));},addLink:function(_83,rel,_84,_85,_86){if(!this.links){this.links=[];}this.links.push(new dojox.atom.io.model.Link(_83,rel,_84,_85,_86));},removeLink:function(_87,rel){if(!this.links||!dojo.isArray(this.links)){return;}var _88=0;for(var i=0;i<this.links.length;i++){if((!_87||this.links[i].href===_87)&&(!rel||this.links[i].rel===rel)){this.links.splice(i,1);_88++;}}return _88;},removeBasicLinks:function(){if(!this.links){return;}var _89=0;for(var i=0;i<this.links.length;i++){if(!this.links[i].rel){this.links.splice(i,1);_89++;i--;}}return _89;},addCategory:function(_8a,_8b,_8c){if(!this.categories){this.categories=[];}this.categories.push(new dojox.atom.io.model.Category(_8a,_8b,_8c));},getCategories:function(_8d){if(!_8d){return this.categories;}var arr=[];for(var x in this.categories){if(this.categories[x].scheme===_8d){arr.push(this.categories[x]);}}return arr;},removeCategories:function(_8e,_8f){if(!this.categories){return;}var _90=0;for(var i=0;i<this.categories.length;i++){if((!_8e||this.categories[i].scheme===_8e)&&(!_8f||this.categories[i].term===_8f)){this.categories.splice(i,1);_90++;i--;}}return _90;},setTitle:function(str,_91){if(!str){return;}this.title=new dojox.atom.io.model.Content("title");this.title.value=str;if(_91){this.title.type=_91;}},addExtension:function(_92,_93,_94,_95,_96){if(!this.extensions){this.extensions=[];}this.extensions.push(new dojox.atom.io.model.Node(_92,_93,_94,_95,_96||"ns"+this.extensions.length));},getExtensions:function(_97,_98){var arr=[];if(!this.extensions){return arr;}for(var x in this.extensions){if((this.extensions[x].name_space===_97||this.extensions[x].shortNs===_97)&&(!_98||this.extensions[x].name===_98)){arr.push(this.extensions[x]);}}return arr;},removeExtensions:function(_99,_9a){if(!this.extensions){return;}for(var i=0;i<this.extensions.length;i++){if((this.extensions[i].name_space==_99||this.extensions[i].shortNs===_99)&&this.extensions[i].name===_9a){this.extensions.splice(i,1);i--;}}},destroy:function(){this.links=null;this.authors=null;this.categories=null;this.contributors=null;this.icon=this.id=this.logo=this.xmlBase=this.rights=null;this.subtitle=this.title=null;this.updated=this.published=null;this.issued=this.modified=null;this.content=null;this.extensions=null;this.entries=null;}});dojo.declare("dojox.atom.io.model.Category",dojox.atom.io.model.Node,{constructor:function(_9b,_9c,_9d){this.scheme=_9b;this.term=_9c;this.label=_9d;this._objName="Category";},_postBuild:function(){},_getAttributeNames:function(){return ["label","scheme","term"];},toString:function(){var s=[];s.push("<category ");if(this.label){s.push(" label=\""+this.label+"\" ");}if(this.scheme){s.push(" scheme=\""+this.scheme+"\" ");}if(this.term){s.push(" term=\""+this.term+"\" ");}s.push("/>\n");return s.join("");},buildFromDom:function(_9e){this._saveAttributes(_9e);this.label=this.attributes.label;this.scheme=this.attributes.scheme;this.term=this.attributes.term;if(this._postBuild){this._postBuild();}}});dojo.declare("dojox.atom.io.model.Content",dojox.atom.io.model.Node,{constructor:function(_9f,_a0,src,_a1,_a2){this.tagName=_9f;this.value=_a0;this.src=src;this.type=_a1;this.xmlLang=_a2;this.HTML="html";this.TEXT="text";this.XHTML="xhtml";this.XML="xml";this._useTextContent="true";},_getAttributeNames:function(){return ["type","src"];},_postBuild:function(){},buildFromDom:function(_a3){var _a4=_a3.getAttribute("type");if(_a4){_a4=_a4.toLowerCase();if(_a4=="xml"||"text/xml"){_a4=this.XML;}}else{_a4="text";}if(_a4===this.XML){if(_a3.firstChild){var i;this.value="";for(i=0;i<_a3.childNodes.length;i++){var c=_a3.childNodes[i];if(c){this.value+=dojox.xml.parser.innerXML(c);}}}}else{if(_a3.innerHTML){this.value=_a3.innerHTML;}else{this.value=dojox.xml.parser.textContent(_a3);}}this._saveAttributes(_a3);if(this.attributes){this.type=this.attributes.type;this.scheme=this.attributes.scheme;this.term=this.attributes.term;}if(!this.type){this.type="text";}var _a5=this.type.toLowerCase();if(_a5==="html"||_a5==="text/html"||_a5==="xhtml"||_a5==="text/xhtml"){this.value=dojox.atom.io.model.util.unEscapeHtml(this.value);}if(this._postBuild){this._postBuild();}},toString:function(){var s=[];s.push("<"+this.tagName+" ");if(!this.type){this.type="text";}if(this.type){s.push(" type=\""+this.type+"\" ");}if(this.xmlLang){s.push(" xml:lang=\""+this.xmlLang+"\" ");}if(this.xmlBase){s.push(" xml:base=\""+this.xmlBase+"\" ");}if(this.type.toLowerCase()==this.HTML){s.push(">"+dojox.atom.io.model.util.escapeHtml(this.value)+"</"+this.tagName+">\n");}else{s.push(">"+this.value+"</"+this.tagName+">\n");}var ret=s.join("");return ret;}});dojo.declare("dojox.atom.io.model.Link",dojox.atom.io.model.Node,{constructor:function(_a6,rel,_a7,_a8,_a9){this.href=_a6;this.hrefLang=_a7;this.rel=rel;this.title=_a8;this.type=_a9;},_getAttributeNames:function(){return ["href","jrefLang","rel","title","type"];},_postBuild:function(){},buildFromDom:function(_aa){this._saveAttributes(_aa);this.href=this.attributes.href;this.hrefLang=this.attributes.hreflang;this.rel=this.attributes.rel;this.title=this.attributes.title;this.type=this.attributes.type;if(this._postBuild){this._postBuild();}},toString:function(){var s=[];s.push("<link ");if(this.href){s.push(" href=\""+this.href+"\" ");}if(this.hrefLang){s.push(" hrefLang=\""+this.hrefLang+"\" ");}if(this.rel){s.push(" rel=\""+this.rel+"\" ");}if(this.title){s.push(" title=\""+this.title+"\" ");}if(this.type){s.push(" type = \""+this.type+"\" ");}s.push("/>\n");return s.join("");}});dojo.declare("dojox.atom.io.model.Person",dojox.atom.io.model.Node,{constructor:function(_ab,_ac,_ad,uri){this.author="author";this.contributor="contributor";if(!_ab){_ab=this.author;}this.personType=_ab;this.name=_ac||"";this.email=_ad||"";this.uri=uri||"";this._objName="Person";},_getAttributeNames:function(){return null;},_postBuild:function(){},accept:function(tag){return Boolean(this._accepts[tag]);},buildFromDom:function(_ae){var c=_ae.childNodes;for(var i=0;i<c.length;i++){var _af=dojox.atom.io.model.util.getNodename(c[i]);if(!_af){continue;}if(c[i].namespaceURI!=dojox.atom.io.model._Constants.ATOM_NS&&_af!="#text"){if(!this.extensions){this.extensions=[];}var _b0=new dojox.atom.io.model.Node();_b0.buildFromDom(c[i]);this.extensions.push(_b0);}if(!this.accept(_af.toLowerCase())){continue;}var fn=dojox.atom.io.model._actions[_af];if(fn){fn(this,c[i]);}}this._saveAttributes(_ae);if(this._postBuild){this._postBuild();}},_accepts:{"name":true,"uri":true,"email":true},toString:function(){var s=[];s.push("<"+this.personType+">\n");if(this.name){s.push("\t<name>"+this.name+"</name>\n");}if(this.email){s.push("\t<email>"+this.email+"</email>\n");}if(this.uri){s.push("\t<uri>"+this.uri+"</uri>\n");}s.push("</"+this.personType+">\n");return s.join("");}});dojo.declare("dojox.atom.io.model.Generator",dojox.atom.io.model.Node,{constructor:function(uri,_b1,_b2){this.uri=uri;this.version=_b1;this.value=_b2;},_postBuild:function(){},buildFromDom:function(_b3){this.value=dojox.xml.parser.textContent(_b3);this._saveAttributes(_b3);this.uri=this.attributes.uri;this.version=this.attributes.version;if(this._postBuild){this._postBuild();}},toString:function(){var s=[];s.push("<generator ");if(this.uri){s.push(" uri=\""+this.uri+"\" ");}if(this.version){s.push(" version=\""+this.version+"\" ");}s.push(">"+this.value+"</generator>\n");var ret=s.join("");return ret;}});dojo.declare("dojox.atom.io.model.Entry",dojox.atom.io.model.AtomItem,{constructor:function(id){this.id=id;this._objName="Entry";this.feedUrl=null;},_getAttributeNames:function(){return null;},_accepts:{"author":true,"content":true,"category":true,"contributor":true,"created":true,"id":true,"link":true,"published":true,"rights":true,"summary":true,"title":true,"updated":true,"xmlbase":true,"issued":true,"modified":true},toString:function(_b4){var s=[];var i;if(_b4){s.push("<?xml version='1.0' encoding='UTF-8'?>");s.push("<entry xmlns='"+dojox.atom.io.model._Constants.ATOM_URI+"'");}else{s.push("<entry");}if(this.xmlBase){s.push(" xml:base=\""+this.xmlBase+"\" ");}for(i in this.name_spaces){s.push(" xmlns:"+i+"=\""+this.name_spaces[i]+"\"");}s.push(">\n");s.push("<id>"+(this.id?this.id:"")+"</id>\n");if(this.issued&&!this.published){this.published=this.issued;}if(this.published){s.push("<published>"+dojo.date.stamp.toISOString(this.published)+"</published>\n");}if(this.created){s.push("<created>"+dojo.date.stamp.toISOString(this.created)+"</created>\n");}if(this.issued){s.push("<issued>"+dojo.date.stamp.toISOString(this.issued)+"</issued>\n");}if(this.modified){s.push("<modified>"+dojo.date.stamp.toISOString(this.modified)+"</modified>\n");}if(this.modified&&!this.updated){this.updated=this.modified;}if(this.updated){s.push("<updated>"+dojo.date.stamp.toISOString(this.updated)+"</updated>\n");}if(this.rights){s.push("<rights>"+this.rights+"</rights>\n");}if(this.title){s.push(this.title.toString());}if(this.summary){s.push(this.summary.toString());}var _b5=[this.authors,this.categories,this.links,this.contributors,this.extensions];for(var x in _b5){if(_b5[x]){for(var y in _b5[x]){s.push(_b5[x][y]);}}}if(this.content){s.push(this.content.toString());}s.push("</entry>\n");return s.join("");},getEditHref:function(){if(this.links===null||this.links.length===0){return null;}for(var x in this.links){if(this.links[x].rel&&this.links[x].rel=="edit"){return this.links[x].href;}}return null;},setEditHref:function(url){if(this.links===null){this.links=[];}for(var x in this.links){if(this.links[x].rel&&this.links[x].rel=="edit"){this.links[x].href=url;return;}}this.addLink(url,"edit");}});dojo.declare("dojox.atom.io.model.Feed",dojox.atom.io.model.AtomItem,{_accepts:{"author":true,"content":true,"category":true,"contributor":true,"created":true,"id":true,"link":true,"published":true,"rights":true,"summary":true,"title":true,"updated":true,"xmlbase":true,"entry":true,"logo":true,"issued":true,"modified":true,"icon":true,"subtitle":true},addEntry:function(_b6){if(!_b6.id){throw new Error("The entry object must be assigned an ID attribute.");}if(!this.entries){this.entries=[];}_b6.feedUrl=this.getSelfHref();this.entries.push(_b6);},getFirstEntry:function(){if(!this.entries||this.entries.length===0){return null;}return this.entries[0];},getEntry:function(_b7){if(!this.entries){return null;}for(var x in this.entries){if(this.entries[x].id==_b7){return this.entries[x];}}return null;},removeEntry:function(_b8){if(!this.entries){return;}var _b9=0;for(var i=0;i<this.entries.length;i++){if(this.entries[i]===_b8){this.entries.splice(i,1);_b9++;}}return _b9;},setEntries:function(_ba){for(var x in _ba){this.addEntry(_ba[x]);}},toString:function(){var s=[];var i;s.push("<?xml version=\"1.0\" encoding=\"utf-8\"?>\n");s.push("<feed xmlns=\""+dojox.atom.io.model._Constants.ATOM_URI+"\"");if(this.xmlBase){s.push(" xml:base=\""+this.xmlBase+"\"");}for(i in this.name_spaces){s.push(" xmlns:"+i+"=\""+this.name_spaces[i]+"\"");}s.push(">\n");s.push("<id>"+(this.id?this.id:"")+"</id>\n");if(this.title){s.push(this.title);}if(this.copyright&&!this.rights){this.rights=this.copyright;}if(this.rights){s.push("<rights>"+this.rights+"</rights>\n");}if(this.issued){s.push("<issued>"+dojo.date.stamp.toISOString(this.issued)+"</issued>\n");}if(this.modified){s.push("<modified>"+dojo.date.stamp.toISOString(this.modified)+"</modified>\n");}if(this.modified&&!this.updated){this.updated=this.modified;}if(this.updated){s.push("<updated>"+dojo.date.stamp.toISOString(this.updated)+"</updated>\n");}if(this.published){s.push("<published>"+dojo.date.stamp.toISOString(this.published)+"</published>\n");}if(this.icon){s.push("<icon>"+this.icon+"</icon>\n");}if(this.language){s.push("<language>"+this.language+"</language>\n");}if(this.logo){s.push("<logo>"+this.logo+"</logo>\n");}if(this.subtitle){s.push(this.subtitle.toString());}if(this.tagline){s.push(this.tagline.toString());}var _bb=[this.alternateLinks,this.authors,this.categories,this.contributors,this.otherLinks,this.extensions,this.entries];for(i in _bb){if(_bb[i]){for(var x in _bb[i]){s.push(_bb[i][x]);}}}s.push("</feed>");return s.join("");},createEntry:function(){var _bc=new dojox.atom.io.model.Entry();_bc.feedUrl=this.getSelfHref();return _bc;},getSelfHref:function(){if(this.links===null||this.links.length===0){return null;}for(var x in this.links){if(this.links[x].rel&&this.links[x].rel=="self"){return this.links[x].href;}}return null;}});dojo.declare("dojox.atom.io.model.Service",dojox.atom.io.model.AtomItem,{constructor:function(_bd){this.href=_bd;},buildFromDom:function(_be){var i;this.workspaces=[];if(_be.tagName!="service"){return;}if(_be.namespaceURI!=dojox.atom.io.model._Constants.PURL_NS&&_be.namespaceURI!=dojox.atom.io.model._Constants.APP_NS){return;}var ns=_be.namespaceURI;this.name_space=_be.namespaceURI;var _bf;if(typeof (_be.getElementsByTagNameNS)!="undefined"){_bf=_be.getElementsByTagNameNS(ns,"workspace");}else{_bf=[];var _c0=_be.getElementsByTagName("workspace");for(i=0;i<_c0.length;i++){if(_c0[i].namespaceURI==ns){_bf.push(_c0[i]);}}}if(_bf&&_bf.length>0){var _c1=0;var _c2;for(i=0;i<_bf.length;i++){_c2=(typeof (_bf.item)==="undefined"?_bf[i]:_bf.item(i));var _c3=new dojox.atom.io.model.Workspace();_c3.buildFromDom(_c2);this.workspaces[_c1++]=_c3;}}},getCollection:function(url){for(var i=0;i<this.workspaces.length;i++){var _c4=this.workspaces[i].collections;for(var j=0;j<_c4.length;j++){if(_c4[j].href==url){return _c4;}}}return null;}});dojo.declare("dojox.atom.io.model.Workspace",dojox.atom.io.model.AtomItem,{constructor:function(_c5){this.title=_c5;this.collections=[];},buildFromDom:function(_c6){var _c7=dojox.atom.io.model.util.getNodename(_c6);if(_c7!="workspace"){return;}var c=_c6.childNodes;var len=0;for(var i=0;i<c.length;i++){var _c8=c[i];if(_c8.nodeType===1){_c7=dojox.atom.io.model.util.getNodename(_c8);if(_c8.namespaceURI==dojox.atom.io.model._Constants.PURL_NS||_c8.namespaceURI==dojox.atom.io.model._Constants.APP_NS){if(_c7==="collection"){var _c9=new dojox.atom.io.model.Collection();_c9.buildFromDom(_c8);this.collections[len++]=_c9;}}else{if(_c8.namespaceURI===dojox.atom.io.model._Constants.ATOM_NS){if(_c7==="title"){this.title=dojox.xml.parser.textContent(_c8);}}}}}}});dojo.declare("dojox.atom.io.model.Collection",dojox.atom.io.model.AtomItem,{constructor:function(_ca,_cb){this.href=_ca;this.title=_cb;this.attributes=[];this.features=[];this.children=[];this.memberType=null;this.id=null;},buildFromDom:function(_cc){this.href=_cc.getAttribute("href");var c=_cc.childNodes;for(var i=0;i<c.length;i++){var _cd=c[i];if(_cd.nodeType===1){var _ce=dojox.atom.io.model.util.getNodename(_cd);if(_cd.namespaceURI==dojox.atom.io.model._Constants.PURL_NS||_cd.namespaceURI==dojox.atom.io.model._Constants.APP_NS){if(_ce==="member-type"){this.memberType=dojox.xml.parser.textContent(_cd);}else{if(_ce=="feature"){if(_cd.getAttribute("id")){this.features.push(_cd.getAttribute("id"));}}else{var _cf=new dojox.atom.io.model.Node();_cf.buildFromDom(_cd);this.children.push(_cf);}}}else{if(_cd.namespaceURI===dojox.atom.io.model._Constants.ATOM_NS){if(_ce==="id"){this.id=dojox.xml.parser.textContent(_cd);}else{if(_ce==="title"){this.title=dojox.xml.parser.textContent(_cd);}}}}}}}});}if(!dojo._hasResource["dojo.date"]){dojo._hasResource["dojo.date"]=true;dojo.provide("dojo.date");dojo.date.getDaysInMonth=function(_d0){var _d1=_d0.getMonth();var _d2=[31,28,31,30,31,30,31,31,30,31,30,31];if(_d1==1&&dojo.date.isLeapYear(_d0)){return 29;}return _d2[_d1];};dojo.date.isLeapYear=function(_d3){var _d4=_d3.getFullYear();return !(_d4%400)||(!(_d4%4)&&!!(_d4%100));};dojo.date.getTimezoneName=function(_d5){var str=_d5.toString();var tz="";var _d6;var pos=str.indexOf("(");if(pos>-1){tz=str.substring(++pos,str.indexOf(")"));}else{var pat=/([A-Z\/]+) \d{4}$/;if((_d6=str.match(pat))){tz=_d6[1];}else{str=_d5.toLocaleString();pat=/ ([A-Z\/]+)$/;if((_d6=str.match(pat))){tz=_d6[1];}}}return (tz=="AM"||tz=="PM")?"":tz;};dojo.date.compare=function(_d7,_d8,_d9){_d7=new Date(+_d7);_d8=new Date(+(_d8||new Date()));if(_d9=="date"){_d7.setHours(0,0,0,0);_d8.setHours(0,0,0,0);}else{if(_d9=="time"){_d7.setFullYear(0,0,0);_d8.setFullYear(0,0,0);}}if(_d7>_d8){return 1;}if(_d7<_d8){return -1;}return 0;};dojo.date.add=function(_da,_db,_dc){var sum=new Date(+_da);var _dd=false;var _de="Date";switch(_db){case "day":break;case "weekday":var _df,_e0;var mod=_dc%5;if(!mod){_df=(_dc>0)?5:-5;_e0=(_dc>0)?((_dc-5)/5):((_dc+5)/5);}else{_df=mod;_e0=parseInt(_dc/5);}var _e1=_da.getDay();var adj=0;if(_e1==6&&_dc>0){adj=1;}else{if(_e1==0&&_dc<0){adj=-1;}}var _e2=_e1+_df;if(_e2==0||_e2==6){adj=(_dc>0)?2:-2;}_dc=(7*_e0)+_df+adj;break;case "year":_de="FullYear";_dd=true;break;case "week":_dc*=7;break;case "quarter":_dc*=3;case "month":_dd=true;_de="Month";break;default:_de="UTC"+_db.charAt(0).toUpperCase()+_db.substring(1)+"s";}if(_de){sum["set"+_de](sum["get"+_de]()+_dc);}if(_dd&&(sum.getDate()<_da.getDate())){sum.setDate(0);}return sum;};dojo.date.difference=function(_e3,_e4,_e5){_e4=_e4||new Date();_e5=_e5||"day";var _e6=_e4.getFullYear()-_e3.getFullYear();var _e7=1;switch(_e5){case "quarter":var m1=_e3.getMonth();var m2=_e4.getMonth();var q1=Math.floor(m1/3)+1;var q2=Math.floor(m2/3)+1;q2+=(_e6*4);_e7=q2-q1;break;case "weekday":var _e8=Math.round(dojo.date.difference(_e3,_e4,"day"));var _e9=parseInt(dojo.date.difference(_e3,_e4,"week"));var mod=_e8%7;if(mod==0){_e8=_e9*5;}else{var adj=0;var _ea=_e3.getDay();var _eb=_e4.getDay();_e9=parseInt(_e8/7);mod=_e8%7;var _ec=new Date(_e3);_ec.setDate(_ec.getDate()+(_e9*7));var _ed=_ec.getDay();if(_e8>0){switch(true){case _ea==6:adj=-1;break;case _ea==0:adj=0;break;case _eb==6:adj=-1;break;case _eb==0:adj=-2;break;case (_ed+mod)>5:adj=-2;}}else{if(_e8<0){switch(true){case _ea==6:adj=0;break;case _ea==0:adj=1;break;case _eb==6:adj=2;break;case _eb==0:adj=1;break;case (_ed+mod)<0:adj=2;}}}_e8+=adj;_e8-=(_e9*2);}_e7=_e8;break;case "year":_e7=_e6;break;case "month":_e7=(_e4.getMonth()-_e3.getMonth())+(_e6*12);break;case "week":_e7=parseInt(dojo.date.difference(_e3,_e4,"day")/7);break;case "day":_e7/=24;case "hour":_e7/=60;case "minute":_e7/=60;case "second":_e7/=1000;case "millisecond":_e7*=_e4.getTime()-_e3.getTime();}return Math.round(_e7);};}if(!dojo._hasResource["dojo.i18n"]){dojo._hasResource["dojo.i18n"]=true;dojo.provide("dojo.i18n");dojo.i18n.getLocalization=function(_ee,_ef,_f0){_f0=dojo.i18n.normalizeLocale(_f0);var _f1=_f0.split("-");var _f2=[_ee,"nls",_ef].join(".");var _f3=dojo._loadedModules[_f2];if(_f3){var _f4;for(var i=_f1.length;i>0;i--){var loc=_f1.slice(0,i).join("_");if(_f3[loc]){_f4=_f3[loc];break;}}if(!_f4){_f4=_f3.ROOT;}if(_f4){var _f5=function(){};_f5.prototype=_f4;return new _f5();}}throw new Error("Bundle not found: "+_ef+" in "+_ee+" , locale="+_f0);};dojo.i18n.normalizeLocale=function(_f6){var _f7=_f6?_f6.toLowerCase():dojo.locale;if(_f7=="root"){_f7="ROOT";}return _f7;};dojo.i18n._requireLocalization=function(_f8,_f9,_fa,_fb){var _fc=dojo.i18n.normalizeLocale(_fa);var _fd=[_f8,"nls",_f9].join(".");var _fe="";if(_fb){var _ff=_fb.split(",");for(var i=0;i<_ff.length;i++){if(_fc["indexOf"](_ff[i])==0){if(_ff[i].length>_fe.length){_fe=_ff[i];}}}if(!_fe){_fe="ROOT";}}var _100=_fb?_fe:_fc;var _101=dojo._loadedModules[_fd];var _102=null;if(_101){if(dojo.config.localizationComplete&&_101._built){return;}var _103=_100.replace(/-/g,"_");var _104=_fd+"."+_103;_102=dojo._loadedModules[_104];}if(!_102){_101=dojo["provide"](_fd);var syms=dojo._getModuleSymbols(_f8);var _105=syms.concat("nls").join("/");var _106;dojo.i18n._searchLocalePath(_100,_fb,function(loc){var _107=loc.replace(/-/g,"_");var _108=_fd+"."+_107;var _109=false;if(!dojo._loadedModules[_108]){dojo["provide"](_108);var _10a=[_105];if(loc!="ROOT"){_10a.push(loc);}_10a.push(_f9);var _10b=_10a.join("/")+".js";_109=dojo._loadPath(_10b,null,function(hash){var _10c=function(){};_10c.prototype=_106;_101[_107]=new _10c();for(var j in hash){_101[_107][j]=hash[j];}});}else{_109=true;}if(_109&&_101[_107]){_106=_101[_107];}else{_101[_107]=_106;}if(_fb){return true;}});}if(_fb&&_fc!=_fe){_101[_fc.replace(/-/g,"_")]=_101[_fe.replace(/-/g,"_")];}};(function(){var _10d=dojo.config.extraLocale;if(_10d){if(!_10d instanceof Array){_10d=[_10d];}var req=dojo.i18n._requireLocalization;dojo.i18n._requireLocalization=function(m,b,_10e,_10f){req(m,b,_10e,_10f);if(_10e){return;}for(var i=0;i<_10d.length;i++){req(m,b,_10d[i],_10f);}};}})();dojo.i18n._searchLocalePath=function(_110,down,_111){_110=dojo.i18n.normalizeLocale(_110);var _112=_110.split("-");var _113=[];for(var i=_112.length;i>0;i--){_113.push(_112.slice(0,i).join("-"));}_113.push(false);if(down){_113.reverse();}for(var j=_113.length-1;j>=0;j--){var loc=_113[j]||"ROOT";var stop=_111(loc);if(stop){break;}}};dojo.i18n._preloadLocalizations=function(_114,_115){function _116(_117){_117=dojo.i18n.normalizeLocale(_117);dojo.i18n._searchLocalePath(_117,true,function(loc){for(var i=0;i<_115.length;i++){if(_115[i]==loc){dojo["require"](_114+"_"+loc);return true;}}return false;});};_116();var _118=dojo.config.extraLocale||[];for(var i=0;i<_118.length;i++){_116(_118[i]);}};}if(!dojo._hasResource["dojo.cldr.supplemental"]){dojo._hasResource["dojo.cldr.supplemental"]=true;dojo.provide("dojo.cldr.supplemental");dojo.cldr.supplemental.getFirstDayOfWeek=function(_119){var _11a={mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,er:6,et:6,iq:6,ir:6,jo:6,ke:6,kw:6,lb:6,ly:6,ma:6,om:6,qa:6,sa:6,sd:6,so:6,tn:6,ye:6,as:0,au:0,az:0,bw:0,ca:0,cn:0,fo:0,ge:0,gl:0,gu:0,hk:0,ie:0,il:0,is:0,jm:0,jp:0,kg:0,kr:0,la:0,mh:0,mo:0,mp:0,mt:0,nz:0,ph:0,pk:0,sg:0,th:0,tt:0,tw:0,um:0,us:0,uz:0,vi:0,za:0,zw:0,et:0,mw:0,ng:0,tj:0,sy:4};var _11b=dojo.cldr.supplemental._region(_119);var dow=_11a[_11b];return (dow===undefined)?1:dow;};dojo.cldr.supplemental._region=function(_11c){_11c=dojo.i18n.normalizeLocale(_11c);var tags=_11c.split("-");var _11d=tags[1];if(!_11d){_11d={de:"de",en:"us",es:"es",fi:"fi",fr:"fr",he:"il",hu:"hu",it:"it",ja:"jp",ko:"kr",nl:"nl",pt:"br",sv:"se",zh:"cn"}[tags[0]];}else{if(_11d.length==4){_11d=tags[2];}}return _11d;};dojo.cldr.supplemental.getWeekend=function(_11e){var _11f={eg:5,il:5,sy:5,"in":0,ae:4,bh:4,dz:4,iq:4,jo:4,kw:4,lb:4,ly:4,ma:4,om:4,qa:4,sa:4,sd:4,tn:4,ye:4};var _120={ae:5,bh:5,dz:5,iq:5,jo:5,kw:5,lb:5,ly:5,ma:5,om:5,qa:5,sa:5,sd:5,tn:5,ye:5,af:5,ir:5,eg:6,il:6,sy:6};var _121=dojo.cldr.supplemental._region(_11e);var _122=_11f[_121];var end=_120[_121];if(_122===undefined){_122=6;}if(end===undefined){end=0;}return {start:_122,end:end};};}if(!dojo._hasResource["dojo.regexp"]){dojo._hasResource["dojo.regexp"]=true;dojo.provide("dojo.regexp");dojo.regexp.escapeString=function(str,_123){return str.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,function(ch){if(_123&&_123.indexOf(ch)!=-1){return ch;}return "\\"+ch;});};dojo.regexp.buildGroupRE=function(arr,re,_124){if(!(arr instanceof Array)){return re(arr);}var b=[];for(var i=0;i<arr.length;i++){b.push(re(arr[i]));}return dojo.regexp.group(b.join("|"),_124);};dojo.regexp.group=function(_125,_126){return "("+(_126?"?:":"")+_125+")";};}if(!dojo._hasResource["dojo.date.locale"]){dojo._hasResource["dojo.date.locale"]=true;dojo.provide("dojo.date.locale");(function(){function _127(_128,_129,_12a,_12b){return _12b.replace(/([a-z])\1*/ig,function(_12c){var s,pad,c=_12c.charAt(0),l=_12c.length,_12d=["abbr","wide","narrow"];switch(c){case "G":s=_129[(l<4)?"eraAbbr":"eraNames"][_128.getFullYear()<0?0:1];break;case "y":s=_128.getFullYear();switch(l){case 1:break;case 2:if(!_12a.fullYear){s=String(s);s=s.substr(s.length-2);break;}default:pad=true;}break;case "Q":case "q":s=Math.ceil((_128.getMonth()+1)/3);pad=true;break;case "M":var m=_128.getMonth();if(l<3){s=m+1;pad=true;}else{var _12e=["months","format",_12d[l-3]].join("-");s=_129[_12e][m];}break;case "w":var _12f=0;s=dojo.date.locale._getWeekOfYear(_128,_12f);pad=true;break;case "d":s=_128.getDate();pad=true;break;case "D":s=dojo.date.locale._getDayOfYear(_128);pad=true;break;case "E":var d=_128.getDay();if(l<3){s=d+1;pad=true;}else{var _130=["days","format",_12d[l-3]].join("-");s=_129[_130][d];}break;case "a":var _131=(_128.getHours()<12)?"am":"pm";s=_129[_131];break;case "h":case "H":case "K":case "k":var h=_128.getHours();switch(c){case "h":s=(h%12)||12;break;case "H":s=h;break;case "K":s=(h%12);break;case "k":s=h||24;break;}pad=true;break;case "m":s=_128.getMinutes();pad=true;break;case "s":s=_128.getSeconds();pad=true;break;case "S":s=Math.round(_128.getMilliseconds()*Math.pow(10,l-3));pad=true;break;case "v":case "z":s=dojo.date.locale._getZone(_128,true,_12a);if(s){break;}l=4;case "Z":var _132=dojo.date.locale._getZone(_128,false,_12a);var tz=[(_132<=0?"+":"-"),dojo.string.pad(Math.floor(Math.abs(_132)/60),2),dojo.string.pad(Math.abs(_132)%60,2)];if(l==4){tz.splice(0,0,"GMT");tz.splice(3,0,":");}s=tz.join("");break;default:throw new Error("dojo.date.locale.format: invalid pattern char: "+_12b);}if(pad){s=dojo.string.pad(s,l);}return s;});};dojo.date.locale._getZone=function(_133,_134,_135){if(_134){return dojo.date.getTimezoneName(_133);}else{return _133.getTimezoneOffset();}};dojo.date.locale.format=function(_136,_137){_137=_137||{};var _138=dojo.i18n.normalizeLocale(_137.locale),_139=_137.formatLength||"short",_13a=dojo.date.locale._getGregorianBundle(_138),str=[],_13b=dojo.hitch(this,_127,_136,_13a,_137);if(_137.selector=="year"){return _13c(_13a["dateFormatItem-yyyy"]||"yyyy",_13b);}var _13d;if(_137.selector!="date"){_13d=_137.timePattern||_13a["timeFormat-"+_139];if(_13d){str.push(_13c(_13d,_13b));}}if(_137.selector!="time"){_13d=_137.datePattern||_13a["dateFormat-"+_139];if(_13d){str.push(_13c(_13d,_13b));}}return str.length==1?str[0]:_13a["dateTimeFormat-"+_139].replace(/\{(\d+)\}/g,function(_13e,key){return str[key];});};dojo.date.locale.regexp=function(_13f){return dojo.date.locale._parseInfo(_13f).regexp;};dojo.date.locale._parseInfo=function(_140){_140=_140||{};var _141=dojo.i18n.normalizeLocale(_140.locale),_142=dojo.date.locale._getGregorianBundle(_141),_143=_140.formatLength||"short",_144=_140.datePattern||_142["dateFormat-"+_143],_145=_140.timePattern||_142["timeFormat-"+_143],_146;if(_140.selector=="date"){_146=_144;}else{if(_140.selector=="time"){_146=_145;}else{_146=_142["dateTimeFormat-"+_143].replace(/\{(\d+)\}/g,function(_147,key){return [_145,_144][key];});}}var _148=[],re=_13c(_146,dojo.hitch(this,_149,_148,_142,_140));return {regexp:re,tokens:_148,bundle:_142};};dojo.date.locale.parse=function(_14a,_14b){var info=dojo.date.locale._parseInfo(_14b),_14c=info.tokens,_14d=info.bundle,re=new RegExp("^"+info.regexp+"$",info.strict?"":"i"),_14e=re.exec(_14a);if(!_14e){return null;}var _14f=["abbr","wide","narrow"],_150=[1970,0,1,0,0,0,0],amPm="",_151=dojo.every(_14e,function(v,i){if(!i){return true;}var _152=_14c[i-1];var l=_152.length;switch(_152.charAt(0)){case "y":if(l!=2&&_14b.strict){_150[0]=v;}else{if(v<100){v=Number(v);var year=""+new Date().getFullYear(),_153=year.substring(0,2)*100,_154=Math.min(Number(year.substring(2,4))+20,99),num=(v<_154)?_153+v:_153-100+v;_150[0]=num;}else{if(_14b.strict){return false;}_150[0]=v;}}break;case "M":if(l>2){var _155=_14d["months-format-"+_14f[l-3]].concat();if(!_14b.strict){v=v.replace(".","").toLowerCase();_155=dojo.map(_155,function(s){return s.replace(".","").toLowerCase();});}v=dojo.indexOf(_155,v);if(v==-1){return false;}}else{v--;}_150[1]=v;break;case "E":case "e":var days=_14d["days-format-"+_14f[l-3]].concat();if(!_14b.strict){v=v.toLowerCase();days=dojo.map(days,function(d){return d.toLowerCase();});}v=dojo.indexOf(days,v);if(v==-1){return false;}break;case "D":_150[1]=0;case "d":_150[2]=v;break;case "a":var am=_14b.am||_14d.am;var pm=_14b.pm||_14d.pm;if(!_14b.strict){var _156=/\./g;v=v.replace(_156,"").toLowerCase();am=am.replace(_156,"").toLowerCase();pm=pm.replace(_156,"").toLowerCase();}if(_14b.strict&&v!=am&&v!=pm){return false;}amPm=(v==pm)?"p":(v==am)?"a":"";break;case "K":if(v==24){v=0;}case "h":case "H":case "k":if(v>23){return false;}_150[3]=v;break;case "m":_150[4]=v;break;case "s":_150[5]=v;break;case "S":_150[6]=v;}return true;});var _157=+_150[3];if(amPm==="p"&&_157<12){_150[3]=_157+12;}else{if(amPm==="a"&&_157==12){_150[3]=0;}}var _158=new Date(_150[0],_150[1],_150[2],_150[3],_150[4],_150[5],_150[6]);if(_14b.strict){_158.setFullYear(_150[0]);}var _159=_14c.join(""),_15a=_159.indexOf("d")!=-1,_15b=_159.indexOf("M")!=-1;if(!_151||(_15b&&_158.getMonth()>_150[1])||(_15a&&_158.getDate()>_150[2])){return null;}if((_15b&&_158.getMonth()<_150[1])||(_15a&&_158.getDate()<_150[2])){_158=dojo.date.add(_158,"hour",1);}return _158;};function _13c(_15c,_15d,_15e,_15f){var _160=function(x){return x;};_15d=_15d||_160;_15e=_15e||_160;_15f=_15f||_160;var _161=_15c.match(/(''|[^'])+/g),_162=_15c.charAt(0)=="'";dojo.forEach(_161,function(_163,i){if(!_163){_161[i]="";}else{_161[i]=(_162?_15e:_15d)(_163);_162=!_162;}});return _15f(_161.join(""));};function _149(_164,_165,_166,_167){_167=dojo.regexp.escapeString(_167);if(!_166.strict){_167=_167.replace(" a"," ?a");}return _167.replace(/([a-z])\1*/ig,function(_168){var s,c=_168.charAt(0),l=_168.length,p2="",p3="";if(_166.strict){if(l>1){p2="0"+"{"+(l-1)+"}";}if(l>2){p3="0"+"{"+(l-2)+"}";}}else{p2="0?";p3="0{0,2}";}switch(c){case "y":s="\\d{2,4}";break;case "M":s=(l>2)?"\\S+?":p2+"[1-9]|1[0-2]";break;case "D":s=p2+"[1-9]|"+p3+"[1-9][0-9]|[12][0-9][0-9]|3[0-5][0-9]|36[0-6]";break;case "d":s="[12]\\d|"+p2+"[1-9]|3[01]";break;case "w":s=p2+"[1-9]|[1-4][0-9]|5[0-3]";break;case "E":s="\\S+";break;case "h":s=p2+"[1-9]|1[0-2]";break;case "k":s=p2+"\\d|1[01]";break;case "H":s=p2+"\\d|1\\d|2[0-3]";break;case "K":s=p2+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":s="[0-5]\\d";break;case "S":s="\\d{"+l+"}";break;case "a":var am=_166.am||_165.am||"AM";var pm=_166.pm||_165.pm||"PM";if(_166.strict){s=am+"|"+pm;}else{s=am+"|"+pm;if(am!=am.toLowerCase()){s+="|"+am.toLowerCase();}if(pm!=pm.toLowerCase()){s+="|"+pm.toLowerCase();}if(s.indexOf(".")!=-1){s+="|"+s.replace(/\./g,"");}}s=s.replace(/\./g,"\\.");break;default:s=".*";}if(_164){_164.push(_168);}return "("+s+")";}).replace(/[\xa0 ]/g,"[\\s\\xa0]");};})();(function(){var _169=[];dojo.date.locale.addCustomFormats=function(_16a,_16b){_169.push({pkg:_16a,name:_16b});};dojo.date.locale._getGregorianBundle=function(_16c){var _16d={};dojo.forEach(_169,function(desc){var _16e=dojo.i18n.getLocalization(desc.pkg,desc.name,_16c);_16d=dojo.mixin(_16d,_16e);},this);return _16d;};})();dojo.date.locale.addCustomFormats("dojo.cldr","gregorian");dojo.date.locale.getNames=function(item,type,_16f,_170){var _171,_172=dojo.date.locale._getGregorianBundle(_170),_173=[item,_16f,type];if(_16f=="standAlone"){var key=_173.join("-");_171=_172[key];if(_171[0]==1){_171=undefined;}}_173[1]="format";return (_171||_172[_173.join("-")]).concat();};dojo.date.locale.isWeekend=function(_174,_175){var _176=dojo.cldr.supplemental.getWeekend(_175),day=(_174||new Date()).getDay();if(_176.end<_176.start){_176.end+=7;if(day<_176.start){day+=7;}}return day>=_176.start&&day<=_176.end;};dojo.date.locale._getDayOfYear=function(_177){return dojo.date.difference(new Date(_177.getFullYear(),0,1,_177.getHours()),_177)+1;};dojo.date.locale._getWeekOfYear=function(_178,_179){if(arguments.length==1){_179=0;}var _17a=new Date(_178.getFullYear(),0,1).getDay(),adj=(_17a-_179+7)%7,week=Math.floor((dojo.date.locale._getDayOfYear(_178)+adj-1)/7);if(_17a==_179){week++;}return week;};}if(!dojo._hasResource["dojox.date.posix"]){dojo._hasResource["dojox.date.posix"]=true;dojo.provide("dojox.date.posix");dojox.date.posix.strftime=function(_17b,_17c,_17d){var _17e=null;var _17f=function(s,n){return dojo.string.pad(s,n||2,_17e||"0");};var _180=dojo.date.locale._getGregorianBundle(_17d);var $=function(_181){switch(_181){case "a":return dojo.date.locale.getNames("days","abbr","format",_17d)[_17b.getDay()];case "A":return dojo.date.locale.getNames("days","wide","format",_17d)[_17b.getDay()];case "b":case "h":return dojo.date.locale.getNames("months","abbr","format",_17d)[_17b.getMonth()];case "B":return dojo.date.locale.getNames("months","wide","format",_17d)[_17b.getMonth()];case "c":return dojo.date.locale.format(_17b,{formatLength:"full",locale:_17d});case "C":return _17f(Math.floor(_17b.getFullYear()/100));case "d":return _17f(_17b.getDate());case "D":return $("m")+"/"+$("d")+"/"+$("y");case "e":if(_17e==null){_17e=" ";}return _17f(_17b.getDate());case "f":if(_17e==null){_17e=" ";}return _17f(_17b.getMonth()+1);case "g":break;case "G":dojo.unimplemented("unimplemented modifier 'G'");break;case "F":return $("Y")+"-"+$("m")+"-"+$("d");case "H":return _17f(_17b.getHours());case "I":return _17f(_17b.getHours()%12||12);case "j":return _17f(dojo.date.locale._getDayOfYear(_17b),3);case "k":if(_17e==null){_17e=" ";}return _17f(_17b.getHours());case "l":if(_17e==null){_17e=" ";}return _17f(_17b.getHours()%12||12);case "m":return _17f(_17b.getMonth()+1);case "M":return _17f(_17b.getMinutes());case "n":return "\n";case "p":return _180[_17b.getHours()<12?"am":"pm"];case "r":return $("I")+":"+$("M")+":"+$("S")+" "+$("p");case "R":return $("H")+":"+$("M");case "S":return _17f(_17b.getSeconds());case "t":return "\t";case "T":return $("H")+":"+$("M")+":"+$("S");case "u":return String(_17b.getDay()||7);case "U":return _17f(dojo.date.locale._getWeekOfYear(_17b));case "V":return _17f(dojox.date.posix.getIsoWeekOfYear(_17b));case "W":return _17f(dojo.date.locale._getWeekOfYear(_17b,1));case "w":return String(_17b.getDay());case "x":return dojo.date.locale.format(_17b,{selector:"date",formatLength:"full",locale:_17d});case "X":return dojo.date.locale.format(_17b,{selector:"time",formatLength:"full",locale:_17d});case "y":return _17f(_17b.getFullYear()%100);case "Y":return String(_17b.getFullYear());case "z":var _182=_17b.getTimezoneOffset();return (_182>0?"-":"+")+_17f(Math.floor(Math.abs(_182)/60))+":"+_17f(Math.abs(_182)%60);case "Z":return dojo.date.getTimezoneName(_17b);case "%":return "%";}};var _183="";var i=0;var _184=0;var _185=null;while((_184=_17c.indexOf("%",i))!=-1){_183+=_17c.substring(i,_184++);switch(_17c.charAt(_184++)){case "_":_17e=" ";break;case "-":_17e="";break;case "0":_17e="0";break;case "^":_185="upper";break;case "*":_185="lower";break;case "#":_185="swap";break;default:_17e=null;_184--;break;}var _186=$(_17c.charAt(_184++));switch(_185){case "upper":_186=_186.toUpperCase();break;case "lower":_186=_186.toLowerCase();break;case "swap":var _187=_186.toLowerCase();var _188="";var ch="";for(var j=0;j<_186.length;j++){ch=_186.charAt(j);_188+=(ch==_187.charAt(j))?ch.toUpperCase():ch.toLowerCase();}_186=_188;break;default:break;}_185=null;_183+=_186;i=_184;}_183+=_17c.substring(i);return _183;};dojox.date.posix.getStartOfWeek=function(_189,_18a){if(isNaN(_18a)){_18a=dojo.cldr.supplemental.getFirstDayOfWeek?dojo.cldr.supplemental.getFirstDayOfWeek():0;}var _18b=_18a;if(_189.getDay()>=_18a){_18b-=_189.getDay();}else{_18b-=(7-_189.getDay());}var date=new Date(_189);date.setHours(0,0,0,0);return dojo.date.add(date,"day",_18b);};dojox.date.posix.setIsoWeekOfYear=function(_18c,week){if(!week){return _18c;}var _18d=dojox.date.posix.getIsoWeekOfYear(_18c);var _18e=week-_18d;if(week<0){var _18f=dojox.date.posix.getIsoWeeksInYear(_18c);_18e=(_18f+week+1)-_18d;}return dojo.date.add(_18c,"week",_18e);};dojox.date.posix.getIsoWeekOfYear=function(_190){var _191=dojox.date.posix.getStartOfWeek(_190,1);var _192=new Date(_190.getFullYear(),0,4);_192=dojox.date.posix.getStartOfWeek(_192,1);var diff=_191.getTime()-_192.getTime();if(diff<0){return dojox.date.posix.getIsoWeeksInYear(_191);}return Math.ceil(diff/604800000)+1;};dojox.date.posix.getIsoWeeksInYear=function(_193){function p(y){return y+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400);};var y=_193.getFullYear();return (p(y)%7==4||p(y-1)%7==3)?53:52;};}if(!dojo._hasResource["com.realitybuilder.Block"]){dojo._hasResource["com.realitybuilder.Block"]=true;"use strict";dojo.provide("com.realitybuilder.Block");dojo.declare("com.realitybuilder.Block",null,{_INITIAL_EDGES:[[0,1,0,true],[1,2,1,true],[2,3,2,false],[3,0,3,false],[4,5,4,false],[5,6,5,false],[6,7,6,false],[7,4,7,false],[0,4,8,false],[1,5,9,true],[2,6,10,false],[3,7,11,false]],_positionB:null,_camera:null,_edges:null,_BORDER_EDGES:[[2,3,2],[3,0,3],[0,4,8],[4,5,4],[5,6,5],[2,6,10]],_BORDER_VERTEX_INDEXES:[2,3,0,4,5,6],_verticesB:null,_verticesV:null,_verticesS:null,_boundingBoxS:null,_lastCameraId:null,constructor:function(_194,_195,_196){this._positionB=_195;this._camera=_194;this._edges=this._INITIAL_EDGES;},positionB:function(){return this._positionB;},xB:function(){return this._positionB[0];},yB:function(){return this._positionB[1];},zB:function(){return this._positionB[2];},_updateWorldSpace:function(){var xB=this.positionB()[0],yB=this.positionB()[1],zB=this.positionB()[2],vs=[];vs.push(com.realitybuilder.util.blockToWorld([xB,yB,zB]));vs.push(com.realitybuilder.util.blockToWorld([xB,yB+2,zB]));vs.push(com.realitybuilder.util.blockToWorld([xB+2,yB+2,zB]));vs.push(com.realitybuilder.util.blockToWorld([xB+2,yB,zB]));vs.push(com.realitybuilder.util.blockToWorld([xB,yB,zB+1]));vs.push(com.realitybuilder.util.blockToWorld([xB,yB+2,zB+1]));vs.push(com.realitybuilder.util.blockToWorld([xB+2,yB+2,zB+1]));vs.push(com.realitybuilder.util.blockToWorld([xB+2,yB,zB+1]));this._verticesB=vs;},_updateViewSpace:function(){this._updateWorldSpace();this._verticesV=dojo.map(this._verticesB,dojo.hitch(this._camera,this._camera.worldToView));},_sensorSpaceNeedsToBeUpdated:function(){return this._lastCameraId!==this._camera.id();},_onSensorSpaceUpdated:function(){this._lastCameraId=this._camera.id();},updateSensorSpace:function(){if(this._sensorSpaceNeedsToBeUpdated()){this._updateViewSpace();this._verticesS=dojo.map(this._verticesV,dojo.hitch(this._camera,this._camera.viewToSensor));this._updateSensorSpaceBoundingBox();this._onSensorSpaceUpdated();return true;}else{return false;}},boundingBoxS:function(){this.updateSensorSpace();return this._boundingBoxS;},_updateSensorSpaceBoundingBox:function(){var minX=Number.MAX_VALUE,minY=Number.MAX_VALUE,maxX=Number.MIN_VALUE,maxY=Number.MIN_VALUE;dojo.forEach(this._verticesS,function(_197){if(_197[0]<minX){minX=_197[0];}else{if(_197[0]>maxX){maxX=_197[0];}}if(_197[1]<minY){minY=_197[1];}else{if(_197[1]>maxY){maxY=_197[1];}}});this._boundingBoxS=[[minX,minY],[maxX,maxY]];},render:function(_198,_199){var _19a,_19b,_19c;this.updateSensorSpace();_19a=this._verticesS;dojo.forEach(this._edges,function(edge){_19b=_19a[edge[0]];_19c=_19a[edge[1]];_198.globalAlpha=edge[3]?0.2:1;_198.strokeStyle=_199;_198.beginPath();_198.moveTo(_19b[0],_19b[1]);_198.lineTo(_19c[0],_19c[1]);_198.stroke();});}});}if(!dojo._hasResource["com.realitybuilder.ConstructionBlock"]){dojo._hasResource["com.realitybuilder.ConstructionBlock"]=true;"use strict";dojo.provide("com.realitybuilder.ConstructionBlock");dojo.declare("com.realitybuilder.ConstructionBlock",com.realitybuilder.Block,{_state:null,_timeStamp:null,constructor:function(_19d,_19e,_19f,_1a0){this._state=_19f;this._timeStamp=_1a0;},timeStamp:function(){return this._timeStamp;},isDeleted:function(){return this._state===0;},isPending:function(){return this._state===1;},isReal:function(){return this._state===2;},state:function(){return this._state;},render:function(_1a1){if(!this.isDeleted()){var _1a2=this.isReal()?"green":"white";this.inherited(arguments,[arguments[0],_1a2]);}},subtract:function(_1a3){var _1a4,x,y;this.updateSensorSpace();_1a3.globalCompositeOperation="destination-out";_1a3.fillStyle="black";_1a4=this._verticesS;_1a3.beginPath();dojo.forEach(this._BORDER_VERTEX_INDEXES,function(_1a5,i){x=_1a4[_1a5][0];y=_1a4[_1a5][1];if(i===0){_1a3.moveTo(x,y);}else{_1a3.lineTo(x,y);}});_1a3.closePath();_1a3.fill();_1a3.globalCompositeOperation="source-over";}});}if(!dojo._hasResource["com.realitybuilder.util"]){dojo._hasResource["com.realitybuilder.util"]=true;"use strict";dojo.provide("com.realitybuilder.util");com.realitybuilder.util.TOLERANCE_S=0.5;com.realitybuilder.util.GRID_SPACING_X=8;com.realitybuilder.util.GRID_SPACING_Y=8;com.realitybuilder.util.HEIGHT=9.6;com.realitybuilder.util.blockToWorld=function(_1a6){var gX=com.realitybuilder.util.GRID_SPACING_X,gY=com.realitybuilder.util.GRID_SPACING_Y,h=com.realitybuilder.util.HEIGHT;return [_1a6[0]*gX,_1a6[1]*gY,_1a6[2]*h];};com.realitybuilder.util.pointIsBetween=function(_1a7,_1a8,_1a9){var _1aa=(_1a7[0]>=_1a8[0]&&_1a7[0]<=_1a9[0])||(_1a7[0]<=_1a8[0]&&_1a7[0]>=_1a9[0]),_1ab=(_1a7[1]>=_1a8[1]&&_1a7[1]<=_1a9[1])||(_1a7[1]<=_1a8[1]&&_1a7[1]>=_1a9[1]);return _1aa&&_1ab;};com.realitybuilder.util.pointsIdenticalS=function(_1ac,_1ad){return (Math.abs(_1ac[0]-_1ad[0])<com.realitybuilder.util.TOLERANCE_S&&Math.abs(_1ac[1]-_1ad[1])<com.realitybuilder.util.TOLERANCE_S);};com.realitybuilder.util.pointsIdenticalB=function(_1ae,_1af){return ((_1ae[0]-_1af[0])===0&&(_1ae[1]-_1af[1])===0&&(_1ae[2]-_1af[2])===0);};com.realitybuilder.util.subtractVectors=function(_1b0,_1b1){return [_1b0[0]-_1b1[0],_1b0[1]-_1b1[1],_1b0[2]-_1b1[2]];};com.realitybuilder.util.addVectorsB=function(_1b2,_1b3){return [_1b2[0]+_1b3[0],_1b2[1]+_1b3[1],_1b2[2]+_1b3[2]];};com.realitybuilder.util.subtractVectorsB=function(_1b4,_1b5){return [_1b4[0]-_1b5[0],_1b4[1]-_1b5[1],_1b4[2]-_1b5[2]];};com.realitybuilder.util.withDuplicatesRemoved=function(_1b6){var _1b7=[],i,j,_1b8,_1b9,_1ba;for(i=0;i<_1b6.length;i+=1){_1b8=_1b6[i];_1ba=false;for(j=i+1;j<_1b6.length;j+=1){_1b9=_1b6[j];if(com.realitybuilder.util.pointsIdenticalS(_1b8,_1b9)){_1ba=true;break;}}if(!_1ba){_1b7.push(_1b8);}}return _1b7;};com.realitybuilder.util.intersectionSegmentLine=function(_1bb,line){var x1=_1bb[0][0],y1=_1bb[0][1],x2=_1bb[1][0],y2=_1bb[1][1],x3=line[0][0],y3=line[0][1],x4=line[1][0],y4=line[1][1],u1=(x4-x3)*(y1-y3)-(y4-y3)*(x1-x3),u2=(y4-y3)*(x2-x1)-(x4-x3)*(y2-y1),_1bc=0.01,u,x,y;if(Math.abs(u2)<_1bc){if(Math.abs(u1)<_1bc){return [x1,y1];}else{return false;}}else{u=u1/u2;if(u>-_1bc&&u<1+_1bc){x=x1+u*(x2-x1);y=y1+u*(y2-y1);return [x,y];}else{return false;}}};com.realitybuilder.util.cartesianToPolar=function(_1bd){var x=_1bd[0],y=_1bd[1],_1be=Math.atan2(y,x),_1bf=Math.sqrt(x*x+y*y);return [_1be,_1bf];};com.realitybuilder.util.addS=function(_1c0,_1c1){return [_1c0[0]+_1c1[0],_1c0[1]+_1c1[1]];};com.realitybuilder.util.polarToCartesian=function(_1c2){var _1c3=_1c2[0],_1c4=_1c2[1],x=_1c4*Math.cos(_1c3),y=_1c4*Math.sin(_1c3);return [x,y];};com.realitybuilder.addPrefix=function(_1c5,_1c6){var tmp=[],i;for(i in _1c6){if(_1c6.hasOwnProperty(i)){tmp[_1c5.toString()+i.toString()]=_1c6[i];}}return tmp;};com.realitybuilder.hasExplorerCanvasLoaded=function(){return (typeof G_vmlCanvasManager!=="undefined");};com.realitybuilder.isCanvasSupported=function(){return (document.createElement("canvas").getContext||com.realitybuilder.hasExplorerCanvasLoaded());};com.realitybuilder.aboutMessage=function(){return "<p><a href=\"about\">About the Reality Builder</a></p>";};com.realitybuilder.showNoCanvasErrorMessage=function(){dojo.attr("noCanvasErrorMessage","innerHTML","<p class=\"first\">The Reality Builder does not work because your "+"browser does not support the <a "+"href=\"http://www.w3.org/TR/html5/the-canvas-element.html\">Canvas "+"element</a>.</p>"+com.realitybuilder.aboutMessage());};com.realitybuilder.showNoImagesErrorMessage=function(){dojo.attr("noImagesErrorMessage","innerHTML","<p class=\"first\">The Reality Builder does not work because your "+"browser does not load images.</p>"+com.realitybuilder.aboutMessage());};}if(!dojo._hasResource["com.realitybuilder.ConstructionBlocks"]){dojo._hasResource["com.realitybuilder.ConstructionBlocks"]=true;"use strict";dojo.provide("com.realitybuilder.ConstructionBlocks");dojo.declare("com.realitybuilder.ConstructionBlocks",null,{_versionOnServer:"-1",_construction:null,_blocks:null,_realBlocksSorted:null,_pendingBlocks:null,_realBlocksCanvas:null,_pendingBlocksCanvas:null,constructor:function(_1c7){this._blocks=[];this._realBlocksSorted=[];this._construction=_1c7;var _1c8=_1c7.camera().sensor();this._realBlocksCanvas=_1c8.realBlocksCanvas();this._pendingBlocksCanvas=_1c8.pendingBlocksCanvas();},blocks:function(){return this._blocks;},pendingBlocks:function(){return this._pendingBlocks;},realBlocksSorted:function(){return this._realBlocksSorted;},versionOnServer:function(){return this._versionOnServer;},hasAlreadyBeenUpdatedWithServerData:function(){return this._versionOnServer!=="-1";},updateWithServerData:function(_1c9){this._versionOnServer=_1c9.version;var _1ca=this._construction.camera();this._blocks=dojo.map(_1c9.blocks,function(bd){return new com.realitybuilder.ConstructionBlock(_1ca,[bd.xB,bd.yB,bd.zB],bd.state,bd.timeStamp);});this._updateRealBlocksSorted();this._updatePendingBlocks();dojo.publish("com/realitybuilder/ConstructionBlocks/changed");},_sortByHeight:function(_1cb,_1cc){if(_1cb.zB()>_1cc.zB()){return -1;}else{if(_1cb.zB()<_1cc.zB()){return 1;}else{return 0;}}},_updateRealBlocksSorted:function(_1cd){var tmp=dojo.filter(this._blocks,function(_1ce){return _1ce.isReal();});tmp.sort(this._sortByHeight);this._realBlocksSorted=tmp;},_updatePendingBlocks:function(_1cf){this._pendingBlocks=dojo.filter(this._blocks,function(_1d0){return _1d0.isPending();});},blockAt:function(_1d1){var _1d2=this.blocks(),_1d3,i;for(i=0;i<_1d2.length;i+=1){_1d3=_1d2[i];if(com.realitybuilder.util.pointsIdenticalB(_1d1,_1d3.positionB())){return _1d3;}}return false;},realBlockIntersectionState:function(_1d4){var xB,yB,zB,_1d5,_1d6,_1d7,_1d8,_1d9,_1da,i;xB=_1d4[0];yB=_1d4[1];zB=_1d4[2];_1d5=this._realBlocksSorted;for(i=0;i<_1d5.length;i+=1){_1d6=_1d5[i];_1d7=_1d6.positionB();_1d8=_1d7[0];_1d9=_1d7[1];_1da=_1d7[2];if(com.realitybuilder.util.pointsIdenticalB(_1d4,_1d7)){return 1;}else{if(xB>=_1d8-1&&xB<=_1d8+1&&yB>=_1d9-1&&yB<=_1d9+1&&zB===_1da){return 2;}}}return 0;},_makePendingOnServerSucceeded:function(){dojo.publish("com/realitybuilder/ConstructionBlocks/changedOnServer");},_makePendingOnServerFailed:function(){dojo.publish("com/realitybuilder/ConstructionBlocks/changeOnServerFailed");},makePendingOnServer:function(_1db){dojo.xhrPost({url:"/admin/rpc/make_pending",content:{"xB":_1db[0],"yB":_1db[1],"zB":_1db[2]},load:dojo.hitch(this,this._makePendingOnServerSucceeded),error:dojo.hitch(this,this._makePendingOnServerFailed)});},_createPendingOnServerSucceeded:function(){dojo.publish("com/realitybuilder/ConstructionBlocks/changedOnServer");},_createPendingOnServerFailed:function(){dojo.publish("com/realitybuilder/ConstructionBlocks/changeOnServerFailed");},createPendingOnServer:function(_1dc){dojo.xhrPost({url:"/rpc/create_pending",content:{"xB":_1dc[0],"yB":_1dc[1],"zB":_1dc[2]},load:dojo.hitch(this,this._createPendingOnServerSucceeded),error:dojo.hitch(this,this._createPendingOnServerFailed)});},_deleteOnServerSucceeded:function(){dojo.publish("com/realitybuilder/ConstructionBlocks/changedOnServer");},_deleteOnServerFailed:function(){dojo.publish("com/realitybuilder/ConstructionBlocks/changeOnServerFailed");},deleteOnServer:function(_1dd){dojo.xhrPost({url:"/admin/rpc/delete",content:{"xB":_1dd[0],"yB":_1dd[1],"zB":_1dd[2]},load:dojo.hitch(this,this._deleteOnServerSucceeded),error:dojo.hitch(this,this._deleteOnServerFailed)});},_makeRealOnServerSucceeded:function(){dojo.publish("com/realitybuilder/ConstructionBlocks/changedOnServer");},_makeRealOnServerFailed:function(){dojo.publish("com/realitybuilder/ConstructionBlocks/changeOnServerFailed");},makeRealOnServer:function(_1de){dojo.xhrPost({url:"/admin/rpc/make_real",content:{"xB":_1de[0],"yB":_1de[1],"zB":_1de[2]},load:dojo.hitch(this,this._makeRealOnServerSucceeded),error:dojo.hitch(this,this._makeRealOnServerFailed)});},setBlockStateOnServer:function(_1df,_1e0){switch(_1e0){case 0:this.deleteOnServer(_1df);break;case 1:this.makePendingOnServer(_1df);break;case 2:this.makeRealOnServer(_1df);break;}},zBOfUpperSideOfRealBlockBelow:function(xB,yB,zB){var _1e1,_1e2,_1e3,bXB,bYB,bZB;_1e1=this._realBlocksSorted;_1e2=zB-1;_1e3=0;dojo.forEach(_1e1,function(b){bXB=b.xB();bYB=b.yB();bZB=b.zB();if(bZB+1<=_1e2&&xB>=bXB&&xB<=bXB+1&&yB>=bYB&&yB<=bYB+1&&bZB+1>_1e3){_1e3=bZB+1;}});return _1e3;},_renderBlocks:function(_1e4,_1e5){if(_1e4.getContext){var _1e6=_1e4.getContext("2d");_1e6.clearRect(0,0,_1e4.width,_1e4.height);dojo.forEach(_1e5,function(b){b.render(_1e6);});}},render:function(){this._renderBlocks(this._realBlocksCanvas,this._realBlocksSorted);this._renderBlocks(this._pendingBlocksCanvas,this._pendingBlocks);}});}if(!dojo._hasResource["com.realitybuilder.ShadowPart"]){dojo._hasResource["com.realitybuilder.ShadowPart"]=true;"use strict";dojo.provide("com.realitybuilder.ShadowPart");dojo.declare("com.realitybuilder.ShadowPart",null,{_newBlock:null,_vertices:null,_verticesV:null,_verticesS:null,_camera:null,_boundingBoxS:null,_points:null,_constructionBlocks:null,_xB:null,_yB:null,_zB:null,_deltaXB:null,_deltaYB:null,constructor:function(_1e7,_1e8,_1e9,_1ea,_1eb){this._deltaXB=_1e7;this._deltaYB=_1e8;this._newBlock=_1e9;this._camera=_1ea;this._constructionBlocks=_1eb;},zB:function(){return this._zB;},positionB:function(){return [this._newBlock.xB(),this._newBlock.yB(),this._zB];},_updateWorldSpace:function(){var xB=this._newBlock.xB()+this._deltaXB,yB=this._newBlock.yB()+this._deltaYB,zB=this._constructionBlocks.zBOfUpperSideOfRealBlockBelow(xB,yB,this._newBlock.zB()+1),_1ec=[[0,0],[1,0],[1,1],[0,1]];this._vertices=dojo.map(_1ec,function(rVB){return com.realitybuilder.util.blockToWorld([xB+rVB[0],yB+rVB[1],zB]);});this._xB=xB;this._yB=yB;this._zB=zB;},_updateViewSpace:function(){this._updateWorldSpace();this._verticesV=dojo.map(this._vertices,dojo.hitch(this._camera,this._camera.worldToView));},updateSensorSpace:function(){this._updateViewSpace();this._verticesS=dojo.map(this._verticesV,dojo.hitch(this._camera,this._camera.viewToSensor));this._updateSensorSpaceBoundingBox();},_boundingBoxesOverlap:function(_1ed){var bBS=_1ed.boundingBoxS();return (this._boundingBoxS[1][0]>=bBS[0][0]&&this._boundingBoxS[0][0]<=bBS[1][0]&&this._boundingBoxS[1][1]>=bBS[0][1]&&this._boundingBoxS[0][1]<=bBS[1][1]);},_anyVertexInBoundingBox:function(_1ee){var bBS=_1ee.boundingBoxS(),i,vS;for(i=0;i<this._verticesS.length;i+=1){vS=this._verticesS[i];if(vS[0]>=bBS[0][0]&&vS[0]<=bBS[1][0]&&vS[1]>=bBS[0][1]&&vS[1]<=bBS[1][1]){return true;}}return false;},_updateSensorSpaceBoundingBox:function(){var minX=Number.MAX_VALUE,minY=Number.MAX_VALUE,maxX=Number.MIN_VALUE,maxY=Number.MIN_VALUE;dojo.forEach(this._verticesS,function(tmp){if(tmp[0]<minX){minX=tmp[0];}else{if(tmp[0]>maxX){maxX=tmp[0];}}if(tmp[1]<minY){minY=tmp[1];}else{if(tmp[1]>maxY){maxY=tmp[1];}}});this._boundingBoxS=[[minX,minY],[maxX,maxY]];},_isCuttingBlock:function(_1ef){return (_1ef.xB()>=this._xB-1&&_1ef.yB()<=this._yB+1&&_1ef.zB()>=this._zB);},_subtractRealBlocks:function(_1f0){var _1f1=this._constructionBlocks.realBlocksSorted(),i,_1f2;for(i=0;i<_1f1.length;i+=1){_1f2=_1f1[i];if(_1f2.zB()<this._zB){break;}if(this._isCuttingBlock(_1f2)){if(this._boundingBoxesOverlap(_1f2)&&this._anyVertexInBoundingBox(_1f2)){_1f2.subtract(_1f0);}}}},render:function(_1f3){var _1f4=this._verticesS,i;_1f3.fillStyle="rgba(255,0,0,0.2)";_1f3.beginPath();_1f3.moveTo(_1f4[0][0],_1f4[0][1]);for(i=1;i<4;i+=1){_1f3.lineTo(_1f4[i][0],_1f4[i][1]);}_1f3.closePath();_1f3.fill();this._subtractRealBlocks(_1f3);}});}if(!dojo._hasResource["com.realitybuilder.Shadow"]){dojo._hasResource["com.realitybuilder.Shadow"]=true;"use strict";dojo.provide("com.realitybuilder.Shadow");dojo.declare("com.realitybuilder.Shadow",null,{_newBlock:null,_shadowParts:null,_camera:null,_constructionBlocks:null,constructor:function(_1f5,_1f6,_1f7){var i,_1f8,_1f9;this._newBlock=_1f5;this._camera=_1f6;this._constructionBlocks=_1f7;this._shadowParts=[];i=0;for(_1f8=0;_1f8<2;_1f8+=1){for(_1f9=0;_1f9<2;_1f9+=1){this._shadowParts[i]=new com.realitybuilder.ShadowPart(_1f8,_1f9,_1f5,_1f6,_1f7);i+=1;}}},_sortByHeight:function(_1fa,_1fb){if(_1fa.zB()>_1fb.zB()){return 1;}else{if(_1fa.zB()<_1fb.zB()){return -1;}else{return 0;}}},_updateSensorSpace:function(){dojo.forEach(this._shadowParts,function(_1fc){_1fc.updateSensorSpace();});},_sortShadowParts:function(){this._shadowParts.sort(this._sortByHeight);},render:function(){var _1fd=this._camera.sensor().shadowCanvas(),_1fe;this._updateSensorSpace();this._sortShadowParts();if(_1fd.getContext){_1fe=_1fd.getContext("2d");_1fe.clearRect(0,0,_1fd.width,_1fd.height);dojo.forEach(this._shadowParts,function(_1ff){_1ff.render(_1fe);});}},clear:function(){var _200=this._camera.sensor().shadowCanvas(),_201;if(_200.getContext){_201=_200.getContext("2d");_201.clearRect(0,0,_200.width,_200.height);}}});}if(!dojo._hasResource["com.realitybuilder.NewBlock"]){dojo._hasResource["com.realitybuilder.NewBlock"]=true;"use strict";dojo.provide("com.realitybuilder.NewBlock");dojo.declare("com.realitybuilder.NewBlock",com.realitybuilder.Block,{_BUILD_SPACE_1B:[-1,-1,0],_BUILD_SPACE_2B:[11,11,6],_state:null,_constructionBlocks:null,_shadow:null,_camera:null,_lastPositionB:null,_lastState:null,_lastConstructionBlocksVersion:null,constructor:function(_202,_203,_204){this._state=1;this._constructionBlocks=_204;this._shadow=new com.realitybuilder.Shadow(this,_202,_204);this._camera=_202;},_sensorSpaceNeedsToBeUpdated:function(){return (this._lastPositionB===null||!com.realitybuilder.util.pointsIdenticalB(this._lastPositionB,this._positionB)||this.inherited(arguments));},_onSensorSpaceUpdated:function(){this._lastPositionB=dojo.clone(this._positionB);this.inherited(arguments);},move:function(_205){if(!this.wouldGoOutOfRange(_205)){this._positionB=com.realitybuilder.util.addVectorsB(this._positionB,_205);}dojo.publish("com/realitybuilder/NewBlock/moved");},isMovable:function(){return this._state===1;},isStopped:function(){return this._state===0;},stop:function(){this._state=0;dojo.publish("com/realitybuilder/NewBlock/stopped");},makeMovable:function(){this._state=1;dojo.publish("com/realitybuilder/NewBlock/madeMovable");},updatePositionB:function(){var _206=this._constructionBlocks.realBlockIntersectionState(this._positionB),_207;if(_206!==0){_207=this._positionB[2]+1;while(this._wouldIntersectWithRealBlock([this._positionB[0],this._positionB[1],_207])){_207+=1;}this._positionB[2]=_207;}},wouldGoOutOfRange:function(_208){var _209=com.realitybuilder.util.addVectorsB(this._positionB,_208);return (this._wouldIntersectWithRealBlock(_209)||!this._wouldBeInMoveSpace(_209));},_wouldBeInMoveSpace:function(_20a){var b1B=this._BUILD_SPACE_1B,b2B=this._BUILD_SPACE_2B;return (_20a[0]>=b1B[0]-2&&_20a[0]<=b2B[0]&&_20a[1]>=b1B[1]-2&&_20a[1]<=b2B[1]&&_20a[2]>=0&&_20a[2]<=b2B[2]+1);},_isInBuildSpace:function(){var xB=this._positionB[0],yB=this._positionB[1],zB=this._positionB[2],b1B=this._BUILD_SPACE_1B,b2B=this._BUILD_SPACE_2B;return (xB>=b1B[0]&&xB<=b2B[0]-2&&yB>=b1B[1]&&yB<=b2B[1]-2&&zB>=b1B[2]&&zB<=b2B[2]);},_isAttachable:function(){var xB=this._positionB[0],yB=this._positionB[1],zB=this._positionB[2];return (this._wouldIntersectWithRealBlock([xB,yB,zB-1])||this._wouldIntersectWithRealBlock([xB,yB,zB+1])||zB===0);},canBeMadeReal:function(){return this._isInBuildSpace()&&this._isAttachable();},_wouldIntersectWithRealBlock:function(_20b){return (this._constructionBlocks.realBlockIntersectionState(_20b)!==0);},_boundingBoxesOverlap:function(_20c){return ((this._boundingBoxS[1][0]>=_20c._boundingBoxS[0][0])&&(this._boundingBoxS[0][0]<=_20c._boundingBoxS[1][0])&&(this._boundingBoxS[1][1]>=_20c._boundingBoxS[0][1])&&(this._boundingBoxS[0][1]<=_20c._boundingBoxS[1][1]));},_anyVertexInBoundingBox:function(_20d){var _20e=this._verticesS,i,vS;for(i=0;i<_20e.length;i+=1){vS=_20e[i];if(vS[0]>=_20d._boundingBoxS[0][0]&&vS[0]<=_20d._boundingBoxS[1][0]&&vS[1]>=_20d._boundingBoxS[0][1]&&vS[1]<=_20d._boundingBoxS[1][1]){return true;}}return false;},_intersectionLineBlock:function(line,_20f){var ips=[],bvsS=_20f._verticesS,_210,p;dojo.forEach(this._BORDER_EDGES,function(edge){_210=[bvsS[edge[0]],bvsS[edge[1]]];p=com.realitybuilder.util.intersectionSegmentLine(_210,line);if(p){ips.push(p);}});return com.realitybuilder.util.withDuplicatesRemoved(ips);},_subtractFromEdge:function(edge,_211){var _212=this._verticesS,_213=_212[edge[0]],_214=_212[edge[1]],line=[_213,_214],_215=this._intersectionLineBlock(line,_211),_216,_217,_218,_219,_21a,_21b,_21c;if(_215.length<2){return edge;}else{_216=_215[0];_217=_215[1];_218=com.realitybuilder.util.pointIsBetween(_213,_216,_217);_219=com.realitybuilder.util.pointIsBetween(_214,_216,_217);if(_218&&_219){return false;}if(!_218&&!_219){return edge;}_21a=com.realitybuilder.util.pointIsBetween(_216,_213,_214);_21b=_212.push(_218?_214:_213)-1;_21c=_212.push(_21a?_216:_217)-1;return [_21b,_21c,edge[2],edge[3]];}},_borderTouchesBorder:function(_21d){var _21e=[],_21f,i,j;_21e[0]=com.realitybuilder.util.subtractVectorsB(_21d.positionB(),this._positionB);_21e[1]=com.realitybuilder.util.subtractVectorsB(this._positionB,_21d.positionB());_21f=[[-1,2,1],[0,2,1],[1,2,1],[2,2,0],[2,1,-1],[2,0,-1],[2,-1,-1]];for(i=0;i<2;i+=1){for(j=0;j<7;j+=1){if(com.realitybuilder.util.pointsIdenticalB(_21e[i],_21f[j])){return true;}}}return false;},_edgeIsInsideEdgeAndTouchedByBorder:function(edge,_220){var _221=com.realitybuilder.util.subtractVectorsB(_220.positionB(),this._positionB),_222=[],i;switch(edge[2]){case 7:_222=[[-1,0,1],[0,0,1],[1,0,1],[-1,-2,0],[0,-2,0],[1,-2,0]];break;case 6:_222=[[0,-1,1],[0,0,1],[0,1,1],[2,-1,0],[2,0,0],[2,1,0]];break;case 11:_222=[[0,-2,0],[2,0,0]];break;default:return false;}for(i=0;i<_222.length;i+=1){if(com.realitybuilder.util.pointsIdenticalB(_221,_222[i])){return true;}}return false;},_edgeShouldNotBeCut:function(edge,_223){return this._edgeIsInsideEdgeAndTouchedByBorder(edge,_223);},_subtract:function(_224){var _225=[],that=this,_226;dojo.forEach(this._edges,function(edge){if(!that._edgeShouldNotBeCut(edge,_224)){_226=that._subtractFromEdge(edge,_224);if(_226){_225.push(_226);}}else{_225.push(edge);}});this._edges=_225;},_isCuttingBlock:function(_227){return (_227.xB()>=this.xB()-1&&_227.yB()<=this.yB()+1&&_227.zB()>=this.zB());},_fulfillsBlockSpaceHidingConditions:function(_228){return (this._isCuttingBlock(_228)&&!this._borderTouchesBorder(_228));},_removeHiddenLines:function(){var _229,i,_22a;this._edges=this._INITIAL_EDGES;_229=this._constructionBlocks.realBlocksSorted();for(i=0;i<_229.length;i+=1){_22a=_229[i];if(_22a.zB()<this.zB()){break;}if(this._fulfillsBlockSpaceHidingConditions(_22a)){_22a.updateSensorSpace();if(this._boundingBoxesOverlap(_22a)&&this._anyVertexInBoundingBox(_22a)){this._subtract(_22a);this._updateSensorSpaceBoundingBox();}}}},_renderShadow:function(_22b,_22c){var _22d=(this._lastConstructionBlocksVersion!==this._constructionBlocks.versionOnServer());if(_22b||_22c||_22d){if(this.isMovable()){this._shadow.render();}else{this._shadow.clear();}}this._lastConstructionBlocksVersion=this._constructionBlocks.versionOnServer();},render:function(){var _22e=this._camera.sensor().newBlockCanvas(),_22f=this.updateSensorSpace(),_230=(this._lastState!==this._state),_231,_232;if(_22f){this._removeHiddenLines();}if(_22e.getContext){_231=_22e.getContext("2d");_232=this.isMovable()?"red":"white";if(!dojo.isIE){this._renderShadow(_230,_22f);}if(_22f||_230){_231.clearRect(0,0,_22e.width,_22e.height);this.inherited(arguments,[_231,_232]);}}this._lastState=this._state;}});}if(!dojo._hasResource["com.realitybuilder.Image"]){dojo._hasResource["com.realitybuilder.Image"]=true;"use strict";dojo.provide("com.realitybuilder.Image");dojo.declare("com.realitybuilder.Image",null,{_versionOnServer:"-1",_url:"",_updateIntervalClient:5,_updateIntervalServer:5,_node:null,_onloadHandle:null,_imageLoaded:false,constructor:function(_233){this._node=dojo.byId("live");this._node.style.width=_233.sensor().width()+"px";this._node.style.height=_233.sensor().height()+"px";this._onloadHandle=dojo.connect(this._node,"onload",this,this._onFirstImageLoad);this._refresh();},imageLoaded:function(){return this._imageLoaded;},versionOnServer:function(){return this._versionOnServer;},url:function(){return this._url;},updateIntervalServer:function(){return this._updateIntervalServer;},updateIntervalClient:function(){return this._updateIntervalClient;},updateWithServerData:function(_234){this._versionOnServer=_234.version;this._updateIntervalClient=_234.updateIntervalClient;this._updateIntervalServer=_234.updateIntervalServer;this._url=_234.url;this._backgroundImageInterval=_234.updateIntervalClient*1000;dojo.publish("com/realitybuilder/Image/changed");},_onFirstImageLoad:function(){this._imageLoaded=true;dojo.disconnect(this._onloadHandle);},_refresh:function(){this._node.src="/images/live.jpg?nocache="+Math.random().toString();setTimeout(dojo.hitch(this,this._refresh),this._updateIntervalClient*1000);this._refreshed=true;}});}if(!dojo._hasResource["com.realitybuilder.Sensor"]){dojo._hasResource["com.realitybuilder.Sensor"]=true;"use strict";dojo.provide("com.realitybuilder.Sensor");dojo.declare("com.realitybuilder.Sensor",null,{_realBlocksCanvas:null,_pendingBlocksCanvas:null,_shadowCanvas:null,_newBlockCanvas:null,_width:null,_height:null,constructor:function(_235,_236){this._realBlocksCanvas=dojo.byId("sensorRealBlocksCanvas");this._pendingBlocksCanvas=dojo.byId("sensorPendingBlocksCanvas");this._shadowCanvas=dojo.byId("sensorShadowCanvas");this._newBlockCanvas=dojo.byId("sensorNewBlockCanvas");this._width=_235;this._height=_236;this._setCanvasesDimensions();var _237=dojo.byId("view");_237.style.width=_235+"px";_237.style.height=_236+"px";},_setCanvasesDimensions:function(){var _238=[this._realBlocksCanvas,this._pendingBlocksCanvas,this._shadowCanvas,this._newBlockCanvas],_239=this._width,_23a=this._height;dojo.forEach(_238,function(_23b){dojo.attr(_23b,"width",_239);dojo.attr(_23b,"height",_23a);dojo.style(_23b,"width",_239+"px");dojo.style(_23b,"height",_23a+"px");});},realBlocksCanvas:function(){return this._realBlocksCanvas;},pendingBlocksCanvas:function(){return this._pendingBlocksCanvas;},shadowCanvas:function(){return this._shadowCanvas;},newBlockCanvas:function(){return this._newBlockCanvas;},_setCanvasVisibility:function(_23c,show){dojo.style(_23c,"visibility",show?"visible":"hidden");},showRealBlocks:function(show){this._setCanvasVisibility(this._realBlocksCanvas,show);},showPendingBlocks:function(show){this._setCanvasVisibility(this._pendingBlocksCanvas,show);},width:function(){return this._width;},height:function(){return this._height;}});}if(!dojo._hasResource["com.realitybuilder.Camera"]){dojo._hasResource["com.realitybuilder.Camera"]=true;"use strict";dojo.provide("com.realitybuilder.Camera");dojo.declare("com.realitybuilder.Camera",null,{_position:null,_aX:0,_aY:0,_aZ:0,_fl:1,_sensorResolution:100,_rZ:null,_rX:null,_rZYX:null,_sensor:null,_versionOnServer:"-1",_id:null,constructor:function(_23d,_23e){this._position=[0,0,1];this._sensor=new com.realitybuilder.Sensor(_23d,_23e);this._updateRotationMatrices();},_updateId:function(){this._id=Math.random().toString();},sensor:function(){return this._sensor;},versionOnServer:function(){return this._versionOnServer;},version:function(){},hasAlreadyBeenUpdatedWithServerData:function(){return this._versionOnServer!=="-1";},position:function(){return this._position;},aX:function(){return this._aX;},aY:function(){return this._aY;},aZ:function(){return this._aZ;},fl:function(){return this._fl;},sensorResolution:function(){return this._sensorResolution;},id:function(){return this._id;},update:function(data){this._position=[data.x,data.y,data.z];this._aX=data.aX;this._aY=data.aY;this._aZ=data.aZ;this._fl=data.fl;this._sensorResolution=data.sensorResolution;this._updateRotationMatrices();this._updateId();dojo.publish("com/realitybuilder/Camera/changed");},updateWithServerData:function(_23f){this._versionOnServer=_23f.version;this.update(_23f);},_updateRotationMatrices:function(){this._rX=[[1,0,0],[0,Math.cos(-this._aX),Math.sin(-this._aX)],[0,-Math.sin(-this._aX),Math.cos(-this._aX)]];this._rY=[[Math.cos(-this._aY),0,Math.sin(-this._aY)],[0,1,0],[-Math.sin(-this._aY),0,Math.cos(-this._aY)]];this._rZ=[[Math.cos(-this._aZ),Math.sin(-this._aZ),0],[-Math.sin(-this._aZ),Math.cos(-this._aZ),0],[0,0,1]];var rYX=dojox.math.matrix.multiply(this._rY,this._rX);this._rZYX=dojox.math.matrix.multiply(this._rZ,rYX);},worldToView:function(_240){var tmp=com.realitybuilder.util.subtractVectors(_240,this._position);tmp=dojox.math.matrix.transpose([tmp]);tmp=dojox.math.matrix.multiply(this._rZYX,tmp);tmp=dojox.math.matrix.transpose(tmp)[0];return tmp;},scale:function(zV){return this._sensorResolution*this._fl/zV;},viewToSensor:function(_241){var tmp=_241,_242;_242=this.scale(tmp[2]);tmp[0]*=_242;tmp[1]*=_242;tmp[0]+=this._sensor.width()/2;tmp[1]+=this._sensor.height()/2;return [tmp[0],tmp[1]];},blockToSensor:function(_243){return this.viewToSensor(this.worldToView(com.realitybuilder.util.blockToWorld(_243)));}});}if(!dojo._hasResource["com.realitybuilder.CoordinateButton"]){dojo._hasResource["com.realitybuilder.CoordinateButton"]=true;"use strict";dojo.provide("com.realitybuilder.CoordinateButton");dojo.declare("com.realitybuilder.CoordinateButton",null,{_highlightColor:"red",_standardColor:"white",_sideLengthS:37,_radiusS:17.5,centerS:null,_canvas:null,_group:null,_plus:null,_newBlock:null,_coordinate:null,_disabled:true,_onclickHandle:null,_deltaB:null,constructor:function(_244,_245,_246,plus,_247){this.centerS=_245;this._plus=plus;this._newBlock=_244;this._coordinate=_246;this._computeDeltaB();this._createNode();},highlight:function(){if(!this._disabled){this._render(this._highlightColor);}},unhighlight:function(){this._render(this._standardColor);},radiusS:function(){return this._radiusS;},move:function(_248){var l=this._sideLengthS;this._canvas.style.left=(_248[0]-l/2)+"px";this._canvas.style.top=(_248[1]-l/2)+"px";this.centerS=_248;},update:function(_249){var _24a,i;if(_249){this._disable();}else{_24a=[];for(i=0;i<3;i+=1){_24a[i]=(i===this._coordinate)?this._delta():0;}if(this._newBlock.wouldGoOutOfRange(_24a)){this._disable();}else{this._enable();}}},moveNewBlock:function(){this._newBlock.move(this._deltaB);},_computeDeltaB:function(){this._deltaB=[];for(var i=0;i<3;i+=1){this._deltaB[i]=(i===this._coordinate)?this._delta():0;}},_direction:function(){return (this._plus?1:-1);},_delta:function(){return this._direction();},_disable:function(){if(!this._disabled){dojo.disconnect(this._onclickHandle);this._render(this._standardColor);this._disabled=true;}},_enable:function(){if(this._disabled){this._onclickHandle=dojo.connect(this._canvas,"onclick",this,this.moveNewBlock);this._disabled=false;}},_drawRectangle:function(_24b){_24b.createRect({x1:0,y1:0,x2:_24b.width,y2:_24b.height}).setFill([0,0,0,0]);},_createNode:function(){var l=this._sideLengthS;this._canvas=dojo.create("canvas",{width:l,height:l,style:{position:"absolute",left:(this.centerS[0]-l/2)+"px",top:(this.centerS[1]-l/2)+"px"}},"coordinateControls");if(dojo.isIE){G_vmlCanvasManager.initElement(this._canvas);}dojo.connect(this._canvas,"onmouseover",this,this.highlight);dojo.connect(this._canvas,"onmouseout",this,this.unhighlight);this._render(this._standardColor);},_render:function(_24c){var _24d=this._canvas,l=this._sideLengthS,_24e;if(_24d.getContext){_24e=_24d.getContext("2d");_24e.clearRect(0,0,_24d.width,_24d.height);_24e.strokeStyle=_24c;_24e.beginPath();_24e.arc(l/2,l/2,this._radiusS,0,Math.PI*2,true);_24e.stroke();if(this._plus){_24e.moveTo(l/2,4);_24e.lineTo(l/2,l-4);_24e.stroke();}_24e.moveTo(4,l/2);_24e.lineTo(l-4,l/2);_24e.stroke();}}});}if(!dojo._hasResource["com.realitybuilder.CoordinateControls"]){dojo._hasResource["com.realitybuilder.CoordinateControls"]=true;"use strict";dojo.provide("com.realitybuilder.CoordinateControls");dojo.declare("com.realitybuilder.CoordinateControls",null,{_coordinateButtons:null,_newBlock:null,_canvas:null,_camera:null,constructor:function(_24f,_250){this._newBlock=_24f;this._camera=_250;this._coordinateButtons=[];this._canvas=dojo.byId("coordinateControlsCanvas");this._setCanvasDimensions();this.render();},_setCanvasDimensions:function(){var _251=this._camera.sensor(),_252=_251.width(),_253=_251.height();dojo.attr(this._canvas,"width",_252);dojo.attr(this._canvas,"height",_253);dojo.style(this._canvas,"width",_252+"px");dojo.style(this._canvas,"height",_253+"px");},update:function(_254){var cbs=this._coordinateButtons;dojo.forEach(cbs,function(cb){cb.update(_254);});},render:function(){if(this._canvas.getContext){var _255=this._canvas.getContext("2d");_255.clearRect(0,0,this._canvas.width,this._canvas.height);}this._renderButtonPair(0,[3,-1.5,0],[7,-1.5,0]);this._renderButtonPair(1,[11.5,3,0],[11.5,7,0]);this._renderButtonPair(2,[0,-1.5,1],[0,-1.5,4]);},_renderLine:function(_256,_257){var _258,_259,_25a,_25b,_25c,_25d,_25e,_25f,_260,_261,_262,_263;_258=_256.centerS;_259=_257.centerS;_25a=_256.radiusS();_25b=[_259[0]-_258[0],_259[1]-_258[1]];_25c=com.realitybuilder.util.cartesianToPolar(_25b);_25d=_25c[0];_25e=_25c[1];_25f=com.realitybuilder.util.polarToCartesian([_25d,_25a+0.5]);_260=com.realitybuilder.util.polarToCartesian([_25d,_25e-_25a-0.5]);_261=com.realitybuilder.util.addS(_258,_25f);_262=com.realitybuilder.util.addS(_258,_260);if(this._canvas.getContext){_263=this._canvas.getContext("2d");_263.strokeStyle="white";_263.beginPath();_263.moveTo(_261[0],_261[1]);_263.lineTo(_262[0],_262[1]);_263.stroke();}},_renderButton:function(_264,plus,_265){var _266=this._camera.blockToSensor(_265),i=2*_264+(plus?1:0),_267;if(this._coordinateButtons[i]){_267=this._coordinateButtons[i];_267.move(_266);}else{_267=new com.realitybuilder.CoordinateButton(this._newBlock,_266,_264,plus);this._coordinateButtons[i]=_267;}return _267;},_renderButtonPair:function(_268,_269,_26a){var _26b=this._renderButton(_268,false,_269),_26c=this._renderButton(_268,true,_26a);this._renderLine(_26b,_26c);}});}if(!dojo._hasResource["com.realitybuilder.UserControls"]){dojo._hasResource["com.realitybuilder.UserControls"]=true;"use strict";dojo.provide("com.realitybuilder.UserControls");dojo.declare("com.realitybuilder.UserControls",null,{_construction:null,_node:null,constructor:function(_26d){this._construction=_26d;this._coordinateControls=new com.realitybuilder.CoordinateControls(_26d.newBlock(),_26d.camera());this._node=dojo.byId("userControls");dojo.connect(dojo.byId("requestReal"),"onclick",_26d,_26d.requestReal);},updateCoordinateControls:function(_26e){this._coordinateControls.update(_26e);},renderCoordinateControls:function(){this._coordinateControls.render();},updateRequestRealButton:function(){var _26f=dojo.byId("requestReal"),_270=this._construction.newBlock();if(_270.isMovable()&&_270.canBeMadeReal()){dojo.style(_26f,"visibility","visible");}else{dojo.style(_26f,"visibility","hidden");}},updateStatusMessage:function(_271){var html="",_272=this._construction.newBlock();switch(_271){case 0:if(_272.canBeMadeReal()){html="To request having the block built in its current "+"position, make it real.";}else{html="Move the block to a position where you want it to be "+"built.";}break;case 1:html="Your request is being processed. Be patient...";break;case 2:html="Your block has been built. Continue...";break;case 3:html="Your request has been denied. Continue...";break;}dojo.byId("status").innerHTML=html;}});}if(!dojo._hasResource["com.realitybuilder.AdminControls"]){dojo._hasResource["com.realitybuilder.AdminControls"]=true;"use strict";dojo.provide("com.realitybuilder.AdminControls");dojo.declare("com.realitybuilder.AdminControls",null,{_construction:null,constructor:function(_273){this._construction=_273;dojo.byId("bottomBar").style.width=_273.camera().sensor().width()+"px";this.updateToggleRealButton();this.updateTogglePendingButton();dojo.connect(dojo.byId("saveSettingsButton"),"onclick",this._construction,this._construction.storeSettingsOnServer);dojo.connect(dojo.byId("previewCameraButton"),"onclick",this,this.updateCamera);dojo.connect(dojo.byId("toggleRealButton"),"onclick",this._construction,this._construction.toggleReal);dojo.connect(dojo.byId("togglePendingButton"),"onclick",this._construction,this._construction.togglePending);dojo.connect(dojo.byId("logoutButton"),"onclick",this,this.logOut);},logOut:function(){location.href=logoutUrl;},updateToggleRealButton:function(){dojo.byId("toggleRealButton").innerHTML=(this._construction.showReal()?"Hide":"Show")+" Real Blocks";},updateTogglePendingButton:function(){dojo.byId("togglePendingButton").innerHTML=(this._construction.showPending()?"Hide":"Show")+" Pending Blocks";},updateCameraControls:function(_274){var _275=_274.position();dojo.byId("cameraX").value=_275[0];dojo.byId("cameraY").value=_275[1];dojo.byId("cameraZ").value=_275[2];dojo.byId("cameraAX").value=_274.aX();dojo.byId("cameraAY").value=_274.aY();dojo.byId("cameraAZ").value=_274.aZ();dojo.byId("cameraFl").value=_274.fl();dojo.byId("cameraSensorResolution").value=_274.sensorResolution();},updateImageControls:function(_276){dojo.byId("imageURL").value=_276.url();dojo.byId("imageUpdateIntervalServer").value=_276.updateIntervalServer();dojo.byId("imageUpdateIntervalClient").value=_276.updateIntervalClient();},readImageControls:function(){var data={"url":dojo.byId("imageURL").value||"","updateIntervalServer":parseFloat(dojo.byId("imageUpdateIntervalServer").value)||5,"updateIntervalClient":parseFloat(dojo.byId("imageUpdateIntervalClient").value)||5};return data;},readCameraControls:function(){var data={"x":parseFloat(dojo.byId("cameraX").value)||0,"y":parseFloat(dojo.byId("cameraY").value)||0,"z":parseFloat(dojo.byId("cameraZ").value)||0,"aX":parseFloat(dojo.byId("cameraAX").value)||0,"aY":parseFloat(dojo.byId("cameraAY").value)||0,"aZ":parseFloat(dojo.byId("cameraAZ").value)||0,"fl":parseFloat(dojo.byId("cameraFl").value)||1,"sensorResolution":parseFloat(dojo.byId("cameraSensorResolution").value)||100};return data;},updateCamera:function(){this._construction.camera().update(this.readCameraControls());},updateCoordinateDisplays:function(){var _277=this._construction.newBlock().positionB();dojo.byId("newBlockX").innerHTML=_277[0].toString();dojo.byId("newBlockY").innerHTML=_277[1].toString();dojo.byId("newBlockZ").innerHTML=_277[2].toString();},_sortForTable:function(x,y){if(x.state()===y.state()){if(x.timeStamp()>y.timeStamp()){return -1;}else{if(x.timeStamp()<y.timeStamp()){return 1;}else{return 0;}}}else{if(x.state()===1){return -1;}else{if(x.state()===2){return y.state()===1?1:-1;}else{return 1;}}}},_blocksSortedForTable:function(){var tmp=dojo.map(this._construction.constructionBlocks().blocks(),function(_278){return _278;});tmp.sort(this._sortForTable);return tmp;},_applyStateFromStateSelector:function(_279,_27a){this._construction.constructionBlocks().setBlockStateOnServer(_27a.positionB(),parseInt(_279.value,10));},_stateSelector:function(_27b){var _27c=document.createElement("select"),_27d=["Deleted","Pending","Real"],_27e,_27f,_280;dojo.attr(_27c,"size",1);for(_27e=0;_27e<3;_27e+=1){_27f=_27d[_27e];_280=document.createElement("option");dojo.attr(_280,"value",_27e);if(_27e===_27b.state()){dojo.attr(_280,"selected","");}_280.innerHTML=_27f;_27c.appendChild(_280);}dojo.connect(_27c,"onchange",this,function(_281){this._applyStateFromStateSelector(_27c,_27b);});return _27c;},_appendBlocksTableRow:function(_282,_283){var _284=_282.positionB(),row=document.createElement("tr"),date=new Date(_282.timeStamp()*1000),_285=dojox.date.posix.strftime(date,"%Y-%m-%d %H:%M:%S"),_286=[_284[0],_284[1],_284[2],_285,this._stateSelector(_282)],cell;dojo.forEach(_286,function(_287,i){cell=document.createElement("td");if(i<4){cell.innerHTML=_287;}else{cell.appendChild(_287);}if(i<3){dojo.addClass(cell,"number");}row.appendChild(cell);});_283.appendChild(row);},updateBlocksTable:function(){var _288=dojo.query("#blocksTable tbody"),_289=_288[0],_28a=this._blocksSortedForTable(),that=this;dojo.empty(_289);dojo.forEach(_28a,function(_28b){that._appendBlocksTableRow(_28b,_289);});}});}if(!dojo._hasResource["com.realitybuilder.Construction"]){dojo._hasResource["com.realitybuilder.Construction"]=true;"use strict";dojo.provide("com.realitybuilder.Construction");dojo.declare("com.realitybuilder.Construction",null,{_showAdminControls:null,_constructionBlocks:null,_responseToLastRequest:null,_UPDATE_INTERVAL:2000,_CHECK_IF_HAS_LOADED_INTERVAL:500,_showReal:null,_showPending:null,_newBlock:null,_camera:null,_image:null,_userControls:null,_adminControls:null,_updateTimeout:null,constructor:function(_28c){this._insertLoadIndicator();this._insertView();this._showAdminControls=_28c;this._responseToLastRequest=0;this._showReal=_28c;this._showPending=_28c;this._camera=new com.realitybuilder.Camera(640,480);this._image=new com.realitybuilder.Image(this._camera);this._constructionBlocks=new com.realitybuilder.ConstructionBlocks(this);this._newBlock=new com.realitybuilder.NewBlock(this._camera,[8,0,7],this._constructionBlocks,!this._showAdminControls);this._userControls=new com.realitybuilder.UserControls(this);if(this._showAdminControls){this._adminControls=new com.realitybuilder.AdminControls(this);dojo.subscribe("com/realitybuilder/ConstructionBlocks/changeOnServerFailed",this._adminControls,this._adminControls.updateBlocksTable);}dojo.subscribe("com/realitybuilder/ConstructionBlocks/changedOnServer",this,this._update);dojo.subscribe("com/realitybuilder/NewBlock/stopped",this,this._onNewBlockStopped);dojo.subscribe("com/realitybuilder/NewBlock/madeMovable",this,this._onNewBlockMadeMovable);dojo.subscribe("com/realitybuilder/NewBlock/moved",this,this._onNewBlockMoved);dojo.subscribe("com/realitybuilder/ConstructionBlocks/changed",this,this._onConstructionBlocksChanged);dojo.subscribe("com/realitybuilder/Camera/changed",this,this._onCameraChanged);dojo.subscribe("com/realitybuilder/Image/changed",this,this._onImageChanged);this._setupDemoFunctionality();this._update();this._checkIfHasLoaded();},newBlock:function(){return this._newBlock;},camera:function(){return this._camera;},showPending:function(){return this._showPending;},showReal:function(){return this._showReal;},constructionBlocks:function(){return this._constructionBlocks;},_onNewBlockStopped:function(){this._newBlock.render();this._userControls.updateCoordinateControls(true);},_onNewBlockMadeMovable:function(){this._newBlock.render();this._userControls.updateCoordinateControls(false);},requestReal:function(){if(this._newBlock.isMovable()){this._newBlock.stop();this._constructionBlocks.createPendingOnServer(this._newBlock.positionB());this._responseToLastRequest=1;}this._userControls.updateRequestRealButton();this._userControls.updateStatusMessage(this._responseToLastRequest);},toggleReal:function(){this._showReal=!this._showReal;this._camera.sensor().showRealBlocks(this._showReal);this._adminControls.updateToggleRealButton();},togglePending:function(){this._showPending=!this._showPending;this._camera.sensor().showPendingBlocks(this._showPending);this._adminControls.updateTogglePendingButton();},_onDemoKeyPress:function(_28d){if(_28d.shiftKey&&_28d.keyCode===dojo.keys.F11){this._constructionBlocks.setBlockStateOnServer(this._newBlock.positionB(),2);}},_setupDemoFunctionality:function(){dojo.connect(null,"onkeypress",dojo.hitch(this,this._onDemoKeyPress));},_onNewBlockMoved:function(){this._newBlock.render();this._userControls.updateRequestRealButton();this._userControls.updateStatusMessage(this._responseToLastRequest);this._userControls.updateCoordinateControls();if(this._showAdminControls){this._adminControls.updateCoordinateDisplays();}},_updateNewBlockPositionAndState:function(){var _28e=this._newBlock.positionB(),tmp,_28f;if(this._newBlock.isStopped()){tmp=this._constructionBlocks.blockAt(_28e);}this._newBlock.updatePositionB();if(this._showAdminControls){this._adminControls.updateCoordinateDisplays();}if(this._newBlock.isStopped()){if(tmp&&!tmp.isDeleted()){_28f=tmp.state();if(_28f===2){this._responseToLastRequest=2;this._newBlock.makeMovable();}else{this._responseToLastRequest=1;}}else{this._responseToLastRequest=3;this._newBlock.makeMovable();}}},_onConstructionBlocksChanged:function(){this._updateNewBlockPositionAndState();this._userControls.updateRequestRealButton();this._userControls.updateCoordinateControls(!this._newBlock.isMovable());this._userControls.updateStatusMessage(this._responseToLastRequest);if(this._showAdminControls){this._adminControls.updateBlocksTable();}if(this._camera.hasAlreadyBeenUpdatedWithServerData()){if(this._showAdminControls){this._constructionBlocks.render();}this._newBlock.render();}},_onCameraChanged:function(){if(this._showAdminControls){this._adminControls.updateCameraControls(this._camera);}this._userControls.renderCoordinateControls();if(this._constructionBlocks.hasAlreadyBeenUpdatedWithServerData()){if(this._showAdminControls){this._constructionBlocks.render();}this._newBlock.render();}},_onImageChanged:function(){if(this._showAdminControls){this._adminControls.updateImageControls(this._image);}},_insertLoadIndicator:function(){dojo.attr("loadIndicator","innerHTML","Loading...");},_requestRealButtonHtml:function(){var tmp1,tmp2;if(dojo.isIE&&dojo.isIE===6){tmp1="a href=\"javascript:void(0)\"";tmp2="a";}else{tmp1=tmp2="div";}return "<"+tmp1+" id=\"requestReal\" >Make Real</"+tmp2+">";},_insertView:function(){dojo.attr("view","innerHTML","<img id=\"live\" src=\"/images/placeholder.gif\" alt=\"Live Image\">"+"<div id=\"sensor\">"+"<canvas id=\"sensorShadowCanvas\" width=\"1\" height=\"1\">"+"</canvas>"+"<canvas id=\"sensorRealBlocksCanvas\" width=\"1\" height=\"1\">"+"</canvas>"+"<canvas id=\"sensorPendingBlocksCanvas\" width=\"1\" height=\"1\">"+"</canvas>"+"<canvas id=\"sensorNewBlockCanvas\" width=\"1\" height=\"1\">"+"</canvas>"+"</div>"+"<div id=\"coordinateControls\">"+"<canvas id=\"coordinateControlsCanvas\" width=\"1\" height=\"1\">"+"</canvas>"+"</div>"+"<p id=\"status\"></p>"+this._requestRealButtonHtml()+"<a id=\"about\" href=\"about\">About</a>");if(dojo.isIE){G_vmlCanvasManager.initElement(dojo.byId("sensorShadowCanvas"));G_vmlCanvasManager.initElement(dojo.byId("sensorRealBlocksCanvas"));G_vmlCanvasManager.initElement(dojo.byId("sensorPendingBlocksCanvas"));G_vmlCanvasManager.initElement(dojo.byId("sensorNewBlockCanvas"));G_vmlCanvasManager.initElement(dojo.byId("coordinateControlsCanvas"));}},_checkIfHasLoaded:function(){if(this._camera.hasAlreadyBeenUpdatedWithServerData()&&this._constructionBlocks.hasAlreadyBeenUpdatedWithServerData()&&this._image.imageLoaded()){dojo.destroy(dojo.byId("loadIndicator"));this._unhideContent();}else{setTimeout(dojo.hitch(this,this._checkIfHasLoaded),this._CHECK_IF_HAS_LOADED_INTERVAL);}},_updateSucceeded:function(data,_290){if(data.blocksData.changed){this._constructionBlocks.updateWithServerData(data.blocksData,this._image);}if(data.cameraData.changed){this._camera.updateWithServerData(data.cameraData);}if(data.imageData.changed){this._image.updateWithServerData(data.imageData);}if(this._updateTimeout){clearTimeout(this._updateTimeout);}this._updateTimeout=setTimeout(dojo.hitch(this,this._update),this._UPDATE_INTERVAL);},_update:function(){var _291=this._showAdminControls?"true":"false";dojo.xhrGet({url:"/rpc/construction",content:{"blocksDataVersion":this._constructionBlocks.versionOnServer(),"getDeletedBlocks":_291,"cameraDataVersion":this._camera.versionOnServer(),"imageDataVersion":this._image.versionOnServer()},handleAs:"json",load:dojo.hitch(this,this._updateSucceeded)});},_unhideContent:function(){var _292=dojo.byId("content"),_293=(!dojo.isIE||dojo.isIE>8),_294;if(_293){dojo.style(_292,"opacity","0");}dojo.style(_292,"width","auto");dojo.style(_292,"height","auto");if(dojo.isIE&&dojo.isIE<=7){dojo.style(_292,"zoom","1");}if(_293){_294={node:_292,duration:1000};dojo.fadeIn(_294).play();}},_storeSettingsOnServerSucceeded:function(){this._update();},storeSettingsOnServer:function(){var _295=com.realitybuilder.addPrefix("image.",this._adminControls.readImageControls()),_296=com.realitybuilder.addPrefix("camera.",this._adminControls.readCameraControls()),_297={};dojo.mixin(_297,_295,_296);dojo.xhrPost({url:"/admin/rpc/update_settings",content:_297,load:dojo.hitch(this,this._storeSettingsOnServerSucceeded)});}});}dojo.i18n._preloadLocalizations("dojo.nls.realitybuilder",["ROOT","ar","ca","cs","da","de","de-de","el","en","en-gb","en-us","es","es-es","fi","fi-fi","fr","fr-fr","he","he-il","hu","it","it-it","ja","ja-jp","ko","ko-kr","nb","nl","nl-nl","pl","pt","pt-br","pt-pt","ru","sk","sl","sv","th","tr","xx","zh","zh-cn","zh-tw"]);
