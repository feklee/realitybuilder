/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realityBuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.gantt.GanttChart"],["require","dijit.Tooltip"],["require","dojox.gantt.GanttProjectItem"],["require","dojox.gantt.GanttResourceItem"],["require","dojox.gantt.TabMenu"],["require","dojo.date.locale"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.gantt.GanttChart"]){_4._hasResource["dojox.gantt.GanttChart"]=true;_4.provide("dojox.gantt.GanttChart");_4.require("dijit.Tooltip");_4.require("dojox.gantt.GanttProjectItem");_4.require("dojox.gantt.GanttResourceItem");_4.require("dojox.gantt.TabMenu");_4.require("dojo.date.locale");(function(){_4.declare("dojox.gantt.GanttChart",null,{constructor:function(_7,_8){this.resourceChartHeight=_7.resourceChartHeight!==undefined?_7.resourceChartHeight:false;this.withResource=_7.withResource!==undefined?_7.withResource:true;this.correctError=_7.autoCorrectError!==undefined?_7.autoCorrectError:false;this.isShowConMenu=this.isContentEditable=!_7.readOnly;this.withTaskId=_7.withTaskId!==undefined?_7.withTaskId:!_7.readOnly;this.animation=_7.animation!==undefined?_7.animation:true;this.saveProgramPath=_7.saveProgramPath||"saveGanttData.php";this.dataFilePath=_7.dataFilePath||"gantt_default.json";this.contentHeight=_7.height||400;this.contentWidth=_7.width||600;this.content=_4.byId(_8);this.scrollBarWidth=18;this.panelTimeHeight=102;this.maxWidthPanelNames=150;this.maxWidthTaskNames=150;this.minWorkLength=8;this.heightTaskItem=12;this.heightTaskItemExtra=11;this.pixelsPerDay=24;this.hsPerDay=8;this.pixelsPerWorkHour=this.pixelsPerDay/this.hsPerDay;this.pixelsPerHour=this.pixelsPerDay/24;this.countDays=0;this.totalDays=0;this.startDate=null;this.initialPos=0;this.contentDataHeight=0;this.panelTimeExpandDelta=20;this.divTimeInfo=null;this.panelNames=null;this.panelTime=null;this.contentData=null;this.tabMenu=null;this.project=[];this.arrProjects=[];this.xmlLoader=null;this.isMoving=false;this.isResizing=false;this.animationNodes=[];this.scale=1;this.tempDayInPixels=0;this.resource=null;this.months=_4.date.locale.getNames("months","wide");this._events=[];},getProject:function(id){return _4.filter(this.arrProjects,function(_9){return _9.project.id==id;},this)[0];},checkPosPreviousTask:function(_a,_b){var _c=this.getWidthOnDuration(_a.duration);var _d=this.getPosOnDate(_a.startTime);var _e=this.getPosOnDate(_b.startTime);if((_c+_d)>_e){return false;}return true;},correctPosPreviousTask:function(_f,_10,_11){var _12=new Date(_f.startTime);_12.setHours(_12.getHours()+(_f.duration/this.hsPerDay*24));if(_12.getHours()>0){_12.setHours(0);_12.setDate(_12.getDate()+1);}_11?(_11.setStartTime(_12,true)):(_10.startTime=_12);if(_10.parentTask){if(!this.checkPosParentTask(_10.parentTask,_10)){var _13=new Date(_10.parentTask.startTime);_13.setHours(_13.getHours()+(_10.parentTask.duration/this.hsPerDay*24));_10.duration=parseInt((parseInt((_13-_10.startTime)/(1000*60*60)))*this.hsPerDay/24);}}},correctPosParentTask:function(_14,_15){if(!_15.previousTask){if(_14.startTime>_15.startTime){_15.startTime=new Date(_14.startTime);}if(!this.checkPosParentTask(_14,_15)){_15.duration=_14.duration;}}else{this.correctPosPreviousTask(_15.previousTask,_15);}},checkPosParentTaskInTree:function(_16){var _17=false;for(var i=0;i<_16.cldTasks.length;i++){var _18=_16.cldTasks[i];if(!this.checkPosParentTask(_16,_18)){if(!this.correctError){return true;}else{this.correctPosParentTask(_16,_18);}}if(_16.startTime>_18.startTime){if(!this.correctError){return true;}else{this.correctPosParentTask(_16,_18);}}if(_18.cldTasks.length>0){_17=this.checkPosParentTaskInTree(_18);}}return _17;},setPreviousTask:function(_19){var _1a=false;for(var i=0;i<_19.parentTasks.length;i++){var _1b=_19.parentTasks[i];if(_1b.previousTaskId){_1b.previousTask=_19.getTaskById(_1b.previousTaskId);if(!_1b.previousTask){if(!this.correctError){return true;}}_1b.previousTask.cldPreTasks.push(_1b);}if(_1b.previousTask){if(!this.checkPosPreviousTask(_1b.previousTask,_1b)){if(!this.correctError){return true;}else{this.correctPosPreviousTask(_1b.previousTask,_1b);}}}_1a=this.setPreviousTaskInTree(_1b);}return _1a;},setPreviousTaskInTree:function(_1c){var _1d=false;for(var i=0;i<_1c.cldTasks.length;i++){var _1e=_1c.cldTasks[i];if(_1e.previousTaskId){_1e.previousTask=_1c.project.getTaskById(_1e.previousTaskId);if(!_1e.previousTask){if(!this.correctError){return true;}}if(!this.checkPosPreviousTask(_1e.previousTask,_1e)){if(!this.correctError){return true;}else{this.correctPosPreviousTask(_1e.previousTask,_1e);}}_1e.previousTask.cldPreTasks.push(_1e);}if(_1e.cldTasks.length>0){_1d=this.setPreviousTaskInTree(_1e);}}return _1d;},checkPosParentTask:function(_1f,_20){var _21=this.getWidthOnDuration(_1f.duration);var _22=this.getPosOnDate(_1f.startTime);var _23=this.getPosOnDate(_20.startTime);var _24=this.getWidthOnDuration(_20.duration);return (_21+_22)>=(_23+_24);},addProject:function(_25){this.project.push(_25);},deleteProject:function(id){var _26=this.getProject(id);if(_26){if(_26.arrTasks.length>0){while(_26.arrTasks.length>0){_26.deleteChildTask(_26.arrTasks[0]);}}var _27=this.heightTaskItemExtra+this.heightTaskItem;_26.nextProject&&_26.shiftNextProject(_26,-_27);this.project=_4.filter(this.project,function(_28){return _28.id!=_26.project.id;},this);if((_26.previousProject)&&(_26.nextProject)){var _29=_26.previousProject;_29.nextProject=_26.nextProject;}if((_26.previousProject)&&!(_26.nextProject)){var _29=_26.previousProject;_29.nextProject=null;}if(!(_26.previousProject)&&(_26.nextProject)){var _2a=_26.nextProject;_2a.previousProject=null;}for(var i=0;i<this.arrProjects.length;i++){if(this.arrProjects[i].project.id==id){this.arrProjects.splice(i,1);}}_26.projectItem[0].parentNode.removeChild(_26.projectItem[0]);_26.descrProject.parentNode.removeChild(_26.descrProject);_26.projectNameItem.parentNode.removeChild(_26.projectNameItem);this.contentDataHeight-=this.heightTaskItemExtra+this.heightTaskItem;if(this.project.length==0){var d=new Date(this.startDate);var t=new Date(d.setDate(d.getDate()+1));var pi=new _6.gantt.GanttProjectItem({id:1,name:"New Project",startDate:t});this.project.push(pi);var _26=new _6.gantt.GanttProjectControl(this,pi);_26.create();this.arrProjects.push(_26);this.contentDataHeight+=this.heightTaskItemExtra+this.heightTaskItem;}this.checkPosition();}},insertProject:function(id,_2b,_2c){if(this.startDate>=_2c){return false;}if(this.getProject(id)){return false;}this.checkHeighPanelTasks();var _2d=new _6.gantt.GanttProjectItem({id:id,name:_2b,startDate:_2c});this.project.push(_2d);var _2e=new _6.gantt.GanttProjectControl(this,_2d);for(var i=0;i<this.arrProjects.length;i++){var _2f=this.arrProjects[i],_30=this.arrProjects[i-1],_31=this.arrProjects[i+1];if(_2c<_2f.project.startDate){this.arrProjects.splice(i,0,_2e);if(i>0){_2e.previousProject=_30;_30.nextProject=_2e;}if(i+1<=this.arrProjects.length){_2e.nextProject=_31;_31.previousProject=_2e;var _32=this.heightTaskItem+this.heightTaskItemExtra;_2e.shiftNextProject(_2e,_32);}_2e.create();_2e.hideDescrProject();this.checkPosition();return _2e;}}if(this.arrProjects.length>0){this.arrProjects[this.arrProjects.length-1].nextProject=_2e;_2e.previousProject=this.arrProjects[this.arrProjects.length-1];}this.arrProjects.push(_2e);_2e.create();_2e.hideDescrProject();this.checkPosition();return _2e;},openTree:function(_33){var _34=this.getLastCloseParent(_33);this.openNode(_34);_33.taskItem.id!=_34.taskItem.id&&this.openTree(_33);},openNode:function(_35){if(!_35.isExpanded){_4.removeClass(_35.cTaskNameItem[2],"ganttImageTreeExpand");_4.addClass(_35.cTaskNameItem[2],"ganttImageTreeCollapse");_35.isExpanded=true;_35.shiftCurrentTasks(_35,_35.hideTasksHeight);_35.showChildTasks(_35,_35.isExpanded);_35.hideTasksHeight=0;}},getLastCloseParent:function(_36){if(_36.parentTask){if((!_36.parentTask.isExpanded)||(_36.parentTask.cTaskNameItem[2].style.display=="none")){return this.getLastCloseParent(_36.parentTask);}else{return _36;}}else{return _36;}},getProjectItemById:function(id){return _4.filter(this.project,function(_37){return _37.id==id;},this)[0];},clearAll:function(){this.contentDataHeight=0;this.startDate=null;this.clearData();this.clearItems();this.clearEvents();},clearEvents:function(){_4.forEach(this._events,_4.disconnect);this._events=[];},clearData:function(){this.project=[];this.arrProjects=[];},clearItems:function(){this.contentData.removeChild(this.contentData.firstChild);this.contentData.appendChild(this.createPanelTasks());this.panelNames.removeChild(this.panelNames.firstChild);this.panelNames.appendChild(this.createPanelNamesTasks());this.panelTime.removeChild(this.panelTime.firstChild);},buildUIContent:function(){this.project.sort(this.sortProjStartDate);this.startDate=this.getStartDate();this.panelTime.appendChild(this.createPanelTime());for(var i=0;i<this.project.length;i++){var _38=this.project[i];for(var k=0;k<_38.parentTasks.length;k++){var _39=_38.parentTasks[k];if(_39.startTime){this.setStartTimeChild(_39);}else{return;}if(this.setPreviousTask(_38)){return;}}for(var k=0;k<_38.parentTasks.length;k++){var _39=_38.parentTasks[k];if(_39.startTime<_38.startDate){return;}if(this.checkPosParentTaskInTree(_39)){return;}}this.sortTasksByStartTime(_38);}for(var i=0;i<this.project.length;i++){var _38=this.project[i];var _3a=new _6.gantt.GanttProjectControl(this,_38);if(this.arrProjects.length>0){var _3b=this.arrProjects[this.arrProjects.length-1];_3a.previousProject=_3b;_3b.nextProject=_3a;}_3a.create();this.checkHeighPanelTasks();this.arrProjects.push(_3a);this.createTasks(_3a);}this.resource&&this.resource.reConstruct();this.postLoadData();this.postBindEvents();},loadJSONData:function(_3c){var _3d=this;_3d.dataFilePath=_3c||_3d.dataFilePath;_4.xhrGet({url:_3d.dataFilePath,sync:true,load:function(_3e,_3f){_3d.loadJSONString(_3e);_3d.buildUIContent();alert("Successfully! Loaded data from: "+_3d.dataFilePath);},error:function(err,_40){alert("Failed! Load error: "+_3d.dataFilePath);}});},loadJSONString:function(_41){if(!_41){return;}this.clearAll();var _42=_4.fromJson(_41);var _43=_42.items;_4.forEach(_43,function(_44){var _45=_44.startdate.split("-");var _46=new _6.gantt.GanttProjectItem({id:_44.id,name:_44.name,startDate:new Date(_45[0],(parseInt(_45[1])-1),_45[2])});var _47=_44.tasks;_4.forEach(_47,function(_48){var id=_48.id,_49=_48.name,_4a=_48.starttime.split("-");duration=_48.duration,percentage=_48.percentage,previousTaskId=_48.previousTaskId,taskOwner=_48.taskOwner;var _4b=new _6.gantt.GanttTaskItem({id:id,name:_49,startTime:new Date(_4a[0],(parseInt(_4a[1])-1),_4a[2]),duration:duration,percentage:percentage,previousTaskId:previousTaskId,taskOwner:taskOwner});var _4c=_48.children;if(_4c.length!=0){this.buildChildTasksData(_4b,_4c);}_46.addTask(_4b);},this);this.addProject(_46);},this);},buildChildTasksData:function(_4d,_4e){_4e&&_4.forEach(_4e,function(_4f){var id=_4f.id,_50=_4f.name,_51=_4f.starttime.split("-"),_52=_4f.duration,_53=_4f.percentage,_54=_4f.previousTaskId,_55=_4f.taskOwner;var _56=new _6.gantt.GanttTaskItem({id:id,name:_50,startTime:new Date(_51[0],(parseInt(_51[1])-1),_51[2]),duration:_52,percentage:_53,previousTaskId:_54,taskOwner:_55});_56.parentTask=_4d;_4d.addChildTask(_56);var _57=_4f.children;if(_57.length!=0){this.buildChildTasksData(_56,_57);}},this);},getJSONData:function(){var _58={identifier:"id",items:[]};_4.forEach(this.project,function(_59){var _5a={id:_59.id,name:_59.name,startdate:_59.startDate.getFullYear()+"-"+(_59.startDate.getMonth()+1)+"-"+_59.startDate.getDate(),tasks:[]};_58.items.push(_5a);_4.forEach(_59.parentTasks,function(_5b){var _5c={id:_5b.id,name:_5b.name,starttime:_5b.startTime.getFullYear()+"-"+(_5b.startTime.getMonth()+1)+"-"+_5b.startTime.getDate(),duration:_5b.duration,percentage:_5b.percentage,previousTaskId:(_5b.previousTaskId||""),taskOwner:(_5b.taskOwner||""),children:this.getChildTasksData(_5b.cldTasks)};_5a.tasks.push(_5c);},this);},this);return _58;},getChildTasksData:function(_5d){var _5e=[];_5d&&_5d.length>0&&_4.forEach(_5d,function(_5f){var _60={id:_5f.id,name:_5f.name,starttime:_5f.startTime.getFullYear()+"-"+(_5f.startTime.getMonth()+1)+"-"+_5f.startTime.getDate(),duration:_5f.duration,percentage:_5f.percentage,previousTaskId:(_5f.previousTaskId||""),taskOwner:(_5f.taskOwner||""),children:this.getChildTasksData(_5f.cldTasks)};_5e.push(_60);},this);return _5e;},saveJSONData:function(_61){var _62=this;_62.dataFilePath=(_61&&_4.trim(_61).length>0)?_61:this.dataFilePath;try{var td=_4.xhrPost({url:_62.saveProgramPath,content:{filename:_62.dataFilePath,data:_4.toJson(_62.getJSONData())},handle:function(res,_63){if((_4._isDocumentOk(_63.xhr))||(_63.xhr.status==405)){alert("Successfully! Saved data to "+_62.dataFilePath);}else{alert("Failed! Saved error");}}});}catch(e){alert("exception: "+e.message);}},sortTaskStartTime:function(a,b){return a.startTime<b.startTime?-1:(a.startTime>b.startTime?1:0);},sortProjStartDate:function(a,b){return a.startDate<b.startDate?-1:(a.startDate>b.startDate?1:0);},setStartTimeChild:function(_64){_4.forEach(_64.cldTasks,function(_65){if(!_65.startTime){_65.startTime=_64.startTime;}if(_65.cldTasks.length!=0){this.setStartTimeChild(_65);}},this);},createPanelTasks:function(){var _66=_4.create("div",{className:"ganttTaskPanel"});_4.style(_66,{height:(this.contentHeight-this.panelTimeHeight-this.scrollBarWidth)+"px"});return _66;},refreshParams:function(_67){this.pixelsPerDay=_67;this.pixelsPerWorkHour=this.pixelsPerDay/this.hsPerDay;this.pixelsPerHour=this.pixelsPerDay/24;},createPanelNamesTasksHeader:function(){var _68=this;var _69=_4.create("div",{className:"ganttPanelHeader"});var _6a=_4.create("table",{cellPadding:"0px",border:"0px",cellSpacing:"0px",bgColor:"#FFFFFF",className:"ganttToolbar"},_69);var _6b=_6a.insertRow(_6a.rows.length);var _6c=_6a.insertRow(_6a.rows.length);var _6d=_6a.insertRow(_6a.rows.length);var _6e=_6a.insertRow(_6a.rows.length);var _6f=_4.create("td",{align:"center",vAlign:"middle",className:"ganttToolbarZoomIn"},_6b);var _70=_4.hitch(this,function(){if(this.scale*2>5){return;}this.scale=this.scale*2;this.switchTeleMicroView(this.pixelsPerDay*this.scale);});_4.disconnect(this.zoomInClickEvent);this.zoomInClickEvent=_4.connect(_6f,"onclick",this,_70);_4.disconnect(this.zoomInKeyEvent);this.zoomInKeyEvent=_4.connect(_6f,"onkeydown",this,function(e){if(e.keyCode!=_4.keys.ENTER){return;}_70();});_4.attr(_6f,"tabIndex",0);var _71=_4.create("td",{align:"center",vAlign:"middle",className:"ganttToolbarZoomOut"},_6b);var _72=_4.hitch(this,function(){if(this.scale*0.5<0.2){return;}this.scale=this.scale*0.5;this.switchTeleMicroView(this.pixelsPerDay*this.scale);});_4.disconnect(this.zoomOutClickEvent);this.zoomOutClickEvent=_4.connect(_71,"onclick",this,_72);_4.disconnect(this.zoomOutKeyEvent);this.zoomOutKeyEvent=_4.connect(_71,"onkeydown",this,function(e){if(e.keyCode!=_4.keys.ENTER){return;}_72();});_4.attr(_71,"tabIndex",0);var _73=_4.create("td",{align:"center",vAlign:"middle",className:"ganttToolbarMicro"},_6c);_4.disconnect(this.microClickEvent);this.microClickEvent=_4.connect(_73,"onclick",this,_4.hitch(this,this.refresh,this.animation?15:1,0,2));_4.disconnect(this.microKeyEvent);this.microKeyEvent=_4.connect(_73,"onkeydown",this,function(e){if(e.keyCode!=_4.keys.ENTER){return;}_73.blur();this.refresh(this.animation?15:1,0,2);});_4.attr(_73,"tabIndex",0);var _74=_4.create("td",{align:"center",vAlign:"middle",className:"ganttToolbarTele"},_6c);_4.disconnect(this.teleClickEvent);this.teleClickEvent=_4.connect(_74,"onclick",this,_4.hitch(this,this.refresh,this.animation?15:1,0,0.5));_4.disconnect(this.teleKeyEvent);this.teleKeyEvent=_4.connect(_74,"onkeydown",this,function(e){if(e.keyCode!=_4.keys.ENTER){return;}_74.blur();this.refresh(this.animation?15:1,0,0.5);});_4.attr(_74,"tabIndex",0);var _75=_4.create("td",{align:"center",vAlign:"middle",className:"ganttToolbarSave"},_6d);_4.disconnect(this.saveClickEvent);this.saveClickEvent=_4.connect(_75,"onclick",this,_4.hitch(this,this.saveJSONData,""));_4.disconnect(this.saveKeyEvent);this.saveKeyEvent=_4.connect(_75,"onkeydown",this,function(e){if(e.keyCode!=_4.keys.ENTER){return;}this.saveJSONData("");});_4.attr(_75,"tabIndex",0);var _76=_4.create("td",{align:"center",vAlign:"middle",className:"ganttToolbarLoad"},_6d);_4.disconnect(this.loadClickEvent);this.loadClickEvent=_4.connect(_76,"onclick",this,_4.hitch(this,this.loadJSONData,""));_4.disconnect(this.loadKeyEvent);this.loadKeyEvent=_4.connect(_76,"onkeydown",this,function(e){if(e.keyCode!=_4.keys.ENTER){return;}this.loadJSONData("");});_4.attr(_76,"tabIndex",0);var _77=[_6f,_71,_73,_74,_75,_76],_78=["Enlarge timeline","Shrink timeline","Zoom in time zone(microscope view)","Zoom out time zone(telescope view)","Save gantt data to json file","Load gantt data from json file"];_4.forEach(_77,function(_79,i){var _7a=_78[i];var _7b=function(){_4.addClass(_79,"ganttToolbarActionHover");_5.showTooltip(_7a,_79,["above","below"]);};_79.onmouseover=_7b;_79.onfocus=_7b;var _7c=function(){_4.removeClass(_79,"ganttToolbarActionHover");_79&&_5.hideTooltip(_79);};_79.onmouseout=_7c;_79.onblur=_7c;},this);return _69;},createPanelNamesTasks:function(){var _7d=_4.create("div",{innerHTML:"&nbsp;",className:"ganttPanelNames"});_4.style(_7d,{height:(this.contentHeight-this.panelTimeHeight-this.scrollBarWidth)+"px",width:this.maxWidthPanelNames+"px"});return _7d;},createPanelTime:function(){var _7e=_4.create("div",{className:"ganttPanelTime"});var _7f=_4.create("table",{cellPadding:"0px",border:"0px",cellSpacing:"0px",bgColor:"#FFFFFF",className:"ganttTblTime"},_7e);this.totalDays=this.countDays;var _80=_7f.insertRow(_7f.rows.length),_81=oldYear=new Date(this.startDate).getFullYear(),_82=0;for(var i=0;i<this.countDays;i++,_82++){var _83=new Date(this.startDate);_83.setDate(_83.getDate()+i);_81=_83.getFullYear();if(_81!=oldYear){this.addYearInPanelTime(_80,_82,oldYear);_82=0;oldYear=_81;}}this.addYearInPanelTime(_80,_82,_81);_4.style(_80,"display","none");var _84=_7f.insertRow(_7f.rows.length),_85=oldMonth=new Date(this.startDate).getMonth(),_86=0,_87=1970;for(var i=0;i<this.countDays;i++,_86++){var _83=new Date(this.startDate);_83.setDate(_83.getDate()+i);_85=_83.getMonth();_87=_83.getFullYear();if(_85!=oldMonth){this.addMonthInPanelTime(_84,_86,oldMonth,_87);_86=0;oldMonth=_85;}}this.addMonthInPanelTime(_84,_86,_85,_87);var _88=_7f.insertRow(_7f.rows.length),_89=oldWeek=_4.date.locale._getWeekOfYear(new Date(this.startDate)),_86=0;for(var i=0;i<this.countDays;i++,_86++){var _83=new Date(this.startDate);_83.setDate(_83.getDate()+i);_89=_4.date.locale._getWeekOfYear(_83);if(_89!=oldWeek){this.addWeekInPanelTime(_88,_86,oldWeek);_86=0;oldWeek=_89;}}this.addWeekInPanelTime(_88,_86,_89);var _8a=_7f.insertRow(_7f.rows.length);for(var i=0;i<this.countDays;i++){this.addDayInPanelTime(_8a);}var _8b=_7f.insertRow(_7f.rows.length);for(var i=0;i<this.countDays;i++){this.addHourInPanelTime(_8b);}_4.style(_8b,"display","none");return _7e;},adjustPanelTime:function(_8c){var _8d=_4.map(this.arrProjects,function(_8e){return (parseInt(_8e.projectItem[0].style.left)+parseInt(_8e.projectItem[0].firstChild.style.width)+_8e.descrProject.offsetWidth+this.panelTimeExpandDelta);},this).sort(function(a,b){return b-a;})[0];if(this.maxTaskEndPos!=_8d){var _8f=this.panelTime.firstChild.firstChild.rows;for(var i=0;i<=4;i++){this.removeCell(_8f[i]);}var _90=Math.round((_8d+this.panelTimeExpandDelta)/this.pixelsPerDay);this.totalDays=_90;var _91=oldYear=new Date(this.startDate).getFullYear(),_92=0;for(var i=0;i<_90;i++,_92++){var _93=new Date(this.startDate);_93.setDate(_93.getDate()+i);_91=_93.getFullYear();if(_91!=oldYear){this.addYearInPanelTime(_8f[0],_92,oldYear);_92=0;oldYear=_91;}}this.addYearInPanelTime(_8f[0],_92,_91);var _94=oldMonth=new Date(this.startDate).getMonth(),_95=0,_96=1970;for(var i=0;i<_90;i++,_95++){var _93=new Date(this.startDate);_93.setDate(_93.getDate()+i);_94=_93.getMonth();_96=_93.getFullYear();if(_94!=oldMonth){this.addMonthInPanelTime(_8f[1],_95,oldMonth,_96);_95=0;oldMonth=_94;}}this.addMonthInPanelTime(_8f[1],_95,_94,_96);var _97=oldWeek=_4.date.locale._getWeekOfYear(new Date(this.startDate)),_95=0;for(var i=0;i<_90;i++,_95++){var _93=new Date(this.startDate);_93.setDate(_93.getDate()+i);_97=_4.date.locale._getWeekOfYear(_93);if(_97!=oldWeek){this.addWeekInPanelTime(_8f[2],_95,oldWeek);_95=0;oldWeek=_97;}}this.addWeekInPanelTime(_8f[2],_95,_97);for(var i=0;i<_90;i++){this.addDayInPanelTime(_8f[3]);}for(var i=0;i<_90;i++){this.addHourInPanelTime(_8f[4]);}this.panelTime.firstChild.firstChild.style.width=this.pixelsPerDay*(_8f[3].cells.length)+"px";this.contentData.firstChild.style.width=this.pixelsPerDay*(_8f[3].cells.length)+"px";this.maxTaskEndPos=_8d;}},addYearInPanelTime:function(row,_98,_99){var _9a="Year   "+_99;var _9b=_4.create("td",{colSpan:_98,align:"center",vAlign:"middle",className:"ganttYearNumber",innerHTML:this.pixelsPerDay*_98>20?_9a:"",innerHTMLData:_9a},row);_4.style(_9b,"width",(this.pixelsPerDay*_98)+"px");},addMonthInPanelTime:function(row,_9c,_9d,_9e){var _9f=this.months[_9d]+(_9e?" of "+_9e:"");var _a0=_4.create("td",{colSpan:_9c,align:"center",vAlign:"middle",className:"ganttMonthNumber",innerHTML:this.pixelsPerDay*_9c>30?_9f:"",innerHTMLData:_9f},row);_4.style(_a0,"width",(this.pixelsPerDay*_9c)+"px");},addWeekInPanelTime:function(row,_a1,_a2){var _a3="Week   "+_a2;var _a4=_4.create("td",{colSpan:_a1,align:"center",vAlign:"middle",className:"ganttWeekNumber",innerHTML:this.pixelsPerDay*_a1>20?_a3:"",innerHTMLData:_a3},row);_4.style(_a4,"width",(this.pixelsPerDay*_a1)+"px");},addDayInPanelTime:function(row){var _a5=new Date(this.startDate);_a5.setDate(_a5.getDate()+parseInt(row.cells.length));var _a6=_4.create("td",{align:"center",vAlign:"middle",className:"ganttDayNumber",innerHTML:this.pixelsPerDay>20?_a5.getDate():"",innerHTMLData:String(_a5.getDate()),data:row.cells.length},row);_4.style(_a6,"width",this.pixelsPerDay+"px");(_a5.getDay()>=5)&&_4.addClass(_a6,"ganttDayNumberWeekend");this._events.push(_4.connect(_a6,"onmouseover",this,function(_a7){var _a8=_a7.target||_a7.srcElement;var _a9=new Date(this.startDate.getTime());_a9.setDate(_a9.getDate()+parseInt(_4.attr(_a8,"data")));_5.showTooltip(_a9.getFullYear()+"."+(_a9.getMonth()+1)+"."+_a9.getDate(),_a6,["above","below"]);}));this._events.push(_4.connect(_a6,"onmouseout",this,function(_aa){var _ab=_aa.target||_aa.srcElement;_ab&&_5.hideTooltip(_ab);}));},addHourInPanelTime:function(row){var _ac=_4.create("td",{align:"center",vAlign:"middle",className:"ganttHourNumber",data:row.cells.length},row);_4.style(_ac,"width",this.pixelsPerDay+"px");var _ad=_4.create("table",{cellPadding:"0",cellSpacing:"0"},_ac);var _ae=_ad.insertRow(_ad.rows.length);for(var i=0;i<this.hsPerDay;i++){var _af=_4.create("td",{className:"ganttHourClass"},_ae);_4.style(_af,"width",(this.pixelsPerDay/this.hsPerDay)+"px");_4.attr(_af,"innerHTMLData",String(9+i));if(this.pixelsPerDay/this.hsPerDay>5){_4.attr(_af,"innerHTML",String(9+i));}_4.addClass(_af,i<=3?"ganttHourNumberAM":"ganttHourNumberPM");}},incHeightPanelTasks:function(_b0){var _b1=this.contentData.firstChild;_b1.style.height=parseInt(_b1.style.height)+_b0+"px";},incHeightPanelNames:function(_b2){var _b3=this.panelNames.firstChild;_b3.style.height=parseInt(_b3.style.height)+_b2+"px";},checkPosition:function(){_4.forEach(this.arrProjects,function(_b4){_4.forEach(_b4.arrTasks,function(_b5){_b5.checkPosition();},this);},this);},checkHeighPanelTasks:function(){this.contentDataHeight+=this.heightTaskItemExtra+this.heightTaskItem;if((parseInt(this.contentData.firstChild.style.height)<=this.contentDataHeight)){this.incHeightPanelTasks(this.heightTaskItem+this.heightTaskItemExtra);this.incHeightPanelNames(this.heightTaskItem+this.heightTaskItemExtra);}},sortTasksByStartTime:function(_b6){_b6.parentTasks.sort(this.sortTaskStartTime);for(var i=0;i<_b6.parentTasks.length;i++){_b6.parentTasks[i]=this.sortChildTasks(_b6.parentTasks[i]);}},sortChildTasks:function(_b7){_b7.cldTasks.sort(this.sortTaskStartTime);for(var i=0;i<_b7.cldTasks.length;i++){if(_b7.cldTasks[i].cldTasks.length>0){this.sortChildTasks(_b7.cldTasks[i]);}}return _b7;},refresh:function(_b8,_b9,_ba){if(this.arrProjects.length<=0){return;}if(this.arrProjects[0].arrTasks.length<=0){return;}if(!_b8||_b9>_b8){this.refreshController();if(this.resource){this.resource.refresh();}this.tempDayInPixels=0;this.panelNameHeadersCover&&_4.style(this.panelNameHeadersCover,"display","none");return;}if(this.tempDayInPixels==0){this.tempDayInPixels=this.pixelsPerDay;}this.panelNameHeadersCover&&_4.style(this.panelNameHeadersCover,"display","");var dip=this.tempDayInPixels+this.tempDayInPixels*(_ba-1)*Math.pow((_b9/_b8),2);this.refreshParams(dip);_4.forEach(this.arrProjects,function(_bb){_4.forEach(_bb.arrTasks,function(_bc){_bc.refresh();},this);_bb.refresh();},this);setTimeout(_4.hitch(this,function(){this.refresh(_b8,++_b9,_ba);}),15);},switchTeleMicroView:function(dip){var _bd=this.panelTime.firstChild.firstChild;for(var i=0;i<5;i++){if(dip>40){_4.style(_bd.rows[i],"display",(i==0||i==1)?"none":"");}else{if(dip<20){_4.style(_bd.rows[i],"display",(i==2||i==4)?"none":"");}else{_4.style(_bd.rows[i],"display",(i==0||i==4)?"none":"");}}}},refreshController:function(){this.contentData.firstChild.style.width=Math.max(1200,this.pixelsPerDay*this.totalDays)+"px";this.panelTime.firstChild.style.width=this.pixelsPerDay*this.totalDays+"px";this.panelTime.firstChild.firstChild.style.width=this.pixelsPerDay*this.totalDays+"px";this.switchTeleMicroView(this.pixelsPerDay);_4.forEach(this.panelTime.firstChild.firstChild.rows,function(row){_4.forEach(row.childNodes,function(td){var cs=parseInt(_4.attr(td,"colSpan")||1);var _be=_4.trim(_4.attr(td,"innerHTMLData")||"");if(_be.length>0){_4.attr(td,"innerHTML",this.pixelsPerDay*cs<20?"":_be);}else{_4.forEach(td.firstChild.rows[0].childNodes,function(td){var _bf=_4.trim(_4.attr(td,"innerHTMLData")||"");_4.attr(td,"innerHTML",this.pixelsPerDay/this.hsPerDay>10?_bf:"");},this);}if(cs==1){_4.style(td,"width",(this.pixelsPerDay*cs)+"px");if(_be.length<=0){_4.forEach(td.firstChild.rows[0].childNodes,function(td){_4.style(td,"width",(this.pixelsPerDay*cs/this.hsPerDay)+"px");},this);}}},this);},this);},init:function(){this.startDate=this.getStartDate();_4.style(this.content,{width:this.contentWidth+"px",height:this.contentHeight+"px"});this.tableControl=_4.create("table",{cellPadding:"0",cellSpacing:"0",className:"ganttTabelControl"});var _c0=this.tableControl.insertRow(this.tableControl.rows.length);this.content.appendChild(this.tableControl);this.countDays=this.getCountDays();this.panelTime=_4.create("div",{className:"ganttPanelTimeContainer"});_4.style(this.panelTime,"height",this.panelTimeHeight+"px");this.panelTime.appendChild(this.createPanelTime());this.contentData=_4.create("div",{className:"ganttContentDataContainer"});_4.style(this.contentData,"height",(this.contentHeight-this.panelTimeHeight)+"px");this.contentData.appendChild(this.createPanelTasks());var _c1=_4.create("td",{vAlign:"top"});this.panelNameHeaders=_4.create("div",{className:"ganttPanelNameHeaders"},_c1);_4.style(this.panelNameHeaders,{height:this.panelTimeHeight+"px",width:this.maxWidthPanelNames+"px"});this.panelNameHeaders.appendChild(this.createPanelNamesTasksHeader());this.panelNames=_4.create("div",{className:"ganttPanelNamesContainer"},_c1);this.panelNames.appendChild(this.createPanelNamesTasks());_c0.appendChild(_c1);_c1=_4.create("td",{vAlign:"top"});var _c2=_4.create("div",{className:"ganttDivCell"});_c2.appendChild(this.panelTime);_c2.appendChild(this.contentData);_c1.appendChild(_c2);_c0.appendChild(_c1);_4.style(this.panelNames,"height",(this.contentHeight-this.panelTimeHeight-this.scrollBarWidth)+"px");_4.style(this.panelNames,"width",this.maxWidthPanelNames+"px");_4.style(this.contentData,"width",(this.contentWidth-this.maxWidthPanelNames)+"px");_4.style(this.contentData.firstChild,"width",this.pixelsPerDay*this.countDays+"px");_4.style(this.panelTime,"width",(this.contentWidth-this.maxWidthPanelNames-this.scrollBarWidth)+"px");_4.style(this.panelTime.firstChild,"width",this.pixelsPerDay*this.countDays+"px");if(this.isShowConMenu){this.tabMenu=new _6.gantt.TabMenu(this);}var _c3=this;this.contentData.onscroll=function(){_c3.panelTime.scrollLeft=this.scrollLeft;if(_c3.panelNames){_c3.panelNames.scrollTop=this.scrollTop;if(_c3.isShowConMenu){_c3.tabMenu.hide();}}if(_c3.resource){_c3.resource.contentData.scrollLeft=this.scrollLeft;}};this.project.sort(this.sortProjStartDate);for(var i=0;i<this.project.length;i++){var _c4=this.project[i];for(var k=0;k<_c4.parentTasks.length;k++){var _c5=_c4.parentTasks[k];if(!_c5.startTime){_c5.startTime=_c4.startDate;}this.setStartTimeChild(_c5);if(this.setPreviousTask(_c4)){return;}}for(var k=0;k<_c4.parentTasks.length;k++){var _c5=_c4.parentTasks[k];if(_c5.startTime<_c4.startDate){if(!this.correctError){return;}else{_c5.startTime=_c4.startDate;}}if(this.checkPosParentTaskInTree(_c5)){return;}}this.sortTasksByStartTime(_c4);}for(var i=0;i<this.project.length;i++){var _c4=this.project[i];var _c6=new _6.gantt.GanttProjectControl(this,_c4);if(this.arrProjects.length>0){var _c7=this.arrProjects[this.arrProjects.length-1];_c6.previousProject=_c7;_c7.nextProject=_c6;}_c6.create();this.checkHeighPanelTasks();this.arrProjects.push(_c6);this.createTasks(_c6);}if(this.withResource){this.resource=new _6.gantt.GanttResourceItem(this);this.resource.create();}this.postLoadData();this.postBindEvents();return this;},postLoadData:function(){_4.forEach(this.arrProjects,function(_c8){_4.forEach(_c8.arrTasks,function(_c9){_c9.postLoadData();},this);_c8.postLoadData();},this);var _ca=_4.coords(this.panelNameHeaders);if(!this.panelNameHeadersCover){this.panelNameHeadersCover=_4.create("div",{className:"ganttHeaderCover"},this.panelNameHeaders.parentNode);_4.style(this.panelNameHeadersCover,{left:_ca.l+"px",top:_ca.t+"px",height:_ca.h+"px",width:_ca.w+"px",display:"none"});}},postBindEvents:function(){var pos=_4.position(this.tableControl,true);!_4.isIE&&this._events.push(_4.connect(this.tableControl,"onmousemove",this,function(_cb){var _cc=_cb.srcElement||_cb.target;if(_cc==this.panelNames.firstChild||_cc==this.contentData.firstChild){var _cd=this.heightTaskItem+this.heightTaskItemExtra;var _ce=parseInt(_cb.layerY/_cd)*_cd+this.panelTimeHeight-this.contentData.scrollTop;if(_ce!=this.oldHLTop&&_ce<(pos.h-50)){if(this.highLightDiv){_4.style(this.highLightDiv,"top",(pos.y+_ce)+"px");}else{this.highLightDiv=_4.create("div",{className:"ganttRowHighlight"},_4.body());_4.style(this.highLightDiv,{top:(pos.y+_ce)+"px",left:pos.x+"px",width:(pos.w-20)+"px",height:_cd+"px"});}}this.oldHLTop=_ce;}}));},getStartDate:function(){_4.forEach(this.project,function(_cf){if(this.startDate){if(_cf.startDate<this.startDate){this.startDate=new Date(_cf.startDate);}}else{this.startDate=new Date(_cf.startDate);}},this);this.initialPos=24*this.pixelsPerHour;return this.startDate?new Date(this.startDate.setHours(this.startDate.getHours()-24)):new Date();},getCountDays:function(){return parseInt((this.contentWidth-this.maxWidthPanelNames)/(this.pixelsPerHour*24));},createTasks:function(_d0){_4.forEach(_d0.project.parentTasks,function(_d1,i){if(i>0){_d0.project.parentTasks[i-1].nextParentTask=_d1;_d1.previousParentTask=_d0.project.parentTasks[i-1];}var _d2=new _6.gantt.GanttTaskControl(_d1,_d0,this);_d0.arrTasks.push(_d2);_d2.create();this.checkHeighPanelTasks();if(_d1.cldTasks.length>0){this.createChildItemControls(_d1.cldTasks,_d0);}},this);},createChildItemControls:function(_d3,_d4){_d3&&_4.forEach(_d3,function(_d5,i){if(i>0){_d5.previousChildTask=_d3[i-1];_d3[i-1].nextChildTask=_d5;}var _d6=new _6.gantt.GanttTaskControl(_d5,_d4,this);_d6.create();this.checkHeighPanelTasks();if(_d5.cldTasks.length>0){this.createChildItemControls(_d5.cldTasks,_d4);}},this);},getPosOnDate:function(_d7){return (_d7-this.startDate)/(60*60*1000)*this.pixelsPerHour;},getWidthOnDuration:function(_d8){return Math.round(this.pixelsPerWorkHour*_d8);},getLastChildTask:function(_d9){return _d9.childTask.length>0?this.getLastChildTask(_d9.childTask[_d9.childTask.length-1]):_d9;},removeCell:function(row){while(row.cells[0]){row.deleteCell(row.cells[0]);}}});})();}}};});