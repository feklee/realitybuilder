/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realityBuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.gantt.TabMenu"],["require","dijit.dijit"],["require","dijit.Menu"],["require","dijit.Dialog"],["require","dijit.form.NumberSpinner"],["require","dijit.form.Button"],["require","dijit.form.CheckBox"],["require","dijit.form.DateTextBox"],["require","dijit.form.TimeTextBox"],["require","dojo.date.locale"],["require","dijit.form.Form"],["require","dojo.parser"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.gantt.TabMenu"]){_4._hasResource["dojox.gantt.TabMenu"]=true;_4.provide("dojox.gantt.TabMenu");_4.require("dijit.dijit");_4.require("dijit.Menu");_4.require("dijit.Dialog");_4.require("dijit.form.NumberSpinner");_4.require("dijit.form.Button");_4.require("dijit.form.CheckBox");_4.require("dijit.form.DateTextBox");_4.require("dijit.form.TimeTextBox");_4.require("dojo.date.locale");_4.require("dijit.form.Form");_4.require("dojo.parser");(function(){_4.declare("dojox.gantt.TabMenu",null,{constructor:function(_7){this.ganttChart=_7;this.menuPanel=null;this.paneContentArea=null;this.paneActionBar=null;this.tabPanelDlg=null;this.tabPanelDlgId=null;this.arrTabs=[];this.isShow=false;this.buildContent();},buildContent:function(){this.createMenuPanel();this.createTabPanel();var _8=this.createTab(11,"Add Successor Task","t",true,this);_8.addItem(1,"Id","id",true);_8.addItem(2,"Name","name");_8.addItem(3,"Start Time","startTime");_8.addItem(4,"Duration (hours)","duration");_8.addItem(5,"Percent Complete (%)","percentage");_8.addItem(6,"Task Assignee","taskOwner");_8.addAction("addSuccessorTaskAction");var _9=this.createTab(10,"Add Child Task","t",true,this);_9.addItem(1,"Id","id",true);_9.addItem(2,"Name","name");_9.addItem(3,"Start Time","startTime");_9.addItem(4,"Duration (hours)","duration");_9.addItem(5,"Percent Complete (%)","percentage");_9.addItem(6,"Task Assignee","taskOwner");_9.addAction("addChildTaskAction");var _a=this.createTab(4,"Set Duration(hours)","t",true,this,true);_a.addItem(1,"Duration (hours)","duration",true);_a.addAction("durationUpdateAction");var _b=this.createTab(5,"Set Complete Percentage (%)","t",true,this,true);_b.addItem(1,"Percent Complete (%)","percentage",true);_b.addAction("cpUpdateAction");var _c=this.createTab(20,"Set Owner","t",true,this,true);_c.addItem(1,"Task Assignee","taskOwner",true);_c.addAction("ownerUpdateAction");var _d=this.createTab(13,"Set Previous Task","t",true,this);_d.addItem(1,"Previous Task Id","previousTaskId",true);_d.addAction("ptUpdateAction");var _e=this.createTab(1,"Rename Task","t",true,this,true);_e.addItem(1,"New Name","name",true);_e.addAction("renameTaskAction");var _f=this.createTab(2,"Delete Task","t",true,this);_f.addAction("deleteAction");var _10=this.createTab(12,"Add New Project","p",false,this);_10.addItem(1,"Id","id",true);_10.addItem(2,"Name","name",true);_10.addItem(3,"Start Date","startDate",true);_10.addAction("addProjectAction");var _11=this.createTab(8,"Set Complete Percentage (%)","p",true,this,true);_11.addItem(1,"Percent Complete (%)","percentage",true);_11.addAction("cpProjectAction");var _12=this.createTab(6,"Rename Project","p",true,this,true);_12.addItem(1,"New Name","name",true);_12.addAction("renameProjectAction");var _13=this.createTab(7,"Delete Project","p",true,this);_13.addAction("deleteProjectAction");var _14=this.createTab(9,"Add New Task","p",true,this);_14.addItem(1,"Id","id",true);_14.addItem(2,"Name","name");_14.addItem(3,"Start Time","startTime");_14.addItem(4,"Duration (hours)","duration");_14.addItem(5,"Percent Complete (%)","percentage");_14.addItem(6,"Task Assignee","taskOwner");_14.addItem(7,"Parent Task Id","parentTaskId");_14.addItem(8,"Previous Task Id","previousTaskId");_14.addAction("addTaskAction");},createMenuPanel:function(){this.menuPanel=_4.create("div",{innerHTML:"<table></table>",className:"ganttMenuPanel"},this.ganttChart.content);_4.addClass(this.menuPanel.firstChild,"ganttContextMenu");this.menuPanel.firstChild.cellPadding=0;this.menuPanel.firstChild.cellSpacing=0;},createTabPanel:function(){this.tabPanelDlg=_5.byId(this.tabPanelDlgId)||new _5.Dialog({title:"Settings"});this.tabPanelDlgId=this.tabPanelDlg.id;this.tabPanelDlg.closeButtonNode.style.display="none";var _15=this.tabPanelDlg.containerNode;this.paneContentArea=_4.create("div",{className:"dijitDialogPaneContentArea"},_15);this.paneActionBar=_4.create("div",{className:"dijitDialogPaneActionBar"},_15);this.paneContentArea.innerHTML="<table cellpadding=0 cellspacing=0><tr><th></th></tr><tr><td></td></tr></table>";var _16=this.paneContentArea.firstChild.rows[0].cells[0];_16.colSpan=2;_16.innerHTML="Description: ";_4.addClass(_16,"ganttDialogContentHeader");var _17=this.paneContentArea.firstChild.rows[1].cells[0];_17.innerHTML="<table></table>";_4.addClass(_17.firstChild,"ganttDialogContentCell");_17.align="center";this.ok=new _5.form.Button({label:"OK"});this.cancel=new _5.form.Button({label:"Cancel"});this.paneActionBar.appendChild(this.ok.domNode);this.paneActionBar.appendChild(this.cancel.domNode);},addItemMenuPanel:function(tab){var row=this.menuPanel.firstChild.insertRow(this.menuPanel.firstChild.rows.length);var _18=_4.create("td",{className:"ganttContextMenuItem",innerHTML:tab.Description});_4.attr(_18,"tabIndex",0);this.ganttChart._events.push(_4.connect(_18,"onclick",this,function(){try{this.hide();tab.show();}catch(e){console.log("dialog open exception: "+e.message);}}));this.ganttChart._events.push(_4.connect(_18,"onkeydown",this,function(e){if(e.keyCode!=_4.keys.ENTER){return;}try{this.hide();tab.show();}catch(e){console.log("dialog open exception: "+e.message);}}));this.ganttChart._events.push(_4.connect(_18,"onmouseover",this,function(){_4.addClass(_18,"ganttContextMenuItemHover");}));this.ganttChart._events.push(_4.connect(_18,"onmouseout",this,function(){_4.removeClass(_18,"ganttContextMenuItemHover");}));row.appendChild(_18);},show:function(_19,_1a){if(_1a.constructor==_6.gantt.GanttTaskControl){_4.forEach(this.arrTabs,function(tab){if(tab.type=="t"){tab.object=_1a;this.addItemMenuPanel(tab);}},this);}else{if(_1a.constructor==_6.gantt.GanttProjectControl){_4.forEach(this.arrTabs,function(tab){if(tab.type=="p"){tab.object=_1a;this.addItemMenuPanel(tab);}},this);}}this.isShow=true;_4.style(this.menuPanel,{zIndex:15,visibility:"visible"});var _1b=_4.position(this.menuPanel,true),_1c=_4.position(this.ganttChart.content,true),pos=_4.coords(_19,true);if((pos.y+_1b.h)>(_1c.y+_1c.h+50)){this.menuPanel.style.top=pos.y-_1b.h+pos.h+"px";}else{this.menuPanel.style.top=pos.y+"px";}if(_4._isBodyLtr()){this.menuPanel.style.left=pos.x+pos.w+5+"px";}else{this.menuPanel.style.left=pos.x-_1b.w-5+"px";}},hide:function(){this.isShow=false;this.menuPanel.style.visibility="hidden";},clear:function(){this.menuPanel.removeChild(this.menuPanel.firstChild);this.menuPanel.innerHTML="<table></table>";_4.addClass(this.menuPanel.firstChild,"ganttContextMenu");this.menuPanel.firstChild.cellPadding=0;this.menuPanel.firstChild.cellSpacing=0;},createTab:function(id,_1d,_1e,_1f,_20,_21){var tab=new _6.gantt.contextMenuTab(id,_1d,_1e,_1f,_20,_21);this.arrTabs.push(tab);return tab;}});_4.declare("dojox.gantt.contextMenuTab",null,{constructor:function(id,_22,_23,_24,_25,_26){this.id=id;this.arrItems=[];this.TabItemContainer=null;this.Description=_22;this.tabMenu=_25;this.type=_23;this.object=null;this.showObjectInfo=_24;this.withDefaultValue=_26;},preValueValidation:function(_27){for(var i=0;i<_27.length;i++){var _28=_27[i];if(_28.required&&!_28.control.textbox.value){return false;}}return true;},encodeDate:function(_29){return _29.getFullYear()+"."+(_29.getMonth()+1)+"."+_29.getDate();},decodeDate:function(_2a){var arr=_2a.split(".");return (arr.length<3)?"":(new Date(arr[0],parseInt(arr[1])-1,arr[2]));},renameTaskAction:function(){var _2b=this.arrItems[0].control.textbox.value;if(_4.trim(_2b).length<=0){return;}if(!this.preValueValidation(this.arrItems)){return;}this.object.setName(_2b);this.hide();},deleteAction:function(){if(!this.preValueValidation(this.arrItems)){return;}this.object.project.deleteTask(this.object.taskItem.id);this.hide();this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct();},durationUpdateAction:function(){var d=this.arrItems[0].control.textbox.value;if(!this.preValueValidation(this.arrItems)){return;}if(this.object.setDuration(d)){this.hide();}else{alert("Duration out of Range");return;}this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.refresh();},cpUpdateAction:function(){var p=this.arrItems[0].control.textbox.value;if(!this.preValueValidation(this.arrItems)){return;}if(this.object.setPercentCompleted(p)){this.hide();}else{alert("Complete Percentage out of Range");return;}},ownerUpdateAction:function(){var to=this.arrItems[0].control.textbox.value;if(!this.preValueValidation(this.arrItems)){return;}if(this.object.setTaskOwner(to)){this.hide();}else{alert("Task owner not Valid");return;}this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct();},ptUpdateAction:function(){var p=this.arrItems[0].control.textbox.value;if(!this.preValueValidation(this.arrItems)){return;}if(this.object.setPreviousTask(p)){this.hide();}else{alert("Please verify the Previous Task ("+p+")  and adjust its Time Range");return;}},renameProjectAction:function(){var _2c=this.arrItems[0].control.textbox.value;if(_4.trim(_2c).length<=0){return;}if(!this.preValueValidation(this.arrItems)){return;}this.object.setName(_2c);this.hide();},deleteProjectAction:function(){if(!this.preValueValidation(this.arrItems)){return;}this.object.ganttChart.deleteProject(this.object.project.id);this.hide();this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct();},cpProjectAction:function(){var p=this.arrItems[0].control.textbox.value;if(!this.preValueValidation(this.arrItems)){return;}if(this.object.setPercentCompleted(p)){this.hide();}else{alert("Percentage not Acceptable");return;}},addTaskAction:function(){if(!this.preValueValidation(this.arrItems)){return;}var id=this.arrItems[0].control.textbox.value,_2d=this.arrItems[1].control.textbox.value,_2e=this.decodeDate(this.arrItems[2].control.textbox.value),_2f=this.arrItems[3].control.textbox.value,pc=this.arrItems[4].control.textbox.value,_30=this.arrItems[5].control.textbox.value,_31=this.arrItems[6].control.textbox.value,_32=this.arrItems[7].control.textbox.value;if(_4.trim(id).length<=0){return;}if(this.object.insertTask(id,_2d,_2e,_2f,pc,_32,_30,_31)){this.hide();}else{alert("Please adjust your Customization");return;}this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct();},addSuccessorTaskAction:function(){if(!this.preValueValidation(this.arrItems)){return;}var pr=this.object.project,id=this.arrItems[0].control.textbox.value,_33=this.arrItems[1].control.textbox.value,_34=this.decodeDate(this.arrItems[2].control.textbox.value),_35=this.arrItems[3].control.textbox.value,pc=this.arrItems[4].control.textbox.value,_36=this.arrItems[5].control.textbox.value;if(_4.trim(id).length<=0){return;}var _37=!this.object.parentTask?"":this.object.parentTask.taskItem.id;var _38=this.object.taskItem.id;if(pr.insertTask(id,_33,_34,_35,pc,_38,_36,_37)){this.hide();}else{alert("Please adjust your Customization");return;}this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct();},addChildTaskAction:function(){if(!this.preValueValidation(this.arrItems)){return;}var pr=this.object.project,id=this.arrItems[0].control.textbox.value,_39=this.arrItems[1].control.textbox.value,_3a=this.decodeDate(this.arrItems[2].control.textbox.value),_3b=this.arrItems[3].control.textbox.value,pc=this.arrItems[4].control.textbox.value,_3c=this.arrItems[5].control.textbox.value,_3d=this.object.taskItem.id,_3e="";if(_4.trim(id).length<=0){return;}if(pr.insertTask(id,_39,_3a,_3b,pc,_3e,_3c,_3d)){this.hide();}else{alert("Please adjust your Customization");return;}this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct();},addProjectAction:function(){if(!this.preValueValidation(this.arrItems)){return;}var id=this.arrItems[0].control.textbox.value,_3f=this.arrItems[1].control.textbox.value,_40=this.decodeDate(this.arrItems[2].control.textbox.value);if(_4.trim(id).length<=0||_4.trim(_3f).length<=0){return;}if(this.tabMenu.ganttChart.insertProject(id,_3f,_40)){this.hide();}else{alert("Please adjust your Customization");return;}this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct();},addAction:function(_41){this.actionFunc=this[_41];},addItem:function(id,_42,key,_43){var _44;if(key=="startTime"||key=="startDate"){_44=new _5.form.DateTextBox({type:"text",constraints:{datePattern:"yyyy.M.d",strict:true}});}else{if(key=="percentage"){_44=new _5.form.NumberSpinner({constraints:{max:100,min:0}});}else{if(key=="duration"){_44=new _5.form.NumberSpinner({constraints:{min:0}});}else{_44=new _5.form.TextBox();}}}this.arrItems.push({id:id,name:_42,control:_44,tab:this,key:key,required:_43});},show:function(){this.tabMenu.tabPanelDlg=this.tabMenu.tabPanelDlg||_5.byId(this.tabMenu.tabPanelDlgId)||new _5.Dialog({title:"Settings"});try{this.tabMenu.tabPanelDlg.show();}catch(e){console.log("dialog show exception: "+e.message);return;}this.tabMenu.tabPanelDlg.titleNode.innerHTML=this.Description;var _45=this.tabMenu.paneContentArea.firstChild.rows[1].cells[0].firstChild,_46=this.tabMenu.paneActionBar;var _47,_48,row=null;if(this.showObjectInfo){if(this.object){if(this.object.constructor==_6.gantt.GanttTaskControl){this.insertData(_45,"Id",this.object.taskItem.id);this.insertData(_45,"Name",this.object.taskItem.name);this.insertData(_45,"Start Time",this.encodeDate(this.object.taskItem.startTime));this.insertData(_45,"Duration (hours)",this.object.taskItem.duration+" hours");this.insertData(_45,"Percent Complete (%)",this.object.taskItem.percentage+"%");this.insertData(_45,"Task Assignee",this.object.taskItem.taskOwner);this.insertData(_45,"Previous Task Id",this.object.taskItem.previousTaskId);}else{this.insertData(_45,"Id",this.object.project.id);this.insertData(_45,"Name",this.object.project.name);this.insertData(_45,"Start date",this.encodeDate(this.object.project.startDate));}}}row=_45.insertRow(_45.rows.length);_47=row.insertCell(row.cells.length);_47.colSpan=2;_47.innerHTML="<hr/>";row=_45.insertRow(_45.rows.length);_47=row.insertCell(row.cells.length);_47.colSpan=2;_4.addClass(_47,"ganttMenuDialogInputCellHeader");_47.innerHTML="Customization: "+this.Description;_4.forEach(this.arrItems,function(_49){row=_45.insertRow(_45.rows.length);_47=row.insertCell(row.cells.length);_4.addClass(_47,"ganttMenuDialogInputCell");_48=row.insertCell(row.cells.length);_4.addClass(_48,"ganttMenuDialogInputCellValue");_47.innerHTML=_49.name;_48.appendChild(_49.control.domNode);if(this.withDefaultValue&&this.object){if(this.object.constructor==_6.gantt.GanttTaskControl){if(_49.key=="startTime"){_49.control.textbox.value=this.encodeDate(this.object.taskItem.startTime);}else{_49.control.textbox.value=_49.key?this.object.taskItem[_49.key]:"";}}else{if(_49.key=="startDate"){_49.control.textbox.value=this.encodeDate(this.object.project.startDate);}else{_49.control.textbox.value=_49.key?(this.object.project[_49.key]||this.object[_49.key]||""):"";}}}else{_49.control.textbox.placeholder=_49.required?"---required---":"---optional---";}},this);this.tabMenu.ok.onClick=_4.hitch(this,this.actionFunc);this.tabMenu.cancel.onClick=_4.hitch(this,this.hide);},hide:function(){try{this.tabMenu.tabPanelDlg.hide();}catch(e){console.log("dialog show exception: "+e.message);this.tabMenu.tabPanelDlg.destroy();}var _4a=this.tabMenu.paneContentArea.firstChild.rows[1].cells[0];_4a.firstChild.parentNode.removeChild(_4a.firstChild);_4a.innerHTML="<table></table>";_4.addClass(_4a.firstChild,"ganttDialogContentCell");},insertData:function(_4b,_4c,_4d){var _4e,_4f,row=null;row=_4b.insertRow(_4b.rows.length);_4e=row.insertCell(row.cells.length);_4.addClass(_4e,"ganttMenuDialogDescCell");_4e.innerHTML=_4c;_4f=row.insertCell(row.cells.length);_4.addClass(_4f,"ganttMenuDialogDescCellValue");_4f.innerHTML=_4d;}});})();}}};});