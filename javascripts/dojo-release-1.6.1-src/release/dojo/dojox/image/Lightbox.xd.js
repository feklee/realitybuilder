/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realityBuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.image.Lightbox"],["require","dojo.window"],["require","dijit.Dialog"],["require","dojox.fx._base"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.image.Lightbox"]){_4._hasResource["dojox.image.Lightbox"]=true;_4.provide("dojox.image.Lightbox");_4.experimental("dojox.image.Lightbox");_4.require("dojo.window");_4.require("dijit.Dialog");_4.require("dojox.fx._base");_4.declare("dojox.image.Lightbox",_5._Widget,{group:"",title:"",href:"",duration:500,modal:false,_allowPassthru:false,_attachedDialog:null,startup:function(){this.inherited(arguments);var _7=_5.byId("dojoxLightboxDialog");if(_7){this._attachedDialog=_7;}else{this._attachedDialog=new _6.image.LightboxDialog({id:"dojoxLightboxDialog"});this._attachedDialog.startup();}if(!this.store){this._addSelf();this.connect(this.domNode,"onclick","_handleClick");}},_addSelf:function(){this._attachedDialog.addImage({href:this.href,title:this.title},this.group||null);},_handleClick:function(e){if(!this._allowPassthru){e.preventDefault();}else{return;}this.show();},show:function(){this._attachedDialog.show(this);},hide:function(){this._attachedDialog.hide();},disable:function(){this._allowPassthru=true;},enable:function(){this._allowPassthru=false;},onClick:function(){},destroy:function(){this._attachedDialog.removeImage(this);this.inherited(arguments);}});_4.declare("dojox.image.LightboxDialog",_5.Dialog,{title:"",inGroup:null,imgUrl:_5._Widget.prototype._blankGif,errorMessage:"Image not found.",adjust:true,modal:false,errorImg:_4.moduleUrl("dojox.image","resources/images/warning.png"),templateString:_4.cache("dojox.image","resources/Lightbox.html","<div class=\"dojoxLightbox\" dojoAttachPoint=\"containerNode\">\r\n\t<div style=\"position:relative\">\r\n\t\t<div dojoAttachPoint=\"imageContainer\" class=\"dojoxLightboxContainer\" dojoAttachEvent=\"onclick: _onImageClick\">\r\n\t\t\t<img dojoAttachPoint=\"imgNode\" src=\"${imgUrl}\" class=\"dojoxLightboxImage\" alt=\"${title}\">\r\n\t\t\t<div class=\"dojoxLightboxFooter\" dojoAttachPoint=\"titleNode\">\r\n\t\t\t\t<div class=\"dijitInline LightboxClose\" dojoAttachPoint=\"closeButtonNode\"></div>\r\n\t\t\t\t<div class=\"dijitInline LightboxNext\" dojoAttachPoint=\"nextButtonNode\"></div>\t\r\n\t\t\t\t<div class=\"dijitInline LightboxPrev\" dojoAttachPoint=\"prevButtonNode\"></div>\r\n\t\t\t\t<div class=\"dojoxLightboxText\" dojoAttachPoint=\"titleTextNode\"><span dojoAttachPoint=\"textNode\">${title}</span><span dojoAttachPoint=\"groupCount\" class=\"dojoxLightboxGroupText\"></span></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n"),constructor:function(_8){this._groups=this._groups||(_8&&_8._groups)||{XnoGroupX:[]};},startup:function(){this.inherited(arguments);this._animConnects=[];this.connect(this.nextButtonNode,"onclick","_nextImage");this.connect(this.prevButtonNode,"onclick","_prevImage");this.connect(this.closeButtonNode,"onclick","hide");this._makeAnims();this._vp=_4.window.getBox();return this;},show:function(_9){var _a=this;this._lastGroup=_9;if(!_a.open){_a.inherited(arguments);_a._modalconnects.push(_4.connect(_4.global,"onscroll",this,"_position"),_4.connect(_4.global,"onresize",this,"_position"),_4.connect(_4.body(),"onkeypress",this,"_handleKey"));if(!_9.modal){_a._modalconnects.push(_4.connect(_5._underlay.domNode,"onclick",this,"onCancel"));}}if(this._wasStyled){var _b=_4.create("img",null,_a.imgNode,"after");_4.destroy(_a.imgNode);_a.imgNode=_b;_a._makeAnims();_a._wasStyled=false;}_4.style(_a.imgNode,"opacity","0");_4.style(_a.titleNode,"opacity","0");var _c=_9.href;if((_9.group&&_9!=="XnoGroupX")||_a.inGroup){if(!_a.inGroup){_a.inGroup=_a._groups[(_9.group)];_4.forEach(_a.inGroup,function(g,i){if(g.href==_9.href){_a._index=i;}});}if(!_a._index){_a._index=0;var sr=_a.inGroup[_a._index];_c=(sr&&sr.href)||_a.errorImg;}_a.groupCount.innerHTML=" ("+(_a._index+1)+" of "+Math.max(1,_a.inGroup.length)+")";_a.prevButtonNode.style.visibility="visible";_a.nextButtonNode.style.visibility="visible";}else{_a.groupCount.innerHTML="";_a.prevButtonNode.style.visibility="hidden";_a.nextButtonNode.style.visibility="hidden";}if(!_9.leaveTitle){_a.textNode.innerHTML=_9.title;}_a._ready(_c);},_ready:function(_d){var _e=this;_e._imgError=_4.connect(_e.imgNode,"error",_e,function(){_4.disconnect(_e._imgError);_e.imgNode.src=_e.errorImg;_e.textNode.innerHTML=_e.errorMessage;});_e._imgConnect=_4.connect(_e.imgNode,"load",_e,function(e){_e.resizeTo({w:_e.imgNode.width,h:_e.imgNode.height,duration:_e.duration});_4.disconnect(_e._imgConnect);if(_e._imgError){_4.disconnect(_e._imgError);}});_e.imgNode.src=_d;},_nextImage:function(){if(!this.inGroup){return;}if(this._index+1<this.inGroup.length){this._index++;}else{this._index=0;}this._loadImage();},_prevImage:function(){if(this.inGroup){if(this._index==0){this._index=this.inGroup.length-1;}else{this._index--;}this._loadImage();}},_loadImage:function(){this._loadingAnim.play(1);},_prepNodes:function(){this._imageReady=false;if(this.inGroup&&this.inGroup[this._index]){this.show({href:this.inGroup[this._index].href,title:this.inGroup[this._index].title});}else{this.show({title:this.errorMessage,href:this.errorImg});}},_calcTitleSize:function(){var _f=_4.map(_4.query("> *",this.titleNode).position(),function(s){return s.h;});return {h:Math.max.apply(Math,_f)};},resizeTo:function(_10,_11){var _12=_4.boxModel=="border-box"?_4._getBorderExtents(this.domNode).w:0,_13=_11||this._calcTitleSize();this._lastTitleSize=_13;if(this.adjust&&(_10.h+_13.h+_12+80>this._vp.h||_10.w+_12+60>this._vp.w)){this._lastSize=_10;_10=this._scaleToFit(_10);}this._currentSize=_10;var _14=_6.fx.sizeTo({node:this.containerNode,duration:_10.duration||this.duration,width:_10.w+_12,height:_10.h+_13.h+_12});this.connect(_14,"onEnd","_showImage");_14.play(15);},_scaleToFit:function(_15){var ns={},nvp={w:this._vp.w-80,h:this._vp.h-60-this._lastTitleSize.h};var _16=nvp.w/nvp.h,_17=_15.w/_15.h;if(_17>=_16){ns.h=nvp.w/_17;ns.w=nvp.w;}else{ns.w=_17*nvp.h;ns.h=nvp.h;}this._wasStyled=true;this._setImageSize(ns);ns.duration=_15.duration;return ns;},_setImageSize:function(_18){var s=this.imgNode;s.height=_18.h;s.width=_18.w;},_size:function(){},_position:function(e){this._vp=_4.window.getBox();this.inherited(arguments);if(e&&e.type=="resize"){if(this._wasStyled){this._setImageSize(this._lastSize);this.resizeTo(this._lastSize);}else{if(this.imgNode.height+80>this._vp.h||this.imgNode.width+60>this._vp.h){this.resizeTo({w:this.imgNode.width,h:this.imgNode.height});}}}},_showImage:function(){this._showImageAnim.play(1);},_showNav:function(){var _19=_4.marginBox(this.titleNode);if(_19.h>this._lastTitleSize.h){this.resizeTo(this._wasStyled?this._lastSize:this._currentSize,_19);}else{this._showNavAnim.play(1);}},hide:function(){_4.fadeOut({node:this.titleNode,duration:200,onEnd:_4.hitch(this,function(){this.imgNode.src=this._blankGif;})}).play(5);this.inherited(arguments);this.inGroup=null;this._index=null;},addImage:function(_1a,_1b){var g=_1b;if(!_1a.href){return;}if(g){if(!this._groups[g]){this._groups[g]=[];}this._groups[g].push(_1a);}else{this._groups["XnoGroupX"].push(_1a);}},removeImage:function(_1c){var g=_1c.group||"XnoGroupX";_4.every(this._groups[g],function(_1d,i,ar){if(_1d.href==_1c.href){ar.splice(i,1);return false;}return true;});},removeGroup:function(_1e){if(this._groups[_1e]){this._groups[_1e]=[];}},_handleKey:function(e){if(!this.open){return;}var dk=_4.keys;switch(e.charOrCode){case dk.ESCAPE:this.hide();break;case dk.DOWN_ARROW:case dk.RIGHT_ARROW:case 78:this._nextImage();break;case dk.UP_ARROW:case dk.LEFT_ARROW:case 80:this._prevImage();break;}},_makeAnims:function(){_4.forEach(this._animConnects,_4.disconnect);this._animConnects=[];this._showImageAnim=_4.fadeIn({node:this.imgNode,duration:this.duration});this._animConnects.push(_4.connect(this._showImageAnim,"onEnd",this,"_showNav"));this._loadingAnim=_4.fx.combine([_4.fadeOut({node:this.imgNode,duration:175}),_4.fadeOut({node:this.titleNode,duration:175})]);this._animConnects.push(_4.connect(this._loadingAnim,"onEnd",this,"_prepNodes"));this._showNavAnim=_4.fadeIn({node:this.titleNode,duration:225});},onClick:function(_1f){},_onImageClick:function(e){if(e&&e.target==this.imgNode){this.onClick(this._lastGroup);if(this._lastGroup.declaredClass){this._lastGroup.onClick(this._lastGroup);}}}});}}};});