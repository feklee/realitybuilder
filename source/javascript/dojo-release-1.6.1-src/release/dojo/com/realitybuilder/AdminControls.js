/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["com.realitybuilder.AdminControls"]){dojo._hasResource["com.realitybuilder.AdminControls"]=true;dojo.provide("com.realitybuilder.AdminControls");dojo.require("dojox.date.posix");dojo.declare("com.realitybuilder.AdminControls",null,{_construction:null,constructor:function(_1){this._construction=_1;dojo.byId("bottomBar").style.width=_1.camera().sensor().width()+"px";this.updateToggleRealButton();this.updateTogglePendingButton();dojo.connect(dojo.byId("saveSettingsButton"),"onclick",this._construction,this._construction.storeSettingsOnServer);dojo.connect(dojo.byId("previewCameraButton"),"onclick",this,this.updateCamera);dojo.connect(dojo.byId("toggleRealButton"),"onclick",this._construction,this._construction.toggleReal);dojo.connect(dojo.byId("togglePendingButton"),"onclick",this._construction,this._construction.togglePending);dojo.connect(dojo.byId("logoutButton"),"onclick",this,this.logOut);},logOut:function(){location.href=logoutUrl;},updateToggleRealButton:function(){dojo.byId("toggleRealButton").innerHTML=(this._construction.showReal()?"Hide":"Show")+" Real Blocks";},updateTogglePendingButton:function(){dojo.byId("togglePendingButton").innerHTML=(this._construction.showPending()?"Hide":"Show")+" Pending Blocks";},updateCameraControls:function(_2){var _3=_2.position();dojo.byId("cameraX").value=_3[0];dojo.byId("cameraY").value=_3[1];dojo.byId("cameraZ").value=_3[2];dojo.byId("cameraAX").value=_2.aX();dojo.byId("cameraAY").value=_2.aY();dojo.byId("cameraAZ").value=_2.aZ();dojo.byId("cameraFl").value=_2.fl();dojo.byId("cameraSensorResolution").value=_2.sensorResolution();},updateImageControls:function(_4){dojo.byId("imageURL").value=_4.url();dojo.byId("imageUpdateIntervalServer").value=_4.updateIntervalServer();},readImageControls:function(){var _5={"url":dojo.byId("imageURL").value||"","updateIntervalServer":parseFloat(dojo.byId("imageUpdateIntervalServer").value)||5};return _5;},readCameraControls:function(){var _6={"position":[parseFloat(dojo.byId("cameraX").value)||0,parseFloat(dojo.byId("cameraY").value)||0,parseFloat(dojo.byId("cameraZ").value)||0],"aX":parseFloat(dojo.byId("cameraAX").value)||0,"aY":parseFloat(dojo.byId("cameraAY").value)||0,"aZ":parseFloat(dojo.byId("cameraAZ").value)||0,"fl":parseFloat(dojo.byId("cameraFl").value)||1,"sensorResolution":parseFloat(dojo.byId("cameraSensorResolution").value)||100};return _6;},updateCamera:function(){this._construction.camera().update(this.readCameraControls());},updateCoordinateDisplays:function(){var _7,a;_7=this._construction.newBlock().positionB();a=this._construction.newBlock().a();dojo.byId("newBlockXB").innerHTML=_7[0].toString();dojo.byId("newBlockYB").innerHTML=_7[1].toString();dojo.byId("newBlockZB").innerHTML=_7[2].toString();dojo.byId("newBlockA").innerHTML=a.toString();},_sortForTable:function(x,y){if(x.state()===y.state()){if(x.timeStamp()>y.timeStamp()){return -1;}else{if(x.timeStamp()<y.timeStamp()){return 1;}else{return 0;}}}else{if(x.state()===1){return -1;}else{if(x.state()===2){return y.state()===1?1:-1;}else{return 1;}}}},_blocksSortedForTable:function(){var _8=dojo.map(this._construction.constructionBlocks().blocks(),function(_9){return _9;});_8.sort(this._sortForTable);return _8;},_applyStateFromStateSelector:function(_a,_b){this._construction.constructionBlocks().setBlockStateOnServer(_b.positionB(),_b.a(),parseInt(_a.value,10));},_stateSelector:function(_c){var _d=document.createElement("select"),_e=["Deleted","Pending","Real"],_f,_10,_11;dojo.attr(_d,"size",1);for(_f=0;_f<3;_f+=1){_10=_e[_f];_11=document.createElement("option");dojo.attr(_11,"value",_f);if(_f===_c.state()){dojo.attr(_11,"selected","");}_11.innerHTML=_10;_d.appendChild(_11);}dojo.connect(_d,"onchange",this,function(_12){this._applyStateFromStateSelector(_d,_c);});return _d;},_appendBlocksTableRow:function(_13,_14){var _15,row,_16,_17,_18,_19;_15=_13.positionB();row=document.createElement("tr");_16=new Date(_13.timeStamp()*1000);_17=dojox.date.posix.strftime(_16,"%Y-%m-%d %H:%M:%S");_18=[_15[0],_15[1],_15[2],_13.a(),_17,this._stateSelector(_13)];dojo.forEach(_18,function(_1a,i){_19=document.createElement("td");if(i<5){_19.innerHTML=_1a;}else{_19.appendChild(_1a);}if(i<4){dojo.addClass(_19,"number");}row.appendChild(_19);});_14.appendChild(row);},updateBlocksTable:function(){var _1b=dojo.query("#blocksTable tbody"),_1c=_1b[0],_1d=this._blocksSortedForTable(),_1e=this;dojo.empty(_1c);dojo.forEach(_1d,function(_1f){_1e._appendBlocksTableRow(_1f,_1c);});}});}