/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["com.realitybuilder.Shadow"]){dojo._hasResource["com.realitybuilder.Shadow"]=true;dojo.provide("com.realitybuilder.Shadow");dojo.require("com.realitybuilder.LayerShadow");dojo.require("com.realitybuilder.ShadowObscuringBlocks");dojo.declare("com.realitybuilder.Shadow",null,{_newBlock:null,_camera:null,_blockProperties:null,_constructionBlocks:null,_shadowObscuringBlocks:null,_layerShadow:null,constructor:function(_1,_2,_3,_4){this._newBlock=_1;this._blockProperties=_2;this._camera=_3;this._constructionBlocks=_4;this._shadowObscuringBlocks=new com.realitybuilder.ShadowObscuringBlocks(_1,_2,_3,_4);this._layerShadow=new com.realitybuilder.LayerShadow(_1,_2,_3,_4);},_renderLayerShadow:function(_5,_6,_7,_8,_9,_a){this._layerShadow.render(_9,_a);_5.globalAlpha=0.2;_5.drawImage(this._layerShadow.canvas(),0,0);_5.globalAlpha=1;},render:function(_b){var _c=this._camera.sensor().shadowCanvas(),_d,_e,_f=this._newBlock,_10=this._camera,_11=this._constructionBlocks,_12=_11.highestRealBlocksZB();this._shadowObscuringBlocks.update();if(_c.getContext){_d=_c.getContext("2d");com.realitybuilder.util.clearCanvas(_c);for(_e=-1;_e<=_12;_e+=1){if(_e<_f.zB()){this._renderLayerShadow(_d,_f,_10,_11,_e,_b);}this._shadowObscuringBlocks.subtract(_d,_e+1);}return;}},clear:function(){var _13=this._camera.sensor().shadowCanvas();com.realitybuilder.util.clearCanvas(_13);}});}