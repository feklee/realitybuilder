/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["com.realitybuilder.util"]){dojo._hasResource["com.realitybuilder.util"]=true;dojo.provide("com.realitybuilder.util");com.realitybuilder.util.TOLERANCE_S=0.5;com.realitybuilder.util.TOLERANCE_V=0.00001;com.realitybuilder.util.TOLERANCE_VXZ=0.00001;com.realitybuilder.util.blockToWorld=function(pB,_1){var _2=_1.positionSpacingXY(),_3=_1.positionSpacingXY(),_4=_1.positionSpacingZ();return [pB[0]*_2,pB[1]*_3,pB[2]*_4];};com.realitybuilder.util.intersectionLinePlaneVXZ=function(_5){var _6,p1=_5[0],p2=_5[1];_6=com.realitybuilder.util.subtractVectors3D(p2,p1);if(Math.abs(_6[1])<com.realitybuilder.util.TOLERANCE_V){return false;}else{return [p1[0]-p1[1]*_6[0]/_6[1],p1[2]-p1[1]*_6[2]/_6[1]];}};com.realitybuilder.util.intersectionSegmentLineVXZ=function(_7,_8){var x1=_7[0][0],z1=_7[0][1],x2=_7[1][0],z2=_7[1][1],x3=_8[0][0],y3=_8[0][1],x4=_8[1][0],y4=_8[1][1],u1=(x4-x3)*(z1-y3)-(y4-y3)*(x1-x3),u2=(y4-y3)*(x2-x1)-(x4-x3)*(z2-z1),_9=0.01,u,x,y;if(Math.abs(u2)<_9){return false;}else{u=u1/u2;if(u>-_9&&u<1+_9){x=x1+u*(x2-x1);y=z1+u*(z2-z1);return [x,y];}else{return false;}}};com.realitybuilder.util.relationPointSegmentVXZ=function(_a,_b){var _c,_d,_e,_f;_f=com.realitybuilder.util;_c=[0,0];_d=[_c,_a];_e=_f.intersectionSegmentLineVXZ(_b,_d);if(_e===false){return 0;}else{if(_f.pointsIdenticalVXZ(_e,_a)){return 0;}else{return _f.pointIsBetween2D(_a,_c,_e)?-1:1;}}};com.realitybuilder.util.pointIsBetween2D=function(p,p1,p2){var _10=(p[0]>=p1[0]&&p[0]<=p2[0])||(p[0]<=p1[0]&&p[0]>=p2[0]),_11=(p[1]>=p1[1]&&p[1]<=p2[1])||(p[1]<=p1[1]&&p[1]>=p2[1]);return _10&&_11;};com.realitybuilder.util.pointsIdentical2D=function(p1,p2,_12){return (Math.abs(p1[0]-p2[0])<_12&&Math.abs(p1[1]-p2[1])<_12);};com.realitybuilder.util.pointsIdenticalS=function(p1S,p2S){var _13=com.realitybuilder.util.TOLERANCE_S;return com.realitybuilder.util.pointsIdentical2D(p1S,p2S,_13);};com.realitybuilder.util.pointsIdenticalVXZ=function(_14,_15){var _16=com.realitybuilder.util.TOLERANCE_VXZ;return com.realitybuilder.util.pointsIdentical2D(_14,_15,_16);};com.realitybuilder.util.pointsIdenticalB=function(p1B,p2B){return ((p1B[0]-p2B[0])===0&&(p1B[1]-p2B[1])===0&&(p1B[2]-p2B[2])===0);};com.realitybuilder.util.subtractVectors3D=function(_17,_18){return [_17[0]-_18[0],_17[1]-_18[1],_17[2]-_18[2]];};com.realitybuilder.util.addVectorsB=function(_19,_1a){return [_19[0]+_1a[0],_19[1]+_1a[1],_19[2]+_1a[2]];};com.realitybuilder.util.subtractVectorsB=function(_1b,_1c){return [_1b[0]-_1c[0],_1b[1]-_1c[1],_1b[2]-_1c[2]];};com.realitybuilder.util.withDuplicatesRemoved=function(ps){var _1d=[],i,j,p1,p2,_1e;for(i=0;i<ps.length;i+=1){p1=ps[i];_1e=false;for(j=i+1;j<ps.length;j+=1){p2=ps[j];if(com.realitybuilder.util.pointsIdenticalS(p1,p2)){_1e=true;break;}}if(!_1e){_1d.push(p1);}}return _1d;};com.realitybuilder.util.cartesianToPolar=function(pS){var x=pS[0],y=pS[1],_1f=Math.atan2(y,x),_20=Math.sqrt(x*x+y*y);return [_1f,_20];};com.realitybuilder.util.addS=function(p1S,p2S){return [p1S[0]+p2S[0],p1S[1]+p2S[1]];};com.realitybuilder.util.polarToCartesian=function(_21){var _22=_21[0],_23=_21[1],x=_23*Math.cos(_22),y=_23*Math.sin(_22);return [x,y];};com.realitybuilder.util.addPrefix=function(_24,_25){var tmp=[],i;for(i in _25){if(_25.hasOwnProperty(i)){tmp[_24.toString()+i.toString()]=_25[i];}}return tmp;};com.realitybuilder.util.isFlashCanvasActive=function(){return (typeof FlashCanvas!=="undefined");};com.realitybuilder.util.isFlashReadyForFlashCanvas=function(){return swfobject.hasFlashPlayerVersion("9");};com.realitybuilder.util.isCanvasSupported=function(){return (document.createElement("canvas").getContext||(com.realitybuilder.util.isFlashCanvasActive()&&com.realitybuilder.util.isFlashReadyForFlashCanvas()));};com.realitybuilder.util.showNoCanvasErrorMessage=function(){dojo.attr("noCanvasErrorMessage","innerHTML","<p class=\"first\">The Reality Builder does not work because your "+"browser does not support the <a "+"href=\"http://www.w3.org/TR/html5/the-canvas-element.html\">Canvas "+"element</a>.</p>");};com.realitybuilder.util.showNoImagesErrorMessage=function(){dojo.attr("noImagesErrorMessage","innerHTML","<p class=\"first\">The Reality Builder does not work because your "+"browser does not load images.</p>");};com.realitybuilder.util.clearCanvas=function(_26){if(_26.getContext){var _27=_26.getContext("2d");_27.clearRect(0,0,_26.width,_26.height);}};com.realitybuilder.util.fillCanvas=function(_28,_29){if(_28.getContext){var _2a=_28.getContext("2d");_2a.fillStyle=_29;_2a.fillRect(0,0,_28.width,_28.height);}};}