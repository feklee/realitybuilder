/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realitybuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojo.data.ObjectStore"],["require","dojo.regexp"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojo.data.ObjectStore"]){_4._hasResource["dojo.data.ObjectStore"]=true;_4.provide("dojo.data.ObjectStore");_4.require("dojo.regexp");_4.declare("dojo.data.ObjectStore",null,{objectStore:null,constructor:function(_7){_4.mixin(this,_7);},labelProperty:"label",getValue:function(_8,_9,_a){return typeof _8.get==="function"?_8.get(_9):_9 in _8?_8[_9]:_a;},getValues:function(_b,_c){var _d=this.getValue(_b,_c);return _d instanceof Array?_d:_d===undefined?[]:[_d];},getAttributes:function(_e){var _f=[];for(var i in _e){if(_e.hasOwnProperty(i)&&!(i.charAt(0)=="_"&&i.charAt(1)=="_")){_f.push(i);}}return _f;},hasAttribute:function(_10,_11){return _11 in _10;},containsValue:function(_12,_13,_14){return _4.indexOf(this.getValues(_12,_13),_14)>-1;},isItem:function(_15){return (typeof _15=="object")&&_15&&!(_15 instanceof Date);},isItemLoaded:function(_16){return _16&&typeof _16.load!=="function";},loadItem:function(_17){var _18;if(typeof _17.item.load==="function"){_4.when(_17.item.load(),function(_19){_18=_19;var _1a=_19 instanceof Error?_17.onError:_17.onItem;if(_1a){_1a.call(_17.scope,_19);}});}else{if(_17.onItem){_17.onItem.call(_17.scope,_17.item);}}return _18;},close:function(_1b){return _1b&&_1b.abort&&_1b.abort();},fetch:function(_1c){_1c=_1c||{};var _1d=this;var _1e=_1c.scope||_1d;var _1f=_1c.query;if(typeof _1f=="object"){_1f=_4.delegate(_1f);for(var i in _1f){var _20=_1f[i];if(typeof _20=="string"){_1f[i]=RegExp("^"+_4.regexp.escapeString(_20,"*?").replace(/\*/g,".*").replace(/\?/g,".")+"$",_1c.queryOptions&&_1c.queryOptions.ignoreCase?"mi":"m");_1f[i].toString=(function(_21){return function(){return _21;};})(_20);}}}var _22=this.objectStore.query(_1f,_1c);_4.when(_22.total,function(_23){_4.when(_22,function(_24){if(_1c.onBegin){_1c.onBegin.call(_1e,_23||_24.length,_1c);}if(_1c.onItem){for(var i=0;i<_24.length;i++){_1c.onItem.call(_1e,_24[i],_1c);}}if(_1c.onComplete){_1c.onComplete.call(_1e,_1c.onItem?null:_24,_1c);}return _24;},_25);},_25);function _25(_26){if(_1c.onError){_1c.onError.call(_1e,_26,_1c);}};_1c.abort=function(){if(_22.cancel){_22.cancel();}};_1c.store=this;return _1c;},getFeatures:function(){return {"dojo.data.api.Read":!!this.objectStore.get,"dojo.data.api.Identity":true,"dojo.data.api.Write":!!this.objectStore.put,"dojo.data.api.Notification":true};},getLabel:function(_27){if(this.isItem(_27)){return this.getValue(_27,this.labelProperty);}return undefined;},getLabelAttributes:function(_28){return [this.labelProperty];},getIdentity:function(_29){return _29.getId?_29.getId():_29[this.objectStore.idProperty||"id"];},getIdentityAttributes:function(_2a){return [this.objectStore.idProperty];},fetchItemByIdentity:function(_2b){var _2c;_4.when(this.objectStore.get(_2b.identity),function(_2d){_2c=_2d;_2b.onItem.call(_2b.scope,_2d);},function(_2e){_2b.onError.call(_2b.scope,_2e);});return _2c;},newItem:function(_2f,_30){if(_30){var _31=this.getValue(_30.parent,_30.attribute,[]);_31=_31.concat([_2f]);_2f.__parent=_31;this.setValue(_30.parent,_30.attribute,_31);}this._dirtyObjects.push({object:_2f,save:true});this.onNew(_2f);return _2f;},deleteItem:function(_32){this.changing(_32,true);this.onDelete(_32);},setValue:function(_33,_34,_35){var old=_33[_34];this.changing(_33);_33[_34]=_35;this.onSet(_33,_34,old,_35);},setValues:function(_36,_37,_38){if(!_4.isArray(_38)){throw new Error("setValues expects to be passed an Array object as its value");}this.setValue(_36,_37,_38);},unsetAttribute:function(_39,_3a){this.changing(_39);var old=_39[_3a];delete _39[_3a];this.onSet(_39,_3a,old,undefined);},_dirtyObjects:[],changing:function(_3b,_3c){_3b.__isDirty=true;for(var i=0;i<this._dirtyObjects.length;i++){var _3d=this._dirtyObjects[i];if(_3b==_3d.object){if(_3c){_3d.object=false;if(!this._saveNotNeeded){_3d.save=true;}}return;}}var old=_3b instanceof Array?[]:{};for(i in _3b){if(_3b.hasOwnProperty(i)){old[i]=_3b[i];}}this._dirtyObjects.push({object:!_3c&&_3b,old:old,save:!this._saveNotNeeded});},save:function(_3e){_3e=_3e||{};var _3f,_40=[];var _41={};var _42=[];var _43;var _44=this._dirtyObjects;var _45=_44.length;try{_4.connect(_3e,"onError",function(){if(_3e.revertOnError!==false){var _46=_44;_44=_42;var _47=0;jr.revert();_43._dirtyObjects=_46;}else{_43._dirtyObjects=dirtyObject.concat(_42);}});if(this.objectStore.transaction){var _48=this.objectStore.transaction();}for(var i=0;i<_44.length;i++){var _49=_44[i];var _4a=_49.object;var old=_49.old;delete _4a.__isDirty;if(_4a){_3f=this.objectStore.put(_4a,{overwrite:!!old});}else{_3f=this.objectStore.remove(this.getIdentity(old));}_42.push(_49);_44.splice(i--,1);_4.when(_3f,function(_4b){if(!(--_45)){if(_3e.onComplete){_3e.onComplete.call(_3e.scope,_40);}}},function(_4c){_45=-1;_3e.onError.call(_3e.scope,_4c);});}if(_48){_48.commit();}}catch(e){_3e.onError.call(_3e.scope,value);}},revert:function(_4d){var _4e=this._dirtyObjects;for(var i=_4e.length;i>0;){i--;var _4f=_4e[i];var _50=_4f.object;var old=_4f.old;if(_50&&old){for(var j in old){if(old.hasOwnProperty(j)&&_50[j]!==old[j]){this.onSet(_50,j,_50[j],old[j]);_50[j]=old[j];}}for(j in _50){if(!old.hasOwnProperty(j)){this.onSet(_50,j,_50[j]);delete _50[j];}}}else{if(!old){this.onDelete(_50);}else{this.onNew(old);}}delete (_50||old).__isDirty;_4e.splice(i,1);}},isDirty:function(_51){if(!_51){return !!this._dirtyObjects.length;}return _51.__isDirty;},onSet:function(){},onNew:function(){},onDelete:function(){}});}}};});