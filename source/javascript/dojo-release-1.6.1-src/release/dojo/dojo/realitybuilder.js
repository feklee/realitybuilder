/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is an optimized version of Dojo, built for deployment and not for
	development. To get sources and documentation, please visit:

		http://dojotoolkit.org
*/

if(!dojo._hasResource["dojox.math._base"]){dojo._hasResource["dojox.math._base"]=true;dojo.provide("dojox.math._base");dojo.getObject("math",true,dojox);(function(){var m=dojox.math;dojo.mixin(dojox.math,{toRadians:function(n){return (n*Math.PI)/180;},toDegrees:function(n){return (n*180)/Math.PI;},degreesToRadians:function(n){return m.toRadians(n);},radiansToDegrees:function(n){return m.toDegrees(n);},_gamma:function(z){var _1=1;while(--z>=1){_1*=z;}if(z==0){return _1;}if(Math.floor(z)==z){return NaN;}if(z==-0.5){return Math.sqrt(Math.PI);}if(z<-0.5){return Math.PI/(Math.sin(Math.PI*(z+1))*this._gamma(-z));}var a=13;var c=[0.000005665805601518633,1.274371766337968,-4.937419909315511,7.872026703248596,-6.676050374943609,3.252529844448517,-0.9185252144102627,0.14474022977730785,-0.011627561382389852,0.0004011798075706662,-0.0000042652458386405745,6.665191329033609e-9,-1.5392547381874824e-13];var _2=c[0];for(var k=1;k<a;k++){_2+=c[k]/(z+k);}return _1*Math.pow(z+a,z+0.5)/Math.exp(z)*_2;},factorial:function(n){return this._gamma(n+1);},permutations:function(n,k){if(n==0||k==0){return 1;}return this.factorial(n)/this.factorial(n-k);},combinations:function(n,r){if(n==0||r==0){return 1;}return this.factorial(n)/(this.factorial(n-r)*this.factorial(r));},bernstein:function(t,n,i){return this.combinations(n,i)*Math.pow(t,i)*Math.pow(1-t,n-i);},gaussian:function(){var k=2;do{var i=2*Math.random()-1;var j=2*Math.random()-1;k=i*i+j*j;}while(k>=1);return i*Math.sqrt((-2*Math.log(k))/k);},range:function(a,b,_3){if(arguments.length<2){b=a,a=0;}var _4=[],s=_3||1,i;if(s>0){for(i=a;i<b;i+=s){_4.push(i);}}else{if(s<0){for(i=a;i>b;i+=s){_4.push(i);}}else{throw new Error("dojox.math.range: step must not be zero.");}}return _4;},distance:function(a,b){return Math.sqrt(Math.pow(b[0]-a[0],2)+Math.pow(b[1]-a[1],2));},midpoint:function(a,b){if(a.length!=b.length){console.error("dojox.math.midpoint: Points A and B are not the same dimensionally.",a,b);}var m=[];for(var i=0;i<a.length;i++){m[i]=(a[i]+b[i])/2;}return m;}});})();}if(!dojo._hasResource["dojox.math"]){dojo._hasResource["dojox.math"]=true;dojo.provide("dojox.math");dojo.getObject("math",true,dojox);}if(!dojo._hasResource["dojox.math.matrix"]){dojo._hasResource["dojox.math.matrix"]=true;dojo.provide("dojox.math.matrix");dojo.getObject("math.matrix",true,dojox);dojo.mixin(dojox.math.matrix,{iDF:0,ALMOST_ZERO:1e-10,multiply:function(a,b){var ay=a.length,ax=a[0].length,by=b.length,bx=b[0].length;if(ax!=by){console.warn("Can't multiply matricies of sizes "+ax+","+ay+" and "+bx+","+by);return [[0]];}var c=[];for(var k=0;k<ay;k++){c[k]=[];for(var i=0;i<bx;i++){c[k][i]=0;for(var m=0;m<ax;m++){c[k][i]+=a[k][m]*b[m][i];}}}return c;},product:function(){if(arguments.length==0){console.warn("can't multiply 0 matrices!");return 1;}var m=arguments[0];for(var i=1;i<arguments.length;i++){m=this.multiply(m,arguments[i]);}return m;},sum:function(){if(arguments.length==0){console.warn("can't sum 0 matrices!");return 0;}var m=this.copy(arguments[0]);var _5=m.length;if(_5==0){console.warn("can't deal with matrices of 0 rows!");return 0;}var _6=m[0].length;if(_6==0){console.warn("can't deal with matrices of 0 cols!");return 0;}for(var i=1;i<arguments.length;++i){var _7=arguments[i];if(_7.length!=_5||_7[0].length!=_6){console.warn("can't add matrices of different dimensions: first dimensions were "+_5+"x"+_6+", current dimensions are "+_7.length+"x"+_7[0].length);return 0;}for(var r=0;r<_5;r++){for(var c=0;c<_6;c++){m[r][c]+=_7[r][c];}}}return m;},inverse:function(a){if(a.length==1&&a[0].length==1){return [[1/a[0][0]]];}var _8=a.length,m=this.create(_8,_8),mm=this.adjoint(a),_9=this.determinant(a),dd=0;if(_9==0){console.warn("Determinant Equals 0, Not Invertible.");return [[0]];}else{dd=1/_9;}for(var i=0;i<_8;i++){for(var j=0;j<_8;j++){m[i][j]=dd*mm[i][j];}}return m;},determinant:function(a){if(a.length!=a[0].length){console.warn("Can't calculate the determinant of a non-squre matrix!");return 0;}var _a=a.length,_b=1,b=this.upperTriangle(a);for(var i=0;i<_a;i++){var _c=b[i][i];if(Math.abs(_c)<this.ALMOST_ZERO){return 0;}_b*=_c;}_b*=this.iDF;return _b;},upperTriangle:function(m){m=this.copy(m);var f1=0,_d=0,_e=m.length,v=1;this.iDF=1;for(var _f=0;_f<_e-1;_f++){if(typeof m[_f][_f]!="number"){console.warn("non-numeric entry found in a numeric matrix: m["+_f+"]["+_f+"]="+m[_f][_f]);}v=1;var _10=0;while((m[_f][_f]==0)&&!_10){if(_f+v>=_e){this.iDF=0;_10=1;}else{for(var r=0;r<_e;r++){_d=m[_f][r];m[_f][r]=m[_f+v][r];m[_f+v][r]=_d;}v++;this.iDF*=-1;}}for(var row=_f+1;row<_e;row++){if(typeof m[row][_f]!="number"){console.warn("non-numeric entry found in a numeric matrix: m["+row+"]["+_f+"]="+m[row][_f]);}if(typeof m[_f][row]!="number"){console.warn("non-numeric entry found in a numeric matrix: m["+_f+"]["+row+"]="+m[_f][row]);}if(m[_f][_f]!=0){var f1=(-1)*m[row][_f]/m[_f][_f];for(var i=_f;i<_e;i++){m[row][i]=f1*m[_f][i]+m[row][i];}}}}return m;},create:function(a,b,_11){_11=_11||0;var m=[];for(var i=0;i<b;i++){m[i]=[];for(var j=0;j<a;j++){m[i][j]=_11;}}return m;},ones:function(a,b){return this.create(a,b,1);},zeros:function(a,b){return this.create(a,b);},identity:function(_12,_13){_13=_13||1;var m=[];for(var i=0;i<_12;i++){m[i]=[];for(var j=0;j<_12;j++){m[i][j]=(i==j?_13:0);}}return m;},adjoint:function(a){var tms=a.length;if(tms<=1){console.warn("Can't find the adjoint of a matrix with a dimension less than 2");return [[0]];}if(a.length!=a[0].length){console.warn("Can't find the adjoint of a non-square matrix");return [[0]];}var m=this.create(tms,tms),ap=this.create(tms-1,tms-1);var ii=0,jj=0,ia=0,ja=0,det=0;for(var i=0;i<tms;i++){for(var j=0;j<tms;j++){ia=0;for(ii=0;ii<tms;ii++){if(ii==i){continue;}ja=0;for(jj=0;jj<tms;jj++){if(jj==j){continue;}ap[ia][ja]=a[ii][jj];ja++;}ia++;}det=this.determinant(ap);m[i][j]=Math.pow(-1,(i+j))*det;}}return this.transpose(m);},transpose:function(a){var m=this.create(a.length,a[0].length);for(var i=0;i<a.length;i++){for(var j=0;j<a[i].length;j++){m[j][i]=a[i][j];}}return m;},format:function(a,_14){_14=_14||5;function _15(x,dp){var fac=Math.pow(10,dp);var a=Math.round(x*fac)/fac;var b=a.toString();if(b.charAt(0)!="-"){b=" "+b;}if(b.indexOf(".")>-1){b+=".";}while(b.length<dp+3){b+="0";}return b;};var ya=a.length;var xa=ya>0?a[0].length:0;var _16="";for(var y=0;y<ya;y++){_16+="| ";for(var x=0;x<xa;x++){_16+=_15(a[y][x],_14)+" ";}_16+="|\n";}return _16;},copy:function(a){var ya=a.length,xa=a[0].length,m=this.create(xa,ya);for(var y=0;y<ya;y++){for(var x=0;x<xa;x++){m[y][x]=a[y][x];}}return m;},scale:function(a,_17){a=this.copy(a);var ya=a.length,xa=a[0].length;for(var y=0;y<ya;y++){for(var x=0;x<xa;x++){a[y][x]*=_17;}}return a;}});}if(!dojo._hasResource["dojox.xml.parser"]){dojo._hasResource["dojox.xml.parser"]=true;dojo.provide("dojox.xml.parser");dojox.xml.parser.parse=function(str,_18){var _19=dojo.doc;var doc;_18=_18||"text/xml";if(str&&dojo.trim(str)&&"DOMParser" in dojo.global){var _1a=new DOMParser();doc=_1a.parseFromString(str,_18);var de=doc.documentElement;var _1b="http://www.mozilla.org/newlayout/xml/parsererror.xml";if(de.nodeName=="parsererror"&&de.namespaceURI==_1b){var _1c=de.getElementsByTagNameNS(_1b,"sourcetext")[0];if(_1c){_1c=_1c.firstChild.data;}throw new Error("Error parsing text "+de.firstChild.data+" \n"+_1c);}return doc;}else{if("ActiveXObject" in dojo.global){var ms=function(n){return "MSXML"+n+".DOMDocument";};var dp=["Microsoft.XMLDOM",ms(6),ms(4),ms(3),ms(2)];dojo.some(dp,function(p){try{doc=new ActiveXObject(p);}catch(e){return false;}return true;});if(str&&doc){doc.async=false;doc.loadXML(str);var pe=doc.parseError;if(pe.errorCode!==0){throw new Error("Line: "+pe.line+"\n"+"Col: "+pe.linepos+"\n"+"Reason: "+pe.reason+"\n"+"Error Code: "+pe.errorCode+"\n"+"Source: "+pe.srcText);}}if(doc){return doc;}}else{if(_19.implementation&&_19.implementation.createDocument){if(str&&dojo.trim(str)&&_19.createElement){var tmp=_19.createElement("xml");tmp.innerHTML=str;var _1d=_19.implementation.createDocument("foo","",null);dojo.forEach(tmp.childNodes,function(_1e){_1d.importNode(_1e,true);});return _1d;}else{return _19.implementation.createDocument("","",null);}}}}return null;};dojox.xml.parser.textContent=function(_1f,_20){if(arguments.length>1){var _21=_1f.ownerDocument||dojo.doc;dojox.xml.parser.replaceChildren(_1f,_21.createTextNode(_20));return _20;}else{if(_1f.textContent!==undefined){return _1f.textContent;}var _22="";if(_1f){dojo.forEach(_1f.childNodes,function(_23){switch(_23.nodeType){case 1:case 5:_22+=dojox.xml.parser.textContent(_23);break;case 3:case 2:case 4:_22+=_23.nodeValue;}});}return _22;}};dojox.xml.parser.replaceChildren=function(_24,_25){var _26=[];if(dojo.isIE){dojo.forEach(_24.childNodes,function(_27){_26.push(_27);});}dojox.xml.parser.removeChildren(_24);dojo.forEach(_26,dojo.destroy);if(!dojo.isArray(_25)){_24.appendChild(_25);}else{dojo.forEach(_25,function(_28){_24.appendChild(_28);});}};dojox.xml.parser.removeChildren=function(_29){var _2a=_29.childNodes.length;while(_29.hasChildNodes()){_29.removeChild(_29.firstChild);}return _2a;};dojox.xml.parser.innerXML=function(_2b){if(_2b.innerXML){return _2b.innerXML;}else{if(_2b.xml){return _2b.xml;}else{if(typeof XMLSerializer!="undefined"){return (new XMLSerializer()).serializeToString(_2b);}}}return null;};}if(!dojo._hasResource["dojo.string"]){dojo._hasResource["dojo.string"]=true;dojo.provide("dojo.string");dojo.getObject("string",true,dojo);dojo.string.rep=function(str,num){if(num<=0||!str){return "";}var buf=[];for(;;){if(num&1){buf.push(str);}if(!(num>>=1)){break;}str+=str;}return buf.join("");};dojo.string.pad=function(_2c,_2d,ch,end){if(!ch){ch="0";}var out=String(_2c),pad=dojo.string.rep(ch,Math.ceil((_2d-out.length)/ch.length));return end?out+pad:pad+out;};dojo.string.substitute=function(_2e,map,_2f,_30){_30=_30||dojo.global;_2f=_2f?dojo.hitch(_30,_2f):function(v){return v;};return _2e.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(_31,key,_32){var _33=dojo.getObject(key,false,map);if(_32){_33=dojo.getObject(_32,false,_30).call(_30,_33,key);}return _2f(_33,key).toString();});};dojo.string.trim=String.prototype.trim?dojo.trim:function(str){str=str.replace(/^\s+/,"");for(var i=str.length-1;i>=0;i--){if(/\S/.test(str.charAt(i))){str=str.substring(0,i+1);break;}}return str;};}if(!dojo._hasResource["dojo.date.stamp"]){dojo._hasResource["dojo.date.stamp"]=true;dojo.provide("dojo.date.stamp");dojo.getObject("date.stamp",true,dojo);dojo.date.stamp.fromISOString=function(_34,_35){if(!dojo.date.stamp._isoRegExp){dojo.date.stamp._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/;}var _36=dojo.date.stamp._isoRegExp.exec(_34),_37=null;if(_36){_36.shift();if(_36[1]){_36[1]--;}if(_36[6]){_36[6]*=1000;}if(_35){_35=new Date(_35);dojo.forEach(dojo.map(["FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds"],function(_38){return _35["get"+_38]();}),function(_39,_3a){_36[_3a]=_36[_3a]||_39;});}_37=new Date(_36[0]||1970,_36[1]||0,_36[2]||1,_36[3]||0,_36[4]||0,_36[5]||0,_36[6]||0);if(_36[0]<100){_37.setFullYear(_36[0]||1970);}var _3b=0,_3c=_36[7]&&_36[7].charAt(0);if(_3c!="Z"){_3b=((_36[8]||0)*60)+(Number(_36[9])||0);if(_3c!="-"){_3b*=-1;}}if(_3c){_3b-=_37.getTimezoneOffset();}if(_3b){_37.setTime(_37.getTime()+_3b*60000);}}return _37;};dojo.date.stamp.toISOString=function(_3d,_3e){var _3f=function(n){return (n<10)?"0"+n:n;};_3e=_3e||{};var _40=[],_41=_3e.zulu?"getUTC":"get",_42="";if(_3e.selector!="time"){var _43=_3d[_41+"FullYear"]();_42=["0000".substr((_43+"").length)+_43,_3f(_3d[_41+"Month"]()+1),_3f(_3d[_41+"Date"]())].join("-");}_40.push(_42);if(_3e.selector!="date"){var _44=[_3f(_3d[_41+"Hours"]()),_3f(_3d[_41+"Minutes"]()),_3f(_3d[_41+"Seconds"]())].join(":");var _45=_3d[_41+"Milliseconds"]();if(_3e.milliseconds){_44+="."+(_45<100?"0":"")+_3f(_45);}if(_3e.zulu){_44+="Z";}else{if(_3e.selector!="time"){var _46=_3d.getTimezoneOffset();var _47=Math.abs(_46);_44+=(_46>0?"-":"+")+_3f(Math.floor(_47/60))+":"+_3f(_47%60);}}_40.push(_44);}return _40.join("T");};}if(!dojo._hasResource["dojox.atom.io.model"]){dojo._hasResource["dojox.atom.io.model"]=true;dojo.provide("dojox.atom.io.model");dojox.atom.io.model._Constants={"ATOM_URI":"http://www.w3.org/2005/Atom","ATOM_NS":"http://www.w3.org/2005/Atom","PURL_NS":"http://purl.org/atom/app#","APP_NS":"http://www.w3.org/2007/app"};dojox.atom.io.model._actions={"link":function(obj,_48){if(obj.links===null){obj.links=[];}var _49=new dojox.atom.io.model.Link();_49.buildFromDom(_48);obj.links.push(_49);},"author":function(obj,_4a){if(obj.authors===null){obj.authors=[];}var _4b=new dojox.atom.io.model.Person("author");_4b.buildFromDom(_4a);obj.authors.push(_4b);},"contributor":function(obj,_4c){if(obj.contributors===null){obj.contributors=[];}var _4d=new dojox.atom.io.model.Person("contributor");_4d.buildFromDom(_4c);obj.contributors.push(_4d);},"category":function(obj,_4e){if(obj.categories===null){obj.categories=[];}var cat=new dojox.atom.io.model.Category();cat.buildFromDom(_4e);obj.categories.push(cat);},"icon":function(obj,_4f){obj.icon=dojox.xml.parser.textContent(_4f);},"id":function(obj,_50){obj.id=dojox.xml.parser.textContent(_50);},"rights":function(obj,_51){obj.rights=dojox.xml.parser.textContent(_51);},"subtitle":function(obj,_52){var cnt=new dojox.atom.io.model.Content("subtitle");cnt.buildFromDom(_52);obj.subtitle=cnt;},"title":function(obj,_53){var cnt=new dojox.atom.io.model.Content("title");cnt.buildFromDom(_53);obj.title=cnt;},"updated":function(obj,_54){obj.updated=dojox.atom.io.model.util.createDate(_54);},"issued":function(obj,_55){obj.issued=dojox.atom.io.model.util.createDate(_55);},"modified":function(obj,_56){obj.modified=dojox.atom.io.model.util.createDate(_56);},"published":function(obj,_57){obj.published=dojox.atom.io.model.util.createDate(_57);},"entry":function(obj,_58){if(obj.entries===null){obj.entries=[];}var _59=obj.createEntry?obj.createEntry():new dojox.atom.io.model.Entry();_59.buildFromDom(_58);obj.entries.push(_59);},"content":function(obj,_5a){var cnt=new dojox.atom.io.model.Content("content");cnt.buildFromDom(_5a);obj.content=cnt;},"summary":function(obj,_5b){var _5c=new dojox.atom.io.model.Content("summary");_5c.buildFromDom(_5b);obj.summary=_5c;},"name":function(obj,_5d){obj.name=dojox.xml.parser.textContent(_5d);},"email":function(obj,_5e){obj.email=dojox.xml.parser.textContent(_5e);},"uri":function(obj,_5f){obj.uri=dojox.xml.parser.textContent(_5f);},"generator":function(obj,_60){obj.generator=new dojox.atom.io.model.Generator();obj.generator.buildFromDom(_60);}};dojox.atom.io.model.util={createDate:function(_61){var _62=dojox.xml.parser.textContent(_61);if(_62){return dojo.date.stamp.fromISOString(dojo.trim(_62));}return null;},escapeHtml:function(str){return str.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;").replace(/'/gm,"&#39;");},unEscapeHtml:function(str){return str.replace(/&lt;/gm,"<").replace(/&gt;/gm,">").replace(/&quot;/gm,"\"").replace(/&#39;/gm,"'").replace(/&amp;/gm,"&");},getNodename:function(_63){var _64=null;if(_63!==null){_64=_63.localName?_63.localName:_63.nodeName;if(_64!==null){var _65=_64.indexOf(":");if(_65!==-1){_64=_64.substring((_65+1),_64.length);}}}return _64;}};dojo.declare("dojox.atom.io.model.Node",null,{constructor:function(_66,_67,_68,_69,_6a){this.name_space=_66;this.name=_67;this.attributes=[];if(_68){this.attributes=_68;}this.content=[];this.rawNodes=[];this.textContent=null;if(_69){this.content.push(_69);}this.shortNs=_6a;this._objName="Node";},buildFromDom:function(_6b){this._saveAttributes(_6b);this.name_space=_6b.namespaceURI;this.shortNs=_6b.prefix;this.name=dojox.atom.io.model.util.getNodename(_6b);for(var x=0;x<_6b.childNodes.length;x++){var c=_6b.childNodes[x];if(dojox.atom.io.model.util.getNodename(c)!="#text"){this.rawNodes.push(c);var n=new dojox.atom.io.model.Node();n.buildFromDom(c,true);this.content.push(n);}else{this.content.push(c.nodeValue);}}this.textContent=dojox.xml.parser.textContent(_6b);},_saveAttributes:function(_6c){if(!this.attributes){this.attributes=[];}var _6d=function(_6e){var _6f=_6e.attributes;if(_6f===null){return false;}return (_6f.length!==0);};if(_6d(_6c)&&this._getAttributeNames){var _70=this._getAttributeNames(_6c);if(_70&&_70.length>0){for(var x in _70){var _71=_6c.getAttribute(_70[x]);if(_71){this.attributes[_70[x]]=_71;}}}}},addAttribute:function(_72,_73){this.attributes[_72]=_73;},getAttribute:function(_74){return this.attributes[_74];},_getAttributeNames:function(_75){var _76=[];for(var i=0;i<_75.attributes.length;i++){_76.push(_75.attributes[i].nodeName);}return _76;},toString:function(){var xml=[];var x;var _77=(this.shortNs?this.shortNs+":":"")+this.name;var _78=(this.name=="#cdata-section");if(_78){xml.push("<![CDATA[");xml.push(this.textContent);xml.push("]]>");}else{xml.push("<");xml.push(_77);if(this.name_space){xml.push(" xmlns='"+this.name_space+"'");}if(this.attributes){for(x in this.attributes){xml.push(" "+x+"='"+this.attributes[x]+"'");}}if(this.content){xml.push(">");for(x in this.content){xml.push(this.content[x]);}xml.push("</"+_77+">\n");}else{xml.push("/>\n");}}return xml.join("");},addContent:function(_79){this.content.push(_79);}});dojo.declare("dojox.atom.io.model.AtomItem",dojox.atom.io.model.Node,{constructor:function(_7a){this.ATOM_URI=dojox.atom.io.model._Constants.ATOM_URI;this.links=null;this.authors=null;this.categories=null;this.contributors=null;this.icon=this.id=this.logo=this.xmlBase=this.rights=null;this.subtitle=this.title=null;this.updated=this.published=null;this.issued=this.modified=null;this.content=null;this.extensions=null;this.entries=null;this.name_spaces={};this._objName="AtomItem";},_getAttributeNames:function(){return null;},_accepts:{},accept:function(tag){return Boolean(this._accepts[tag]);},_postBuild:function(){},buildFromDom:function(_7b){var i,c,n;for(i=0;i<_7b.attributes.length;i++){c=_7b.attributes.item(i);n=dojox.atom.io.model.util.getNodename(c);if(c.prefix=="xmlns"&&c.prefix!=n){this.addNamespace(c.nodeValue,n);}}c=_7b.childNodes;for(i=0;i<c.length;i++){if(c[i].nodeType==1){var _7c=dojox.atom.io.model.util.getNodename(c[i]);if(!_7c){continue;}if(c[i].namespaceURI!=dojox.atom.io.model._Constants.ATOM_NS&&_7c!="#text"){if(!this.extensions){this.extensions=[];}var _7d=new dojox.atom.io.model.Node();_7d.buildFromDom(c[i]);this.extensions.push(_7d);}if(!this.accept(_7c.toLowerCase())){continue;}var fn=dojox.atom.io.model._actions[_7c];if(fn){fn(this,c[i]);}}}this._saveAttributes(_7b);if(this._postBuild){this._postBuild();}},addNamespace:function(_7e,_7f){if(_7e&&_7f){this.name_spaces[_7f]=_7e;}},addAuthor:function(_80,_81,uri){if(!this.authors){this.authors=[];}this.authors.push(new dojox.atom.io.model.Person("author",_80,_81,uri));},addContributor:function(_82,_83,uri){if(!this.contributors){this.contributors=[];}this.contributors.push(new dojox.atom.io.model.Person("contributor",_82,_83,uri));},addLink:function(_84,rel,_85,_86,_87){if(!this.links){this.links=[];}this.links.push(new dojox.atom.io.model.Link(_84,rel,_85,_86,_87));},removeLink:function(_88,rel){if(!this.links||!dojo.isArray(this.links)){return;}var _89=0;for(var i=0;i<this.links.length;i++){if((!_88||this.links[i].href===_88)&&(!rel||this.links[i].rel===rel)){this.links.splice(i,1);_89++;}}return _89;},removeBasicLinks:function(){if(!this.links){return;}var _8a=0;for(var i=0;i<this.links.length;i++){if(!this.links[i].rel){this.links.splice(i,1);_8a++;i--;}}return _8a;},addCategory:function(_8b,_8c,_8d){if(!this.categories){this.categories=[];}this.categories.push(new dojox.atom.io.model.Category(_8b,_8c,_8d));},getCategories:function(_8e){if(!_8e){return this.categories;}var arr=[];for(var x in this.categories){if(this.categories[x].scheme===_8e){arr.push(this.categories[x]);}}return arr;},removeCategories:function(_8f,_90){if(!this.categories){return;}var _91=0;for(var i=0;i<this.categories.length;i++){if((!_8f||this.categories[i].scheme===_8f)&&(!_90||this.categories[i].term===_90)){this.categories.splice(i,1);_91++;i--;}}return _91;},setTitle:function(str,_92){if(!str){return;}this.title=new dojox.atom.io.model.Content("title");this.title.value=str;if(_92){this.title.type=_92;}},addExtension:function(_93,_94,_95,_96,_97){if(!this.extensions){this.extensions=[];}this.extensions.push(new dojox.atom.io.model.Node(_93,_94,_95,_96,_97||"ns"+this.extensions.length));},getExtensions:function(_98,_99){var arr=[];if(!this.extensions){return arr;}for(var x in this.extensions){if((this.extensions[x].name_space===_98||this.extensions[x].shortNs===_98)&&(!_99||this.extensions[x].name===_99)){arr.push(this.extensions[x]);}}return arr;},removeExtensions:function(_9a,_9b){if(!this.extensions){return;}for(var i=0;i<this.extensions.length;i++){if((this.extensions[i].name_space==_9a||this.extensions[i].shortNs===_9a)&&this.extensions[i].name===_9b){this.extensions.splice(i,1);i--;}}},destroy:function(){this.links=null;this.authors=null;this.categories=null;this.contributors=null;this.icon=this.id=this.logo=this.xmlBase=this.rights=null;this.subtitle=this.title=null;this.updated=this.published=null;this.issued=this.modified=null;this.content=null;this.extensions=null;this.entries=null;}});dojo.declare("dojox.atom.io.model.Category",dojox.atom.io.model.Node,{constructor:function(_9c,_9d,_9e){this.scheme=_9c;this.term=_9d;this.label=_9e;this._objName="Category";},_postBuild:function(){},_getAttributeNames:function(){return ["label","scheme","term"];},toString:function(){var s=[];s.push("<category ");if(this.label){s.push(" label=\""+this.label+"\" ");}if(this.scheme){s.push(" scheme=\""+this.scheme+"\" ");}if(this.term){s.push(" term=\""+this.term+"\" ");}s.push("/>\n");return s.join("");},buildFromDom:function(_9f){this._saveAttributes(_9f);this.label=this.attributes.label;this.scheme=this.attributes.scheme;this.term=this.attributes.term;if(this._postBuild){this._postBuild();}}});dojo.declare("dojox.atom.io.model.Content",dojox.atom.io.model.Node,{constructor:function(_a0,_a1,src,_a2,_a3){this.tagName=_a0;this.value=_a1;this.src=src;this.type=_a2;this.xmlLang=_a3;this.HTML="html";this.TEXT="text";this.XHTML="xhtml";this.XML="xml";this._useTextContent="true";},_getAttributeNames:function(){return ["type","src"];},_postBuild:function(){},buildFromDom:function(_a4){var _a5=_a4.getAttribute("type");if(_a5){_a5=_a5.toLowerCase();if(_a5=="xml"||"text/xml"){_a5=this.XML;}}else{_a5="text";}if(_a5===this.XML){if(_a4.firstChild){var i;this.value="";for(i=0;i<_a4.childNodes.length;i++){var c=_a4.childNodes[i];if(c){this.value+=dojox.xml.parser.innerXML(c);}}}}else{if(_a4.innerHTML){this.value=_a4.innerHTML;}else{this.value=dojox.xml.parser.textContent(_a4);}}this._saveAttributes(_a4);if(this.attributes){this.type=this.attributes.type;this.scheme=this.attributes.scheme;this.term=this.attributes.term;}if(!this.type){this.type="text";}var _a6=this.type.toLowerCase();if(_a6==="html"||_a6==="text/html"||_a6==="xhtml"||_a6==="text/xhtml"){this.value=this.value?dojox.atom.io.model.util.unEscapeHtml(this.value):"";}if(this._postBuild){this._postBuild();}},toString:function(){var s=[];s.push("<"+this.tagName+" ");if(!this.type){this.type="text";}if(this.type){s.push(" type=\""+this.type+"\" ");}if(this.xmlLang){s.push(" xml:lang=\""+this.xmlLang+"\" ");}if(this.xmlBase){s.push(" xml:base=\""+this.xmlBase+"\" ");}if(this.type.toLowerCase()==this.HTML){s.push(">"+dojox.atom.io.model.util.escapeHtml(this.value)+"</"+this.tagName+">\n");}else{s.push(">"+this.value+"</"+this.tagName+">\n");}var ret=s.join("");return ret;}});dojo.declare("dojox.atom.io.model.Link",dojox.atom.io.model.Node,{constructor:function(_a7,rel,_a8,_a9,_aa){this.href=_a7;this.hrefLang=_a8;this.rel=rel;this.title=_a9;this.type=_aa;},_getAttributeNames:function(){return ["href","jrefLang","rel","title","type"];},_postBuild:function(){},buildFromDom:function(_ab){this._saveAttributes(_ab);this.href=this.attributes.href;this.hrefLang=this.attributes.hreflang;this.rel=this.attributes.rel;this.title=this.attributes.title;this.type=this.attributes.type;if(this._postBuild){this._postBuild();}},toString:function(){var s=[];s.push("<link ");if(this.href){s.push(" href=\""+this.href+"\" ");}if(this.hrefLang){s.push(" hrefLang=\""+this.hrefLang+"\" ");}if(this.rel){s.push(" rel=\""+this.rel+"\" ");}if(this.title){s.push(" title=\""+this.title+"\" ");}if(this.type){s.push(" type = \""+this.type+"\" ");}s.push("/>\n");return s.join("");}});dojo.declare("dojox.atom.io.model.Person",dojox.atom.io.model.Node,{constructor:function(_ac,_ad,_ae,uri){this.author="author";this.contributor="contributor";if(!_ac){_ac=this.author;}this.personType=_ac;this.name=_ad||"";this.email=_ae||"";this.uri=uri||"";this._objName="Person";},_getAttributeNames:function(){return null;},_postBuild:function(){},accept:function(tag){return Boolean(this._accepts[tag]);},buildFromDom:function(_af){var c=_af.childNodes;for(var i=0;i<c.length;i++){var _b0=dojox.atom.io.model.util.getNodename(c[i]);if(!_b0){continue;}if(c[i].namespaceURI!=dojox.atom.io.model._Constants.ATOM_NS&&_b0!="#text"){if(!this.extensions){this.extensions=[];}var _b1=new dojox.atom.io.model.Node();_b1.buildFromDom(c[i]);this.extensions.push(_b1);}if(!this.accept(_b0.toLowerCase())){continue;}var fn=dojox.atom.io.model._actions[_b0];if(fn){fn(this,c[i]);}}this._saveAttributes(_af);if(this._postBuild){this._postBuild();}},_accepts:{"name":true,"uri":true,"email":true},toString:function(){var s=[];s.push("<"+this.personType+">\n");if(this.name){s.push("\t<name>"+this.name+"</name>\n");}if(this.email){s.push("\t<email>"+this.email+"</email>\n");}if(this.uri){s.push("\t<uri>"+this.uri+"</uri>\n");}s.push("</"+this.personType+">\n");return s.join("");}});dojo.declare("dojox.atom.io.model.Generator",dojox.atom.io.model.Node,{constructor:function(uri,_b2,_b3){this.uri=uri;this.version=_b2;this.value=_b3;},_postBuild:function(){},buildFromDom:function(_b4){this.value=dojox.xml.parser.textContent(_b4);this._saveAttributes(_b4);this.uri=this.attributes.uri;this.version=this.attributes.version;if(this._postBuild){this._postBuild();}},toString:function(){var s=[];s.push("<generator ");if(this.uri){s.push(" uri=\""+this.uri+"\" ");}if(this.version){s.push(" version=\""+this.version+"\" ");}s.push(">"+this.value+"</generator>\n");var ret=s.join("");return ret;}});dojo.declare("dojox.atom.io.model.Entry",dojox.atom.io.model.AtomItem,{constructor:function(id){this.id=id;this._objName="Entry";this.feedUrl=null;},_getAttributeNames:function(){return null;},_accepts:{"author":true,"content":true,"category":true,"contributor":true,"created":true,"id":true,"link":true,"published":true,"rights":true,"summary":true,"title":true,"updated":true,"xmlbase":true,"issued":true,"modified":true},toString:function(_b5){var s=[];var i;if(_b5){s.push("<?xml version='1.0' encoding='UTF-8'?>");s.push("<entry xmlns='"+dojox.atom.io.model._Constants.ATOM_URI+"'");}else{s.push("<entry");}if(this.xmlBase){s.push(" xml:base=\""+this.xmlBase+"\" ");}for(i in this.name_spaces){s.push(" xmlns:"+i+"=\""+this.name_spaces[i]+"\"");}s.push(">\n");s.push("<id>"+(this.id?this.id:"")+"</id>\n");if(this.issued&&!this.published){this.published=this.issued;}if(this.published){s.push("<published>"+dojo.date.stamp.toISOString(this.published)+"</published>\n");}if(this.created){s.push("<created>"+dojo.date.stamp.toISOString(this.created)+"</created>\n");}if(this.issued){s.push("<issued>"+dojo.date.stamp.toISOString(this.issued)+"</issued>\n");}if(this.modified){s.push("<modified>"+dojo.date.stamp.toISOString(this.modified)+"</modified>\n");}if(this.modified&&!this.updated){this.updated=this.modified;}if(this.updated){s.push("<updated>"+dojo.date.stamp.toISOString(this.updated)+"</updated>\n");}if(this.rights){s.push("<rights>"+this.rights+"</rights>\n");}if(this.title){s.push(this.title.toString());}if(this.summary){s.push(this.summary.toString());}var _b6=[this.authors,this.categories,this.links,this.contributors,this.extensions];for(var x in _b6){if(_b6[x]){for(var y in _b6[x]){s.push(_b6[x][y]);}}}if(this.content){s.push(this.content.toString());}s.push("</entry>\n");return s.join("");},getEditHref:function(){if(this.links===null||this.links.length===0){return null;}for(var x in this.links){if(this.links[x].rel&&this.links[x].rel=="edit"){return this.links[x].href;}}return null;},setEditHref:function(url){if(this.links===null){this.links=[];}for(var x in this.links){if(this.links[x].rel&&this.links[x].rel=="edit"){this.links[x].href=url;return;}}this.addLink(url,"edit");}});dojo.declare("dojox.atom.io.model.Feed",dojox.atom.io.model.AtomItem,{_accepts:{"author":true,"content":true,"category":true,"contributor":true,"created":true,"id":true,"link":true,"published":true,"rights":true,"summary":true,"title":true,"updated":true,"xmlbase":true,"entry":true,"logo":true,"issued":true,"modified":true,"icon":true,"subtitle":true},addEntry:function(_b7){if(!_b7.id){throw new Error("The entry object must be assigned an ID attribute.");}if(!this.entries){this.entries=[];}_b7.feedUrl=this.getSelfHref();this.entries.push(_b7);},getFirstEntry:function(){if(!this.entries||this.entries.length===0){return null;}return this.entries[0];},getEntry:function(_b8){if(!this.entries){return null;}for(var x in this.entries){if(this.entries[x].id==_b8){return this.entries[x];}}return null;},removeEntry:function(_b9){if(!this.entries){return;}var _ba=0;for(var i=0;i<this.entries.length;i++){if(this.entries[i]===_b9){this.entries.splice(i,1);_ba++;}}return _ba;},setEntries:function(_bb){for(var x in _bb){this.addEntry(_bb[x]);}},toString:function(){var s=[];var i;s.push("<?xml version=\"1.0\" encoding=\"utf-8\"?>\n");s.push("<feed xmlns=\""+dojox.atom.io.model._Constants.ATOM_URI+"\"");if(this.xmlBase){s.push(" xml:base=\""+this.xmlBase+"\"");}for(i in this.name_spaces){s.push(" xmlns:"+i+"=\""+this.name_spaces[i]+"\"");}s.push(">\n");s.push("<id>"+(this.id?this.id:"")+"</id>\n");if(this.title){s.push(this.title);}if(this.copyright&&!this.rights){this.rights=this.copyright;}if(this.rights){s.push("<rights>"+this.rights+"</rights>\n");}if(this.issued){s.push("<issued>"+dojo.date.stamp.toISOString(this.issued)+"</issued>\n");}if(this.modified){s.push("<modified>"+dojo.date.stamp.toISOString(this.modified)+"</modified>\n");}if(this.modified&&!this.updated){this.updated=this.modified;}if(this.updated){s.push("<updated>"+dojo.date.stamp.toISOString(this.updated)+"</updated>\n");}if(this.published){s.push("<published>"+dojo.date.stamp.toISOString(this.published)+"</published>\n");}if(this.icon){s.push("<icon>"+this.icon+"</icon>\n");}if(this.language){s.push("<language>"+this.language+"</language>\n");}if(this.logo){s.push("<logo>"+this.logo+"</logo>\n");}if(this.subtitle){s.push(this.subtitle.toString());}if(this.tagline){s.push(this.tagline.toString());}var _bc=[this.alternateLinks,this.authors,this.categories,this.contributors,this.otherLinks,this.extensions,this.entries];for(i in _bc){if(_bc[i]){for(var x in _bc[i]){s.push(_bc[i][x]);}}}s.push("</feed>");return s.join("");},createEntry:function(){var _bd=new dojox.atom.io.model.Entry();_bd.feedUrl=this.getSelfHref();return _bd;},getSelfHref:function(){if(this.links===null||this.links.length===0){return null;}for(var x in this.links){if(this.links[x].rel&&this.links[x].rel=="self"){return this.links[x].href;}}return null;}});dojo.declare("dojox.atom.io.model.Service",dojox.atom.io.model.AtomItem,{constructor:function(_be){this.href=_be;},buildFromDom:function(_bf){var i;this.workspaces=[];if(_bf.tagName!="service"){return;}if(_bf.namespaceURI!=dojox.atom.io.model._Constants.PURL_NS&&_bf.namespaceURI!=dojox.atom.io.model._Constants.APP_NS){return;}var ns=_bf.namespaceURI;this.name_space=_bf.namespaceURI;var _c0;if(typeof (_bf.getElementsByTagNameNS)!="undefined"){_c0=_bf.getElementsByTagNameNS(ns,"workspace");}else{_c0=[];var _c1=_bf.getElementsByTagName("workspace");for(i=0;i<_c1.length;i++){if(_c1[i].namespaceURI==ns){_c0.push(_c1[i]);}}}if(_c0&&_c0.length>0){var _c2=0;var _c3;for(i=0;i<_c0.length;i++){_c3=(typeof (_c0.item)==="undefined"?_c0[i]:_c0.item(i));var _c4=new dojox.atom.io.model.Workspace();_c4.buildFromDom(_c3);this.workspaces[_c2++]=_c4;}}},getCollection:function(url){for(var i=0;i<this.workspaces.length;i++){var _c5=this.workspaces[i].collections;for(var j=0;j<_c5.length;j++){if(_c5[j].href==url){return _c5;}}}return null;}});dojo.declare("dojox.atom.io.model.Workspace",dojox.atom.io.model.AtomItem,{constructor:function(_c6){this.title=_c6;this.collections=[];},buildFromDom:function(_c7){var _c8=dojox.atom.io.model.util.getNodename(_c7);if(_c8!="workspace"){return;}var c=_c7.childNodes;var len=0;for(var i=0;i<c.length;i++){var _c9=c[i];if(_c9.nodeType===1){_c8=dojox.atom.io.model.util.getNodename(_c9);if(_c9.namespaceURI==dojox.atom.io.model._Constants.PURL_NS||_c9.namespaceURI==dojox.atom.io.model._Constants.APP_NS){if(_c8==="collection"){var _ca=new dojox.atom.io.model.Collection();_ca.buildFromDom(_c9);this.collections[len++]=_ca;}}else{if(_c9.namespaceURI===dojox.atom.io.model._Constants.ATOM_NS){if(_c8==="title"){this.title=dojox.xml.parser.textContent(_c9);}}}}}}});dojo.declare("dojox.atom.io.model.Collection",dojox.atom.io.model.AtomItem,{constructor:function(_cb,_cc){this.href=_cb;this.title=_cc;this.attributes=[];this.features=[];this.children=[];this.memberType=null;this.id=null;},buildFromDom:function(_cd){this.href=_cd.getAttribute("href");var c=_cd.childNodes;for(var i=0;i<c.length;i++){var _ce=c[i];if(_ce.nodeType===1){var _cf=dojox.atom.io.model.util.getNodename(_ce);if(_ce.namespaceURI==dojox.atom.io.model._Constants.PURL_NS||_ce.namespaceURI==dojox.atom.io.model._Constants.APP_NS){if(_cf==="member-type"){this.memberType=dojox.xml.parser.textContent(_ce);}else{if(_cf=="feature"){if(_ce.getAttribute("id")){this.features.push(_ce.getAttribute("id"));}}else{var _d0=new dojox.atom.io.model.Node();_d0.buildFromDom(_ce);this.children.push(_d0);}}}else{if(_ce.namespaceURI===dojox.atom.io.model._Constants.ATOM_NS){if(_cf==="id"){this.id=dojox.xml.parser.textContent(_ce);}else{if(_cf==="title"){this.title=dojox.xml.parser.textContent(_ce);}}}}}}}});}if(!dojo._hasResource["dojo.date"]){dojo._hasResource["dojo.date"]=true;dojo.provide("dojo.date");dojo.getObject("date",true,dojo);dojo.date.getDaysInMonth=function(_d1){var _d2=_d1.getMonth();var _d3=[31,28,31,30,31,30,31,31,30,31,30,31];if(_d2==1&&dojo.date.isLeapYear(_d1)){return 29;}return _d3[_d2];};dojo.date.isLeapYear=function(_d4){var _d5=_d4.getFullYear();return !(_d5%400)||(!(_d5%4)&&!!(_d5%100));};dojo.date.getTimezoneName=function(_d6){var str=_d6.toString();var tz="";var _d7;var pos=str.indexOf("(");if(pos>-1){tz=str.substring(++pos,str.indexOf(")"));}else{var pat=/([A-Z\/]+) \d{4}$/;if((_d7=str.match(pat))){tz=_d7[1];}else{str=_d6.toLocaleString();pat=/ ([A-Z\/]+)$/;if((_d7=str.match(pat))){tz=_d7[1];}}}return (tz=="AM"||tz=="PM")?"":tz;};dojo.date.compare=function(_d8,_d9,_da){_d8=new Date(+_d8);_d9=new Date(+(_d9||new Date()));if(_da=="date"){_d8.setHours(0,0,0,0);_d9.setHours(0,0,0,0);}else{if(_da=="time"){_d8.setFullYear(0,0,0);_d9.setFullYear(0,0,0);}}if(_d8>_d9){return 1;}if(_d8<_d9){return -1;}return 0;};dojo.date.add=function(_db,_dc,_dd){var sum=new Date(+_db);var _de=false;var _df="Date";switch(_dc){case "day":break;case "weekday":var _e0,_e1;var mod=_dd%5;if(!mod){_e0=(_dd>0)?5:-5;_e1=(_dd>0)?((_dd-5)/5):((_dd+5)/5);}else{_e0=mod;_e1=parseInt(_dd/5);}var _e2=_db.getDay();var adj=0;if(_e2==6&&_dd>0){adj=1;}else{if(_e2==0&&_dd<0){adj=-1;}}var _e3=_e2+_e0;if(_e3==0||_e3==6){adj=(_dd>0)?2:-2;}_dd=(7*_e1)+_e0+adj;break;case "year":_df="FullYear";_de=true;break;case "week":_dd*=7;break;case "quarter":_dd*=3;case "month":_de=true;_df="Month";break;default:_df="UTC"+_dc.charAt(0).toUpperCase()+_dc.substring(1)+"s";}if(_df){sum["set"+_df](sum["get"+_df]()+_dd);}if(_de&&(sum.getDate()<_db.getDate())){sum.setDate(0);}return sum;};dojo.date.difference=function(_e4,_e5,_e6){_e5=_e5||new Date();_e6=_e6||"day";var _e7=_e5.getFullYear()-_e4.getFullYear();var _e8=1;switch(_e6){case "quarter":var m1=_e4.getMonth();var m2=_e5.getMonth();var q1=Math.floor(m1/3)+1;var q2=Math.floor(m2/3)+1;q2+=(_e7*4);_e8=q2-q1;break;case "weekday":var _e9=Math.round(dojo.date.difference(_e4,_e5,"day"));var _ea=parseInt(dojo.date.difference(_e4,_e5,"week"));var mod=_e9%7;if(mod==0){_e9=_ea*5;}else{var adj=0;var _eb=_e4.getDay();var _ec=_e5.getDay();_ea=parseInt(_e9/7);mod=_e9%7;var _ed=new Date(_e4);_ed.setDate(_ed.getDate()+(_ea*7));var _ee=_ed.getDay();if(_e9>0){switch(true){case _eb==6:adj=-1;break;case _eb==0:adj=0;break;case _ec==6:adj=-1;break;case _ec==0:adj=-2;break;case (_ee+mod)>5:adj=-2;}}else{if(_e9<0){switch(true){case _eb==6:adj=0;break;case _eb==0:adj=1;break;case _ec==6:adj=2;break;case _ec==0:adj=1;break;case (_ee+mod)<0:adj=2;}}}_e9+=adj;_e9-=(_ea*2);}_e8=_e9;break;case "year":_e8=_e7;break;case "month":_e8=(_e5.getMonth()-_e4.getMonth())+(_e7*12);break;case "week":_e8=parseInt(dojo.date.difference(_e4,_e5,"day")/7);break;case "day":_e8/=24;case "hour":_e8/=60;case "minute":_e8/=60;case "second":_e8/=1000;case "millisecond":_e8*=_e5.getTime()-_e4.getTime();}return Math.round(_e8);};}if(!dojo._hasResource["dojo.i18n"]){dojo._hasResource["dojo.i18n"]=true;dojo.provide("dojo.i18n");dojo.getObject("i18n",true,dojo);dojo.i18n.getLocalization=dojo.i18n.getLocalization||function(_ef,_f0,_f1){_f1=dojo.i18n.normalizeLocale(_f1);var _f2=_f1.split("-");var _f3=[_ef,"nls",_f0].join(".");var _f4=dojo._loadedModules[_f3];if(_f4){var _f5;for(var i=_f2.length;i>0;i--){var loc=_f2.slice(0,i).join("_");if(_f4[loc]){_f5=_f4[loc];break;}}if(!_f5){_f5=_f4.ROOT;}if(_f5){var _f6=function(){};_f6.prototype=_f5;return new _f6();}}throw new Error("Bundle not found: "+_f0+" in "+_ef+" , locale="+_f1);};dojo.i18n.normalizeLocale=function(_f7){var _f8=_f7?_f7.toLowerCase():dojo.locale;if(_f8=="root"){_f8="ROOT";}return _f8;};dojo.i18n._requireLocalization=function(_f9,_fa,_fb,_fc){var _fd=dojo.i18n.normalizeLocale(_fb);var _fe=[_f9,"nls",_fa].join(".");var _ff="";if(_fc){var _100=_fc.split(",");for(var i=0;i<_100.length;i++){if(_fd["indexOf"](_100[i])==0){if(_100[i].length>_ff.length){_ff=_100[i];}}}if(!_ff){_ff="ROOT";}}var _101=_fc?_ff:_fd;var _102=dojo._loadedModules[_fe];var _103=null;if(_102){if(dojo.config.localizationComplete&&_102._built){return;}var _104=_101.replace(/-/g,"_");var _105=_fe+"."+_104;_103=dojo._loadedModules[_105];}if(!_103){_102=dojo["provide"](_fe);var syms=dojo._getModuleSymbols(_f9);var _106=syms.concat("nls").join("/");var _107;dojo.i18n._searchLocalePath(_101,_fc,function(loc){var _108=loc.replace(/-/g,"_");var _109=_fe+"."+_108;var _10a=false;if(!dojo._loadedModules[_109]){dojo["provide"](_109);var _10b=[_106];if(loc!="ROOT"){_10b.push(loc);}_10b.push(_fa);var _10c=_10b.join("/")+".js";_10a=dojo._loadPath(_10c,null,function(hash){hash=hash.root||hash;var _10d=function(){};_10d.prototype=_107;_102[_108]=new _10d();for(var j in hash){_102[_108][j]=hash[j];}});}else{_10a=true;}if(_10a&&_102[_108]){_107=_102[_108];}else{_102[_108]=_107;}if(_fc){return true;}});}if(_fc&&_fd!=_ff){_102[_fd.replace(/-/g,"_")]=_102[_ff.replace(/-/g,"_")];}};(function(){var _10e=dojo.config.extraLocale;if(_10e){if(!_10e instanceof Array){_10e=[_10e];}var req=dojo.i18n._requireLocalization;dojo.i18n._requireLocalization=function(m,b,_10f,_110){req(m,b,_10f,_110);if(_10f){return;}for(var i=0;i<_10e.length;i++){req(m,b,_10e[i],_110);}};}})();dojo.i18n._searchLocalePath=function(_111,down,_112){_111=dojo.i18n.normalizeLocale(_111);var _113=_111.split("-");var _114=[];for(var i=_113.length;i>0;i--){_114.push(_113.slice(0,i).join("-"));}_114.push(false);if(down){_114.reverse();}for(var j=_114.length-1;j>=0;j--){var loc=_114[j]||"ROOT";var stop=_112(loc);if(stop){break;}}};dojo.i18n._preloadLocalizations=function(_115,_116){function _117(_118){_118=dojo.i18n.normalizeLocale(_118);dojo.i18n._searchLocalePath(_118,true,function(loc){for(var i=0;i<_116.length;i++){if(_116[i]==loc){dojo["require"](_115+"_"+loc);return true;}}return false;});};_117();var _119=dojo.config.extraLocale||[];for(var i=0;i<_119.length;i++){_117(_119[i]);}};}if(!dojo._hasResource["dojo.cldr.supplemental"]){dojo._hasResource["dojo.cldr.supplemental"]=true;dojo.provide("dojo.cldr.supplemental");dojo.getObject("cldr.supplemental",true,dojo);dojo.cldr.supplemental.getFirstDayOfWeek=function(_11a){var _11b={mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,er:6,et:6,iq:6,ir:6,jo:6,ke:6,kw:6,ly:6,ma:6,om:6,qa:6,sa:6,sd:6,so:6,sy:6,tn:6,ye:6,ar:0,as:0,az:0,bw:0,ca:0,cn:0,fo:0,ge:0,gl:0,gu:0,hk:0,il:0,"in":0,jm:0,jp:0,kg:0,kr:0,la:0,mh:0,mn:0,mo:0,mp:0,mt:0,nz:0,ph:0,pk:0,sg:0,th:0,tt:0,tw:0,um:0,us:0,uz:0,vi:0,zw:0};var _11c=dojo.cldr.supplemental._region(_11a);var dow=_11b[_11c];return (dow===undefined)?1:dow;};dojo.cldr.supplemental._region=function(_11d){_11d=dojo.i18n.normalizeLocale(_11d);var tags=_11d.split("-");var _11e=tags[1];if(!_11e){_11e={de:"de",en:"us",es:"es",fi:"fi",fr:"fr",he:"il",hu:"hu",it:"it",ja:"jp",ko:"kr",nl:"nl",pt:"br",sv:"se",zh:"cn"}[tags[0]];}else{if(_11e.length==4){_11e=tags[2];}}return _11e;};dojo.cldr.supplemental.getWeekend=function(_11f){var _120={"in":0,af:4,dz:4,ir:4,om:4,sa:4,ye:4,ae:5,bh:5,eg:5,il:5,iq:5,jo:5,kw:5,ly:5,ma:5,qa:5,sd:5,sy:5,tn:5};var _121={af:5,dz:5,ir:5,om:5,sa:5,ye:5,ae:6,bh:5,eg:6,il:6,iq:6,jo:6,kw:6,ly:6,ma:6,qa:6,sd:6,sy:6,tn:6};var _122=dojo.cldr.supplemental._region(_11f);var _123=_120[_122];var end=_121[_122];if(_123===undefined){_123=6;}if(end===undefined){end=0;}return {start:_123,end:end};};}if(!dojo._hasResource["dojo.regexp"]){dojo._hasResource["dojo.regexp"]=true;dojo.provide("dojo.regexp");dojo.getObject("regexp",true,dojo);dojo.regexp.escapeString=function(str,_124){return str.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,function(ch){if(_124&&_124.indexOf(ch)!=-1){return ch;}return "\\"+ch;});};dojo.regexp.buildGroupRE=function(arr,re,_125){if(!(arr instanceof Array)){return re(arr);}var b=[];for(var i=0;i<arr.length;i++){b.push(re(arr[i]));}return dojo.regexp.group(b.join("|"),_125);};dojo.regexp.group=function(_126,_127){return "("+(_127?"?:":"")+_126+")";};}if(!dojo._hasResource["dojo.date.locale"]){dojo._hasResource["dojo.date.locale"]=true;dojo.provide("dojo.date.locale");dojo.getObject("date.locale",true,dojo);(function(){function _128(_129,_12a,_12b,_12c){return _12c.replace(/([a-z])\1*/ig,function(_12d){var s,pad,c=_12d.charAt(0),l=_12d.length,_12e=["abbr","wide","narrow"];switch(c){case "G":s=_12a[(l<4)?"eraAbbr":"eraNames"][_129.getFullYear()<0?0:1];break;case "y":s=_129.getFullYear();switch(l){case 1:break;case 2:if(!_12b.fullYear){s=String(s);s=s.substr(s.length-2);break;}default:pad=true;}break;case "Q":case "q":s=Math.ceil((_129.getMonth()+1)/3);pad=true;break;case "M":var m=_129.getMonth();if(l<3){s=m+1;pad=true;}else{var _12f=["months","format",_12e[l-3]].join("-");s=_12a[_12f][m];}break;case "w":var _130=0;s=dojo.date.locale._getWeekOfYear(_129,_130);pad=true;break;case "d":s=_129.getDate();pad=true;break;case "D":s=dojo.date.locale._getDayOfYear(_129);pad=true;break;case "E":var d=_129.getDay();if(l<3){s=d+1;pad=true;}else{var _131=["days","format",_12e[l-3]].join("-");s=_12a[_131][d];}break;case "a":var _132=(_129.getHours()<12)?"am":"pm";s=_12b[_132]||_12a["dayPeriods-format-wide-"+_132];break;case "h":case "H":case "K":case "k":var h=_129.getHours();switch(c){case "h":s=(h%12)||12;break;case "H":s=h;break;case "K":s=(h%12);break;case "k":s=h||24;break;}pad=true;break;case "m":s=_129.getMinutes();pad=true;break;case "s":s=_129.getSeconds();pad=true;break;case "S":s=Math.round(_129.getMilliseconds()*Math.pow(10,l-3));pad=true;break;case "v":case "z":s=dojo.date.locale._getZone(_129,true,_12b);if(s){break;}l=4;case "Z":var _133=dojo.date.locale._getZone(_129,false,_12b);var tz=[(_133<=0?"+":"-"),dojo.string.pad(Math.floor(Math.abs(_133)/60),2),dojo.string.pad(Math.abs(_133)%60,2)];if(l==4){tz.splice(0,0,"GMT");tz.splice(3,0,":");}s=tz.join("");break;default:throw new Error("dojo.date.locale.format: invalid pattern char: "+_12c);}if(pad){s=dojo.string.pad(s,l);}return s;});};dojo.date.locale._getZone=function(_134,_135,_136){if(_135){return dojo.date.getTimezoneName(_134);}else{return _134.getTimezoneOffset();}};dojo.date.locale.format=function(_137,_138){_138=_138||{};var _139=dojo.i18n.normalizeLocale(_138.locale),_13a=_138.formatLength||"short",_13b=dojo.date.locale._getGregorianBundle(_139),str=[],_13c=dojo.hitch(this,_128,_137,_13b,_138);if(_138.selector=="year"){return _13d(_13b["dateFormatItem-yyyy"]||"yyyy",_13c);}var _13e;if(_138.selector!="date"){_13e=_138.timePattern||_13b["timeFormat-"+_13a];if(_13e){str.push(_13d(_13e,_13c));}}if(_138.selector!="time"){_13e=_138.datePattern||_13b["dateFormat-"+_13a];if(_13e){str.push(_13d(_13e,_13c));}}return str.length==1?str[0]:_13b["dateTimeFormat-"+_13a].replace(/\{(\d+)\}/g,function(_13f,key){return str[key];});};dojo.date.locale.regexp=function(_140){return dojo.date.locale._parseInfo(_140).regexp;};dojo.date.locale._parseInfo=function(_141){_141=_141||{};var _142=dojo.i18n.normalizeLocale(_141.locale),_143=dojo.date.locale._getGregorianBundle(_142),_144=_141.formatLength||"short",_145=_141.datePattern||_143["dateFormat-"+_144],_146=_141.timePattern||_143["timeFormat-"+_144],_147;if(_141.selector=="date"){_147=_145;}else{if(_141.selector=="time"){_147=_146;}else{_147=_143["dateTimeFormat-"+_144].replace(/\{(\d+)\}/g,function(_148,key){return [_146,_145][key];});}}var _149=[],re=_13d(_147,dojo.hitch(this,_14a,_149,_143,_141));return {regexp:re,tokens:_149,bundle:_143};};dojo.date.locale.parse=function(_14b,_14c){var _14d=/[\u200E\u200F\u202A\u202E]/g,info=dojo.date.locale._parseInfo(_14c),_14e=info.tokens,_14f=info.bundle,re=new RegExp("^"+info.regexp.replace(_14d,"")+"$",info.strict?"":"i"),_150=re.exec(_14b&&_14b.replace(_14d,""));if(!_150){return null;}var _151=["abbr","wide","narrow"],_152=[1970,0,1,0,0,0,0],amPm="",_153=dojo.every(_150,function(v,i){if(!i){return true;}var _154=_14e[i-1];var l=_154.length;switch(_154.charAt(0)){case "y":if(l!=2&&_14c.strict){_152[0]=v;}else{if(v<100){v=Number(v);var year=""+new Date().getFullYear(),_155=year.substring(0,2)*100,_156=Math.min(Number(year.substring(2,4))+20,99),num=(v<_156)?_155+v:_155-100+v;_152[0]=num;}else{if(_14c.strict){return false;}_152[0]=v;}}break;case "M":if(l>2){var _157=_14f["months-format-"+_151[l-3]].concat();if(!_14c.strict){v=v.replace(".","").toLowerCase();_157=dojo.map(_157,function(s){return s.replace(".","").toLowerCase();});}v=dojo.indexOf(_157,v);if(v==-1){return false;}}else{v--;}_152[1]=v;break;case "E":case "e":var days=_14f["days-format-"+_151[l-3]].concat();if(!_14c.strict){v=v.toLowerCase();days=dojo.map(days,function(d){return d.toLowerCase();});}v=dojo.indexOf(days,v);if(v==-1){return false;}break;case "D":_152[1]=0;case "d":_152[2]=v;break;case "a":var am=_14c.am||_14f["dayPeriods-format-wide-am"],pm=_14c.pm||_14f["dayPeriods-format-wide-pm"];if(!_14c.strict){var _158=/\./g;v=v.replace(_158,"").toLowerCase();am=am.replace(_158,"").toLowerCase();pm=pm.replace(_158,"").toLowerCase();}if(_14c.strict&&v!=am&&v!=pm){return false;}amPm=(v==pm)?"p":(v==am)?"a":"";break;case "K":if(v==24){v=0;}case "h":case "H":case "k":if(v>23){return false;}_152[3]=v;break;case "m":_152[4]=v;break;case "s":_152[5]=v;break;case "S":_152[6]=v;}return true;});var _159=+_152[3];if(amPm==="p"&&_159<12){_152[3]=_159+12;}else{if(amPm==="a"&&_159==12){_152[3]=0;}}var _15a=new Date(_152[0],_152[1],_152[2],_152[3],_152[4],_152[5],_152[6]);if(_14c.strict){_15a.setFullYear(_152[0]);}var _15b=_14e.join(""),_15c=_15b.indexOf("d")!=-1,_15d=_15b.indexOf("M")!=-1;if(!_153||(_15d&&_15a.getMonth()>_152[1])||(_15c&&_15a.getDate()>_152[2])){return null;}if((_15d&&_15a.getMonth()<_152[1])||(_15c&&_15a.getDate()<_152[2])){_15a=dojo.date.add(_15a,"hour",1);}return _15a;};function _13d(_15e,_15f,_160,_161){var _162=function(x){return x;};_15f=_15f||_162;_160=_160||_162;_161=_161||_162;var _163=_15e.match(/(''|[^'])+/g),_164=_15e.charAt(0)=="'";dojo.forEach(_163,function(_165,i){if(!_165){_163[i]="";}else{_163[i]=(_164?_160:_15f)(_165.replace(/''/g,"'"));_164=!_164;}});return _161(_163.join(""));};function _14a(_166,_167,_168,_169){_169=dojo.regexp.escapeString(_169);if(!_168.strict){_169=_169.replace(" a"," ?a");}return _169.replace(/([a-z])\1*/ig,function(_16a){var s,c=_16a.charAt(0),l=_16a.length,p2="",p3="";if(_168.strict){if(l>1){p2="0"+"{"+(l-1)+"}";}if(l>2){p3="0"+"{"+(l-2)+"}";}}else{p2="0?";p3="0{0,2}";}switch(c){case "y":s="\\d{2,4}";break;case "M":s=(l>2)?"\\S+?":"1[0-2]|"+p2+"[1-9]";break;case "D":s="[12][0-9][0-9]|3[0-5][0-9]|36[0-6]|"+p3+"[1-9][0-9]|"+p2+"[1-9]";break;case "d":s="3[01]|[12]\\d|"+p2+"[1-9]";break;case "w":s="[1-4][0-9]|5[0-3]|"+p2+"[1-9]";break;case "E":s="\\S+";break;case "h":s="1[0-2]|"+p2+"[1-9]";break;case "k":s="1[01]|"+p2+"\\d";break;case "H":s="1\\d|2[0-3]|"+p2+"\\d";break;case "K":s="1\\d|2[0-4]|"+p2+"[1-9]";break;case "m":case "s":s="[0-5]\\d";break;case "S":s="\\d{"+l+"}";break;case "a":var am=_168.am||_167["dayPeriods-format-wide-am"],pm=_168.pm||_167["dayPeriods-format-wide-pm"];s=am+"|"+pm;if(!_168.strict){if(am!=am.toLowerCase()){s+="|"+am.toLowerCase();}if(pm!=pm.toLowerCase()){s+="|"+pm.toLowerCase();}if(s.indexOf(".")!=-1){s+="|"+s.replace(/\./g,"");}}s=s.replace(/\./g,"\\.");break;default:s=".*";}if(_166){_166.push(_16a);}return "("+s+")";}).replace(/[\xa0 ]/g,"[\\s\\xa0]");};})();(function(){var _16b=[];dojo.date.locale.addCustomFormats=function(_16c,_16d){_16b.push({pkg:_16c,name:_16d});};dojo.date.locale._getGregorianBundle=function(_16e){var _16f={};dojo.forEach(_16b,function(desc){var _170=dojo.i18n.getLocalization(desc.pkg,desc.name,_16e);_16f=dojo.mixin(_16f,_170);},this);return _16f;};})();dojo.date.locale.addCustomFormats("dojo.cldr","gregorian");dojo.date.locale.getNames=function(item,type,_171,_172){var _173,_174=dojo.date.locale._getGregorianBundle(_172),_175=[item,_171,type];if(_171=="standAlone"){var key=_175.join("-");_173=_174[key];if(_173[0]==1){_173=undefined;}}_175[1]="format";return (_173||_174[_175.join("-")]).concat();};dojo.date.locale.isWeekend=function(_176,_177){var _178=dojo.cldr.supplemental.getWeekend(_177),day=(_176||new Date()).getDay();if(_178.end<_178.start){_178.end+=7;if(day<_178.start){day+=7;}}return day>=_178.start&&day<=_178.end;};dojo.date.locale._getDayOfYear=function(_179){return dojo.date.difference(new Date(_179.getFullYear(),0,1,_179.getHours()),_179)+1;};dojo.date.locale._getWeekOfYear=function(_17a,_17b){if(arguments.length==1){_17b=0;}var _17c=new Date(_17a.getFullYear(),0,1).getDay(),adj=(_17c-_17b+7)%7,week=Math.floor((dojo.date.locale._getDayOfYear(_17a)+adj-1)/7);if(_17c==_17b){week++;}return week;};}if(!dojo._hasResource["dojox.date.posix"]){dojo._hasResource["dojox.date.posix"]=true;dojo.provide("dojox.date.posix");dojox.date.posix.strftime=function(_17d,_17e,_17f){var _180=null;var _181=function(s,n){return dojo.string.pad(s,n||2,_180||"0");};var _182=dojo.date.locale._getGregorianBundle(_17f);var $=function(_183){switch(_183){case "a":return dojo.date.locale.getNames("days","abbr","format",_17f)[_17d.getDay()];case "A":return dojo.date.locale.getNames("days","wide","format",_17f)[_17d.getDay()];case "b":case "h":return dojo.date.locale.getNames("months","abbr","format",_17f)[_17d.getMonth()];case "B":return dojo.date.locale.getNames("months","wide","format",_17f)[_17d.getMonth()];case "c":return dojo.date.locale.format(_17d,{formatLength:"full",locale:_17f});case "C":return _181(Math.floor(_17d.getFullYear()/100));case "d":return _181(_17d.getDate());case "D":return $("m")+"/"+$("d")+"/"+$("y");case "e":if(_180==null){_180=" ";}return _181(_17d.getDate());case "f":if(_180==null){_180=" ";}return _181(_17d.getMonth()+1);case "g":break;case "G":dojo.unimplemented("unimplemented modifier 'G'");break;case "F":return $("Y")+"-"+$("m")+"-"+$("d");case "H":return _181(_17d.getHours());case "I":return _181(_17d.getHours()%12||12);case "j":return _181(dojo.date.locale._getDayOfYear(_17d),3);case "k":if(_180==null){_180=" ";}return _181(_17d.getHours());case "l":if(_180==null){_180=" ";}return _181(_17d.getHours()%12||12);case "m":return _181(_17d.getMonth()+1);case "M":return _181(_17d.getMinutes());case "n":return "\n";case "p":return _182["dayPeriods-format-wide-"+(_17d.getHours()<12?"am":"pm")];case "r":return $("I")+":"+$("M")+":"+$("S")+" "+$("p");case "R":return $("H")+":"+$("M");case "S":return _181(_17d.getSeconds());case "t":return "\t";case "T":return $("H")+":"+$("M")+":"+$("S");case "u":return String(_17d.getDay()||7);case "U":return _181(dojo.date.locale._getWeekOfYear(_17d));case "V":return _181(dojox.date.posix.getIsoWeekOfYear(_17d));case "W":return _181(dojo.date.locale._getWeekOfYear(_17d,1));case "w":return String(_17d.getDay());case "x":return dojo.date.locale.format(_17d,{selector:"date",formatLength:"full",locale:_17f});case "X":return dojo.date.locale.format(_17d,{selector:"time",formatLength:"full",locale:_17f});case "y":return _181(_17d.getFullYear()%100);case "Y":return String(_17d.getFullYear());case "z":var _184=_17d.getTimezoneOffset();return (_184>0?"-":"+")+_181(Math.floor(Math.abs(_184)/60))+":"+_181(Math.abs(_184)%60);case "Z":return dojo.date.getTimezoneName(_17d);case "%":return "%";}};var _185="";var i=0;var _186=0;var _187=null;while((_186=_17e.indexOf("%",i))!=-1){_185+=_17e.substring(i,_186++);switch(_17e.charAt(_186++)){case "_":_180=" ";break;case "-":_180="";break;case "0":_180="0";break;case "^":_187="upper";break;case "*":_187="lower";break;case "#":_187="swap";break;default:_180=null;_186--;break;}var _188=$(_17e.charAt(_186++));switch(_187){case "upper":_188=_188.toUpperCase();break;case "lower":_188=_188.toLowerCase();break;case "swap":var _189=_188.toLowerCase();var _18a="";var ch="";for(var j=0;j<_188.length;j++){ch=_188.charAt(j);_18a+=(ch==_189.charAt(j))?ch.toUpperCase():ch.toLowerCase();}_188=_18a;break;default:break;}_187=null;_185+=_188;i=_186;}_185+=_17e.substring(i);return _185;};dojox.date.posix.getStartOfWeek=function(_18b,_18c){if(isNaN(_18c)){_18c=dojo.cldr.supplemental.getFirstDayOfWeek?dojo.cldr.supplemental.getFirstDayOfWeek():0;}var _18d=_18c;if(_18b.getDay()>=_18c){_18d-=_18b.getDay();}else{_18d-=(7-_18b.getDay());}var date=new Date(_18b);date.setHours(0,0,0,0);return dojo.date.add(date,"day",_18d);};dojox.date.posix.setIsoWeekOfYear=function(_18e,week){if(!week){return _18e;}var _18f=dojox.date.posix.getIsoWeekOfYear(_18e);var _190=week-_18f;if(week<0){var _191=dojox.date.posix.getIsoWeeksInYear(_18e);_190=(_191+week+1)-_18f;}return dojo.date.add(_18e,"week",_190);};dojox.date.posix.getIsoWeekOfYear=function(_192){var _193=dojox.date.posix.getStartOfWeek(_192,1);var _194=new Date(_192.getFullYear(),0,4);_194=dojox.date.posix.getStartOfWeek(_194,1);var diff=_193.getTime()-_194.getTime();if(diff<0){return dojox.date.posix.getIsoWeeksInYear(_193);}return Math.ceil(diff/604800000)+1;};dojox.date.posix.getIsoWeeksInYear=function(_195){function p(y){return y+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400);};var y=_195.getFullYear();return (p(y)%7==4||p(y-1)%7==3)?53:52;};}if(!dojo._hasResource["com.realitybuilder.Block"]){dojo._hasResource["com.realitybuilder.Block"]=true;dojo.provide("com.realitybuilder.Block");dojo.declare("com.realitybuilder.Block",null,{_positionB:null,_camera:null,_blockProperties:null,_bottomVertexes:null,_bottomVertexesV:null,_bottomVertexesS:null,_topVertexes:null,_topVertexesV:null,_topVertexesS:null,_projectedVertexesVXZ:null,_projectedVertexesVXZS:null,_boundingBoxS:null,_lastCameraId:null,_lastBlockPropertiesVersionOnServer:null,_coordinatesChangedAfterLastRendering:false,_indexOfLeftmostVertex:null,_indexOfRightmostVertex:null,_onlySubtractBottom:false,constructor:function(_196,_197,_198){this._positionB=_198;this._blockProperties=_196;this._camera=_197;this._edges=this._INITIAL_EDGES;},positionB:function(){return this._positionB;},xB:function(){return this._positionB[0];},yB:function(){return this._positionB[1];},zB:function(){return this._positionB[2];},_vertexesS:function(){return this._bottomVertexesS.concat(this._topVertexesS);},projectedVertexesVXZ:function(){this._updateCoordinates();return (this._projectedVertexesVXZ===null)?false:this._projectedVertexesVXZ;},_updateViewSpaceXZPlaneCoordinates:function(){var i,_199,_19a,len,tmp=[],_19b,_19c;_199=this._bottomVertexesV;_19a=this._topVertexesV;len=_199.length;for(i=0;i<len;i+=1){_19b=[_199[i],_19a[i]];_19c=com.realitybuilder.util.intersectionLinePlaneVXZ(_19b);if(!_19c){tmp=null;break;}else{tmp.push(_19c);}}this._projectedVertexesVXZ=tmp;},collidesWith:function(_19d){var _19e,_19f=this._blockProperties.collisionOffsetsB(),_1a0,i;for(i=0;i<_19f.length;i+=1){_1a0=_19f[i];_19e=[this.xB()+_1a0[0],this.yB()+_1a0[1],this.zB()];if(com.realitybuilder.util.pointsIdenticalB(_19d.positionB(),_19e)){return true;}}return false;},attachableTo:function(_1a1){var _1a2,_1a3=this._blockProperties.attachmentOffsetsB(),_1a4,i;for(i=0;i<_1a3.length;i+=1){_1a4=_1a3[i];_1a2=com.realitybuilder.util.addVectorsB(this.positionB(),_1a4);if(com.realitybuilder.util.pointsIdenticalB(_1a1.positionB(),_1a2)){return true;}}return false;},_updateWorldSpaceCoordinates:function(){var xB=this.positionB()[0],yB=this.positionB()[1],zB=this.positionB()[2],_1a5=[],_1a6=[],_1a7=this._blockProperties.outlineB(),that=this;dojo.forEach(_1a7,function(_1a8){_1a5.push(com.realitybuilder.util.blockToWorld([xB+_1a8[0],yB+_1a8[1],zB],that._blockProperties));_1a6.push(com.realitybuilder.util.blockToWorld([xB+_1a8[0],yB+_1a8[1],zB+1],that._blockProperties));});this._bottomVertexes=_1a5;this._topVertexes=_1a6;},_updateViewSpaceCoordinates:function(){this._bottomVertexesV=dojo.map(this._bottomVertexes,dojo.hitch(this._camera,this._camera.worldToView));this._topVertexesV=dojo.map(this._topVertexes,dojo.hitch(this._camera,this._camera.worldToView));},_coordinatesNeedToBeUpdated:function(){var _1a9,_1aa;_1a9=this._lastCameraIdS!==this._camera.id();_1aa=this._lastBlockPropertiesVersionOnServer!==this._blockProperties.versionOnServer();return _1a9||_1aa;},_onCoordinatesUpdated:function(){this._lastBlockPropertiesVersionOnServer=this._blockProperties.versionOnServer();this._lastCameraId=this._camera.id();this._coordinatesChangedAfterLastRendering=true;},_updateHorizontalExtentsInSensorSpace:function(){var _1ab,_1ac,_1ad,_1ae,i,ilv,irv;_1ab=this._projectedVertexesVXZS;_1ad=_1ae=_1ab[0];ilv=irv=0;for(i=1;i<_1ab.length;i+=1){_1ac=_1ab[i];if(_1ac[0]<_1ad[0]){_1ad=_1ac;ilv=i;}if(_1ac[0]>_1ae[0]){_1ae=_1ac;irv=i;}}this._indexOfLeftmostVertex=ilv;this._indexOfRightmostVertex=irv;},_updateProjectedVertexesVXZS:function(){var cam=this._camera;this._projectedVertexesVXZS=dojo.map(this._projectedVertexesVXZ,function(_1af){var _1b0=[_1af[0],0,_1af[1]];return cam.viewToSensor(_1b0);});},_updateSensorSpaceBoundingBox:function(){var minX=Number.MAX_VALUE,minY=Number.MAX_VALUE,maxX=Number.MIN_VALUE,maxY=Number.MIN_VALUE;dojo.forEach(this._vertexesS(),function(_1b1){if(_1b1[0]<minX){minX=_1b1[0];}else{if(_1b1[0]>maxX){maxX=_1b1[0];}}if(_1b1[1]<minY){minY=_1b1[1];}else{if(_1b1[1]>maxY){maxY=_1b1[1];}}});this._boundingBoxS=[[minX,minY],[maxX,maxY]];},_updateSensorSpaceCoordinates:function(){var cam=this._camera;this._bottomVertexesS=dojo.map(this._bottomVertexesV,dojo.hitch(cam,cam.viewToSensor));this._topVertexesS=dojo.map(this._topVertexesV,dojo.hitch(cam,cam.viewToSensor));this._updateProjectedVertexesVXZS();this._updateHorizontalExtentsInSensorSpace();this._updateSensorSpaceBoundingBox();},_updateCoordinates:function(){if(this._coordinatesNeedToBeUpdated()){this._updateWorldSpaceCoordinates();this._updateViewSpaceCoordinates();this._updateViewSpaceXZPlaneCoordinates();this._updateSensorSpaceCoordinates();this._onCoordinatesUpdated();}},onlySubtractBottom:function(){this._onlySubtractBottom=true;},_subtractDrawBottomPath:function(_1b2){var _1b3,len,_1b4,i;_1b3=this._bottomVertexesS;_1b4=_1b3[0];_1b2.moveTo(_1b4[0],_1b4[1]);for(i=1;i<_1b3.length;i+=1){_1b4=_1b3[i];_1b2.lineTo(_1b4[0],_1b4[1]);}},_subtractDrawPath:function(_1b5){var _1b6,_1b7,len,_1b8,i,ilv,irv;_1b6=this._bottomVertexesS;_1b7=this._topVertexesS;len=_1b7.length;ilv=this._indexOfLeftmostVertex;irv=this._indexOfRightmostVertex;_1b8=_1b7[irv];_1b5.moveTo(_1b8[0],_1b8[1]);for(i=irv+1;i<=len+ilv;i+=1){_1b8=_1b7[i%len];_1b5.lineTo(_1b8[0],_1b8[1]);}_1b8=_1b6[ilv];_1b5.lineTo(_1b8[0],_1b8[1]);for(i=ilv+1;i<=len+irv;i+=1){_1b8=_1b6[i%len];_1b5.lineTo(_1b8[0],_1b8[1]);}_1b8=_1b6[irv];_1b5.lineTo(_1b8[0],_1b8[1]);},subtract:function(_1b9){var _1ba,_1bb,len,_1bc,i,ilv,irv;this._updateCoordinates();_1b9.globalCompositeOperation="destination-out";_1b9.fillStyle="black";_1b9.beginPath();if(this._onlySubtractBottom){this._subtractDrawBottomPath(_1b9);}else{this._subtractDrawPath(_1b9);}_1b9.closePath();_1b9.fill();_1b9.globalCompositeOperation="source-over";},_renderForeground:function(_1bd){var _1be=this._topVertexesS,_1bf=this._bottomVertexesS,len=_1be.length,_1c0,_1c1,i,ilv=this._indexOfLeftmostVertex,irv=this._indexOfRightmostVertex;_1bd.globalAlpha=1;_1bd.beginPath();_1c1=_1bf[ilv];_1bd.moveTo(_1c1[0],_1c1[1]);for(i=ilv+1;i<=irv;i+=1){_1c0=_1bf[i];_1bd.lineTo(_1c0[0],_1c0[1]);}_1bd.stroke();_1bd.beginPath();_1c1=_1be[0];_1bd.moveTo(_1c1[0],_1c1[1]);for(i=1;i<=_1be.length;i+=1){_1c0=_1be[i%len];_1bd.lineTo(_1c0[0],_1c0[1]);}_1bd.lineTo(_1c1[0],_1c1[1]);_1bd.stroke();for(i=ilv;i<=irv;i+=1){_1bd.beginPath();_1c0=_1bf[i%len];_1bd.moveTo(_1c0[0],_1c0[1]);_1c0=_1be[i%len];_1bd.lineTo(_1c0[0],_1c0[1]);_1bd.stroke();}},_renderBackground:function(_1c2){var _1c3=this._bottomVertexesS,_1c4=this._topVertexesS,len=_1c4.length,_1c5,i,ilv=this._indexOfLeftmostVertex,irv=this._indexOfRightmostVertex;_1c2.globalAlpha=0.2;_1c2.beginPath();_1c5=_1c3[irv];_1c2.moveTo(_1c5[0],_1c5[1]);for(i=irv+1;i<=len+ilv;i+=1){_1c5=_1c3[i%len];_1c2.lineTo(_1c5[0],_1c5[1]);}_1c2.stroke();for(i=irv+1;i<=len+ilv-1;i+=1){_1c2.beginPath();_1c5=_1c3[i%len];_1c2.moveTo(_1c5[0],_1c5[1]);_1c5=_1c4[i%len];_1c2.lineTo(_1c5[0],_1c5[1]);_1c2.stroke();}_1c2.globalAlpha=1;},render:function(_1c6,_1c7){this._updateCoordinates();_1c6.strokeStyle=_1c7;this._renderForeground(_1c6);this._renderBackground(_1c6);}});}if(!dojo._hasResource["com.realitybuilder.BlockProperties"]){dojo._hasResource["com.realitybuilder.BlockProperties"]=true;dojo.provide("com.realitybuilder.BlockProperties");dojo.declare("com.realitybuilder.BlockProperties",com.realitybuilder.Block,{_versionOnServer:"-1",_blockPositionSpacingXY:null,_blockPositionSpacingZ:null,_outlineB:null,_collisionOffsetsB:null,_attachmentOffsetsB:null,versionOnServer:function(){return this._versionOnServer;},isInitializedWithServerData:function(){return this._versionOnServer!=="-1";},updateWithServerData:function(_1c8){this._versionOnServer=_1c8.version;this._positionSpacingXY=_1c8.positionSpacingXY;this._positionSpacingZ=_1c8.positionSpacingZ;this._outlineB=_1c8.outlineB;this._collisionOffsetsB=_1c8.collisionOffsetsB;this._attachmentOffsetsB=_1c8.attachmentOffsetsB;dojo.publish("com/realitybuilder/BlockProperties/changed");},positionSpacingXY:function(){return this._positionSpacingXY;},positionSpacingZ:function(){return this._positionSpacingZ;},outlineB:function(){return this._outlineB;},collisionOffsetsB:function(){return this._collisionOffsetsB;},attachmentOffsetsB:function(){return this._attachmentOffsetsB;}});}if(!dojo._hasResource["com.realitybuilder.ConstructionBlock"]){dojo._hasResource["com.realitybuilder.ConstructionBlock"]=true;dojo.provide("com.realitybuilder.ConstructionBlock");dojo.declare("com.realitybuilder.ConstructionBlock",com.realitybuilder.Block,{_state:null,_timeStamp:null,constructor:function(_1c9,_1ca,_1cb,_1cc,_1cd){this._state=_1cc;this._timeStamp=_1cd;},timeStamp:function(){return this._timeStamp;},isDeleted:function(){return this._state===0;},isPending:function(){return this._state===1;},isReal:function(){return this._state===2;},state:function(){return this._state;},render:function(_1ce){if(!this.isDeleted()){var _1cf=this.isReal()?"green":"white";this.inherited(arguments,[arguments[0],_1cf]);}},renderSolidTop:function(_1d0){var _1d1,_1d2,i;this._updateCoordinates();_1d1=this._topVertexesS;_1d2=_1d1[0];_1d0.beginPath();_1d0.moveTo(_1d2[0],_1d2[1]);for(i=1;i<_1d1.length;i+=1){_1d2=_1d1[i];_1d0.lineTo(_1d2[0],_1d2[1]);}_1d0.closePath();_1d0.fill();}});}if(!dojo._hasResource["com.realitybuilder.util"]){dojo._hasResource["com.realitybuilder.util"]=true;dojo.provide("com.realitybuilder.util");com.realitybuilder.util.TOLERANCE_S=0.5;com.realitybuilder.util.TOLERANCE_V=0.00001;com.realitybuilder.util.TOLERANCE_VXZ=0.00001;com.realitybuilder.util.blockToWorld=function(pB,_1d3){var _1d4=_1d3.positionSpacingXY(),_1d5=_1d3.positionSpacingXY(),_1d6=_1d3.positionSpacingZ();return [pB[0]*_1d4,pB[1]*_1d5,pB[2]*_1d6];};com.realitybuilder.util.intersectionLinePlaneVXZ=function(_1d7){var _1d8,p1=_1d7[0],p2=_1d7[1];_1d8=com.realitybuilder.util.subtractVectors3D(p2,p1);if(Math.abs(_1d8[1])<com.realitybuilder.util.TOLERANCE_V){return false;}else{return [p1[0]-p1[1]*_1d8[0]/_1d8[1],p1[2]-p1[1]*_1d8[2]/_1d8[1]];}};com.realitybuilder.util.intersectionSegmentLineVXZ=function(_1d9,_1da){var x1=_1d9[0][0],z1=_1d9[0][1],x2=_1d9[1][0],z2=_1d9[1][1],x3=_1da[0][0],y3=_1da[0][1],x4=_1da[1][0],y4=_1da[1][1],u1=(x4-x3)*(z1-y3)-(y4-y3)*(x1-x3),u2=(y4-y3)*(x2-x1)-(x4-x3)*(z2-z1),_1db=0.01,u,x,y;if(Math.abs(u2)<_1db){return false;}else{u=u1/u2;if(u>-_1db&&u<1+_1db){x=x1+u*(x2-x1);y=z1+u*(z2-z1);return [x,y];}else{return false;}}};com.realitybuilder.util.relationPointSegmentVXZ=function(_1dc,_1dd){var _1de,_1df,_1e0,util;util=com.realitybuilder.util;_1de=[0,0];_1df=[_1de,_1dc];_1e0=util.intersectionSegmentLineVXZ(_1dd,_1df);if(_1e0===false){return 0;}else{if(util.pointsIdenticalVXZ(_1e0,_1dc)){return 0;}else{return util.pointIsBetween2D(_1dc,_1de,_1e0)?-1:1;}}};com.realitybuilder.util.pointIsBetween2D=function(p,p1,p2){var _1e1=(p[0]>=p1[0]&&p[0]<=p2[0])||(p[0]<=p1[0]&&p[0]>=p2[0]),_1e2=(p[1]>=p1[1]&&p[1]<=p2[1])||(p[1]<=p1[1]&&p[1]>=p2[1]);return _1e1&&_1e2;};com.realitybuilder.util.pointsIdentical2D=function(p1,p2,_1e3){return (Math.abs(p1[0]-p2[0])<_1e3&&Math.abs(p1[1]-p2[1])<_1e3);};com.realitybuilder.util.pointsIdenticalS=function(p1S,p2S){var _1e4=com.realitybuilder.util.TOLERANCE_S;return com.realitybuilder.util.pointsIdentical2D(p1S,p2S,_1e4);};com.realitybuilder.util.pointsIdenticalVXZ=function(_1e5,_1e6){var _1e7=com.realitybuilder.util.TOLERANCE_VXZ;return com.realitybuilder.util.pointsIdentical2D(_1e5,_1e6,_1e7);};com.realitybuilder.util.pointsIdenticalB=function(p1B,p2B){return ((p1B[0]-p2B[0])===0&&(p1B[1]-p2B[1])===0&&(p1B[2]-p2B[2])===0);};com.realitybuilder.util.subtractVectors3D=function(_1e8,_1e9){return [_1e8[0]-_1e9[0],_1e8[1]-_1e9[1],_1e8[2]-_1e9[2]];};com.realitybuilder.util.addVectorsB=function(_1ea,_1eb){return [_1ea[0]+_1eb[0],_1ea[1]+_1eb[1],_1ea[2]+_1eb[2]];};com.realitybuilder.util.subtractVectorsB=function(_1ec,_1ed){return [_1ec[0]-_1ed[0],_1ec[1]-_1ed[1],_1ec[2]-_1ed[2]];};com.realitybuilder.util.withDuplicatesRemoved=function(ps){var _1ee=[],i,j,p1,p2,_1ef;for(i=0;i<ps.length;i+=1){p1=ps[i];_1ef=false;for(j=i+1;j<ps.length;j+=1){p2=ps[j];if(com.realitybuilder.util.pointsIdenticalS(p1,p2)){_1ef=true;break;}}if(!_1ef){_1ee.push(p1);}}return _1ee;};com.realitybuilder.util.cartesianToPolar=function(pS){var x=pS[0],y=pS[1],_1f0=Math.atan2(y,x),_1f1=Math.sqrt(x*x+y*y);return [_1f0,_1f1];};com.realitybuilder.util.addS=function(p1S,p2S){return [p1S[0]+p2S[0],p1S[1]+p2S[1]];};com.realitybuilder.util.polarToCartesian=function(_1f2){var _1f3=_1f2[0],_1f4=_1f2[1],x=_1f4*Math.cos(_1f3),y=_1f4*Math.sin(_1f3);return [x,y];};com.realitybuilder.util.addPrefix=function(_1f5,_1f6){var tmp=[],i;for(i in _1f6){if(_1f6.hasOwnProperty(i)){tmp[_1f5.toString()+i.toString()]=_1f6[i];}}return tmp;};com.realitybuilder.util.isFlashCanvasActive=function(){return (typeof FlashCanvas!=="undefined");};com.realitybuilder.util.isFlashReadyForFlashCanvas=function(){return swfobject.hasFlashPlayerVersion("9");};com.realitybuilder.util.isCanvasSupported=function(){return (document.createElement("canvas").getContext||(com.realitybuilder.util.isFlashCanvasActive()&&com.realitybuilder.util.isFlashReadyForFlashCanvas()));};com.realitybuilder.util.showNoCanvasErrorMessage=function(){dojo.attr("noCanvasErrorMessage","innerHTML","<p class=\"first\">The Reality Builder does not work because your "+"browser does not support the <a "+"href=\"http://www.w3.org/TR/html5/the-canvas-element.html\">Canvas "+"element</a>.</p>");};com.realitybuilder.util.showNoImagesErrorMessage=function(){dojo.attr("noImagesErrorMessage","innerHTML","<p class=\"first\">The Reality Builder does not work because your "+"browser does not load images.</p>");};com.realitybuilder.util.clearCanvas=function(_1f7){if(_1f7.getContext){var _1f8=_1f7.getContext("2d");_1f8.clearRect(0,0,_1f7.width,_1f7.height);}};com.realitybuilder.util.fillCanvas=function(_1f9,_1fa){if(_1f9.getContext){var _1fb=_1f9.getContext("2d");_1fb.fillStyle=_1fa;_1fb.fillRect(0,0,_1f9.width,_1f9.height);}};}if(!dojo._hasResource["com.realitybuilder.ConstructionBlocks"]){dojo._hasResource["com.realitybuilder.ConstructionBlocks"]=true;dojo.provide("com.realitybuilder.ConstructionBlocks");dojo.declare("com.realitybuilder.ConstructionBlocks",null,{_versionOnServer:"-1",_construction:null,_blockProperties:null,_blocks:null,_realBlocksSorted:null,_pendingBlocks:null,_realBlocksCanvas:null,_pendingBlocksCanvas:null,constructor:function(_1fc,_1fd){this._blockProperties=_1fd;this._blocks=[];this._realBlocksSorted=[];this._construction=_1fc;var _1fe=_1fc.camera().sensor();this._realBlocksCanvas=_1fe.realBlocksCanvas();this._pendingBlocksCanvas=_1fe.pendingBlocksCanvas();},blocks:function(){return this._blocks;},pendingBlocks:function(){return this._pendingBlocks;},realBlocksSorted:function(){return this._realBlocksSorted;},realBlocksInLayer:function(zB){var _1ff=[],i,_200=this._realBlocksSorted,_201;for(i=0;i<_200.length;i+=1){_201=_200[i];if(_201.zB()===zB){_1ff.push(_201);}else{if(_201.zB()<zB){break;}}}return _1ff;},versionOnServer:function(){return this._versionOnServer;},isInitializedWithServerData:function(){return this._versionOnServer!=="-1";},_createBlockFromServerData:function(bd){var _202=this._construction.camera();return new com.realitybuilder.ConstructionBlock(this._blockProperties,_202,[bd.xB,bd.yB,bd.zB],bd.state,bd.timeStamp);},updateWithServerData:function(_203){this._versionOnServer=_203.version;this._blocks=dojo.map(_203.blocks,dojo.hitch(this,this._createBlockFromServerData));this._updateRealBlocksSorted();this._updatePendingBlocks();dojo.publish("com/realitybuilder/ConstructionBlocks/changed");},_sortByHeight:function(_204,_205){if(_204.zB()>_205.zB()){return -1;}else{if(_204.zB()<_205.zB()){return 1;}else{return 0;}}},_updateRealBlocksSorted:function(_206){var tmp=dojo.filter(this._blocks,function(_207){return _207.isReal();});tmp.sort(this._sortByHeight);this._realBlocksSorted=tmp;},_updatePendingBlocks:function(_208){this._pendingBlocks=dojo.filter(this._blocks,function(_209){return _209.isPending();});},blockAt:function(_20a){var _20b=this.blocks(),_20c,i;for(i=0;i<_20b.length;i+=1){_20c=_20b[i];if(com.realitybuilder.util.pointsIdenticalB(_20a,_20c.positionB())){return _20c;}}return false;},realBlocksCollideWith:function(_20d){var _20e=this.realBlocksSorted(),_20f,i;for(i=0;i<_20e.length;i+=1){_20f=_20e[i];if(_20f.collidesWith(_20d)){return true;}}return false;},realBlocksAreAttachableTo:function(_210){var _211=this.realBlocksSorted(),_212,i;for(i=0;i<_211.length;i+=1){_212=_211[i];if(_212.attachableTo(_210)){return true;}}return false;},_makePendingOnServerSucceeded:function(){dojo.publish("com/realitybuilder/ConstructionBlocks/changedOnServer");},_makePendingOnServerFailed:function(){dojo.publish("com/realitybuilder/ConstructionBlocks/changeOnServerFailed");},makePendingOnServer:function(_213){dojo.xhrPost({url:"/admin/rpc/make_pending",content:{"xB":_213[0],"yB":_213[1],"zB":_213[2]},load:dojo.hitch(this,this._makePendingOnServerSucceeded),error:dojo.hitch(this,this._makePendingOnServerFailed)});},_createPendingOnServerSucceeded:function(){dojo.publish("com/realitybuilder/ConstructionBlocks/changedOnServer");},_createPendingOnServerFailed:function(){dojo.publish("com/realitybuilder/ConstructionBlocks/changeOnServerFailed");},createPendingOnServer:function(_214){dojo.xhrPost({url:"/rpc/create_pending",content:{"xB":_214[0],"yB":_214[1],"zB":_214[2]},load:dojo.hitch(this,this._createPendingOnServerSucceeded),error:dojo.hitch(this,this._createPendingOnServerFailed)});},_deleteOnServerSucceeded:function(){dojo.publish("com/realitybuilder/ConstructionBlocks/changedOnServer");},_deleteOnServerFailed:function(){dojo.publish("com/realitybuilder/ConstructionBlocks/changeOnServerFailed");},deleteOnServer:function(_215){dojo.xhrPost({url:"/admin/rpc/delete",content:{"xB":_215[0],"yB":_215[1],"zB":_215[2]},load:dojo.hitch(this,this._deleteOnServerSucceeded),error:dojo.hitch(this,this._deleteOnServerFailed)});},_makeRealOnServerSucceeded:function(){dojo.publish("com/realitybuilder/ConstructionBlocks/changedOnServer");},_makeRealOnServerFailed:function(){dojo.publish("com/realitybuilder/ConstructionBlocks/changeOnServerFailed");},makeRealOnServer:function(_216){dojo.xhrPost({url:"/admin/rpc/make_real",content:{"xB":_216[0],"yB":_216[1],"zB":_216[2]},load:dojo.hitch(this,this._makeRealOnServerSucceeded),error:dojo.hitch(this,this._makeRealOnServerFailed)});},setBlockStateOnServer:function(_217,_218){switch(_218){case 0:this.deleteOnServer(_217);break;case 1:this.makePendingOnServer(_217);break;case 2:this.makeRealOnServer(_217);break;}},zBOfUpperSideOfRealBlockBelow:function(xB,yB,zB){var _219,_21a,_21b,bXB,bYB,bZB;_219=this._realBlocksSorted;_21a=zB-1;_21b=0;dojo.forEach(_219,function(b){bXB=b.xB();bYB=b.yB();bZB=b.zB();if(bZB+1<=_21a&&xB>=bXB&&xB<=bXB+1&&yB>=bYB&&yB<=bYB+1&&bZB+1>_21b){_21b=bZB+1;}});return _21b;},_renderBlocks:function(_21c,_21d){if(_21c.getContext){var _21e=_21c.getContext("2d");com.realitybuilder.util.clearCanvas(_21c);dojo.forEach(_21d,function(b){b.render(_21e);});}},render:function(){this._renderBlocks(this._realBlocksCanvas,this._realBlocksSorted);this._renderBlocks(this._pendingBlocksCanvas,this._pendingBlocks);}});}if(!dojo._hasResource["com.realitybuilder.LayerShadow"]){dojo._hasResource["com.realitybuilder.LayerShadow"]=true;dojo.provide("com.realitybuilder.LayerShadow");dojo.declare("com.realitybuilder.LayerShadow",null,{_newBlock:null,_camera:null,_blockProperties:null,_constructionBlocks:null,_fullVertexes:null,_fullVertexesV:null,_fullVertexesS:null,_canvas:null,_helperCanvas:null,constructor:function(_21f,_220,_221,_222){var _223;this._newBlock=_21f;this._blockProperties=_220;this._camera=_221;this._constructionBlocks=_222;_223=_221.sensor().shadowCanvas();this._canvas=dojo.create("canvas");dojo.attr(this._canvas,"width",_223.width);dojo.attr(this._canvas,"height",_223.height);this._helperCanvas=dojo.create("canvas");dojo.attr(this._helperCanvas,"width",_223.width);dojo.attr(this._helperCanvas,"height",_223.height);if(com.realitybuilder.util.isFlashCanvasActive()){FlashCanvas.initElement(this._canvas);FlashCanvas.initElement(this._helperCanvas);}},canvas:function(){return this._canvas;},_updateWorldSpace:function(_224){var xB=this._newBlock.xB(),yB=this._newBlock.yB(),zB=_224+1,vs=[],_225=this._blockProperties.outlineB(),that=this;dojo.forEach(_225,function(_226){vs.push(com.realitybuilder.util.blockToWorld([xB+_226[0],yB+_226[1],zB],that._blockProperties));});this._fullVertexes=vs;},_updateViewSpaceCoordinates:function(_227){this._updateWorldSpace(_227);this._fullVertexesV=dojo.map(this._fullVertexes,dojo.hitch(this._camera,this._camera.worldToView));},_updateSensorSpaceCoordinates:function(_228){this._fullVertexesS=dojo.map(this._fullVertexesV,dojo.hitch(this._camera,this._camera.viewToSensor));},_updateCoordinates:function(_229){this._updateViewSpaceCoordinates(_229);this._updateSensorSpaceCoordinates(_229);},_renderTops:function(_22a,_22b){var _22c=this._constructionBlocks.realBlocksInLayer(_22a);dojo.forEach(_22c,function(_22d){_22d.renderSolidTop(_22b);});},_renderFull:function(_22e,_22f){var _230,_231,i;this._updateCoordinates(_22e);_230=this._fullVertexesS;_22f.fillStyle="red";_231=_230[0];_22f.beginPath();_22f.moveTo(_231[0],_231[1]);for(i=1;i<_230.length;i+=1){_231=_230[i];_22f.lineTo(_231[0],_231[1]);}_22f.closePath();_22f.fill();},render:function(_232){var _233=this._canvas,_234=this._helperCanvas,_235,_236;if(_233.getContext){_235=_233.getContext("2d");com.realitybuilder.util.clearCanvas(_233);_236=_234.getContext("2d");com.realitybuilder.util.clearCanvas(_234);_235.globalCompositeOperation="source-over";if(_232===-1){com.realitybuilder.util.fillCanvas(_233,"black");}else{this._renderTops(_232,_235);}_236.globalCompositeOperation="source-over";_236.drawImage(_233,0,0);_236.globalCompositeOperation="xor";this._renderFull(_232,_236);this._renderFull(_232,_235);_235.globalCompositeOperation="destination-out";_235.drawImage(_234,0,0);}}});}if(!dojo._hasResource["com.realitybuilder.ShadowObscuringBlocks"]){dojo._hasResource["com.realitybuilder.ShadowObscuringBlocks"]=true;dojo.provide("com.realitybuilder.ShadowObscuringBlocks");dojo.declare("com.realitybuilder.ShadowObscuringBlocks",null,{_blocksSorted:null,_newBlock:null,_camera:null,_blockProperties:null,_constructionBlocks:null,constructor:function(_237,_238,_239,_23a){this._newBlock=_237;this._blockProperties=_238;this._camera=_239;this._constructionBlocks=_23a;},_copyBlocksToLayer:function(_23b,_23c){var _23d=[],_23e=this._camera,that=this;dojo.forEach(_23b,function(_23f){var _240,_241;_241=[_23f.xB(),_23f.yB(),_23c];_240=new com.realitybuilder.Block(that._blockProperties,_23e,_241);_240.onlySubtractBottom();_23d.push(_240);});return _23d;},update:function(){var zB,_242=this._newBlock,cbs=this._constructionBlocks,_243=[],_244,_245=[],_246;for(zB=_242.maxZB()-1;zB>=0;zB-=1){_244=cbs.realBlocksInLayer(zB);if(zB<_242.zB()){_246=this._copyBlocksToLayer(_245,zB);_244=_244.concat(_244,_246);}_243=_243.concat(_244);_245=_244;}this._blocksSorted=_243;},_blocksInLayer:function(zB){var _247,_248,i,_249=[];_247=this._blocksSorted;for(i=0;i<_247.length;i+=1){_248=_247[i];if(_248.zB()===zB){_249.push(_248);}else{if(_248.zB()<zB){break;}}}return _249;},subtract:function(_24a,zB){var _24b=this._blocksInLayer(zB);dojo.forEach(_24b,function(_24c){_24c.subtract(_24a);});}});}if(!dojo._hasResource["com.realitybuilder.Shadow"]){dojo._hasResource["com.realitybuilder.Shadow"]=true;dojo.provide("com.realitybuilder.Shadow");dojo.declare("com.realitybuilder.Shadow",null,{_newBlock:null,_camera:null,_blockProperties:null,_constructionBlocks:null,_shadowObscuringBlocks:null,_layerShadow:null,constructor:function(_24d,_24e,_24f,_250){this._newBlock=_24d;this._blockProperties=_24e;this._camera=_24f;this._constructionBlocks=_250;this._shadowObscuringBlocks=new com.realitybuilder.ShadowObscuringBlocks(_24d,_24e,_24f,_250);this._layerShadow=new com.realitybuilder.LayerShadow(_24d,_24e,_24f,_250);},_renderLayerShadow:function(_251,_252,_253,_254,_255){this._layerShadow.render(_255);_251.globalAlpha=0.2;_251.drawImage(this._layerShadow.canvas(),0,0);_251.globalAlpha=1;},render:function(){var _256=this._camera.sensor().shadowCanvas(),_257,_258,_259=this._newBlock,_25a=this._camera,_25b=this._constructionBlocks;this._shadowObscuringBlocks.update();if(_256.getContext){_257=_256.getContext("2d");com.realitybuilder.util.clearCanvas(_256);for(_258=-1;_258<=_259.maxZB()-1;_258+=1){if(_258<_259.zB()){this._renderLayerShadow(_257,_259,_25a,_25b,_258);}this._shadowObscuringBlocks.subtract(_257,_258+1);}return;}},clear:function(){var _25c=this._camera.sensor().shadowCanvas();com.realitybuilder.util.clearCanvas(_25c);}});}if(!dojo._hasResource["com.realitybuilder.NewBlock"]){dojo._hasResource["com.realitybuilder.NewBlock"]=true;dojo.provide("com.realitybuilder.NewBlock");dojo.declare("com.realitybuilder.NewBlock",com.realitybuilder.Block,{"-chains-":{constructor:"manual"},_versionOnServer:"-1",_buildSpace1B:null,_buildSpace2B:null,_state:null,_constructionBlocks:null,_shadow:null,_camera:null,_lastPositionB:null,_lastState:null,_lastConstructionBlocksVersion:null,constructor:function(_25d,_25e,_25f){this.inherited(arguments,[_25d,_25e,[0,0,0]]);this._state=1;this._constructionBlocks=_25f;this._shadow=new com.realitybuilder.Shadow(this,_25d,_25e,_25f);this._camera=_25e;},versionOnServer:function(){return this._versionOnServer;},isInitializedWithServerData:function(){return this._versionOnServer!=="-1";},updateWithServerData:function(_260){var _261,_262;_261=!this.isInitializedWithServerData();if(_261){this._positionB=[_260.initXB,_260.initYB,_260.initZB];_262=true;}else{_262=false;}this._buildSpace1B=[_260.buildSpace1XB,_260.buildSpace1YB,_260.buildSpace1ZB];this._buildSpace2B=[_260.buildSpace2XB,_260.buildSpace2YB,_260.buildSpace2ZB];this._versionOnServer=_260.version;if(_262){dojo.publish("com/realitybuilder/NewBlock/positionInitialized");}dojo.publish("com/realitybuilder/NewBlock/buildSpaceChanged");},collidesWithRealBlock:function(){return this._constructionBlocks.realBlocksCollideWith(this);},_viewSpaceNeedsToBeUpdated:function(){return (this._lastPositionB===null||!com.realitybuilder.util.pointsIdenticalB(this._lastPositionB,this._positionB)||this.inherited(arguments));},_onViewSpaceUpdated:function(){this._lastPositionB=dojo.clone(this._positionB);this.inherited(arguments);},move:function(_263){if(!this.wouldGoOutOfRange(_263)){this._positionB=com.realitybuilder.util.addVectorsB(this._positionB,_263);}dojo.publish("com/realitybuilder/NewBlock/moved");},isMovable:function(){return this._state===1;},isStopped:function(){return this._state===0;},stop:function(){this._state=0;dojo.publish("com/realitybuilder/NewBlock/stopped");},makeMovable:function(){this._state=1;dojo.publish("com/realitybuilder/NewBlock/madeMovable");},maxZB:function(){return this._buildSpace2B[2];},updatePositionB:function(){var _264,cbs=this._constructionBlocks,xB=this.xB(),yB=this.yB(),_265;if(this.collidesWithRealBlock()){_265=this.zB();do{_265+=1;_264=new com.realitybuilder.Block(this._blockProperties,this._camera,[xB,yB,_265]);}while(cbs.realBlocksCollideWith(_264));this._positionB[2]=_265;}},wouldGoOutOfRange:function(_266){var _267,_268,cbs=this._constructionBlocks;_267=com.realitybuilder.util.addVectorsB(this._positionB,_266);_268=new com.realitybuilder.Block(this._blockProperties,this._camera,_267);return (cbs.realBlocksCollideWith(_268)||!this._wouldBeInMoveSpace(_267));},_wouldBeInMoveSpace:function(_269){var b1B=this._buildSpace1B,b2B=this._buildSpace2B;return (_269[0]>=b1B[0]-2&&_269[0]<=b2B[0]&&_269[1]>=b1B[1]-2&&_269[1]<=b2B[1]&&_269[2]>=0&&_269[2]<=b2B[2]+1);},_isInBuildSpace:function(){var xB=this._positionB[0],yB=this._positionB[1],zB=this._positionB[2],b1B=this._buildSpace1B,b2B=this._buildSpace2B;return (xB>=b1B[0]&&xB<=b2B[0]-2&&yB>=b1B[1]&&yB<=b2B[1]-2&&zB>=b1B[2]&&zB<=b2B[2]);},_isAttachable:function(){return (this._constructionBlocks.realBlocksAreAttachableTo(this)||this.zB()===0);},canBeMadeReal:function(){return this._isInBuildSpace()&&this._isAttachable();},_boundingBoxesOverlap:function(_26a){return (this._boundingBoxS[1][0]>=_26a._boundingBoxS[0][0]&&this._boundingBoxS[0][0]<=_26a._boundingBoxS[1][0]&&this._boundingBoxS[1][1]>=_26a._boundingBoxS[0][1]&&this._boundingBoxS[0][1]<=_26a._boundingBoxS[1][1]);},_isObscuredBySLO:function(_26b){var i,j,_26c,_26d,_26e,len,_26f,_270,_271,util;util=com.realitybuilder.util;_26d=this.projectedVertexesVXZ();_26e=_26b.projectedVertexesVXZ();if(_26d===false||_26e===false){return false;}len=_26d.length;for(i=0;i<len;i+=1){_271=[_26d[i],_26d[(i+1)%len]];for(j=0;j<len;j+=1){_270=_26e[j];_26c=util.relationPointSegmentVXZ(_270,_271);if(_26c<0){return true;}else{if(_26c>0){return false;}}}}return false;},_subtractRealBlock:function(_272,_273){if(this._boundingBoxesOverlap(_272)){_272.subtract(_273);}},_subtractRealBlocks:function(_274){var _275=this._constructionBlocks.realBlocksSorted(),i,_276,zB=this.zB();for(i=0;i<_275.length;i+=1){_276=_275[i];if(_276.zB()<zB){break;}else{if(_276.zB()===zB){if(this._isObscuredBySLO(_276)){this._subtractRealBlock(_276,_274);}}else{if(_276.zB()>zB){this._subtractRealBlock(_276,_274);}}}}},_renderShadow:function(){if(this.isMovable()){this._shadow.render();}else{this._shadow.clear();}},_needsToBeRendered:function(){var _277,_278,_279;_277=this._coordinatesChangedAfterLastRendering;_278=(this._lastConstructionBlocksVersion!==this._constructionBlocks.versionOnServer());_279=(this._lastState!==this._state);return _277||_278||_279;},_onRendered:function(){this._coordinatesChangedAfterLastRendering=false;this._lastState=this._state;this._lastConstructionBlocksVersion=this._constructionBlocks.versionOnServer();},render:function(){var _27a,_27b,_27c;this._updateCoordinates();if(this._needsToBeRendered()){_27a=this._camera.sensor().newBlockCanvas();if(_27a.getContext){_27b=_27a.getContext("2d");_27c=this.isMovable()?"red":"white";if(!com.realitybuilder.util.isFlashCanvasActive()){this._renderShadow();}com.realitybuilder.util.clearCanvas(_27a);this.inherited(arguments,[_27b,_27c]);this._subtractRealBlocks(_27b);}this._onRendered();}}});}if(!dojo._hasResource["com.realitybuilder.Image"]){dojo._hasResource["com.realitybuilder.Image"]=true;dojo.provide("com.realitybuilder.Image");dojo.declare("com.realitybuilder.Image",null,{_versionOnServer:"-1",_url:"",_updateIntervalClient:5,_updateIntervalServer:5,_node:null,_onloadHandle:null,_imageLoaded:false,constructor:function(_27d){this._node=dojo.byId("live");this._node.style.width=_27d.sensor().width()+"px";this._node.style.height=_27d.sensor().height()+"px";this._onloadHandle=dojo.connect(this._node,"onload",this,this._onFirstImageLoad);this._refresh();},imageLoaded:function(){return this._imageLoaded;},versionOnServer:function(){return this._versionOnServer;},url:function(){return this._url;},updateIntervalServer:function(){return this._updateIntervalServer;},updateIntervalClient:function(){return this._updateIntervalClient;},updateWithServerData:function(_27e){this._versionOnServer=_27e.version;this._updateIntervalClient=_27e.updateIntervalClient;this._updateIntervalServer=_27e.updateIntervalServer;this._url=_27e.url;this._backgroundImageInterval=_27e.updateIntervalClient*1000;dojo.publish("com/realitybuilder/Image/changed");},_onFirstImageLoad:function(){this._imageLoaded=true;dojo.disconnect(this._onloadHandle);},_refresh:function(){this._node.src="/images/live.jpg?nocache="+Math.random().toString();setTimeout(dojo.hitch(this,this._refresh),this._updateIntervalClient*1000);this._refreshed=true;}});}if(!dojo._hasResource["com.realitybuilder.Sensor"]){dojo._hasResource["com.realitybuilder.Sensor"]=true;dojo.provide("com.realitybuilder.Sensor");dojo.declare("com.realitybuilder.Sensor",null,{_realBlocksCanvas:null,_pendingBlocksCanvas:null,_shadowCanvas:null,_newBlockCanvas:null,_width:null,_height:null,constructor:function(_27f,_280){this._realBlocksCanvas=dojo.byId("sensorRealBlocksCanvas");this._pendingBlocksCanvas=dojo.byId("sensorPendingBlocksCanvas");this._shadowCanvas=dojo.byId("sensorShadowCanvas");this._newBlockCanvas=dojo.byId("sensorNewBlockCanvas");this._width=_27f;this._height=_280;this._setCanvasesDimensions();var _281=dojo.byId("view");_281.style.width=_27f+"px";_281.style.height=_280+"px";},_setCanvasesDimensions:function(){var _282=[this._realBlocksCanvas,this._pendingBlocksCanvas,this._shadowCanvas,this._newBlockCanvas],_283=this._width,_284=this._height;dojo.forEach(_282,function(_285){dojo.attr(_285,"width",_283);dojo.attr(_285,"height",_284);dojo.style(_285,"width",_283+"px");dojo.style(_285,"height",_284+"px");});},realBlocksCanvas:function(){return this._realBlocksCanvas;},pendingBlocksCanvas:function(){return this._pendingBlocksCanvas;},shadowCanvas:function(){return this._shadowCanvas;},newBlockCanvas:function(){return this._newBlockCanvas;},_setCanvasVisibility:function(_286,show){dojo.style(_286,"visibility",show?"visible":"hidden");},showRealBlocks:function(show){this._setCanvasVisibility(this._realBlocksCanvas,show);},showPendingBlocks:function(show){this._setCanvasVisibility(this._pendingBlocksCanvas,show);},width:function(){return this._width;},height:function(){return this._height;}});}if(!dojo._hasResource["com.realitybuilder.Camera"]){dojo._hasResource["com.realitybuilder.Camera"]=true;dojo.provide("com.realitybuilder.Camera");dojo.declare("com.realitybuilder.Camera",null,{_blockProperties:null,_position:null,_aX:0,_aY:0,_aZ:0,_fl:1,_sensorResolution:100,_rZ:null,_rX:null,_rZYX:null,_sensor:null,_versionOnServer:"-1",_id:null,constructor:function(_287,_288,_289){this._blockProperties=_287;this._position=[0,0,1];this._sensor=new com.realitybuilder.Sensor(_288,_289);this._updateRotationMatrices();},_updateId:function(){this._id=Math.random().toString();},sensor:function(){return this._sensor;},versionOnServer:function(){return this._versionOnServer;},version:function(){},isInitializedWithServerData:function(){return this._versionOnServer!=="-1";},position:function(){return this._position;},aX:function(){return this._aX;},aY:function(){return this._aY;},aZ:function(){return this._aZ;},fl:function(){return this._fl;},sensorResolution:function(){return this._sensorResolution;},id:function(){return this._id;},update:function(data){this._position=[data.x,data.y,data.z];this._aX=data.aX;this._aY=data.aY;this._aZ=data.aZ;this._fl=data.fl;this._sensorResolution=data.sensorResolution;this._updateRotationMatrices();this._updateId();dojo.publish("com/realitybuilder/Camera/changed");},updateWithServerData:function(_28a){this._versionOnServer=_28a.version;this.update(_28a);},_updateRotationMatrices:function(){var rYX;this._rX=[[1,0,0],[0,Math.cos(-this._aX),Math.sin(-this._aX)],[0,-Math.sin(-this._aX),Math.cos(-this._aX)]];this._rY=[[Math.cos(-this._aY),0,Math.sin(-this._aY)],[0,1,0],[-Math.sin(-this._aY),0,Math.cos(-this._aY)]];this._rZ=[[Math.cos(-this._aZ),Math.sin(-this._aZ),0],[-Math.sin(-this._aZ),Math.cos(-this._aZ),0],[0,0,1]];rYX=dojox.math.matrix.multiply(this._rY,this._rX);this._rZYX=dojox.math.matrix.multiply(this._rZ,rYX);},worldToView:function(_28b){var tmp=com.realitybuilder.util.subtractVectors3D(_28b,this._position);tmp=dojox.math.matrix.transpose([tmp]);tmp=dojox.math.matrix.multiply(this._rZYX,tmp);tmp=dojox.math.matrix.transpose(tmp)[0];return tmp;},scale:function(zV){return this._sensorResolution*this._fl/zV;},viewToSensor:function(_28c){var xV=_28c[0],yV=_28c[1],zV=_28c[2],_28d;_28d=this.scale(zV);xV*=_28d;yV*=_28d;xV+=this._sensor.width()/2;yV+=this._sensor.height()/2;return [xV,yV];},blockToSensor:function(_28e){return this.viewToSensor(this.worldToView(com.realitybuilder.util.blockToWorld(_28e,this._blockProperties)));}});}if(!dojo._hasResource["com.realitybuilder.CoordinateButton"]){dojo._hasResource["com.realitybuilder.CoordinateButton"]=true;dojo.provide("com.realitybuilder.CoordinateButton");dojo.declare("com.realitybuilder.CoordinateButton",null,{_highlightColor:"red",_standardColor:"white",_sideLengthS:37,_radiusS:17.5,centerS:null,_canvas:null,_group:null,_plus:null,_newBlock:null,_coordinate:null,_disabled:true,_onclickHandle:null,_deltaB:null,constructor:function(_28f,_290,_291,plus,_292){this.centerS=_290;this._plus=plus;this._newBlock=_28f;this._coordinate=_291;this._computeDeltaB();this._createNode();},highlight:function(){if(!this._disabled){this._render(this._highlightColor);}},unhighlight:function(){this._render(this._standardColor);},radiusS:function(){return this._radiusS;},move:function(_293){var l=this._sideLengthS;this._canvas.style.left=(_293[0]-l/2)+"px";this._canvas.style.top=(_293[1]-l/2)+"px";this.centerS=_293;},update:function(_294){var _295,i;if(_294){this._disable();}else{_295=[];for(i=0;i<3;i+=1){_295[i]=(i===this._coordinate)?this._delta():0;}if(this._newBlock.wouldGoOutOfRange(_295)){this._disable();}else{this._enable();}}},moveNewBlock:function(){this._newBlock.move(this._deltaB);},_computeDeltaB:function(){var i;this._deltaB=[];for(i=0;i<3;i+=1){this._deltaB[i]=(i===this._coordinate)?this._delta():0;}},_direction:function(){return (this._plus?1:-1);},_delta:function(){return this._direction();},_disable:function(){if(!this._disabled){dojo.disconnect(this._onclickHandle);this._render(this._standardColor);this._disabled=true;}},_enable:function(){if(this._disabled){this._onclickHandle=dojo.connect(this._canvas,"onclick",this,this.moveNewBlock);this._disabled=false;}},_drawRectangle:function(_296){_296.createRect({x1:0,y1:0,x2:_296.width,y2:_296.height}).setFill([0,0,0,0]);},_createNode:function(){var l=this._sideLengthS;this._canvas=dojo.create("canvas",{width:l,height:l,style:{position:"absolute",left:(this.centerS[0]-l/2)+"px",top:(this.centerS[1]-l/2)+"px"}},"coordinateControls");if(com.realitybuilder.util.isFlashCanvasActive()){FlashCanvas.initElement(this._canvas);}dojo.connect(this._canvas,"onmouseover",this,this.highlight);dojo.connect(this._canvas,"onmouseout",this,this.unhighlight);this._render(this._standardColor);},_render:function(_297){var _298=this._canvas,l=this._sideLengthS,_299;if(_298.getContext){_299=_298.getContext("2d");com.realitybuilder.util.clearCanvas(_298);_299.strokeStyle=_297;_299.beginPath();_299.arc(l/2,l/2,this._radiusS,0,2*Math.PI,false);_299.stroke();if(this._plus){_299.moveTo(l/2,4);_299.lineTo(l/2,l-4);_299.stroke();}_299.moveTo(4,l/2);_299.lineTo(l-4,l/2);_299.stroke();}}});}if(!dojo._hasResource["com.realitybuilder.CoordinateControls"]){dojo._hasResource["com.realitybuilder.CoordinateControls"]=true;dojo.provide("com.realitybuilder.CoordinateControls");dojo.declare("com.realitybuilder.CoordinateControls",null,{_coordinateButtons:null,_newBlock:null,_canvas:null,_camera:null,constructor:function(_29a,_29b){this._newBlock=_29a;this._camera=_29b;this._coordinateButtons=[];this._canvas=dojo.byId("coordinateControlsCanvas");this._setCanvasDimensions();},_setCanvasDimensions:function(){var _29c=this._camera.sensor(),_29d=_29c.width(),_29e=_29c.height();dojo.attr(this._canvas,"width",_29d);dojo.attr(this._canvas,"height",_29e);dojo.style(this._canvas,"width",_29d+"px");dojo.style(this._canvas,"height",_29e+"px");},update:function(_29f){var cbs=this._coordinateButtons;dojo.forEach(cbs,function(cb){cb.update(_29f);});},render:function(){if(this._canvas.getContext){var _2a0=this._canvas.getContext("2d");_2a0.clearRect(0,0,this._canvas.width,this._canvas.height);}this._renderButtonPair(0,[3,-1.5,0],[7,-1.5,0]);this._renderButtonPair(1,[11.5,3,0],[11.5,7,0]);this._renderButtonPair(2,[0,-1.5,1],[0,-1.5,4]);},_renderLine:function(_2a1,_2a2){var _2a3,_2a4,_2a5,_2a6,_2a7,_2a8,_2a9,_2aa,_2ab,_2ac,_2ad,_2ae;_2a3=_2a1.centerS;_2a4=_2a2.centerS;_2a5=_2a1.radiusS();_2a6=[_2a4[0]-_2a3[0],_2a4[1]-_2a3[1]];_2a7=com.realitybuilder.util.cartesianToPolar(_2a6);_2a8=_2a7[0];_2a9=_2a7[1];_2aa=com.realitybuilder.util.polarToCartesian([_2a8,_2a5+0.5]);_2ab=com.realitybuilder.util.polarToCartesian([_2a8,_2a9-_2a5-0.5]);_2ac=com.realitybuilder.util.addS(_2a3,_2aa);_2ad=com.realitybuilder.util.addS(_2a3,_2ab);if(this._canvas.getContext){_2ae=this._canvas.getContext("2d");_2ae.strokeStyle="white";_2ae.beginPath();_2ae.moveTo(_2ac[0],_2ac[1]);_2ae.lineTo(_2ad[0],_2ad[1]);_2ae.stroke();}},_renderButton:function(_2af,plus,_2b0){var _2b1=this._camera.blockToSensor(_2b0),i=2*_2af+(plus?1:0),_2b2;if(this._coordinateButtons[i]){_2b2=this._coordinateButtons[i];_2b2.move(_2b1);}else{_2b2=new com.realitybuilder.CoordinateButton(this._newBlock,_2b1,_2af,plus);this._coordinateButtons[i]=_2b2;}return _2b2;},_renderButtonPair:function(_2b3,_2b4,_2b5){var _2b6=this._renderButton(_2b3,false,_2b4),_2b7=this._renderButton(_2b3,true,_2b5);this._renderLine(_2b6,_2b7);}});}if(!dojo._hasResource["com.realitybuilder.UserControls"]){dojo._hasResource["com.realitybuilder.UserControls"]=true;dojo.provide("com.realitybuilder.UserControls");dojo.declare("com.realitybuilder.UserControls",null,{_construction:null,_node:null,constructor:function(_2b8){this._construction=_2b8;this._coordinateControls=new com.realitybuilder.CoordinateControls(_2b8.newBlock(),_2b8.camera());this._node=dojo.byId("userControls");dojo.connect(dojo.byId("requestReal"),"onclick",_2b8,_2b8.requestReal);},updateCoordinateControls:function(_2b9){this._coordinateControls.update(_2b9);},renderCoordinateControls:function(){this._coordinateControls.render();},updateRequestRealButton:function(){var _2ba=dojo.byId("requestReal"),_2bb=this._construction.newBlock();if(_2bb.isMovable()&&_2bb.canBeMadeReal()){dojo.style(_2ba,"visibility","visible");}else{dojo.style(_2ba,"visibility","hidden");}},updateStatusMessage:function(_2bc){var html="",_2bd=this._construction.newBlock();switch(_2bc){case 0:if(_2bd.canBeMadeReal()){html="To request having the block built in its current "+"position, make it real.";}else{html="Move the block to a position where you want it to be "+"built.";}break;case 1:html="Your request is being processed. Be patient...";break;case 2:html="Your block has been built. Continue...";break;case 3:html="Your request has been denied. Continue...";break;}dojo.byId("status").innerHTML=html;}});}if(!dojo._hasResource["com.realitybuilder.AdminControls"]){dojo._hasResource["com.realitybuilder.AdminControls"]=true;dojo.provide("com.realitybuilder.AdminControls");dojo.declare("com.realitybuilder.AdminControls",null,{_construction:null,constructor:function(_2be){this._construction=_2be;dojo.byId("bottomBar").style.width=_2be.camera().sensor().width()+"px";this.updateToggleRealButton();this.updateTogglePendingButton();dojo.connect(dojo.byId("saveSettingsButton"),"onclick",this._construction,this._construction.storeSettingsOnServer);dojo.connect(dojo.byId("previewCameraButton"),"onclick",this,this.updateCamera);dojo.connect(dojo.byId("toggleRealButton"),"onclick",this._construction,this._construction.toggleReal);dojo.connect(dojo.byId("togglePendingButton"),"onclick",this._construction,this._construction.togglePending);dojo.connect(dojo.byId("logoutButton"),"onclick",this,this.logOut);},logOut:function(){location.href=logoutUrl;},updateToggleRealButton:function(){dojo.byId("toggleRealButton").innerHTML=(this._construction.showReal()?"Hide":"Show")+" Real Blocks";},updateTogglePendingButton:function(){dojo.byId("togglePendingButton").innerHTML=(this._construction.showPending()?"Hide":"Show")+" Pending Blocks";},updateCameraControls:function(_2bf){var _2c0=_2bf.position();dojo.byId("cameraX").value=_2c0[0];dojo.byId("cameraY").value=_2c0[1];dojo.byId("cameraZ").value=_2c0[2];dojo.byId("cameraAX").value=_2bf.aX();dojo.byId("cameraAY").value=_2bf.aY();dojo.byId("cameraAZ").value=_2bf.aZ();dojo.byId("cameraFl").value=_2bf.fl();dojo.byId("cameraSensorResolution").value=_2bf.sensorResolution();},updateImageControls:function(_2c1){dojo.byId("imageURL").value=_2c1.url();dojo.byId("imageUpdateIntervalServer").value=_2c1.updateIntervalServer();dojo.byId("imageUpdateIntervalClient").value=_2c1.updateIntervalClient();},readImageControls:function(){var data={"url":dojo.byId("imageURL").value||"","updateIntervalServer":parseFloat(dojo.byId("imageUpdateIntervalServer").value)||5,"updateIntervalClient":parseFloat(dojo.byId("imageUpdateIntervalClient").value)||5};return data;},readCameraControls:function(){var data={"x":parseFloat(dojo.byId("cameraX").value)||0,"y":parseFloat(dojo.byId("cameraY").value)||0,"z":parseFloat(dojo.byId("cameraZ").value)||0,"aX":parseFloat(dojo.byId("cameraAX").value)||0,"aY":parseFloat(dojo.byId("cameraAY").value)||0,"aZ":parseFloat(dojo.byId("cameraAZ").value)||0,"fl":parseFloat(dojo.byId("cameraFl").value)||1,"sensorResolution":parseFloat(dojo.byId("cameraSensorResolution").value)||100};return data;},updateCamera:function(){this._construction.camera().update(this.readCameraControls());},updateCoordinateDisplays:function(){var _2c2=this._construction.newBlock().positionB();dojo.byId("newBlockX").innerHTML=_2c2[0].toString();dojo.byId("newBlockY").innerHTML=_2c2[1].toString();dojo.byId("newBlockZ").innerHTML=_2c2[2].toString();},_sortForTable:function(x,y){if(x.state()===y.state()){if(x.timeStamp()>y.timeStamp()){return -1;}else{if(x.timeStamp()<y.timeStamp()){return 1;}else{return 0;}}}else{if(x.state()===1){return -1;}else{if(x.state()===2){return y.state()===1?1:-1;}else{return 1;}}}},_blocksSortedForTable:function(){var tmp=dojo.map(this._construction.constructionBlocks().blocks(),function(_2c3){return _2c3;});tmp.sort(this._sortForTable);return tmp;},_applyStateFromStateSelector:function(_2c4,_2c5){this._construction.constructionBlocks().setBlockStateOnServer(_2c5.positionB(),parseInt(_2c4.value,10));},_stateSelector:function(_2c6){var _2c7=document.createElement("select"),_2c8=["Deleted","Pending","Real"],_2c9,_2ca,_2cb;dojo.attr(_2c7,"size",1);for(_2c9=0;_2c9<3;_2c9+=1){_2ca=_2c8[_2c9];_2cb=document.createElement("option");dojo.attr(_2cb,"value",_2c9);if(_2c9===_2c6.state()){dojo.attr(_2cb,"selected","");}_2cb.innerHTML=_2ca;_2c7.appendChild(_2cb);}dojo.connect(_2c7,"onchange",this,function(_2cc){this._applyStateFromStateSelector(_2c7,_2c6);});return _2c7;},_appendBlocksTableRow:function(_2cd,_2ce){var _2cf=_2cd.positionB(),row=document.createElement("tr"),date=new Date(_2cd.timeStamp()*1000),_2d0=dojox.date.posix.strftime(date,"%Y-%m-%d %H:%M:%S"),_2d1=[_2cf[0],_2cf[1],_2cf[2],_2d0,this._stateSelector(_2cd)],cell;dojo.forEach(_2d1,function(_2d2,i){cell=document.createElement("td");if(i<4){cell.innerHTML=_2d2;}else{cell.appendChild(_2d2);}if(i<3){dojo.addClass(cell,"number");}row.appendChild(cell);});_2ce.appendChild(row);},updateBlocksTable:function(){var _2d3=dojo.query("#blocksTable tbody"),_2d4=_2d3[0],_2d5=this._blocksSortedForTable(),that=this;dojo.empty(_2d4);dojo.forEach(_2d5,function(_2d6){that._appendBlocksTableRow(_2d6,_2d4);});}});}if(!dojo._hasResource["com.realitybuilder.Construction"]){dojo._hasResource["com.realitybuilder.Construction"]=true;dojo.provide("com.realitybuilder.Construction");dojo.declare("com.realitybuilder.Construction",null,{_showAdminControls:null,_constructionBlocks:null,_responseToLastRequest:null,_UPDATE_INTERVAL:2000,_CHECK_IF_HAS_LOADED_INTERVAL:500,_showReal:null,_showPending:null,_blockProperties:null,_newBlock:null,_camera:null,_image:null,_userControls:null,_adminControls:null,_updateTimeout:null,constructor:function(_2d7){this._insertLoadIndicator();this._insertView();this._showAdminControls=_2d7;this._responseToLastRequest=0;this._showReal=_2d7;this._showPending=_2d7;this._blockProperties=new com.realitybuilder.BlockProperties();this._camera=new com.realitybuilder.Camera(this._blockProperties,640,480);this._image=new com.realitybuilder.Image(this._camera);this._constructionBlocks=new com.realitybuilder.ConstructionBlocks(this,this._blockProperties);this._newBlock=new com.realitybuilder.NewBlock(this._blockProperties,this._camera,this._constructionBlocks);this._userControls=new com.realitybuilder.UserControls(this);if(this._showAdminControls){this._adminControls=new com.realitybuilder.AdminControls(this);dojo.subscribe("com/realitybuilder/ConstructionBlocks/changeOnServerFailed",this._adminControls,this._adminControls.updateBlocksTable);}dojo.subscribe("com/realitybuilder/ConstructionBlocks/changedOnServer",this,this._update);dojo.subscribe("com/realitybuilder/NewBlock/positionInitialized",this,this._onNewBlockPositionInitialized);dojo.subscribe("com/realitybuilder/NewBlock/buildSpaceChanged",this,this._onBuildSpaceChanged);dojo.subscribe("com/realitybuilder/NewBlock/stopped",this,this._onNewBlockStopped);dojo.subscribe("com/realitybuilder/NewBlock/madeMovable",this,this._onNewBlockMadeMovable);dojo.subscribe("com/realitybuilder/NewBlock/moved",this,this._onNewBlockMoved);dojo.subscribe("com/realitybuilder/ConstructionBlocks/changed",this,this._onConstructionBlocksChanged);dojo.subscribe("com/realitybuilder/Camera/changed",this,this._onCameraChanged);dojo.subscribe("com/realitybuilder/Image/changed",this,this._onImageChanged);dojo.subscribe("com/realitybuilder/BlockProperties/changed",this,this._onBlockPropertiesChanged);this._setupDemoFunctionality();this._update();this._checkIfHasLoaded();},newBlock:function(){return this._newBlock;},camera:function(){return this._camera;},showPending:function(){return this._showPending;},showReal:function(){return this._showReal;},constructionBlocks:function(){return this._constructionBlocks;},_onNewBlockStopped:function(){this._newBlock.render();this._userControls.updateCoordinateControls(true);},_onNewBlockMadeMovable:function(){this._newBlock.render();this._userControls.updateCoordinateControls(false);},requestReal:function(){if(this._newBlock.isMovable()){this._newBlock.stop();this._constructionBlocks.createPendingOnServer(this._newBlock.positionB());this._responseToLastRequest=1;}this._userControls.updateRequestRealButton();this._userControls.updateStatusMessage(this._responseToLastRequest);},toggleReal:function(){this._showReal=!this._showReal;this._camera.sensor().showRealBlocks(this._showReal);this._adminControls.updateToggleRealButton();},togglePending:function(){this._showPending=!this._showPending;this._camera.sensor().showPendingBlocks(this._showPending);this._adminControls.updateTogglePendingButton();},_onDemoKeyPress:function(_2d8){if(_2d8.shiftKey&&_2d8.keyCode===dojo.keys.F12){this._constructionBlocks.setBlockStateOnServer(this._newBlock.positionB(),2);}},_setupDemoFunctionality:function(){dojo.connect(null,"onkeypress",dojo.hitch(this,this._onDemoKeyPress));},_onNewBlockMoved:function(){this._newBlock.render();this._userControls.updateRequestRealButton();this._userControls.updateStatusMessage(this._responseToLastRequest);this._userControls.updateCoordinateControls();if(this._showAdminControls){this._adminControls.updateCoordinateDisplays();}},_updateNewBlockPositionAndState:function(){var _2d9=this._newBlock.positionB(),tmp,_2da;if(this._newBlock.isStopped()){tmp=this._constructionBlocks.blockAt(_2d9);}this._newBlock.updatePositionB();if(this._showAdminControls){this._adminControls.updateCoordinateDisplays();}if(this._newBlock.isStopped()){if(tmp&&!tmp.isDeleted()){_2da=tmp.state();if(_2da===2){this._responseToLastRequest=2;this._newBlock.makeMovable();}else{this._responseToLastRequest=1;}}else{this._responseToLastRequest=3;this._newBlock.makeMovable();}}},_renderBlocksIfFullyInitialized:function(){if(this._constructionBlocks.isInitializedWithServerData()&&this._newBlock.isInitializedWithServerData()&&this._camera.isInitializedWithServerData()&&this._blockProperties.isInitializedWithServerData()){if(this._showAdminControls){this._constructionBlocks.render();}this._newBlock.render();}},_renderCoordinateControlsIfFullyInitialized:function(){if(this._camera.isInitializedWithServerData()&&this._blockProperties.isInitializedWithServerData()&&this._newBlock.isInitializedWithServerData()){this._userControls.renderCoordinateControls();}},_updateNewBlockStateIfFullyInitialized:function(){if(this._constructionBlocks.isInitializedWithServerData()&&this._newBlock.isInitializedWithServerData()&&this._blockProperties.isInitializedWithServerData()){this._updateNewBlockPositionAndState();this._userControls.updateRequestRealButton();this._userControls.updateCoordinateControls(!this._newBlock.isMovable());}},_updateStatusMessageIfFullyInitialized:function(){if(this._constructionBlocks.isInitializedWithServerData()&&this._newBlock.isInitializedWithServerData()&&this._blockProperties.isInitializedWithServerData()){this._userControls.updateStatusMessage(this._responseToLastRequest);}},_onConstructionBlocksChanged:function(){if(this._showAdminControls){this._adminControls.updateBlocksTable();}this._updateStatusMessageIfFullyInitialized();this._updateNewBlockStateIfFullyInitialized();this._renderBlocksIfFullyInitialized();},_onCameraChanged:function(){if(this._showAdminControls){this._adminControls.updateCameraControls(this._camera);}this._renderCoordinateControlsIfFullyInitialized();this._renderBlocksIfFullyInitialized();},_onNewBlockPositionInitialized:function(){this._updateNewBlockStateIfFullyInitialized();this._renderBlocksIfFullyInitialized();this._updateStatusMessageIfFullyInitialized();this._renderCoordinateControlsIfFullyInitialized();},_onBuildSpaceChanged:function(){this._updateNewBlockStateIfFullyInitialized();this._renderBlocksIfFullyInitialized();this._updateStatusMessageIfFullyInitialized();this._renderCoordinateControlsIfFullyInitialized();},_onBlockPropertiesChanged:function(){this._userControls.renderCoordinateControls();this._renderCoordinateControlsIfFullyInitialized();this._renderBlocksIfFullyInitialized();this._updateNewBlockStateIfFullyInitialized();this._updateStatusMessageIfFullyInitialized();this._renderBlocksIfFullyInitialized();},_onImageChanged:function(){if(this._showAdminControls){this._adminControls.updateImageControls(this._image);}},_insertLoadIndicator:function(){dojo.attr("loadIndicator","innerHTML","Loading...");},_requestRealButtonHtml:function(){var tmp1,tmp2;if(dojo.isIE&&dojo.isIE===6){tmp1="a href=\"javascript:void(0)\"";tmp2="a";}else{tmp1=tmp2="div";}return "<"+tmp1+" id=\"requestReal\" >Make Real</"+tmp2+">";},_insertView:function(){dojo.attr("view","innerHTML","<img id=\"live\" src=\"/images/placeholder.gif\" alt=\"Live Image\">"+"<div id=\"sensor\">"+"<canvas id=\"sensorShadowCanvas\" width=\"1\" height=\"1\">"+"</canvas>"+"<canvas id=\"sensorRealBlocksCanvas\" width=\"1\" height=\"1\">"+"</canvas>"+"<canvas id=\"sensorPendingBlocksCanvas\" width=\"1\" height=\"1\">"+"</canvas>"+"<canvas id=\"sensorNewBlockCanvas\" width=\"1\" height=\"1\">"+"</canvas>"+"</div>"+"<div id=\"coordinateControls\">"+"<canvas id=\"coordinateControlsCanvas\" width=\"1\" height=\"1\">"+"</canvas>"+"</div>"+"<p id=\"status\"></p>"+this._requestRealButtonHtml());if(com.realitybuilder.util.isFlashCanvasActive()){FlashCanvas.initElement(dojo.byId("sensorShadowCanvas"));FlashCanvas.initElement(dojo.byId("sensorRealBlocksCanvas"));FlashCanvas.initElement(dojo.byId("sensorPendingBlocksCanvas"));FlashCanvas.initElement(dojo.byId("sensorNewBlockCanvas"));FlashCanvas.initElement(dojo.byId("coordinateControlsCanvas"));}},_checkIfHasLoaded:function(){if(this._constructionBlocks.isInitializedWithServerData()&&this._camera.isInitializedWithServerData()&&this._blockProperties.isInitializedWithServerData()&&this._image.imageLoaded()){dojo.destroy(dojo.byId("loadIndicator"));this._unhideContent();}else{setTimeout(dojo.hitch(this,this._checkIfHasLoaded),this._CHECK_IF_HAS_LOADED_INTERVAL);}},_updateSucceeded:function(data,_2db){var that=this;if(data.blocksData.changed){this._constructionBlocks.updateWithServerData(data.blocksData,this._image);}if(data.cameraData.changed){this._camera.updateWithServerData(data.cameraData);}if(data.imageData.changed){this._image.updateWithServerData(data.imageData);}if(data.blockPropertiesData.changed){this._blockProperties.updateWithServerData(data.blockPropertiesData);}if(data.newBlockData.changed){this._newBlock.updateWithServerData(data.newBlockData);}if(this._updateTimeout){clearTimeout(this._updateTimeout);}this._updateTimeout=setTimeout(function(){that._update();},this._UPDATE_INTERVAL);},_update:function(){var _2dc;_2dc=this._showAdminControls?"true":"false";dojo.xhrGet({url:"/rpc/construction",content:{"blocksDataVersion":this._constructionBlocks.versionOnServer(),"getDeletedBlocks":_2dc,"cameraDataVersion":this._camera.versionOnServer(),"imageDataVersion":this._image.versionOnServer(),"blockPropertiesDataVersion":this._blockProperties.versionOnServer(),"newBlockDataVersion":this._newBlock.versionOnServer()},handleAs:"json",load:dojo.hitch(this,this._updateSucceeded)});},_unhideContent:function(){var _2dd=dojo.byId("content"),_2de=(!dojo.isIE||dojo.isIE>8),_2df;if(_2de){dojo.style(_2dd,"opacity","0");}dojo.style(_2dd,"width","auto");dojo.style(_2dd,"height","auto");if(dojo.isIE&&dojo.isIE<=7){dojo.style(_2dd,"zoom","1");}if(_2de){_2df={node:_2dd,duration:1000};dojo.fadeIn(_2df).play();}},_storeSettingsOnServerSucceeded:function(){this._update();},storeSettingsOnServer:function(){var _2e0=com.realitybuilder.util.addPrefix("image.",this._adminControls.readImageControls()),_2e1=com.realitybuilder.util.addPrefix("camera.",this._adminControls.readCameraControls()),_2e2={};dojo.mixin(_2e2,_2e0,_2e1);dojo.xhrPost({url:"/admin/rpc/update_settings",content:_2e2,load:dojo.hitch(this,this._storeSettingsOnServerSucceeded)});}});}dojo.i18n._preloadLocalizations("dojo.nls.realitybuilder",["ROOT","ar","ca","cs","da","de","de-de","el","en","en-gb","en-us","es","es-es","fi","fi-fi","fr","fr-fr","he","he-il","hu","it","it-it","ja","ja-jp","ko","ko-kr","nb","nl","nl-nl","pl","pt","pt-br","pt-pt","ru","sk","sl","sv","th","tr","xx","zh","zh-cn","zh-tw"]);
