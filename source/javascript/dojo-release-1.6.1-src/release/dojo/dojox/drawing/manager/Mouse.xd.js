/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realitybuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.drawing.manager.Mouse"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.drawing.manager.Mouse"]){_4._hasResource["dojox.drawing.manager.Mouse"]=true;_4.provide("dojox.drawing.manager.Mouse");_6.drawing.manager.Mouse=_6.drawing.util.oo.declare(function(_7){this.util=_7.util;this.keys=_7.keys;this.id=_7.id||this.util.uid("mouse");this.currentNodeId="";this.registered={};},{doublClickSpeed:400,rightClickMenu:false,_lastx:0,_lasty:0,__reg:0,_downOnCanvas:false,init:function(_8){this.container=_8;this.setCanvas();var c;var _9=false;_4.connect(this.container,"rightclick",this,function(_a){console.warn("RIGHTCLICK");});_4.connect(document.body,"mousedown",this,function(_b){});_4.connect(this.container,"mousedown",this,function(_c){this.down(_c);if(_c.button!=_4.mouseButtons.RIGHT){_9=true;c=_4.connect(document,"mousemove",this,"drag");}});_4.connect(document,"mouseup",this,function(_d){if(_d.button!=_4.mouseButtons.RIGHT){_4.disconnect(c);_9=false;}this.up(_d);});_4.connect(document,"mousemove",this,function(_e){if(!_9){this.move(_e);}});_4.connect(this.keys,"onEsc",this,function(_f){this._dragged=false;});},setCanvas:function(){var pos=_4.coords(this.container.parentNode);this.origin=_4.clone(pos);},scrollOffset:function(){return {top:this.container.parentNode.scrollTop,left:this.container.parentNode.scrollLeft};},resize:function(_10,_11){if(this.origin){this.origin.w=_10;this.origin.h=_11;}},register:function(_12){var _13=_12.id||"reg_"+(this.__reg++);if(!this.registered[_13]){this.registered[_13]=_12;}return _13;},unregister:function(_14){if(!this.registered[_14]){return;}delete this.registered[_14];},_broadcastEvent:function(_15,obj){for(var nm in this.registered){if(this.registered[nm][_15]){this.registered[nm][_15](obj);}}},onDown:function(obj){this._broadcastEvent(this.eventName("down"),obj);},onDrag:function(obj){var nm=this.eventName("drag");if(this._selected&&nm=="onDrag"){nm="onStencilDrag";}this._broadcastEvent(nm,obj);},onMove:function(obj){this._broadcastEvent("onMove",obj);},overName:function(obj,evt){var nm=obj.id.split(".");evt=evt.charAt(0).toUpperCase()+evt.substring(1);if(nm[0]=="dojox"&&(_6.drawing.defaults.clickable||!_6.drawing.defaults.clickMode)){return "onStencil"+evt;}else{return "on"+evt;}},onOver:function(obj){this._broadcastEvent(this.overName(obj,"over"),obj);},onOut:function(obj){this._broadcastEvent(this.overName(obj,"out"),obj);},onUp:function(obj){var nm=this.eventName("up");if(nm=="onStencilUp"){this._selected=true;}else{if(this._selected&&nm=="onUp"){nm="onStencilUp";this._selected=false;}}console.info("Up Event:",this.id,nm,"id:",obj.id);this._broadcastEvent(nm,obj);if(_6.gfx.renderer=="silverlight"){return;}this._clickTime=new Date().getTime();if(this._lastClickTime){if(this._clickTime-this._lastClickTime<this.doublClickSpeed){var dnm=this.eventName("doubleClick");console.warn("DOUBLE CLICK",dnm,obj);this._broadcastEvent(dnm,obj);}else{}}this._lastClickTime=this._clickTime;},zoom:1,setZoom:function(_16){this.zoom=1/_16;},setEventMode:function(_17){this.mode=_17?"on"+_17.charAt(0).toUpperCase()+_17.substring(1):"";},eventName:function(_18){_18=_18.charAt(0).toUpperCase()+_18.substring(1);if(this.mode){if(this.mode=="onPathEdit"){return "on"+_18;}if(this.mode=="onUI"){}return this.mode+_18;}else{if(!_6.drawing.defaults.clickable&&_6.drawing.defaults.clickMode){return "on"+_18;}var dt=!this.drawingType||this.drawingType=="surface"||this.drawingType=="canvas"?"":this.drawingType;var t=!dt?"":dt.charAt(0).toUpperCase()+dt.substring(1);return "on"+t+_18;}},up:function(evt){this.onUp(this.create(evt));},down:function(evt){this._downOnCanvas=true;var sc=this.scrollOffset();var dim=this._getXY(evt);this._lastpagex=dim.x;this._lastpagey=dim.y;var o=this.origin;var x=dim.x-o.x+sc.left;var y=dim.y-o.y+sc.top;var _19=x>=0&&y>=0&&x<=o.w&&y<=o.h;x*=this.zoom;y*=this.zoom;o.startx=x;o.starty=y;this._lastx=x;this._lasty=y;this.drawingType=this.util.attr(evt,"drawingType")||"";var id=this._getId(evt);if(this.rightClickMenu&&(evt.button==_4.mouseButtons.RIGHT)&&this.id=="mse"){}else{evt.preventDefault();_4.stopEvent(evt);}this.onDown({mid:this.id,x:x,y:y,pageX:dim.x,pageY:dim.y,withinCanvas:_19,id:id});},over:function(obj){this.onOver(obj);},out:function(obj){this.onOut(obj);},move:function(evt){var obj=this.create(evt);if(this.id=="MUI"){}if(obj.id!=this.currentNodeId){var _1a={};for(var nm in obj){_1a[nm]=obj[nm];}_1a.id=this.currentNodeId;this.currentNodeId&&this.out(_1a);obj.id&&this.over(obj);this.currentNodeId=obj.id;}this.onMove(obj);},drag:function(evt){this.onDrag(this.create(evt,true));},create:function(evt,_1b){var sc=this.scrollOffset();var dim=this._getXY(evt);var _1c=dim.x;var _1d=dim.y;var o=this.origin;var x=dim.x-o.x+sc.left;var y=dim.y-o.y+sc.top;var _1e=x>=0&&y>=0&&x<=o.w&&y<=o.h;x*=this.zoom;y*=this.zoom;var id=_1e?this._getId(evt,_1b):"";var ret={mid:this.id,x:x,y:y,pageX:dim.x,pageY:dim.y,page:{x:dim.x,y:dim.y},orgX:o.x,orgY:o.y,last:{x:this._lastx,y:this._lasty},start:{x:this.origin.startx,y:this.origin.starty},move:{x:_1c-this._lastpagex,y:_1d-this._lastpagey},scroll:sc,id:id,withinCanvas:_1e};this._lastx=x;this._lasty=y;this._lastpagex=_1c;this._lastpagey=_1d;_4.stopEvent(evt);return ret;},_getId:function(evt,_1f){return this.util.attr(evt,"id",null,_1f);},_getXY:function(evt){return {x:evt.pageX,y:evt.pageY};},setCursor:function(_20,_21){if(!_21){_4.style(this.container,"cursor",_20);}else{_4.style(_21,"cursor",_20);}}});}}};});