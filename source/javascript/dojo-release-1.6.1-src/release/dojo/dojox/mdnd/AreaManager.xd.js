/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realitybuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.mdnd.AreaManager"],["require","dojox.mdnd.Moveable"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.mdnd.AreaManager"]){_4._hasResource["dojox.mdnd.AreaManager"]=true;_4.provide("dojox.mdnd.AreaManager");_4.require("dojox.mdnd.Moveable");_4.declare("dojox.mdnd.AreaManager",null,{autoRefresh:true,areaClass:"dojoxDndArea",dragHandleClass:"dojoxDragHandle",constructor:function(){this._areaList=[];this.resizeHandler=_4.connect(_4.global,"onresize",this,function(){this._dropMode.updateAreas(this._areaList);});this._oldIndexArea=this._currentIndexArea=this._oldDropIndex=this._currentDropIndex=this._sourceIndexArea=this._sourceDropIndex=-1;},init:function(){this.registerByClass();},registerByNode:function(_7,_8){var _9=this._getIndexArea(_7);if(_7&&_9==-1){var _a=_7.getAttribute("accept");var _b=(_a)?_a.split(/\s*,\s*/):["text"];var _c={"node":_7,"items":[],"coords":{},"margin":null,"accept":_b,"initItems":false};_4.forEach(this._getChildren(_7),function(_d){this._setMarginArea(_c,_d);_c.items.push(this._addMoveableItem(_d));},this);this._areaList=this._dropMode.addArea(this._areaList,_c);if(!_8){this._dropMode.updateAreas(this._areaList);}_4.publish("/dojox/mdnd/manager/register",[_7]);}},registerByClass:function(){_4.query("."+this.areaClass).forEach(function(_e){this.registerByNode(_e,true);},this);this._dropMode.updateAreas(this._areaList);},unregister:function(_f){var _10=this._getIndexArea(_f);if(_10!=-1){_4.forEach(this._areaList[_10].items,function(_11){this._deleteMoveableItem(_11);},this);this._areaList.splice(_10,1);this._dropMode.updateAreas(this._areaList);return true;}return false;},_addMoveableItem:function(_12){_12.setAttribute("tabIndex","0");var _13=this._searchDragHandle(_12);var _14=new _6.mdnd.Moveable({"handle":_13,"skip":true},_12);_4.addClass(_13||_12,"dragHandle");var _15=_12.getAttribute("dndType");var _16={"item":_14,"type":_15?_15.split(/\s*,\s*/):["text"],"handlers":[_4.connect(_14,"onDragStart",this,"onDragStart")]};if(_5&&_5.byNode){var _17=_5.byNode(_12);if(_17){_16.type=_17.dndType?_17.dndType.split(/\s*,\s*/):["text"];_16.handlers.push(_4.connect(_17,"uninitialize",this,function(){this.removeDragItem(_12.parentNode,_14.node);}));}}return _16;},_deleteMoveableItem:function(_18){_4.forEach(_18.handlers,function(_19){_4.disconnect(_19);});var _1a=_18.item.node,_1b=this._searchDragHandle(_1a);_4.removeClass(_1b||_1a,"dragHandle");_18.item.destroy();},_getIndexArea:function(_1c){if(_1c){for(var i=0;i<this._areaList.length;i++){if(this._areaList[i].node===_1c){return i;}}}return -1;},_searchDragHandle:function(_1d){if(_1d){var _1e=this.dragHandleClass.split(" "),_1f=_1e.length,_20="";_4.forEach(_1e,function(css,i){_20+="."+css;if(i!=_1f-1){_20+=", ";}});return _4.query(_20,_1d)[0];}},addDragItem:function(_21,_22,_23,_24){var add=true;if(!_24){add=_21&&_22&&(_22.parentNode===null||(_22.parentNode&&_22.parentNode.nodeType!==1));}if(add){var _25=this._getIndexArea(_21);if(_25!==-1){var _26=this._addMoveableItem(_22),_27=this._areaList[_25].items;if(0<=_23&&_23<_27.length){var _28=_27.slice(0,_23),_29=_27.slice(_23,_27.length);_28[_28.length]=_26;this._areaList[_25].items=_28.concat(_29);_21.insertBefore(_22,_27[_23].item.node);}else{this._areaList[_25].items.push(_26);_21.appendChild(_22);}this._setMarginArea(this._areaList[_25],_22);this._areaList[_25].initItems=false;return true;}}return false;},removeDragItem:function(_2a,_2b){var _2c=this._getIndexArea(_2a);if(_2a&&_2c!==-1){var _2d=this._areaList[_2c].items;for(var j=0;j<_2d.length;j++){if(_2d[j].item.node===_2b){this._deleteMoveableItem(_2d[j]);_2d.splice(j,1);return _2a.removeChild(_2b);}}}return null;},_getChildren:function(_2e){var _2f=[];_4.forEach(_2e.childNodes,function(_30){if(_30.nodeType==1){if(_5&&_5.byNode){var _31=_5.byNode(_30);if(_31){if(!_31.dragRestriction){_2f.push(_30);}}else{_2f.push(_30);}}else{_2f.push(_30);}}});return _2f;},_setMarginArea:function(_32,_33){if(_32&&_32.margin===null&&_33){_32.margin=_4._getMarginExtents(_33);}},findCurrentIndexArea:function(_34,_35){this._oldIndexArea=this._currentIndexArea;this._currentIndexArea=this._dropMode.getTargetArea(this._areaList,_34,this._currentIndexArea);if(this._currentIndexArea!=this._oldIndexArea){if(this._oldIndexArea!=-1){this.onDragExit(_34,_35);}if(this._currentIndexArea!=-1){this.onDragEnter(_34,_35);}}return this._currentIndexArea;},_isAccepted:function(_36,_37){this._accept=false;for(var i=0;i<_37.length;++i){for(var j=0;j<_36.length;++j){if(_36[j]==_37[i]){this._accept=true;break;}}}},onDragStart:function(_38,_39,_3a){if(this.autoRefresh){this._dropMode.updateAreas(this._areaList);}var _3b=(_4.isWebKit)?_4.body():_4.body().parentNode;if(!this._cover){this._cover=_4.create("div",{"class":"dndCover"});this._cover2=_4.clone(this._cover);_4.addClass(this._cover2,"dndCover2");}var h=_3b.scrollHeight+"px";this._cover.style.height=this._cover2.style.height=h;_4.body().appendChild(this._cover);_4.body().appendChild(this._cover2);this._dragStartHandler=_4.connect(_38.ownerDocument,"ondragstart",_4,"stopEvent");this._sourceIndexArea=this._lastValidIndexArea=this._currentIndexArea=this._getIndexArea(_38.parentNode);var _3c=this._areaList[this._sourceIndexArea];var _3d=_3c.items;for(var i=0;i<_3d.length;i++){if(_3d[i].item.node==_38){this._dragItem=_3d[i];this._dragItem.handlers.push(_4.connect(this._dragItem.item,"onDrag",this,"onDrag"));this._dragItem.handlers.push(_4.connect(this._dragItem.item,"onDragEnd",this,"onDrop"));_3d.splice(i,1);this._currentDropIndex=this._sourceDropIndex=i;break;}}var _3e=null;if(this._sourceDropIndex!==_3c.items.length){_3e=_3c.items[this._sourceDropIndex].item.node;}if(_4.isIE>7){this._eventsIE7=[_4.connect(this._cover,"onmouseover",_4,"stopEvent"),_4.connect(this._cover,"onmouseout",_4,"stopEvent"),_4.connect(this._cover,"onmouseenter",_4,"stopEvent"),_4.connect(this._cover,"onmouseleave",_4,"stopEvent")];}var s=_38.style;s.left=_39.x+"px";s.top=_39.y+"px";if(s.position=="relative"||s.position==""){s.position="absolute";}this._cover.appendChild(_38);this._dropIndicator.place(_3c.node,_3e,_3a);_4.addClass(_38,"dragNode");this._accept=true;_4.publish("/dojox/mdnd/drag/start",[_38,_3c,this._sourceDropIndex]);},onDragEnter:function(_3f,_40){if(this._currentIndexArea===this._sourceIndexArea){this._accept=true;}else{this._isAccepted(this._dragItem.type,this._areaList[this._currentIndexArea].accept);}},onDragExit:function(_41,_42){this._accept=false;},onDrag:function(_43,_44,_45,_46){var _47=this._dropMode.getDragPoint(_44,_45,_46);this.findCurrentIndexArea(_47,_45);if(this._currentIndexArea!==-1&&this._accept){this.placeDropIndicator(_47,_45);}},placeDropIndicator:function(_48,_49){this._oldDropIndex=this._currentDropIndex;var _4a=this._areaList[this._currentIndexArea];if(!_4a.initItems){this._dropMode.initItems(_4a);}this._currentDropIndex=this._dropMode.getDropIndex(_4a,_48);if(!(this._currentIndexArea===this._oldIndexArea&&this._oldDropIndex===this._currentDropIndex)){this._placeDropIndicator(_49);}return this._currentDropIndex;},_placeDropIndicator:function(_4b){var _4c=this._areaList[this._lastValidIndexArea];var _4d=this._areaList[this._currentIndexArea];this._dropMode.refreshItems(_4c,this._oldDropIndex,_4b,false);var _4e=null;if(this._currentDropIndex!=-1){_4e=_4d.items[this._currentDropIndex].item.node;}this._dropIndicator.place(_4d.node,_4e);this._lastValidIndexArea=this._currentIndexArea;this._dropMode.refreshItems(_4d,this._currentDropIndex,_4b,true);},onDropCancel:function(){if(!this._accept){var _4f=this._getIndexArea(this._dropIndicator.node.parentNode);if(_4f!=-1){this._currentIndexArea=_4f;}else{this._currentIndexArea=0;}}},onDrop:function(_50){this.onDropCancel();var _51=this._areaList[this._currentIndexArea];_4.removeClass(_50,"dragNode");var _52=_50.style;_52.position="relative";_52.left="0";_52.top="0";_52.width="auto";if(_51.node==this._dropIndicator.node.parentNode){_51.node.insertBefore(_50,this._dropIndicator.node);}else{_51.node.appendChild(_50);this._currentDropIndex=_51.items.length;}var _53=this._currentDropIndex;if(_53==-1){_53=_51.items.length;}var _54=_51.items;var _55=_54.slice(0,_53);var _56=_54.slice(_53,_54.length);_55[_55.length]=this._dragItem;_51.items=_55.concat(_56);this._setMarginArea(_51,_50);_4.forEach(this._areaList,function(obj){obj.initItems=false;});_4.disconnect(this._dragItem.handlers.pop());_4.disconnect(this._dragItem.handlers.pop());this._resetAfterDrop();if(this._cover){_4.body().removeChild(this._cover);_4.body().removeChild(this._cover2);}_4.publish("/dojox/mdnd/drop",[_50,_51,_53]);},_resetAfterDrop:function(){this._accept=false;this._dragItem=null;this._currentDropIndex=-1;this._currentIndexArea=-1;this._oldDropIndex=-1;this._sourceIndexArea=-1;this._sourceDropIndex=-1;this._dropIndicator.remove();if(this._dragStartHandler){_4.disconnect(this._dragStartHandler);}if(_4.isIE>7){_4.forEach(this._eventsIE7,_4.disconnect);}},destroy:function(){while(this._areaList.length>0){if(!this.unregister(this._areaList[0].node)){throw new Error("Error while destroying AreaManager");}}_4.disconnect(this.resizeHandler);this._dropIndicator.destroy();this._dropMode.destroy();if(_6.mdnd.autoScroll){_6.mdnd.autoScroll.destroy();}if(this.refreshListener){_4.unsubscribe(this.refreshListener);}if(this._cover){_4._destroyElement(this._cover);_4._destroyElement(this._cover2);delete this._cover;delete this._cover2;}}});if(_5&&_5._Widget){_4.extend(_5._Widget,{dndType:"text"});}_6.mdnd._areaManager=null;_6.mdnd.areaManager=function(){if(!_6.mdnd._areaManager){_6.mdnd._areaManager=new _6.mdnd.AreaManager();}return _6.mdnd._areaManager;};}}};});