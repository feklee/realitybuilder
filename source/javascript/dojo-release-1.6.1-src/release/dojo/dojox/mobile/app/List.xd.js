/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realitybuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.mobile.app.List"],["require","dojo.string"],["require","dijit._WidgetBase"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.mobile.app.List"]){_4._hasResource["dojox.mobile.app.List"]=true;_4.provide("dojox.mobile.app.List");_4.experimental("dojox.mobile.app.List");_4.require("dojo.string");_4.require("dijit._WidgetBase");(function(){var _7={};_4.declare("dojox.mobile.app.List",_5._WidgetBase,{items:null,itemTemplate:"",emptyTemplate:"",dividerTemplate:"",dividerFunction:null,labelDelete:"Delete",labelCancel:"Cancel",controller:null,autoDelete:true,enableDelete:true,enableHold:true,formatters:null,_templateLoadCount:0,_mouseDownPos:null,baseClass:"list",constructor:function(){this._checkLoadComplete=_4.hitch(this,this._checkLoadComplete);this._replaceToken=_4.hitch(this,this._replaceToken);this._postDeleteAnim=_4.hitch(this,this._postDeleteAnim);},postCreate:function(){var _8=this;if(this.emptyTemplate){this._templateLoadCount++;}if(this.itemTemplate){this._templateLoadCount++;}if(this.dividerTemplate){this._templateLoadCount++;}this.connect(this.domNode,"onmousedown",function(_9){var _a=_9;if(_9.targetTouches&&_9.targetTouches.length>0){_a=_9.targetTouches[0];}var _b=_8._getRowNode(_9.target);if(_b){_8._setDataInfo(_b,_9);_8._selectRow(_b);_8._mouseDownPos={x:_a.pageX,y:_a.pageY};_8._dragThreshold=null;}});this.connect(this.domNode,"onmouseup",function(_c){if(_c.targetTouches&&_c.targetTouches.length>0){_c=_c.targetTouches[0];}var _d=_8._getRowNode(_c.target);if(_d){_8._setDataInfo(_d,_c);if(_8._selectedRow){_8.onSelect(_d._data,_d._idx,_d);}this._deselectRow();}});if(this.enableDelete){this.connect(this.domNode,"mousemove",function(_e){_4.stopEvent(_e);if(!_8._selectedRow){return;}var _f=_8._getRowNode(_e.target);if(_8.enableDelete&&_f&&!_8._deleting){_8.handleDrag(_e);}});}this.connect(this.domNode,"onclick",function(_10){if(_10.touches&&_10.touches.length>0){_10=_10.touches[0];}var _11=_8._getRowNode(_10.target,true);if(_11){_8._setDataInfo(_11,_10);}});this.connect(this.domNode,"mouseout",function(_12){if(_12.touches&&_12.touches.length>0){_12=_12.touches[0];}if(_12.target==_8._selectedRow){_8._deselectRow();}});if(!this.itemTemplate){throw Error("An item template must be provided to "+this.declaredClass);}this._loadTemplate(this.itemTemplate,"itemTemplate",this._checkLoadComplete);if(this.emptyTemplate){this._loadTemplate(this.emptyTemplate,"emptyTemplate",this._checkLoadComplete);}if(this.dividerTemplate){this._loadTemplate(this.dividerTemplate,"dividerTemplate",this._checkLoadComplete);}},handleDrag:function(_13){var _14=_13;if(_13.targetTouches&&_13.targetTouches.length>0){_14=_13.targetTouches[0];}var _15=_14.pageX-this._mouseDownPos.x;var _16=Math.abs(_15);if(_16>10&&!this._dragThreshold){this._dragThreshold=_4.marginBox(this._selectedRow).w*0.6;if(!this.autoDelete){this.createDeleteButtons(this._selectedRow);}}this._selectedRow.style.left=(_16>10?_15:0)+"px";if(this._dragThreshold&&this._dragThreshold<_16){this.preDelete(_15);}},handleDragCancel:function(){if(this._deleting){return;}_4.removeClass(this._selectedRow,"hold");this._selectedRow.style.left=0;this._mouseDownPos=null;this._dragThreshold=null;this._deleteBtns&&_4.style(this._deleteBtns,"display","none");},preDelete:function(_17){var _18=this;this._deleting=true;_4.animateProperty({node:this._selectedRow,duration:400,properties:{left:{end:_17+((_17>0?1:-1)*this._dragThreshold*0.8)}},onEnd:_4.hitch(this,function(){if(this.autoDelete){this.deleteRow(this._selectedRow);}})}).play();},deleteRow:function(row){_4.style(row,{visibility:"hidden",minHeight:"0px"});_4.removeClass(row,"hold");this._deleteAnimConn=this.connect(row,"webkitAnimationEnd",this._postDeleteAnim);_4.addClass(row,"collapsed");},_postDeleteAnim:function(_19){if(this._deleteAnimConn){this.disconnect(this._deleteAnimConn);this._deleteAnimConn=null;}var row=this._selectedRow;var _1a=row.nextSibling;var _1b=row.previousSibling;if(_1b&&_1b._isDivider){if(!_1a||_1a._isDivider){_1b.parentNode.removeChild(_1b);}}row.parentNode.removeChild(row);this.onDelete(row._data,row._idx,this.items);while(_1a){if(_1a._idx){_1a._idx--;}_1a=_1a.nextSibling;}_4.destroy(row);_4.query("> *:not(.buttons)",this.domNode).forEach(this.applyClass);this._deleting=false;this._deselectRow();},createDeleteButtons:function(_1c){var mb=_4.marginBox(_1c);var pos=_4._abs(_1c,true);if(!this._deleteBtns){this._deleteBtns=_4.create("div",{"class":"buttons"},this.domNode);this.buttons=[];this.buttons.push(new _6.mobile.Button({btnClass:"mblRedButton",label:this.labelDelete}));this.buttons.push(new _6.mobile.Button({btnClass:"mblBlueButton",label:this.labelCancel}));_4.place(this.buttons[0].domNode,this._deleteBtns);_4.place(this.buttons[1].domNode,this._deleteBtns);_4.addClass(this.buttons[0].domNode,"deleteBtn");_4.addClass(this.buttons[1].domNode,"cancelBtn");this._handleButtonClick=_4.hitch(this._handleButtonClick);this.connect(this._deleteBtns,"onclick",this._handleButtonClick);}_4.removeClass(this._deleteBtns,"fade out fast");_4.style(this._deleteBtns,{display:"",width:mb.w+"px",height:mb.h+"px",top:(_1c.offsetTop)+"px",left:"0px"});},onDelete:function(_1d,_1e,_1f){_1f.splice(_1e,1);if(_1f.length<1){this.render();}},cancelDelete:function(){this._deleting=false;this.handleDragCancel();},_handleButtonClick:function(_20){if(_20.touches&&_20.touches.length>0){_20=_20.touches[0];}var _21=_20.target;if(_4.hasClass(_21,"deleteBtn")){this.deleteRow(this._selectedRow);}else{if(_4.hasClass(_21,"cancelBtn")){this.cancelDelete();}else{return;}}_4.addClass(this._deleteBtns,"fade out");},applyClass:function(_22,idx,_23){_4.removeClass(_22,"first last");if(idx==0){_4.addClass(_22,"first");}if(idx==_23.length-1){_4.addClass(_22,"last");}},_setDataInfo:function(_24,_25){_25.item=_24._data;_25.index=_24._idx;},onSelect:function(_26,_27,_28){},_selectRow:function(row){if(this._deleting&&this._selectedRow&&row!=this._selectedRow){this.cancelDelete();}if(!_4.hasClass(row,"row")){return;}if(this.enableHold||this.enableDelete){_4.addClass(row,"hold");}this._selectedRow=row;},_deselectRow:function(){if(!this._selectedRow||this._deleting){return;}this.handleDragCancel();_4.removeClass(this._selectedRow,"hold");this._selectedRow=null;},_getRowNode:function(_29,_2a){while(_29&&!_29._data&&_29!=this.domNode){if(!_2a&&_4.hasClass(_29,"noclick")){return null;}_29=_29.parentNode;}return _29==this.domNode?null:_29;},applyTemplate:function(_2b,_2c){return _4._toDom(_4.string.substitute(_2b,_2c,this._replaceToken,this.formatters||this));},render:function(){_4.query("> *:not(.buttons)",this.domNode).forEach(_4.destroy);if(this.items.length<1&&this.emptyTemplate){_4.place(_4._toDom(this.emptyTemplate),this.domNode,"first");}else{this.domNode.appendChild(this._renderRange(0,this.items.length));}if(_4.hasClass(this.domNode.parentNode,"mblRoundRect")){_4.addClass(this.domNode.parentNode,"mblRoundRectList");}var _2d=_4.query("> .row",this.domNode);if(_2d.length>0){_4.addClass(_2d[0],"first");_4.addClass(_2d[_2d.length-1],"last");}},_renderRange:function(_2e,_2f){var _30=[];var row,i;var _31=document.createDocumentFragment();_2e=Math.max(0,_2e);_2f=Math.min(_2f,this.items.length);for(i=_2e;i<_2f;i++){row=this.applyTemplate(this.itemTemplate,this.items[i]);_4.addClass(row,"row");row._data=this.items[i];row._idx=i;_30.push(row);}if(!this.dividerFunction||!this.dividerTemplate){for(i=_2e;i<_2f;i++){_30[i]._data=this.items[i];_30[i]._idx=i;_31.appendChild(_30[i]);}}else{var _32=null;var _33;var _34;for(i=_2e;i<_2f;i++){_30[i]._data=this.items[i];_30[i]._idx=i;_33=this.dividerFunction(this.items[i]);if(_33&&_33!=_32){_34=this.applyTemplate(this.dividerTemplate,{label:_33,item:this.items[i]});_34._isDivider=true;_31.appendChild(_34);_32=_33;}_31.appendChild(_30[i]);}}return _31;},_replaceToken:function(_35,key){if(key.charAt(0)=="!"){_35=_4.getObject(key.substr(1),false,_this);}if(typeof _35=="undefined"){return "";}if(_35==null){return "";}return key.charAt(0)=="!"?_35:_35.toString().replace(/"/g,"&quot;");},_checkLoadComplete:function(){this._templateLoadCount--;if(this._templateLoadCount<1&&this.get("items")){this.render();}},_loadTemplate:function(url,_36,_37){if(!url){_37();return;}if(_7[url]){this.set(_36,_7[url]);_37();}else{var _38=this;_4.xhrGet({url:url,sync:false,handleAs:"text",load:function(_39){_7[url]=_4.trim(_39);_38.set(_36,_7[url]);_37();}});}},_setFormattersAttr:function(_3a){this.formatters=_3a;},_setItemsAttr:function(_3b){this.items=_3b||[];if(this._templateLoadCount<1&&_3b){this.render();}},destroy:function(){if(this.buttons){_4.forEach(this.buttons,function(_3c){_3c.destroy();});this.buttons=null;}this.inherited(arguments);}});})();}}};});