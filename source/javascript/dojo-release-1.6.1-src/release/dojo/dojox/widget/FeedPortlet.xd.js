/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


realitybuilderDojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.widget.FeedPortlet"],["require","dojox.widget.Portlet"],["require","dijit.Tooltip"],["require","dijit.form.TextBox"],["require","dijit.form.Button"],["require","dojox.data.GoogleFeedStore"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.widget.FeedPortlet"]){_4._hasResource["dojox.widget.FeedPortlet"]=true;_4.provide("dojox.widget.FeedPortlet");_4.require("dojox.widget.Portlet");_4.require("dijit.Tooltip");_4.require("dijit.form.TextBox");_4.require("dijit.form.Button");_4.require("dojox.data.GoogleFeedStore");_4.declare("dojox.widget.FeedPortlet",_6.widget.Portlet,{local:false,maxResults:5,url:"",openNew:true,showFeedTitle:true,postCreate:function(){this.inherited(arguments);if(this.local&&!_6.data.AtomReadStore){throw Error(this.declaredClass+": To use local feeds, you must include dojox.data.AtomReadStore on the page.");}},onFeedError:function(){this.containerNode.innerHTML="Error accessing the feed.";},addChild:function(_7){this.inherited(arguments);var _8=_7.attr("feedPortletUrl");if(_8){this.set("url",_8);}},_getTitle:function(_9){var t=this.store.getValue(_9,"title");return this.local?t.text:t;},_getLink:function(_a){var l=this.store.getValue(_a,"link");return this.local?l.href:l;},_getContent:function(_b){var c=this.store.getValue(_b,"summary");if(!c){return null;}if(this.local){c=c.text;}c=c.split("<script").join("<!--").split("</script>").join("-->");c=c.split("<iframe").join("<!--").split("</iframe>").join("-->");return c;},_setUrlAttr:function(_c){this.url=_c;if(this._started){this.load();}},startup:function(){if(this.started||this._started){return;}this.inherited(arguments);if(!this.url||this.url==""){throw new Error(this.id+": A URL must be specified for the feed portlet");}if(this.url&&this.url!=""){this.load();}},load:function(){if(this._resultList){_4.destroy(this._resultList);}var _d,_e;if(this.local){_d=new _6.data.AtomReadStore({url:this.url});_e={};}else{_d=new _6.data.GoogleFeedStore();_e={url:this.url};}var _f={query:_e,count:this.maxResults,onComplete:_4.hitch(this,function(_10){if(this.showFeedTitle&&_d.getFeedValue){var _11=this.store.getFeedValue("title");if(_11){this.set("title",_11.text?_11.text:_11);}}this.generateResults(_10);}),onError:_4.hitch(this,"onFeedError")};this.store=_d;_d.fetch(_f);},generateResults:function(_12){var _13=this.store;var _14;var ul=(this._resultList=_4.create("ul",{"class":"dojoxFeedPortletList"},this.containerNode));_4.forEach(_12,_4.hitch(this,function(_15){var li=_4.create("li",{innerHTML:"<a href=\""+this._getLink(_15)+"\""+(this.openNew?" target=\"_blank\"":"")+">"+this._getTitle(_15)+"</a>"},ul);_4.connect(li,"onmouseover",_4.hitch(this,function(evt){if(_14){clearTimeout(_14);}_14=setTimeout(_4.hitch(this,function(){_14=null;var _16=this._getContent(_15);if(!_16){return;}var _17="<div class=\"dojoxFeedPortletPreview\">"+_16+"</div>";_4.query("li",ul).forEach(function(_18){if(_18!=evt.target){_5.hideTooltip(_18);}});_5.showTooltip(_17,li.firstChild,!this.isLeftToRight());}),500);}));_4.connect(li,"onmouseout",function(){if(_14){clearTimeout(_14);_14=null;}_5.hideTooltip(li.firstChild);});}));this.resize();}});_4.declare("dojox.widget.ExpandableFeedPortlet",_6.widget.FeedPortlet,{onlyOpenOne:false,generateResults:function(_19){var _1a=this.store;var _1b="dojoxPortletToggleIcon";var _1c="dojoxPortletItemCollapsed";var _1d="dojoxPortletItemOpen";var _1e;var ul=(this._resultList=_4.create("ul",{"class":"dojoxFeedPortletExpandableList"},this.containerNode));_4.forEach(_19,_4.hitch(this,_4.hitch(this,function(_1f){var li=_4.create("li",{"class":_1c},ul);var _20=_4.create("div",{style:"width: 100%;"},li);var _21=_4.create("div",{"class":"dojoxPortletItemSummary",innerHTML:this._getContent(_1f)},li);_4.create("span",{"class":_1b,innerHTML:"<img src='"+_4.config.baseUrl+"/resources/blank.gif'>"},_20);var a=_4.create("a",{href:this._getLink(_1f),innerHTML:this._getTitle(_1f)},_20);if(this.openNew){_4.attr(a,"target","_blank");}})));_4.connect(ul,"onclick",_4.hitch(this,function(evt){if(_4.hasClass(evt.target,_1b)||_4.hasClass(evt.target.parentNode,_1b)){_4.stopEvent(evt);var li=evt.target.parentNode;while(li.tagName!="LI"){li=li.parentNode;}if(this.onlyOpenOne){_4.query("li",ul).filter(function(_22){return _22!=li;}).removeClass(_1d).addClass(_1c);}var _23=_4.hasClass(li,_1d);_4.toggleClass(li,_1d,!_23);_4.toggleClass(li,_1c,_23);}}));}});_4.declare("dojox.widget.PortletFeedSettings",_6.widget.PortletSettings,{"class":"dojoxPortletFeedSettings",urls:null,selectedIndex:0,buildRendering:function(){var s;if(this.urls&&this.urls.length>0){console.log(this.id+" -> creating select with urls ",this.urls);s=_4.create("select");if(this.srcNodeRef){_4.place(s,this.srcNodeRef,"before");_4.destroy(this.srcNodeRef);}this.srcNodeRef=s;_4.forEach(this.urls,function(url){_4.create("option",{value:url.url||url,innerHTML:url.label||url},s);});}if(this.srcNodeRef.tagName=="SELECT"){this.text=this.srcNodeRef;var div=_4.create("div",{},this.srcNodeRef,"before");div.appendChild(this.text);this.srcNodeRef=div;_4.query("option",this.text).filter("return !item.value;").forEach("item.value = item.innerHTML");if(!this.text.value){if(this.content&&this.text.options.length==0){this.text.appendChild(this.content);}_4.attr(s||this.text,"value",this.text.options[this.selectedIndex].value);}}this.inherited(arguments);},_setContentAttr:function(){},postCreate:function(){console.log(this.id+" -> postCreate");if(!this.text){var _24=this.text=new _5.form.TextBox({});_4.create("span",{innerHTML:"Choose Url: "},this.domNode);this.addChild(_24);}this.addChild(new _5.form.Button({label:"Load",onClick:_4.hitch(this,function(){this.portlet.attr("url",(this.text.tagName=="SELECT")?this.text.value:this.text.attr("value"));if(this.text.tagName=="SELECT"){_4.some(this.text.options,_4.hitch(this,function(opt,idx){if(opt.selected){this.set("selectedIndex",idx);return true;}return false;}));}this.toggle();})}));this.addChild(new _5.form.Button({label:"Cancel",onClick:_4.hitch(this,"toggle")}));this.inherited(arguments);},startup:function(){if(this._started){return;}console.log(this.id+" -> startup");this.inherited(arguments);if(!this.portlet){throw Error(this.declaredClass+": A PortletFeedSettings widget cannot exist without a Portlet.");}if(this.text.tagName=="SELECT"){_4.forEach(this.text.options,_4.hitch(this,function(opt,_25){_4.attr(opt,"selected",_25==this.selectedIndex);}));}var url=this.portlet.attr("url");if(url){if(this.text.tagName=="SELECT"){if(!this.urls&&_4.query("option[value='"+url+"']",this.text).length<1){_4.place(_4.create("option",{value:url,innerHTML:url,selected:"true"}),this.text,"first");}}else{this.text.attr("value",url);}}else{this.portlet.attr("url",this.get("feedPortletUrl"));}},_getFeedPortletUrlAttr:function(){return this.text.value;}});}}};});