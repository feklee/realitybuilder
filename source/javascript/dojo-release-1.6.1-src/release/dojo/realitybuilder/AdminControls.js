/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["realitybuilder.AdminControls"]){dojo._hasResource["realitybuilder.AdminControls"]=true;dojo.provide("realitybuilder.AdminControls");dojo.require("dojox.date.posix");dojo.declare("realitybuilder.AdminControls",null,{_construction:null,constructor:function(_1){this._construction=_1;dojo.byId("bottomBar").style.width=_1.camera().sensor().width()+"px";this.updateToggleRealButton();this.updateTogglePendingButton();dojo.connect(dojo.byId("saveSettingsButton"),"onclick",this._construction,this._construction.storeSettingsOnServer);dojo.connect(dojo.byId("previewCameraButton"),"onclick",this,this.updateCamera);dojo.connect(dojo.byId("toggleRealButton"),"onclick",this._construction,this._construction.toggleReal);dojo.connect(dojo.byId("togglePendingButton"),"onclick",this._construction,this._construction.togglePending);dojo.connect(dojo.byId("logoutButton"),"onclick",this,this.logOut);dojo.connect(dojo.byId("setPrerenderedBlockConfigurationButton"),"onclick",this,this.setPrerenderedBlockConfiguration);dojo.connect(dojo.byId("prevPrerenderedBlockConfigurationButton"),"onclick",this,this.prevPrerenderedBlockConfiguration);dojo.connect(dojo.byId("nextPrerenderedBlockConfigurationButton"),"onclick",this,this.nextPrerenderedBlockConfiguration);},logOut:function(){location.href=logoutUrl;},updateToggleRealButton:function(){dojo.byId("toggleRealButton").innerHTML=(this._construction.showReal()?"Hide":"Show")+" Real Blocks";},updateTogglePendingButton:function(){dojo.byId("togglePendingButton").innerHTML=(this._construction.showPending()?"Hide":"Show")+" Pending Blocks";},updateCameraControls:function(_2){var _3=_2.position();dojo.byId("cameraXTextField").value=_3[0];dojo.byId("cameraYTextField").value=_3[1];dojo.byId("cameraZTextField").value=_3[2];dojo.byId("cameraAXTextField").value=_2.aX();dojo.byId("cameraAYTextField").value=_2.aY();dojo.byId("cameraAZTextField").value=_2.aZ();dojo.byId("cameraFlTextField").value=_2.fl();dojo.byId("cameraSensorResolutionTextField").value=_2.sensorResolution();},updateImageControls:function(_4){dojo.byId("imageUrlTextField").value=_4.url();dojo.byId("imageUpdateIntervalServerTextField").value=_4.updateIntervalServer();},updatePrerenderModeControls:function(){var _5=this._construction.prerenderMode();if(_5.isEnabled()){dojo.byId("prerenderedBlockConfigurationTextField").value=_5.i();dojo.style("prerenderedBlockConfigurations","display","block");}else{dojo.style("prerenderedBlockConfigurations","display","none");}},setPrerenderedBlockConfiguration:function(){var _6,i;_6=this._construction.prerenderMode();i=parseInt(dojo.byId("prerenderedBlockConfigurationTextField").value,10);_6.loadBlockConfigurationOnServer(i);},prevPrerenderedBlockConfiguration:function(){var _7=this._construction.prerenderMode();_7.loadPrevBlockConfigurationOnServer();},nextPrerenderedBlockConfiguration:function(){var _8=this._construction.prerenderMode();_8.loadNextBlockConfigurationOnServer();},readImageControls:function(){var _9={"url":dojo.byId("imageUrlTextField").value||"","updateIntervalServer":parseFloat(dojo.byId("imageUpdateIntervalServerTextField").value)||5};return _9;},readCameraControls:function(){var _a={"position":[parseFloat(dojo.byId("cameraXTextField").value)||0,parseFloat(dojo.byId("cameraYTextField").value)||0,parseFloat(dojo.byId("cameraZTextField").value)||0],"aX":parseFloat(dojo.byId("cameraAXTextField").value)||0,"aY":parseFloat(dojo.byId("cameraAYTextField").value)||0,"aZ":parseFloat(dojo.byId("cameraAZTextField").value)||0,"fl":parseFloat(dojo.byId("cameraFlTextField").value)||1,"sensorResolution":parseFloat(dojo.byId("cameraSensorResolutionTextField").value)||100};return _a;},updateCamera:function(){this._construction.camera().update(this.readCameraControls());},updateCoordinateDisplays:function(){var _b,a;_b=this._construction.newBlock().positionB();a=this._construction.newBlock().a();dojo.byId("newBlockXB").innerHTML=_b[0].toString();dojo.byId("newBlockYB").innerHTML=_b[1].toString();dojo.byId("newBlockZB").innerHTML=_b[2].toString();dojo.byId("newBlockA").innerHTML=a.toString();},_sortForTable:function(x,y){if(x.state()===y.state()){if(x.timeStamp()>y.timeStamp()){return -1;}else{if(x.timeStamp()<y.timeStamp()){return 1;}else{return 0;}}}else{if(x.state()===1){return -1;}else{if(x.state()===2){return y.state()===1?1:-1;}else{return 1;}}}},_blocksSortedForTable:function(){var _c=dojo.map(this._construction.constructionBlocks().blocks(),function(_d){return _d;});_c.sort(this._sortForTable);return _c;},_applyStateFromStateSelector:function(_e,_f){this._construction.constructionBlocks().setBlockStateOnServer(_f.positionB(),_f.a(),parseInt(_e.value,10));},_stateSelector:function(_10){var _11=document.createElement("select"),_12=["Deleted","Pending","Real"],_13,_14,_15;dojo.attr(_11,"size",1);for(_13=0;_13<3;_13+=1){_14=_12[_13];_15=document.createElement("option");dojo.attr(_15,"value",_13);if(_13===_10.state()){dojo.attr(_15,"selected","");}_15.innerHTML=_14;_11.appendChild(_15);}dojo.connect(_11,"onchange",this,function(_16){this._applyStateFromStateSelector(_11,_10);});return _11;},_appendBlocksTableRow:function(_17,_18){var _19,row,_1a,_1b,_1c,_1d;_19=_17.positionB();row=document.createElement("tr");_1a=new Date(_17.timeStamp()*1000);_1b=dojox.date.posix.strftime(_1a,"%Y-%m-%d %H:%M:%S");_1c=[_19[0],_19[1],_19[2],_17.a(),_1b,this._stateSelector(_17)];dojo.forEach(_1c,function(_1e,i){_1d=document.createElement("td");if(i<5){_1d.innerHTML=_1e;}else{_1d.appendChild(_1e);}if(i<4){dojo.addClass(_1d,"number");}row.appendChild(_1d);});_18.appendChild(row);},updateBlocksTable:function(){var _1f=dojo.query("#blocksTable tbody"),_20=_1f[0],_21=this._blocksSortedForTable(),_22=this;dojo.empty(_20);dojo.forEach(_21,function(_23){_22._appendBlocksTableRow(_23,_20);});}});}